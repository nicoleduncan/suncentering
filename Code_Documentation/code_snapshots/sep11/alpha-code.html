<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:55:48 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>alpha.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="alpha.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">; docformat = 'rst'</span>
PRO alpha
<span class="comments">;+</span>
<span class="comments">;   :Description:</span>
<span class="comments">;      Finds the center of N whole suns and M partial suns using limb-fitting for the whole suns and simple centroiding for the partial suns</span>
<span class="comments">;</span>
<span class="comments">;   :Params:</span>
<span class="comments">;</span>
<span class="comments">;   :TODO: </span>
<span class="comments">;       NONE, BRAH</span>
<span class="comments">;</span>
<span class="comments">; idldoc,root='../suncentering', output='doc_lib',format_style='rst',/user,/quiet,markup_style='rst'</span>
<span class="comments">;-</span>
COMPILE_OPT idl2
ON_ERROR,1

<span class="comments">; Our list of images to take centers of</span>
wholeimage  = MRDFITS('../fits_files/dottedimage.fits',/sil)
w1_w2_p3    = MRDFITS('../fits_files/partial3rd.fits',/sil)
w1_p2_p3    = MRDFITS('../fits_files/2partials.fits',/sil)
reg12       = MRDFITS('../fits_files/1_2.fits',/sil)
reg13       = MRDFITS('../fits_files/1_3.fits',/sil)
reg23       = MRDFITS('../fits_files/2_3.fits',/sil)
w2_p3       = MRDFITS('../fits_files/w2_p3.fits',/sil)
p1_w2_w3    = MRDFITS('../fits_files/p1_w2_w3.fits',/sil)
p1_w2_p3    = MRDFITS('../fits_files/p1_w2_p3.fits',/sil)
p1_p2_w3    = MRDFITS('../fits_files/p1_p2_w3.fits',/sil)
w1_p2_w3    = MRDFITS('../fits_files/w1_p2_w3.fits',/sil)
p1_w3       = MRDFITS('../fits_files/p1_w3.fits',/sil)
p1_w2       = MRDFITS('../fits_files/p1_w2.fits',/sil)
w1_p3       = MRDFITS('../fits_files/w1_p3.fits',/sil)
brightsun   = MRDFITS('../fits_files/albsun.fits',/sil)
corner      = MRDFITS('../fits_files/corner.fits',/sil)
corner2     = MRDFITS('../fits_files/corner2.fits',/sil)
corner3     = MRDFITS('../fits_files/corner3.fits',/sil)
dimsun      = MRDFITS('../fits_files/sun2.fits',/sil)
tritest     = MRDFITS('../fits_files/tritest.fits',/sil)

<span class="comments">; Toggling which image is going to be analyzed</span>

startimage=wholeimage
<span class="comments">; startimage=w1_w2_p3</span>
<span class="comments">; startimage=w1_p2_p3</span>
<span class="comments">; startimage=reg12</span>
<span class="comments">; startimage=reg23</span>
<span class="comments">; startimage=reg13</span>
<span class="comments">; startimage=w2_p3</span>
<span class="comments">; startimage=p1_w2_w3</span>
<span class="comments">; startimage=p1_w2_p3</span>
<span class="comments">; startimage=p1_p2_w3</span>
<span class="comments">; startimage=w1_p2_w3</span>
<span class="comments">; startimage=p1_w3</span>
<span class="comments">; startimage=p1_w2</span>
<span class="comments">; startimage=w1_p3</span>
<span class="comments">; startimage=brightsun   ;no param list for this one</span>
startimage = dimsun
startimage = tritest

<span class="comments">; profiler</span>
<span class="comments">; profiler,/system</span>

<span class="comments">; takes ~.07 s to run albert's triple sun image</span>

tic
defparams, 'pblock_albtritest.txt'
<span class="comments">; defparams, 'pblock_albdimsun.txt'</span>
<span class="comments">; defparams, 'pblock_orig_small.txt'</span>
toc
<span class="comments">; .0005 to here</span>
defsysvarthresh, startimage
toc
<span class="comments">; .03 to here</span>
grannysmith = everysun(startimage)
toc
<span class="comments">; .065 to here</span>
fuji = picksun_rot(startimage, grannysmith)
toc
<span class="comments">; .065 to here</span>
limbfittedcentroids=centroidwholesuns(fuji,startimage)
toc
<span class="comments">; .068 to here</span>
bbb = para_fid(startimage,limbfittedcentroids)
<span class="comments">; .07 to here</span>
toc
<span class="comments">; newlimbfittedcentroids=centroidwholesuns(limbfittedcentroids,startimage,bbb)</span>
<span class="comments">; toc</span>
best4 = best4(limbfittedcentroids,bbb)
<span class="comments">; .078 to here</span>
toc

tmpimage = startimage

if N_ELEMENTS(limbfittedcentroids) gt 1 then begin
    for i =0,N_ELEMENTS(limbfittedcentroids)-1 do begin
        tmpimage[limbfittedcentroids[i].limbxpos-1:limbfittedcentroids[i].limbxpos+1,*] = 255
        tmpimage[*,limbfittedcentroids[i].limbypos-1:limbfittedcentroids[i].limbypos+1] = 255
    endfor
endif else begin
    tmpimage[limbfittedcentroids[0].limbxpos-1:limbfittedcentroids[0].limbxpos+1,*] = 255
    tmpimage[*,limbfittedcentroids[0].limbypos-1:limbfittedcentroids[0].limbypos+1] = 255
endelse

<span class="comments">; so the rough center is a bit off. Gasp! Why though?</span>

<span class="comments">; profiler,/report,data=data</span>
<span class="comments">; profiler,/reset,/clear</span>
<span class="comments">; print,data[sort(-data.time)],format='(A-20, I7, F12.5, F10.5, I9)'</span>

atmp = startimage

<span class="comments">; So I have to highlight fiducials</span>

for i = 0,N_ELEMENTS(bbb)-1 do begin
    for j = 0,N_ELEMENTS((*(bbb[i])).fidarr)-1 do begin

        if ((*(bbb[i])).fidarr)[j].subx ne 0 or ((*(bbb[i])).fidarr)[j].suby ne 0 then begin
        atmp[((*(bbb[i])).fidarr)[j].subx + limbfittedcentroids[i].limbxpos - !param.crop_box -1:((*(bbb[i])).fidarr)[j].subx + limbfittedcentroids[i].limbxpos - !param.crop_box+1,((*(bbb[i])).fidarr)[j].suby + limbfittedcentroids[i].limbypos - !param.crop_box-1:((*(bbb[i])).fidarr)[j].suby + limbfittedcentroids[i].limbypos - !param.crop_box+1]=255
        endif
    endfor
endfor

<span class="comments">; print,'Main sun x pos:',limbfittedcentroids[0].limbxpos</span>
<span class="comments">; print,'Main sun y pos:',limbfittedcentroids[0].limbypos</span>
<span class="comments">; print,'50% sun x pos: ',limbfittedcentroids[1].limbxpos</span>
<span class="comments">; print,'50% sun y pos: ',limbfittedcentroids[1].limbypos</span>
<span class="comments">; print,'25% sun x pos: ',limbfittedcentroids[2].limbxpos</span>
<span class="comments">; print,'25% sun y pos: ',limbfittedcentroids[2].limbypos</span>

window,0
cgimage,tmpimage,/k
window,1
cgimage,atmp,/k

ztmp = startimage
<span class="comments">; Highlight the best 4 fiducials for each sun </span>
for i = 0,n_elements(best4)-1 do begin
    for j = 0,n_elements(best4[i].fidarr)-1 do begin
        ztmp[best4[i].fidarr[j].subx + limbfittedcentroids[i].limbxpos - !param.crop_box -1:best4[i].fidarr[j].subx + limbfittedcentroids[i].limbxpos - !param.crop_box+1,$
            best4[i].fidarr[j].suby + limbfittedcentroids[i].limbypos - !param.crop_box-1:$
            best4[i].fidarr[j].suby + limbfittedcentroids[i].limbypos - !param.crop_box+1]=255
    endfor
endfor
window,2
cgimage,ztmp,/k


print,'Brightest sun center position: ',limbfittedcentroids[0].limbxpos,limbfittedcentroids[0].limbypos
print,'50% sun center position: ',limbfittedcentroids[1].limbxpos,limbfittedcentroids[1].limbypos
print,'25% sun center position: ',limbfittedcentroids[2].limbxpos,limbfittedcentroids[2].limbypos


stop
idedfids = idfids(best4)



<span class="comments">; What's going on here?</span>

<span class="comments">; cgimage,startimage[limbfittedcentroids[0].limbxpos- !param.crop_box:limbfittedcentroids[0].limbxpos+ !param.crop_box,limbfittedcentroids[0].limbypos- !param.crop_box:limbfittedcentroids[0].limbypos+ !param.crop_box],output='tritest_reg1.eps',/k,/display</span>
<span class="comments">; cgimage,startimage[limbfittedcentroids[1].limbxpos- !param.crop_box:limbfittedcentroids[1].limbxpos+ !param.crop_box,limbfittedcentroids[1].limbypos- !param.crop_box:limbfittedcentroids[1].limbypos+ !param.crop_box],output='tritest_reg2.eps',/k,/display</span>
<span class="comments">; cgimage,startimage[limbfittedcentroids[2].limbxpos- !param.crop_box:limbfittedcentroids[2].limbxpos+ !param.crop_box,limbfittedcentroids[2].limbypos- !param.crop_box:limbfittedcentroids[2].limbypos+ !param.crop_box],output='tritest_reg3.eps',/k,/display</span>

<span class="comments">; aa = startimage</span>

<span class="comments">; aa[*,limbfittedcentroids[0].limbypos -20]=255</span>
<span class="comments">; aa[*,limbfittedcentroids[0].limbypos -10]=255</span>
<span class="comments">; aa[*,limbfittedcentroids[0].limbypos]=255</span>
<span class="comments">; aa[*,limbfittedcentroids[0].limbypos +10]=255</span>
<span class="comments">; aa[*,limbfittedcentroids[0].limbypos +20]=255</span>

<span class="comments">; aa = aa[limbfittedcentroids[0].limbxpos- !param.crop_box:limbfittedcentroids[0].limbxpos+ !param.crop_box,limbfittedcentroids[0].limbypos- !param.crop_box:limbfittedcentroids[0].limbypos+ !param.crop_box]</span>
<span class="comments">; cgimage,aa,/k,/display,output='5chords.eps'</span>

stop

end
</code>
    </div>
  </body>
</html>