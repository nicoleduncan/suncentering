<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:19 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>arcbar.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="arcbar.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source">Pro arcbar, hdr, arclen, LABEL = label, SIZE = size, THICK = thick, DATA =data, $
            COLOR = color, POSITION = position, NORMAL = normal, $
            SECONDS=SECONDS, FONT=font
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;       ARCBAR</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;       Draw an arc bar on an image showing the astronomical plate scale</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;       ARCBAR, hdr, arclen,[  COLOR= , /DATA, LABEL= , /NORMAL, POSITION =, </span>
<span class="comments">;                              /SECONDS, SIZE=, THICK=, FONT= ]</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;       hdr - image FITS header with astrometry, string array</span>
<span class="comments">;       arclen - numeric scalar giving length of bar in arcminutes (default)</span>
<span class="comments">;               or arcseconds (if /SECONDS is set) </span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL KEYWORD INPUTS:</span>
<span class="comments">;       COLOR - name  or integer scalar specifying the color to draw the arcbar </span>
<span class="comments">;               See cgColor for a list of available color names</span>
<span class="comments">;       /DATA - if set and non-zero, then the POSITION keyword is given in data</span>
<span class="comments">;              units</span>
<span class="comments">;       LABEL - string giving user defined label for bar.  Default label is size</span>
<span class="comments">;               of bar in arcminutes</span>
<span class="comments">;       /NORMAL - if this keyword is set and non-zero, then POSITION is given in</span>
<span class="comments">;               normalized units</span>
<span class="comments">;       POSITION - 2 element vector giving the (X,Y) position in device units </span>
<span class="comments">;               (or normalized units if /NORMAL is set, or data units if /DATA</span>
<span class="comments">;               is set) at which to place the  scale bar.   If not supplied, </span>
<span class="comments">;               then the user will be prompted to place the cursor at the </span>
<span class="comments">;               desired position</span>
<span class="comments">;       /SECONDS - if set, then arlen is specified in arcseconds rather than</span>
<span class="comments">;               arcminutes</span>
<span class="comments">;       SIZE  - scalar specifying character size of label, default = 1.0</span>
<span class="comments">;       THICK -  Character thickness of the label, default = !P.THICK</span>
<span class="comments">;       FONT - scalar font graphics keyword (-1,0 or 1) for text</span>
<span class="comments">;</span>
<span class="comments">; EXAMPLE:</span>
<span class="comments">;       Place a 3' arc minute scale bar, at position 300,200 of the current</span>
<span class="comments">;       image window, (which is associated with a FITS header, HDR)</span>
<span class="comments">;</span>
<span class="comments">;       IDL> arcbar, HDR, 3, pos = [300,200]</span>
<span class="comments">;</span>
<span class="comments">; RESTRICTIONS:</span>
<span class="comments">;       When using using a device with scalable pixels (e.g. postscript)</span>
<span class="comments">;       the data coordinate system must be established before calling ARCBAR.</span>
<span class="comments">;       If data coordinates are not set, then ARCBAR assumes that the displayed</span>
<span class="comments">;       image size is given by the NAXIS1 keyword in the FITS header.</span>
<span class="comments">; PROCEDURE CALLS:</span>
<span class="comments">;       AD2XY, EXTAST, GSSSADXY, SXPAR(), cgPlot, cgText</span>
<span class="comments">; REVISON HISTORY:</span>
<span class="comments">;       written by L. Taylor (STX) from ARCBOX (Boothman)</span>
<span class="comments">;       modified for Version 2 IDL,                     B. Pfarr, STX, 4/91</span>
<span class="comments">;       New ASTROMETRY structures               W.Landsman,  HSTX, Jan 94</span>
<span class="comments">;       Recognize a GSSS header                 W. Landsman June 94</span>
<span class="comments">;       Added /NORMAL keyword                   W. Landsman Feb. 96</span>
<span class="comments">;       Use NAXIS1 for postscript if data coords not set,  W. Landsman Aug 96</span>
<span class="comments">;       Fixed typo for postscript W. Landsman   Oct. 96</span>
<span class="comments">;       Account for zeropoint offset in postscript  W. Landsman   Apr 97</span>
<span class="comments">;       Added /DATA, /SECONDS keywords   W. Landsman    July 1998</span>
<span class="comments">;       Use device-independent label offset  W. Landsman   August 2001</span>
<span class="comments">;       Allow font keyword to be passed.  T. Robishaw Apr. 2006</span>
<span class="comments">;       Remove obsolete TVCURSOR command  W. Landsman Jul 2007</span>
<span class="comments">;       Use Coyote Graphics W. Landsman  February 2011</span>
<span class="comments">;-</span>
<span class="comments">;</span>
 compile_opt idl2
 On_error,2                                  <span class="comments">;Return to caller</span>

 if N_params() LT 1 then begin
      print, 'Syntax - ARCBAR, hdr,[ arclen, COLOR= '
      print, '         /DATA, LABEL=, /NORM, POS=, /SECONDS, SIZE=, THICK= ]'
      return
 endif

 extast, hdr, bastr, noparams   <span class="comments">;extract astrom params in deg.</span>

 if N_params() LT 2 then arclen = 1      <span class="comments">;default size = 1 arcmin</span>

 setdefaultvalue,size, 1.0
 setdefaultvalue, thick, !P.THICK
 setdefaultvalue, size, 1.0
 setdefaultvalue, thick, !P.THICK
 setdefaultvalue, font, !P.FONT

 a = bastr.crval[0]
 d = bastr.crval[1]
 if keyword_set(seconds) then factor = 3600.0d else factor = 60.0
 d1 = d + (1/factor)             <span class="comments">;compute x,y of crval + 1 arcmin</span>

 proj = strmid(bastr.ctype[0],5,3)
  
 case proj of 
        'GSS': gsssadxy, bastr, [a,a], [d,d1], x, y
        else:  ad2xy, [a,a], [d,d1], bastr, x, y 
 endcase

 dmin = sqrt( (x[1]-x[0])^2 + (y[1]-y[0])^2 ) <span class="comments">;det. size in pixels of 1 arcmin</span>

 if (!D.FLAGS AND 1) EQ 1 then begin          <span class="comments">;Device have scalable pixels?</span>
        if !X.s[1] NE 0 then begin
                dmin = convert_coord( dmin, 0, /DATA, /TO_DEVICE) - $ 
                       convert_coord(    0, 0, /DATA, /TO_DEVICE)  <span class="comments">;Fixed Apr 97</span>
                dmin = dmin[0]
        endif else dmin = dmin/sxpar(hdr, 'NAXIS1' )     <span class="comments">;Fixed Oct. 96</span>
 endif 

 dmini2 = round(dmin * arclen)

 if ~keyword_set( POSITION) then begin
          print,'Position the cursor where you want the bar to begin'
          print,'Hit right mouse button when ready'
          cursor,xi,yi,1,/device
 endif else begin 
        if keyword_set(NORMAL) then begin
                posn = convert_coord(position,/NORMAL, /TO_DEVICE) 
                xi = posn[0] & yi = posn[1]
        endif else if keyword_set(DATA) then begin
                posn = convert_coord(position,/DATA, /TO_DEVICE) 
                xi = posn[0] & yi = posn[1]
        endif else begin
                xi = position[0]   & yi = position[1]
        endelse         
 endelse

 xf = xi + dmini2
 dmini3 = dmini2/10             <span class="comments">;Height of vertical end bars = total length/10.</span>

 cgPlots,[xi,xf],[yi,yi], COLOR=color, /DEV, THICK=thick
 cgPlots,[xf,xf],[ yi+dmini3, yi-dmini3 ], COLOR=color, /DEV, THICK=thick
 cgPlots,[xi,xi],[ yi+dmini3, yi-dmini3 ], COLOR=color, /DEV, THICK=thick

 if ~keyword_set(Seconds) then begin
 if (!D.NAME EQ 'PS') and (FONT EQ 0) then $        <span class="comments">;Postscript Font?</span>
        arcsym='!9'+string(162B)+'!X' else arcsym = "'" 
 endif else begin
 if (!D.NAME EQ 'PS') and (FONT EQ 0) then $        <span class="comments">;Postscript Font?</span>
        arcsym = '!9'+string(178B)+'!X' else arcsym = "''" 
 endelse
 if ~keyword_set( LABEL) then begin
     if (arclen LT 1) then arcstr = string(arclen,format='(f4.2)') $
        else arcstr = string(arclen)
     label = strtrim(arcstr,2) + arcsym 
 endif

 yoffset = round(!D.Y_CH_SIZE/2.)
 cgTEXT,(xi+xf)/2, yi+yoffset, label, SIZE = size,COLOR=color,/DEV,  $
       alignment=0.5, CHARTHICK=thick, FONT=font

 return
 end
</code>
    </div>
  </body>
</html>