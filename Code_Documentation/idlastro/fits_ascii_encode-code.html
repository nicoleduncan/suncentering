<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:30 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>fits_ascii_encode.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="fits_ascii_encode.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="fits_ascii_encode:source"></a>function fits_ascii_encode, sum32
<span class="comments">;+ </span>
<span class="comments">; NAME:</span>
<span class="comments">;    FITS_ASCII_ENCODE()</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;    Encode an unsigned longword as an ASCII string to insert in a FITS header</span>
<span class="comments">; EXPLANATION:</span>
<span class="comments">;     Follows the 23 May 2002 version of the FITS checksum proposal at </span>
<span class="comments">;     http://heasarc.gsfc.nasa.gov/docs/heasarc/fits/checksum.html   </span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;     result = FITS_ASCII_ENCODE( sum32)</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;     sum32 - 32bit *unsigned longword* (e.g. as returned by CHECKSUM32)</span>
<span class="comments">; RESULT:</span>
<span class="comments">;     A 16 character scalar string suitable for the CHECKSUM keyword</span>
<span class="comments">; EXAMPLE:</span>
<span class="comments">;      A FITS header/data unit has a checksum of 868229149.  Encode the </span>
<span class="comments">;      complement of this value (3426738146) into an ASCII string</span>
<span class="comments">;</span>
<span class="comments">;      IDL> print,FITS_ASCII_ENCODE(3426738146U)</span>
<span class="comments">;           ===> "hcHjjc9ghcEghc9g"</span>
<span class="comments">;</span>
<span class="comments">; METHOD:</span>
<span class="comments">;      The 32bit value is interpreted as a sequence of 4 unsigned 8 bit </span>
<span class="comments">;      integers, and divided by 4.    Add an offset of 48b (ASCII '0'). </span>
<span class="comments">;      Remove non-alphanumeric ASCII characters (byte values 58-64 and 91-96)</span>
<span class="comments">;      by simultaneously incrementing and decrementing the values in pairs.</span>
<span class="comments">;      Cyclicly shift the string one place to the right.</span>
<span class="comments">;                  </span>
<span class="comments">; REVISION HISTORY:</span>
<span class="comments">;     Written  W. Landsman  SSAI              December 2002</span>
<span class="comments">;-</span>
 if N_Params() LT 1 then begin
      print,'Syntax -  result = FITS_ASCII_ENCODE( sum32)'
      return,'0'
 endif
 
<span class="comments">; Non-alphanumeric ASCII characters  </span>
 exclude = [58b,59b,60b,61b,62b,63b,64b,91b,92b,93b,94b,95b,96b]
 ch = bytarr(16)
 t = byte(sum32,0,4)
 byteorder,t,/htonl
 quot = t/4 + 48b
 for i=0,12,4 do ch[i] = quot

 remain = t mod 4
 ch[0] = ch[0:3] + remain    <span class="comments">;Insert the remainder in the first 4 bytes</span>

<span class="comments">;Step through the 16 bytes, 8 at a time, removing nonalphanumeric  characters</span>
 repeat begin           
 check = 0b
  for j=0,1 do begin
 il = j*8
 for i=il,il+3 do begin
  bad = where( (exclude EQ ch[i]) or (exclude Eq ch[i+4]) , Nbad) 
   if Nbad GT 0 then begin
       ch[i] = ch[i]+1b
       ch[i+4] = ch[i+4] -1b
       check=1b
  endif
 endfor
 endfor
 endrep until (check EQ 0b)

  return, string( shift(ch,1))
  end

</code>
    </div>
  </body>
</html>