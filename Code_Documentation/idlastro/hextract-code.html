<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:41 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>hextract.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="hextract.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="hextract:source"></a>pro hextract, oldim, oldhd, newim, newhd, x0, x1, y0, y1, SILENT = silent, $
    ERRMSG = errmsg,ALT = alt  
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;       HEXTRACT</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;       Extract a subimage from an array and update astrometry in FITS header</span>
<span class="comments">; EXPLANATION:</span>
<span class="comments">;       Extract a subimage from an array and create a new FITS header with</span>
<span class="comments">;       updated astrometry for the subarray</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;       HEXTRACT, Oldim, Oldhd, [ Newim, Newhd, x0, x1, y0, y1, /SILENT ]</span>
<span class="comments">;               or</span>
<span class="comments">;       HEXTRACT, Oldim, Oldhd, [x0, x1, y0, y1, /SILENT, ERRMSG =  ]    </span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;       Oldim - the original image array</span>
<span class="comments">;       Oldhd - the original image header</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUTS:</span>
<span class="comments">;       x0, x1, y0, y1 - respectively, first and last X pixel, and first and</span>
<span class="comments">;       last Y pixel to be extracted from the original image, integer scalars.</span>
<span class="comments">;       HEXTRACT will convert these values to long integers. </span>
<span class="comments">;       If omitted,  HEXTRACT will prompt for these parameters</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL OUTPUTS:</span>
<span class="comments">;       Newim - the new subarray extracted from the original image </span>
<span class="comments">;       Newhd - header for newim containing updated astrometry info</span>
<span class="comments">;               If output parameters are not supplied or set equal to</span>
<span class="comments">;               -1, then the HEXTRACT will modify the input parameters </span>
<span class="comments">;               OLDIM and OLDHD to contain the subarray and updated header.</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUT KEYWORD:</span>
<span class="comments">;      ALT - Single character 'A' through 'Z' or ' ' specifying which astrometry</span>
<span class="comments">;          system to modify in the FITS header.    The default is to use the</span>
<span class="comments">;          primary astrometry or ALT = ' '.    See Greisen and Calabretta (2002)</span>
<span class="comments">;          for information about alternate astrometry keywords.</span>
<span class="comments">;      /SILENT - If set and non-zero, then a message describing the extraction</span>
<span class="comments">;               is not printed at the terminal.   This message can also be </span>
<span class="comments">;               suppressed by setting !QUIET.</span>
<span class="comments">; OPTIONAL KEYWORD OUTPUT:</span>
<span class="comments">;       ERRMSG - If this keyword is supplied, then any error mesasges will be</span>
<span class="comments">;               returned to the user in this parameter rather than depending on</span>
<span class="comments">;               on the MESSAGE routine in IDL.   If no errors are encountered</span>
<span class="comments">;               then a null string is returned.               </span>
<span class="comments">;</span>
<span class="comments">; PROCEDURE:</span>
<span class="comments">;       The FITS header parameters NAXIS1, NAXIS2, CRPIX1, and CRPIX2 are</span>
<span class="comments">;       updated for the extracted image.</span>
<span class="comments">;</span>
<span class="comments">; EXAMPLE:  </span>
<span class="comments">;       Read an image from a FITS file 'IMAGE', extract a 512 x 512 subimage </span>
<span class="comments">;       with the same origin, and write to a new FITS file 'IMAGENEW'</span>
<span class="comments">;</span>
<span class="comments">;       IDL> im = READFITS( 'IMAGE', hdr )      ;Read FITS files into IDL arrays</span>
<span class="comments">;       IDL> hextract, im, h, 0, 511, 0, 511    ;Extract 512 x 512 subimage</span>
<span class="comments">;       IDL> writefits, 'IMAGENEW', im ,h       ;Write subimage to a FITS file</span>
<span class="comments">;</span>
<span class="comments">; PROCEDURES CALLED</span>
<span class="comments">;       CHECK_FITS, STRN(), SXPAR(), SXADDPAR, SXADDHIST</span>
<span class="comments">; MODIFICATION HISTORY:</span>
<span class="comments">;       Written, Aug. 1986 W. Landsman, STX Corp.</span>
<span class="comments">;       Use astrometry structure,   W. Landsman      Jan, 1994</span>
<span class="comments">;       Minor fix if bad Y range supplied   W. Landsman    Feb, 1996</span>
<span class="comments">;       Added /SILENT keyword              W. Landsman     March, 1997</span>
<span class="comments">;       Added ERRMSG keyword    W. Landsman   May 2000</span>
<span class="comments">;       Work for dimensions larger than 32767   W.L., M.Symeonidis Mar 2007</span>
<span class="comments">;       Added ALT keyword  W.L. April 2007</span>
<span class="comments">;- </span>
 On_error, 2
 compile_opt idl2
 npar = N_params()

 if (npar EQ 3) or (npar LT 2) then begin       <span class="comments">;Check # of parameters</span>
    print,'Syntax - HEXTRACT, oldim, oldhd, [ newim, newhd, x0, x1, y0, y1]'
    print,'   or    HEXTRACT, oldim, oldhd, x0, x1, y0, y1, [/SILENT, ERRMSG=]'
    return
 endif
 
 save_err = arg_present(errmsg)      <span class="comments">;Does user want to return error messages?</span>
<span class="comments">;                                    Check for valid 2-D image & header</span>
  check_FITS, oldim, oldhd, dimen, /NOTYPE, ERRMSG = errmsg
  if errmsg NE '' then begin
        if not save_err then message,'ERROR - ' + errmsg,/CON
        return
  endif

  if N_elements(dimen) NE 2 then begin 
           errmsg = 'Input image array must be 2-dimensional'
           if not save_err then message,'ERROR - ' + errmsg,/CON
           return
  endif

  xsize = dimen[0]  &  ysize = dimen[1]


 if ( npar LT 4 ) then Update = 1 else Update = 0     <span class="comments">;Update old array?</span>

 if ( npar EQ 6 ) then begin                 <span class="comments">;Alternative calling sequence ?</span>

     if ( N_elements(newim) EQ 1 ) and ( N_elements(newhd) EQ 1 ) and $
        ( N_elements(x0) EQ 1 ) and ( N_elements(x1) EQ 1 ) then begin
              y0 = x0   &  y1 = x1
              x0 = newim   &   x1 = newhd
              Update = 1
      endif 

 endif

 RDX: 
 if ( npar LE 5 )  then begin

      message, /INF, $ 
           'Original array size is ' + strn(xsize) + ' by ' + strn(ysize) 
      x0 = 0l & x1 = 0l
      read,'% HEXTRACT: Enter first and last X pixel to be extracted: ',x0,x1

 endif

 if ( x1 LT x0 ) or ( x0 LT 0 ) or ( x1 GE xsize ) then begin

     message,'ERROR - Illegal pixel range: X direction',  /CON
     print, ' '
     message, /INF,   $
     ' Legal Range is 0 &lt; First Pixel &lt; Last Pixel &lt; ' + strn(xsize-1)
     if update then npar = npar &lt<span class="comments">; 2 else npar = npar &lt; 4</span>
     goto, RDX 

 endif

 RDY: if ((not update) and ( npar LE 7 )) or (update and (npar LT 6) ) then $ 
    read,'% HEXTRACT: Enter first and last Y pixel to be extracted: ',y0,y1

 if ( y1 LT y0 ) or ( y0 LT 0 ) or ( y1 GE ysize ) then begin

     message,'ERROR - Illegal pixel range: Y direction', /CON
     message, /INF,     $ 
      'Legal Range is 0 &lt; First Pixel &lt; Last Pixel &lt; ' + strn(ysize-1)
     if update then npar = npar &lt<span class="comments">; 4 else npar = npar &lt; 6 </span>
     goto, RDY

 endif

 x0 = long(x0) & x1 = long(x1)
 y0 = long(y0) & y1 = long(y1)                                          

 naxis1 = x1 - x0 + 1 
 naxis2 = y1 - y0 + 1   <span class="comments">;New dimensions</span>

 if not keyword_set(SILENT) then message, /INF,        $
      'Now extracting a '+ strn(naxis1) + ' by ' + strn(naxis2) + ' subarray'

  if Update then oldim = oldim[ x0:x1,y0:y1 ]        $
            else newim = oldim[ x0:x1,y0:y1 ]

 newhd = oldhd
 sxaddpar, newhd, 'NAXIS1', naxis1                                   
 sxaddpar, newhd, 'NAXIS2', naxis2
 label = 'HEXTRACT: ' + systime(0)

 hist = [label,'Original image size was '+ strn(xsize) + ' by ' + strn(ysize), $
         'Extracted Image: [' + strn(x0) + ':'+ strn(x1) +  $
         ',' + strn(y0) + ':'+ strn(y1) + ']'  ]

 sxaddhist, hist, newhd


<span class="comments">;GSSS image uses CNPIX instead of CRPIX</span>
   cnpix1 = sxpar( oldhd, 'CNPIX1', COUNT = Ncnpix1)
         if ( Ncnpix1 EQ 1 ) then begin   <span class="comments">;Shift position of reference pixel</span>

                sxaddpar, newhd, 'CNPIX1', cnpix1+x0
                cnpix2 = sxpar( oldhd, 'CNPIX2' )
                sxaddpar, newhd, 'CNPIX2', cnpix2+y0
        endif

<span class="comments">; Update astrometry info if it exists</span>

  if N_elements(alt) EQ 0 then alt = ''
  extast, newhd, astr, noparams, ALT = alt
  if noparams GE 0 then begin

  sxaddpar, newhd, 'CRPIX1'+alt, astr.crpix[0]-x0
  sxaddpar, newhd, 'CRPIX2'+alt, astr.crpix[1]-y0


 endif 
 
 if Update then begin

      oldhd = newhd
      newim = x0 & newhd = x1
      x0 = y0 & x1 = y1

 endif

 return
 end
</code>
    </div>
  </body>
</html>