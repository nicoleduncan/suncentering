<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:23 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>date_conv.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="date_conv.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="date_conv:source"></a>function date_conv,date,type
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;     DATE_CONV</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;     Procedure to perform conversion of dates to one of three possible formats.</span>
<span class="comments">;</span>
<span class="comments">; EXPLANATION:</span>
<span class="comments">;     The following date formats are allowed</span>
<span class="comments">;</span>
<span class="comments">;       format 1: real*8 scalar encoded as:</span>
<span class="comments">;               year*1000 + day + hour/24. + min/24./60 + sec/24./60/60</span>
<span class="comments">;               where day is the day of year (1 to 366)</span>
<span class="comments">;       format 2: Vector encoded as:</span>
<span class="comments">;               date[0] = year (eg. 2005)</span>
<span class="comments">;               date[1] = day of year (1 to 366)</span>
<span class="comments">;               date[2] = hour</span>
<span class="comments">;               date[3] = minute</span>
<span class="comments">;               date[4] = second</span>
<span class="comments">;       format 3: string (ascii text) encoded as</span>
<span class="comments">;               DD-MON-YEAR HH:MM:SS.SS</span>
<span class="comments">;               (eg.  14-JUL-2005 15:25:44.23)</span>
<span class="comments">;            OR</span>
<span class="comments">;               YYYY-MM-DD HH:MM:SS.SS  (ISO standard)</span>
<span class="comments">;               (eg.  1987-07-14 15:25:44.23 or 1987-07-14T15:25:44.23)</span>
<span class="comments">;                   </span>
<span class="comments">;       format 4: three element vector giving spacecraft time words</span>
<span class="comments">;       from a Hubble Space Telescope (HST) telemetry packet.   Based on</span>
<span class="comments">;       total number of secs since midnight, JAN. 1, 1979</span>
<span class="comments">;</span>
<span class="comments">;       format 5: Julian day. As this is also a scalar, like format 1, </span>
<span class="comments">;       	the distinction between the two on input is made based on their</span>
<span class="comments">;       	value. Numbers > 2300000 are interpreted as Julian days.</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE</span>
<span class="comments">;       results = DATE_CONV( DATE, TYPE )</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;       DATE - input date in one of the possible formats. Must be scalar.</span>
<span class="comments">;       TYPE - type of output format desired.  If not supplied then</span>
<span class="comments">;               format 3 (real*8 scalar) is used.</span>
<span class="comments">;                       valid values:</span>
<span class="comments">;                       'REAL'  - format 1</span>
<span class="comments">;                       'VECTOR' - format 2</span>
<span class="comments">;                       'STRING' - format 3</span>
<span class="comments">;                       'FITS' - YYYY-MM-DDTHH:MM:SS.SS'</span>
<span class="comments">;                       'JULIAN' - Julian date</span>
<span class="comments">;                       'MODIFIED' - Modified Julian date (JD-2400000.5)</span>
<span class="comments">;               TYPE can be abbreviated to the single character strings 'R',</span>
<span class="comments">;               'V', 'S', 'F', 'J', and 'M'.</span>
<span class="comments">;               Nobody wants to convert TO spacecraft time (I hope!)</span>
<span class="comments">; OUTPUTS:</span>
<span class="comments">;       The converted date is returned as the function value.</span>
<span class="comments">;</span>
<span class="comments">; EXAMPLES:</span>
<span class="comments">;       IDL> print,date_conv('2006-03-13 19:58:00.00'),f='(f15.5)' </span>
<span class="comments">;             2006072.83194 </span>
<span class="comments">;       IDL> print,date_conv( 2006072.8319444d,'F')</span>
<span class="comments">;             2006-03-13T19:58:00.00</span>
<span class="comments">;       IDL> print,date_conv( 2006072.8319444d,'V')</span>
<span class="comments">;             2006.00      72.0000      19.0000      57.0000      59.9962</span>
<span class="comments">;       IDL> print,date_conv( 2006072.8319444d,'J'), f='(f15.5)'</span>
<span class="comments">;             2453808.33194</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; HISTORY:</span>
<span class="comments">;      version 1  D. Lindler  July, 1987</span>
<span class="comments">;      adapted for IDL version 2  J. Isensee  May, 1990</span>
<span class="comments">;      Made year 2000 compliant; allow ISO format input  jls/acc Oct 1998</span>
<span class="comments">;      DJL/ACC Jan 1998, Modified to work with dates such as 6-JAN-1996 where</span>
<span class="comments">;               day of month has only one digit.</span>
<span class="comments">;      DJL, Nov. 2000, Added input/output format YYYY-MM-DDTHH:MM:SS.SS</span>
<span class="comments">;      Replace spaces with '0' in output FITS format  W.Landsman April 2006</span>
<span class="comments">;      Added Julian date capabilities on input and output.  M.Perrin, July 2007</span>
<span class="comments">;      Removed spurious /WARN keyword to MESSAGE W.L. Feb 2012</span>
<span class="comments">;-</span>
<span class="comments">;-------------------------------------------------------------</span>
<span class="comments">;</span>
compile_opt idl2
<span class="comments">; data declaration</span>
<span class="comments">;</span>
days = [0,31,28,31,30,31,30,31,31,30,31,30,31]
months = ['   ','JAN','FEB','MAR','APR','MAY','JUN','JUL','AUG','SEP','OCT',$
        'NOV','DEC']
<span class="comments">;</span>
<span class="comments">; set default type if not supplied</span>
<span class="comments">;</span>
if N_params() lt 2 then type = 'REAL'
<span class="comments">;</span>
<span class="comments">; Determine type of input supplied</span>
<span class="comments">;</span>
s = size(date) & ndim = s[0] & datatype = s[ndim+1]
if ndim gt 0 then begin                 <span class="comments">;vector?</span>
        if ndim gt 1 then goto,notvalid
        if (s[1] ne 5) && (s[1] ne 3) then goto,notvalid
        if (s[1] eq 5) then form = 2 else form = 4
   end else begin                       <span class="comments">;scalar input</span>
        if datatype eq 0 then goto,notvalid
        if datatype eq 7 then form = 3 $        <span class="comments">;string</span>
                         else form = 1  <span class="comments">;numeric scalar</span>
end
<span class="comments">;</span>
<span class="comments">;      -----------------------------------</span>
<span class="comments">;</span>
<span class="comments">;*** convert input to year,day,hour,minute,second</span>
<span class="comments">;</span>
<span class="comments">;      -----------------------------------</span>
case form of

        1: begin                                        <span class="comments">;real scalar</span>
			<span class="comments">; The 'real' input format may be interpreted EITHER</span>
			<span class="comments">; a) if &lt; 2300000</span>
			<span class="comments">;    as the traditional 'real*8 encoded' format used by date_conv</span>
			<span class="comments">; b) if > 2300000</span>
			<span class="comments">;    as a Julian Day Number</span>
                idate = long(date)
                year = long(idate/1000)

				if year lt 2300 then begin
					
					<span class="comments">; if year is only 2 digits, assume 1900</span>
	                if year lt 100 then begin
	                   message,/INF, $
	                     'Warning: Year specified is only 2 digits, assuming 19xx'
	                   year=1900+year
	                   idate=1900000+idate
	                   date=1900000.+date
	                end
	                day = idate - year*1000
	                fdate = date-idate
	                fdate = fdate*24.
	                hour = fix(fdate)
	                fdate = (fdate-hour)*60.0
	                minute = fix(fdate)
	                sec = float((fdate-minute)*60.0)

				endif else begin
					daycnv, date, year, mn, mndy, hr
					<span class="comments">; convert from month/day to day of year</span>
					<span class="comments">; how many days PRECEED the start of each month?</span>
					YDAYS = [0,31,59,90,120,151,181,212,243,273,304,334,366] 
					LEAP =  (((YeaR MOD 4) EQ 0) AND ((YeaR MOD 100) NE 0)) OR $
					                 ((YeaR MOD 400) EQ 0)
			        IF LEAP THEN YDAYS[2:*] = YDAYS[2:*] + 1
					day = ydays[mn-1]+mndy
					
					hour = fix(hr)
					fmin = (hr-hour)*60
					minute = fix(fmin)
					sec = float((fmin-minute)*60)
				endelse
           end

        2: begin                                        <span class="comments">;vector</span>
                year = fix(date[0])
<span class="comments">;</span>
<span class="comments">; if year is only 2 digits, assume 1900</span>
<span class="comments">;</span>
                if year lt 100 then begin
                   message,/CON, $
                    'Warning: Year specified is only 2 digits, assuming 19xx'
                   year=1900+year
                end
<span class="comments">;</span>
                day = fix(date[1])
                hour = fix(date[2])
                minute = fix(date[3])
                sec = float(date[4])
           end

        3: begin                                        <span class="comments">;string</span>
                temp = date
<span class="comments">;</span>
<span class="comments">; check for old type of date, DD-MMM-YYYY</span>
<span class="comments">;</span>
                if strpos(temp,'-') le 2 then begin
                  day_of_month = fix(gettok(temp,'-'))
                  month_name = gettok(temp,'-')
                  year = fix(gettok(temp,' '))
                  hour = fix(gettok(temp,':'))
                  minute = fix(gettok(temp,':'))
                  sec = float(strtrim(strmid(temp,0,5)))
<span class="comments">;</span>
<span class="comments">; determine month number from month name</span>
<span class="comments">;</span>
                  month_name = strupcase(month_name)
                  for mon = 1,12 do begin
                        if month_name eq months[mon] then goto,found
                  end
                  message,'Invalid month name specified'
                  
<span class="comments">;</span>
<span class="comments">; check for new type of date, ISO: YYYY-MM-DD</span>
<span class="comments">;</span>
                end else if strpos(temp,'-') eq 4 then begin
                  year = fix(gettok(temp,'-'))
                  month_name = gettok(temp,'-')
                  mon=month_name
                  day_of_month=gettok(temp,' ')
                  if strlen(temp) eq 0 then begin
                        dtmp=gettok(day_of_month,'T')
                        temp=day_of_month
                        day_of_month=dtmp
                  end
                  day_of_month=fix(day_of_month)
                  hour = fix(gettok(temp,':'))
                  minute = fix(gettok(temp,':'))
                  sec = float(strtrim(strmid(temp,0,5)))
                end else goto, notvalid
              found:
<span class="comments">;</span>
<span class="comments">; if year is only 2 digits, assume 1900</span>
<span class="comments">;</span>
                if year lt 100 then begin
                   message,/WARN, $ 
                     'Warning: Year specified is only 2 digits, assuming 19xx'
                   year=1900+year
                end
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;            convert to day of year from month/day_of_month</span>
<span class="comments">;</span>
<span class="comments">;            correction for leap years</span>
<span class="comments">;</span>
<span class="comments">;               if (fix(year) mod 4) eq 0 then days(2) = 29     ;add one to february</span>
                lpyr = ((year mod 4) eq 0) and ((year mod 100) ne 0) $
                        or ((year mod 400) eq 0)
                if lpyr eq 1 then days[2] = 29 <span class="comments">; if leap year, add day to Feb.</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;            compute day of year</span>
<span class="comments">;</span>
                  day = fix(total(days[0:mon-1])+day_of_month)
           end

        4 : begin                       <span class="comments">;spacecraft time</span>
                SC = DOUBLE(date)
                SC = SC + (SC LT 0.0)*65536.    <span class="comments">;Get rid of neg. numbers </span>
<span class="comments">;</span>
<span class="comments">;            Determine total number of secs since midnight, JAN. 1, 1979</span>
<span class="comments">;</span>
                SECS = SC[2]/64 + SC[1]*1024 + SC[0]*1024*65536.
                SECS = SECS/8192.0D0            <span class="comments">;Convert from spacecraft units </span>
<span class="comments">;</span>
<span class="comments">;            Determine number of years </span>
<span class="comments">;</span>
                MINS = SECS/60.
                HOURS = MINS/60.
                TOTDAYS = HOURS/24.
                YEARS = TOTDAYS/365.
                YEARS = FIX(YEARS)
<span class="comments">;</span>
<span class="comments">;            Compute number of leap years past </span>
<span class="comments">;</span>
                LEAPYEARS = (YEARS+2)/4
<span class="comments">;</span>
<span class="comments">;           Compute day of year </span>
<span class="comments">;</span>
                DAY = FIX(TOTDAYS-YEARS*365.-LEAPYEARS)
<span class="comments">;</span>
<span class="comments">;           Correct for case of being right at end of leapyear</span>
<span class="comments">;</span>
                IF DAY LT 0 THEN BEGIN
                  DAY = DAY+366
                  LEAPYEARS = LEAPYEARS-1
                  YEARS = YEARS-1
                END
<span class="comments">;</span>
<span class="comments">;            COMPUTE HOUR OF DAY</span>
<span class="comments">;</span>
                TOTDAYS = YEARS*365.+DAY+LEAPYEARS
                HOUR = FIX(HOURS - 24*TOTDAYS)
                TOTHOURS = TOTDAYS*24+HOUR
<span class="comments">;</span>
<span class="comments">;            COMPUTE MINUTE</span>
<span class="comments">;</span>
                MINUTE = FIX(MINS-TOTHOURS*60)
                TOTMIN = TOTHOURS*60+MINUTE
<span class="comments">;</span>
<span class="comments">;            COMPUTE SEC</span>
<span class="comments">;</span>
                SEC = SECS-TOTMIN*60
<span class="comments">;</span>
<span class="comments">;            COMPUTE ACTUAL YEAR</span>
<span class="comments">;</span>
                YEAR = YEARS+79
<span class="comments">;</span>
<span class="comments">; if year is only 2 digits, assume 1900</span>
<span class="comments">;</span>
                if year lt 100 then begin
                   message, /CON, $ 
                     'Warning: Year specified is only 2 digits, assuming 19xx'
                   year=1900+year
                end
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;            START DAY AT ONE AND NOT ZERO</span>
<span class="comments">;</span>
                DAY++
           END
ENDCASE
<span class="comments">;</span>
<span class="comments">;            correction for leap years</span>
<span class="comments">;</span>
        if form ne 3 then begin         <span class="comments">;Was it already done?</span>
           lpyr = ((year mod 4) eq 0) && ((year mod 100) ne 0) $
                || ((year mod 400) eq 0)
           if lpyr eq 1 then days[2] = 29 <span class="comments">; if leap year, add day to Feb.</span>
        end
<span class="comments">;</span>
<span class="comments">;            check for valid day</span>
<span class="comments">;</span>
        if (day lt 1) || (day gt total(days)) then $
            message,'ERROR -- There are only ' + strtrim(fix(total(days)),2) + $
	         ' days  in year '+strtrim(year,2)

<span class="comments">;</span>
<span class="comments">;            find month which day occurs</span>
<span class="comments">;</span>
        day_of_month = day
        month_num = 1
        while day_of_month gt days[month_num] do begin
               day_of_month = day_of_month - days[month_num]
               month_num = month_num+1
        end
<span class="comments">;           ---------------------------------------</span>
<span class="comments">;</span>
<span class="comments">;   *****       Now convert to output format</span>
<span class="comments">;</span>
<span class="comments">;           ---------------------------------------</span>
<span class="comments">;</span>
<span class="comments">; is type a string</span>
<span class="comments">;</span>
s = size(type)
if (s[0] ne 0) or (s[1] ne 7) then $
        message,'ERROR - Output type specification must be a string'
<span class="comments">;</span>
case strmid(strupcase(type),0,1) of

        'V' : begin                             <span class="comments">;vector output</span>
                out = fltarr(5)
                out[0] = year
                out[1] = day
                out[2] = hour
                out[3] = minute
                out[4] = sec
             end
 
        'R' : begin                             <span class="comments">;floating point scalar</span>
<span class="comments">;               if year gt 1900 then year = year-1900</span>
                out = sec/24.0d0/60./60. + minute/24.0d0/60. + hour/24.0d0 $
                        +  day + year*1000d0
              end

        'S' : begin                             <span class="comments">;string output </span>

                month_name = months[month_num]
<span class="comments">;</span>
<span class="comments">;            encode into ascii_date</span>
<span class="comments">;</span>
                out = string(day_of_month,'(i2)') +'-'+ month_name +'-' + $
                        string(year,'(i4)') + ' '+ $
                        string(hour,'(i2.2)') +':'+ $
                        strmid(string(minute+100,'(i3)'),1,2) + ':'+ $
                        strmid(string(sec+100,'(f6.2)'),1,5)
           end
        'F' : begin
               xsec = strmid(string(sec+100,'(f6.2)'),1,5)
               if xsec EQ '60.00' then begin
                     minute = minute+1
                     xsec = '00.00'
                endif
                xminute =   string(minute,'(i2.2)')
                if xminute EQ '60' then begin
                       hour = hour+1
                       xminute = '00'                  
                endif          
                out = string(year,'(i4)')+'-'+string(month_num,'(I2.2)')+'-'+ $
                        string(day_of_month,'(i2.2)')+'T' + $
                        string(hour,'(i2.2)') +  ':' +xminute + ':'+ xsec
                        
              end

		'J' : begin	<span class="comments">; Julian Date</span>
				ydn2md, year, day, mn, dy
				juldate, [year, mn, dy, hour, minute, sec], rjd
				out = rjd+2400000   <span class="comments">; convert from reduced to regular JD</span>
			  end
		'M' : begin <span class="comments">; Modified Julian Date = JD - 2400000.5</span>
				ydn2md, year, day, mn, dy
				juldate, [year, mn, dy, hour, minute, sec], rjd
				out = rjd-0.5   <span class="comments">; convert from reduced to modified JD</span>
			  end



        else: begin                     <span class="comments">;invalid type specified</span>
                print,'DATE_CONV-- Invalid output type specified'
                print,' It must be ''REAL'', ''STRING'', ''VECTOR'', ''JULIAN'', ''MODIFIED'', or ''FITS''.'
                return,-1
              end
endcase
return,out
<span class="comments">;</span>
<span class="comments">; invalid input date error section</span>
<span class="comments">;</span>
NOTVALID:
message,'Invalid input date specified',/CON
return, -1
end
</code>
    </div>
  </body>
</html>