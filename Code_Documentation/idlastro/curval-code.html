<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:23 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>curval.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="curval.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="curval:source"></a>pro curval, hd, im, OFFSET = offset, ZOOM = zoom, Filename=Filename, ALT = alt
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;       CURVAL</span>
<span class="comments">; PURPOSE:   </span>
<span class="comments">;       Cursor controlled display of image intensities and astronomical coords</span>
<span class="comments">; EXPLANATION</span>
<span class="comments">;       CURVAL displays different information depending whether the user </span>
<span class="comments">;       supplied an image array, and/or a FITS header array</span>
<span class="comments">;</span>
<span class="comments">;       Note that in the usual truecolor mode, the byte intensity returned by </span>
<span class="comments">;       CURVAL does not correspond to the byte scaled image value but rather </span>
<span class="comments">;       returns the maximum value in each color gun.</span>
<span class="comments">; CALLING SEQUENCE(S):</span>
<span class="comments">;       curval          ;Display x,y and byte intensity (inten)</span>
<span class="comments">;       </span>
<span class="comments">;       curval, im   ;Display x,y,inten, and also pixel value (from image array)</span>
<span class="comments">;       </span>
<span class="comments">;       curval, hdr, [ im, OFFSET= , ZOOM=, FILENAME=, ALT=]        </span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUTS:</span>
<span class="comments">;       Hdr  = FITS Header array</span>
<span class="comments">;       Im  = Array containing values that are displayed.  Any type.</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL KEYWORD INPUTS:</span>
<span class="comments">;      ALT - single character 'A' through 'Z' or ' ' specifying an alternate</span>
<span class="comments">;            astrometry system present in the FITS header.    The default is</span>
<span class="comments">;            to use the primary astrometry or ALT = ' '.   If /ALT is set,</span>
<span class="comments">;            then this is equivalent to ALT = 'A'.   See Section 3.3 of</span>
<span class="comments">;            Greisen & Calabretta (2002, A&A, 395, 1061) for information about</span>
<span class="comments">;            alternate astrometry keywords.</span>
<span class="comments">;      OFFSET - 2 element vector giving the location of the image pixel (0,0) </span>
<span class="comments">;               on the window display.   OFFSET can be positive (e.g if the </span>
<span class="comments">;               image is centered in a larger window) or negative (e.g. if the</span>
<span class="comments">;               only the central region of an image much larger than the window</span>
<span class="comments">;               is being displayed. </span>
<span class="comments">;               Default value is [0,0], or no offset.</span>
<span class="comments">;       ZOOM - Scalar specifying the magnification of the window with respect</span>
<span class="comments">;               to the image variable.    Use, for example, if image has been</span>
<span class="comments">;               REBINed before display.</span>
<span class="comments">;       FILENAME  = name of file to where CURVAL data can be saved.</span>
<span class="comments">;               Data will only be saved if left or center mouse button</span>
<span class="comments">;               are pressed.</span>
<span class="comments">;</span>
<span class="comments">; OUTPUTS:</span>
<span class="comments">;       None.</span>
<span class="comments">;</span>
<span class="comments">; SIDE EFFECTS:</span>
<span class="comments">;       X and Y values, etc., of the pixel under the cursor are constantly</span>
<span class="comments">;       displayed.  </span>
<span class="comments">;       Pressing left or center mouse button prints a line of output, and </span>
<span class="comments">;       starts a new line.</span>
<span class="comments">;       Pressing right mouse button exits the procedure.</span>
<span class="comments">;       If the keyword FILENAME is defined, the date and time, and a heading </span>
<span class="comments">;       will be printed in the file before the data.</span>
<span class="comments">;</span>
<span class="comments">; PROCEDURES CALLED:</span>
<span class="comments">;       ADSTRING(), EXTAST, GSSSXYAD, RADEC, SXPAR(), UNZOOM_XY, XY2AD</span>
<span class="comments">; REVISION HISTORY:</span>
<span class="comments">;       Written,  K. Rhode,  STX  May 1990</span>
<span class="comments">;       Added keyword FILENAME  D. Alexander  June 1991</span>
<span class="comments">;       Don't write to Journal file   W. Landsman    March 1993</span>
<span class="comments">;       Use astrometry structure  W. Landsman      Feb 1994</span>
<span class="comments">;       Modified for Mac IDL          I.   Freedman     April 1994</span>
<span class="comments">;       Allow for zoomed or offset image  W. Landsman      Mar 1996</span>
<span class="comments">;       Proper rounding of zoomed pixel values   W. Landsman/R. Hurt  Dec. 1997</span>
<span class="comments">;       Remove unneeded calls to obsolete !ERR   W. Landsman   December 2000</span>
<span class="comments">;       Replace remaining !ERR calls with !MOUSE.BUTTON W. Landsman Jan 2001</span>
<span class="comments">;       Allow for non-celestial (e.g. Galactic) coordinates W. Landsman Apr 2003</span>
<span class="comments">;       Work if RA/Dec reversed in CTYPE keyword  W. Landsman Feb. 2004</span>
<span class="comments">;       Always call UNZOOM_XY for MOUSSE compatibility W. Landsman Sep. 2004</span>
<span class="comments">;       Added ALT keyword  W. Landsman October 2004 </span>
<span class="comments">;       Always test if offset/zoom supplied  W. Landsman  Feb 2008 </span>
<span class="comments">;-</span>
 On_error,2    <span class="comments">;if an error occurs, return to caller</span>
 compile_opt idl2


 f_header = 0b           <span class="comments">;True if a FITS header supplied</span>
 f_image =  0b           <span class="comments">;True if an image array supplied</span>
 f_astrom = 0b           <span class="comments">;True if FITS header contains astrometry</span>
 f_bscale = 0b           <span class="comments">;True if FITS header contains BSCALE factors</span>
 f_imhd   = 0b           <span class="comments">;True if image array is in HD (1 parameter)</span>
 npar = N_params()
 fileflag=0             <span class="comments">;True once left or middle mouse button pressed</span>

 if !D.WINDOW EQ -1 then begin
        message,'ERROR - No image window active',/INF
        return
 endif


if (!D.FLAGS and 256) EQ 256 then wshow,!D.WINDOW  <span class="comments">;Bring active window to foreground</span>

<span class="comments">; Print formats and header for different astrometry,image, BSCALE combinations</span>

 cr = string(13b)
 line0 = '  X     Y     Byte Inten'
 line1 = '  X     Y     Byte Inten   Value'
 line5 = '  X     Y   ByteInten   Value   Flux'

 f0 = "($,a,i4,2x,i4,6x,i4)"
 f1 = "($,a,i4,2x,i4,6x,i4,5x,a)"
 f2 = "($,a,i4,2x,i4,6x,i4,7x,a,1x,a)"
 f3 = "($,a,i4,2x,i4,2x,i4,7x,a,2x,a,1x,a,3x,e9.2)"
 f4 = "($,a,i4,2x,i4,2x,i4,7x,a,1x,a,a)"
 f5 = "($,a,i4,2x,i4,2x,i4,3x,a,5x,e9.2)"

 g0 = "(a,i4,2x,i4,6x,i4)"
 g1 = "(a,i4,2x,i4,6x,i4,5x,a)"
 g2 = "(a,i4,2x,i4,6x,i4,7x,a,1x,a)"
 g3 = "(a,i4,2x,i4,2x,i4,7x,a,2x,a,1x,a,3x,e9.2)"
 g4 = "(a,i4,2x,i4,2x,i4,7x,a,2x,a,1x,a)"
 g5 = "(a,i4,2x,i4,2x,i4,3x,a,5x,e9.2)"

if (npar gt 0) then begin
  type = size(hd)
  if (npar eq 1) and (type[0] eq 2) then begin
    f_image = 1b  & f_imhd = 1b 
    imtype = type
  endif else if (type[2] ne 7) or (type[0] ne 1) then begin
    print,'Syntax options: CURVAL        ;Display byte values'
    print,'                CURVAL, IM    ;where IM is a 2-D image,'
    print,'                CURVAL, Hdr   ;where Hdr is a FITS header,'
    print,'            or  CURVAL, Hdr,IM'
    return
  endif else if (type[2] eq 7) and (type[0] eq 1) then f_header = 1b
  if (npar eq 2) then begin
    f_image = 1b & f_header = 1b
    imtype = size(im)
    if (imtype[0] lt 2) or $
     (imtype[imtype[0]+2] ne imtype[1]*imtype[2]) then $
       message,'Image array (second parameter) is not two dimensional.'
  endif
endif    

<span class="comments">; Get information from the header</span>

 if f_header then begin     

  EXTAST, hd, astr, noparams, alt=alt                 <span class="comments">;Extract astrometry structure</span>
  if (noparams ge 0) then f_astrom = 1b

  if f_image then begin
  bscale = sxpar(hd,'BSCALE')
  if (bscale ne 0) then begin
    bzero = sxpar(hd,'BZERO')
    bunit = sxpar(hd,'BUNIT', Count = N_Bunit)
    if N_Bunit GE 1 then $ 
    if f_astrom then line3 = line3 + '('+bunit+ ')' else $
                     line5 = line5 + '('+bunit+')'
    f_bscale = 1b
  endif
  endif
 endif

<span class="comments">; Determine if an offset or zoom supplied</span>
 unzoom = f_image  or f_header or keyword_set(offset) or keyword_set(zoom)

 if f_astrom GT 0 then begin
  coord = strmid(astr.ctype,0,4)
  coord = repchr(coord,'-',' ')
  if (coord[0] EQ 'DEC ') or (coord[0] EQ 'ELAT') or $
     (coord[0] EQ 'GLAT') then coord = rotate(coord,2)

  line2 = '  X     Y     Byte Inten        '  + coord[0] + '       ' +coord[1]
  line3 = '  X     Y   ByteInten    Value       ' + coord[0]  + '         ' + $
             coord[1] + '           Flux' 
  line4 = '  X     Y   ByteInten     Value      '  + coord[0] + '          ' + $
             coord[1]

  sexig = strupcase(strmid(coord[0],0,4))  EQ 'RA  ' 
 endif

 print,'Press left or center mouse button for new output line,'
 print,'... right mouse button to exit.'  

<span class="comments">; different print statements, depending on the parameters</span>

 case 1 of

(f_image eq 0b) and (f_astrom eq 0b):  begin   
   curtype = 0 & print, line0  & end      <span class="comments">;No image or header info</span>

(f_image) and (f_astrom eq 0b) and (f_bscale eq 0b): begin
   curtype = 1  & print,line1 & end       <span class="comments">;Only image array supplied</span>

(f_image eq 0b) and (f_astrom) and (f_bscale eq 0b): begin 
   curtype = 2  & print,line2 & end       <span class="comments">;Astrometry but no image array</span>

(f_image) and (f_astrom) and (f_bscale): begin
   curtype =3   & print,line3 & end       <span class="comments">;Image array + astrometry + BSCALE</span>

(f_image) and (f_astrom) and (f_bscale eq 0b): begin
   curtype = 4  & print,line4 & end       <span class="comments">;Image array +astrometry</span>

(f_image) and (f_astrom eq 0b) and (f_bscale): begin
   curtype = 5  & print,line5 & end       <span class="comments">;Image array + BSCALE</span>

endcase
 if f_image then begin
      dtype = imtype[imtype[0]+1]
      if (dtype LT 4) or (dtype GE 12) then dfmt = '(I8)' else  dfmt = '(G8.3)'
 endif

 LOOP: sv_err = !MOUSE.BUTTON
 !MOUSE.BUTTON = 0
 cursor,x,y,2,/DEVICE,/CHANGE                                 
 cr_err = !MOUSE.BUTTON

 if cr_err EQ 4 then begin
    print,' '
    if fileflag then free_lun,lun
    return

 endif


  x = x>0 & y = y>0
  inten = fix(tvrd(x,y,1,1))   <span class="comments">; read the byte intensity </span>

 if unzoom then unzoom_xy,x,y,offset=offset,zoom=zoom

 if f_astrom then begin

        case strmid(astr.ctype[0],5,3) of 
        'GSS': gsssxyad, astr, x, y, a, d
        else:  xy2ad, x, y, astr, a, d            <span class="comments">; convert to ra and dec</span>
        endcase

        if sexig then begin 
            str = adstring(a,d,2)
            a = strmid(str,1,13)
            d  = strmid(str,14,13)
        endif else begin
            a = string(a,'(f10.2)') + '   '
            d = string(d,'(f10.2)') + '   '
        endelse
 endif

 x = round(x)  & y = round(y)

 if f_image then begin
      if (x LT 0) or (x GE imtype[1]) or $
         (y LT 0) or (y GE imtype[2]) then value = 0 else $
      if f_imhd then value = hd[x,y] else value = im[x,y]
      svalue = string(value,f=dfmt)
 endif

 if f_bscale  then flux = bscale*value + bzero  
 case curtype of
        0:  print,form=f0,cr,x,y,inten  
        1:  print,form=f1,cr,x,y,inten,svalue 
        2:  print,form=f2,cr,x,y,inten,a,d        
        3:  print,form=f3,cr,x,y,inten,svalue,a,d,flux
        4:  print,form=f4,cr,x,y,inten,svalue,a,d
        5:  print,form=f5,cr,x,y,inten,svalue,flux
 endcase

<span class="comments">; Were left or center buttons been pressed?</span>

 if (cr_err GE 1) and (cr_err LE 3) and (cr_err NE sv_err) then begin  
    print,form="($,a)",string(10b)   <span class="comments">; print a form feed</span>
    if keyword_set(filename) and (not fileflag) then begin      <span class="comments">; open file & print table header to file</span>
        get_lun,lun
        openw,lun,filename
        printf,lun,'CURVAL:   ',systime()      <span class="comments">;print time and date to file</span>
        case 1 of               <span class="comments">;different print statements for file, depending on parameters</span>

        (f_image eq 0b) and (f_astrom eq 0b) : begin
           printf, lun, line0  & end                    <span class="comments">;No image or header info</span>

        (f_image) and (f_astrom eq 0b) and (f_bscale eq 0b) : begin
           printf, lun, line1 & end                     <span class="comments">;Only image array supplied</span>

        (f_image eq 0b) and (f_astrom) and (f_bscale eq 0b) : begin
           printf, lun, line2 & end                     <span class="comments">;Astrometry but no image array</span>

        (f_image) and (f_astrom) and (f_bscale) : begin
           printf, lun, line3 & end                     <span class="comments">;Image array + astrometry + BSCALE</span>

        (f_image) and (f_astrom) and (f_bscale eq 0b) : begin
           printf, lun, line4 & end                     <span class="comments">;Image array + astrometry</span>

        (f_image) and (f_astrom eq 0b) and (f_bscale) : begin
           printf, lun, line5 & end                     <span class="comments">;Image array + BSCALE</span>
        endcase
        fileflag=1
    endif
    if keyword_set(filename) then begin
        case curtype of 
           0: printf, lun, form=g0,'', x, y, inten
           1: printf, lun, form=g1,'', x, y, inten, svalue 
           2: printf, lun, form=g2,'', x, y, inten, a, d
           3: printf, lun, form=g3,'', x, y, inten, svalue, a, d, flux
           4: printf, lun, form=g4,'', x, y, inten, svalue, a, d
           5: printf, lun, form=g5,'', x, y, inten, svalue, flux
        endcase
    endif
 endif

 goto,LOOP

 end
</code>
    </div>
  </body>
</html>