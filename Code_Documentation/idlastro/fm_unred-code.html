<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:31 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>fm_unred.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="fm_unred.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="fm_unred:source"></a>pro fm_unred, wave, flux, ebv, funred, R_V = R_V, gamma = gamma, x0 = x0, $
              c1 = c1, c2 = c2, c3 = c3, c4 = c4,avglmc=avglmc, lmc2 = lmc2, $
              ExtCurve=ExtCurve
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;     FM_UNRED</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;     Deredden a flux vector using the Fitzpatrick (1999) parameterization</span>
<span class="comments">; EXPLANATION:</span>
<span class="comments">;     The R-dependent Galactic extinction curve is that of Fitzpatrick & Massa </span>
<span class="comments">;     (Fitzpatrick, 1999, PASP, 111, 63; astro-ph/9809387 ).    </span>
<span class="comments">;     Parameterization is valid from the IR to the far-UV (3.5 microns to 0.1 </span>
<span class="comments">;     microns).    UV extinction curve is extrapolated down to 912 Angstroms.</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;     FM_UNRED, wave, flux, ebv, [ funred, R_V = , /LMC2, /AVGLMC, ExtCurve= </span>
<span class="comments">;                       gamma =, x0=, c1=, c2=, c3=, c4= ]</span>
<span class="comments">; INPUT:</span>
<span class="comments">;      WAVE - wavelength vector (Angstroms)</span>
<span class="comments">;      FLUX - calibrated flux vector, same number of elements as WAVE</span>
<span class="comments">;               If only 3 parameters are supplied, then this vector will</span>
<span class="comments">;               updated on output to contain the dereddened flux.</span>
<span class="comments">;      EBV  - color excess E(B-V), scalar.  If a negative EBV is supplied,</span>
<span class="comments">;               then fluxes will be reddened rather than dereddened.</span>
<span class="comments">;</span>
<span class="comments">; OUTPUT:</span>
<span class="comments">;      FUNRED - unreddened flux vector, same units and number of elements</span>
<span class="comments">;               as FLUX</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUT KEYWORDS</span>
<span class="comments">;      R_V - scalar specifying the ratio of total to selective extinction</span>
<span class="comments">;               R(V) = A(V) / E(B - V).    If not specified, then R = 3.1</span>
<span class="comments">;               Extreme values of R(V) range from 2.3 to 5.3</span>
<span class="comments">;</span>
<span class="comments">;      /AVGLMC - if set, then the default fit parameters c1,c2,c3,c4,gamma,x0 </span>
<span class="comments">;             are set to the average values determined for reddening in the </span>
<span class="comments">;             general Large Magellanic Cloud (LMC) field by Misselt et al. </span>
<span class="comments">;            (1999, ApJ, 515, 128)</span>
<span class="comments">;      /LMC2 - if set, then the fit parameters are set to the values determined</span>
<span class="comments">;             for the LMC2 field (including 30 Dor) by Misselt et al.</span>
<span class="comments">;             Note that neither /AVGLMC or /LMC2 will alter the default value </span>
<span class="comments">;             of R_V which is poorly known for the LMC. </span>
<span class="comments">;             </span>
<span class="comments">;      The following five input keyword parameters allow the user to customize</span>
<span class="comments">;      the adopted extinction curve.    For example, see Clayton et al. (2003,</span>
<span class="comments">;      ApJ, 588, 871) for examples of these parameters in different interstellar</span>
<span class="comments">;      environments.</span>
<span class="comments">;</span>
<span class="comments">;      x0 - Centroid of 2200 A bump in microns (default = 4.596)</span>
<span class="comments">;      gamma - Width of 2200 A bump in microns (default  =0.99)</span>
<span class="comments">;      c3 - Strength of the 2200 A bump (default = 3.23)</span>
<span class="comments">;      c4 - FUV curvature (default = 0.41)</span>
<span class="comments">;      c2 - Slope of the linear UV extinction component </span>
<span class="comments">;           (default = -0.824 + 4.717/R)</span>
<span class="comments">;      c1 - Intercept of the linear UV extinction component </span>
<span class="comments">;           (default = 2.030 - 3.007*c2</span>
<span class="comments">;            </span>
<span class="comments">; OPTIONAL OUTPUT KEYWORD:</span>
<span class="comments">;      ExtCurve - Returns the E(wave-V)/E(B-V) extinction curve, interpolated</span>
<span class="comments">;                 onto the input wavelength vector</span>
<span class="comments">;</span>
<span class="comments">; EXAMPLE:</span>
<span class="comments">;       Determine how a flat spectrum (in wavelength) between 1200 A and 3200 A</span>
<span class="comments">;       is altered by a reddening of E(B-V) = 0.1.   Assume an "average"</span>
<span class="comments">;       reddening for the diffuse interstellar medium (R(V) = 3.1)</span>
<span class="comments">;</span>
<span class="comments">;       IDL> w = 1200 + findgen(40)*50      ;Create a wavelength vector</span>
<span class="comments">;       IDL> f = w*0 + 1                    ;Create a "flat" flux vector</span>
<span class="comments">;       IDL> fm_unred, w, f, -0.1, fnew  ;Redden (negative E(B-V)) flux vector</span>
<span class="comments">;       IDL> plot,w,fnew                   </span>
<span class="comments">;</span>
<span class="comments">; NOTES:</span>
<span class="comments">;       (1) The following comparisons between the FM curve and that of Cardelli, </span>
<span class="comments">;           Clayton, & Mathis (1989), (see ccm_unred.pro):</span>
<span class="comments">;           (a) - In the UV, the FM and CCM curves are similar for R &lt; 4.0, but</span>
<span class="comments">;                 diverge for larger R</span>
<span class="comments">;           (b) - In the optical region, the FM more closely matches the</span>
<span class="comments">;                 monochromatic extinction, especially near the R band.</span>
<span class="comments">;       (2)  Many sightlines with peculiar ultraviolet interstellar extinction </span>
<span class="comments">;               can be represented with the FM curve, if the proper value of </span>
<span class="comments">;               R(V) is supplied.</span>
<span class="comments">;       (3) Use the 4 parameter calling sequence if you wish to save the </span>
<span class="comments">;               original flux vector.</span>
<span class="comments">; PROCEDURE CALLS:</span>
<span class="comments">;       CSPLINE(), POLY()</span>
<span class="comments">; REVISION HISTORY:</span>
<span class="comments">;       Written   W. Landsman        Raytheon  STX   October, 1998</span>
<span class="comments">;       Based on FMRCurve by E. Fitzpatrick (Villanova)</span>
<span class="comments">;       Added /LMC2 and /AVGLMC keywords,  W. Landsman   August 2000</span>
<span class="comments">;       Added ExtCurve keyword, J. Wm. Parker   August 2000</span>
<span class="comments">;       Assume since V5.4 use COMPLEMENT to WHERE  W. Landsman April 2006</span>
<span class="comments">;</span>
<span class="comments">;-</span>
 On_error, 2
 compile_opt idl2

 if N_params() LT 3 then begin
     print,'Syntax: FM_UNRED, wave, flux, ebv, funred,[ R_V =, /LMC2, /AVGLMC '
     print,'                  gamma =, x0 =, c1 =, c2 = ,c3 = ,c4 =, ExtCurve=]'
     return
 endif

 if not keyword_set(R_V) then R_V = 3.1

 x = 10000./ wave                <span class="comments">; Convert to inverse microns </span>
 curve = x*0.

<span class="comments">; Set default values of c1,c2,c3,c4,gamma and x0 parameters</span>

 if keyword_set(LMC2) then  begin
         if N_elements(x0) EQ 0 then x0    =  4.626
         if N_elements(gamma) EQ 0 then gamma =  1.05	
         if N_elements(c4) EQ 0 then c4   =  0.42   
         if N_elements(c3) EQ 0 then c3    =  1.92	
         if N_elements(c2) EQ 0 then c2    = 1.31
         if N_elements(c1) EQ 0 then c1    =  -2.16
 endif else if keyword_set(AVGLMC) then begin
         if N_elements(x0) EQ 0 then x0 = 4.596  
         if N_elements(gamma) EQ 0 then gamma = 0.91
         if N_elements(c4) EQ 0 then c4   =  0.64  
         if N_elements(c3) EQ 0 then c3    =  2.73	
         if N_elements(c2) EQ 0 then c2    = 1.11
         if N_elements(c1) EQ 0 then c1    =  -1.28
  endif else begin
         if N_elements(x0) EQ 0 then x0    =  4.596  
         if N_elements(gamma) EQ 0 then gamma =  0.99	
         if N_elements(c3) EQ 0 then c3    =  3.23	
         if N_elements(c4) EQ 0 then c4   =  0.41    
         if N_elements(c2) EQ 0 then c2    = -0.824 + 4.717/R_V
         if N_elements(c1) EQ 0 then c1    =  2.030 - 3.007*c2
 endelse

<span class="comments">; Compute UV portion of A(lambda)/E(B-V) curve using FM fitting function and </span>
<span class="comments">; R-dependent coefficients</span>
 
 xcutuv = 10000.0/2700.0
 xspluv = 10000.0/[2700.0,2600.0]
 iuv = where(x ge xcutuv, N_UV, complement = iopir, Ncomp = Nopir)
 IF (N_UV GT 0) THEN xuv = [xspluv,x[iuv]] ELSE  xuv = xspluv

    yuv = c1  + c2*xuv
    yuv = yuv + c3*xuv^2/((xuv^2-x0^2)^2 +(xuv*gamma)^2)
    yuv = yuv + c4*(0.5392*((xuv>5.9)-5.9)^2+0.05644*((xuv>5.9)-5.9)^3)
    yuv = yuv + R_V
    yspluv  = yuv[0:1]                  <span class="comments">; save spline points</span>

 IF (N_UV GT 0) THEN curve[iuv] = yuv[2:*]      <span class="comments">; remove spline points</span>
 
<span class="comments">; Compute optical portion of A(lambda)/E(B-V) curve</span>
<span class="comments">; using cubic spline anchored in UV, optical, and IR</span>

 xsplopir = [0,10000.0/[26500.0,12200.0,6000.0,5470.0,4670.0,4110.0]]
 ysplir   = [0.0,0.26469,0.82925]*R_V/3.1 
 ysplop   = [poly(R_V, [-4.22809e-01, 1.00270, 2.13572e-04] ), $
             poly(R_V, [-5.13540e-02, 1.00216, -7.35778e-05] ), $
             poly(R_V, [ 7.00127e-01, 1.00184, -3.32598e-05] ), $
             poly(R_V, [ 1.19456, 1.01707, -5.46959e-03, 7.97809e-04, $ 
                     -4.45636e-05] ) ]
  
 ysplopir = [ysplir,ysplop]

 if (Nopir GT 0) then $
          curve[iopir] = CSPLINE([xsplopir,xspluv],[ysplopir,yspluv],x[iopir])

 <span class="comments">; Now apply extinction correction to input flux vector</span>

   curve = ebv*curve 
   if N_params() EQ 3 then flux = flux * 10.^(0.4*curve) else $
        funred = flux * 10.^(0.4*curve)       <span class="comments">;Derive unreddened flux</span>

   ExtCurve = Curve - R_V

 end
</code>
    </div>
  </body>
</html>