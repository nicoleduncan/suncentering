<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:33 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>ftprint.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="ftprint.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="ftprint:source"></a>pro ftprint,h,tab,columns,rows,textout=textout
<span class="comments">;+</span>
<span class="comments">;  NAME:</span>
<span class="comments">;      FTPRINT</span>
<span class="comments">;  PURPOSE:</span>
<span class="comments">;       Procedure to print specified columns and rows of a FITS table</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;       FTPRINT, h, tab, columns, [ rows, TEXTOUT = ]</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;       h - Fits header for table, string array</span>
<span class="comments">;       tab - table array </span>
<span class="comments">;       columns - string giving column names, or vector giving</span>
<span class="comments">;               column numbers (beginning with 1).  If string </span>
<span class="comments">;               supplied then column names should be separated by comma's.</span>
<span class="comments">;       rows - (optional) vector of row numbers to print.  If</span>
<span class="comments">;               not supplied or set to scalar, -1, then all rows</span>
<span class="comments">;               are printed.</span>
<span class="comments">;</span>
<span class="comments">; OUTPUTS:</span>
<span class="comments">;       None</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUT KEYWORDS:</span>
<span class="comments">;       TEXTOUT controls the output device; see the procedure TEXTOPEN</span>
<span class="comments">;</span>
<span class="comments">; SYSTEM VARIABLES:</span>
<span class="comments">;       Uses nonstandard system variables !TEXTOUT and !TEXTOPEN</span>
<span class="comments">;       These will be defined (using ASTROLIB) if not already present.</span>
<span class="comments">;       Set !TEXTOUT = 3 to direct output to a disk file.   The system</span>
<span class="comments">;       variable is overriden by the value of the keyword TEXTOUT</span>
<span class="comments">;</span>
<span class="comments">; EXAMPLES:</span>
<span class="comments">;</span>
<span class="comments">;       ftprint,h,tab,'STAR ID,RA,DEC'    ;print id,ra,dec for all stars</span>
<span class="comments">;       ftprint,h,tab,[2,3,4],indgen(100) ;print columns 2-4 for </span>
<span class="comments">;                                         ;first 100 stars</span>
<span class="comments">;       ftprint,h,tab,text="stars.dat"    ;Convert entire FITS table to</span>
<span class="comments">;                                         ;an ASCII file named STARS.DAT</span>
<span class="comments">;</span>
<span class="comments">; PROCEDURES USED:</span>
<span class="comments">;       FTSIZE, FTINFO, TEXTOPEN, TEXTCLOSE</span>
<span class="comments">;</span>
<span class="comments">; RESTRICTIONS: </span>
<span class="comments">;       (1) Program does not check whether output length exceeds output</span>
<span class="comments">;               device capacity (e.g. 80 or 132).</span>
<span class="comments">;       (2) Column heading may be truncated to fit in space defined by</span>
<span class="comments">;               the FORMAT specified for the column</span>
<span class="comments">;       (3) Program does not check for null values</span>
<span class="comments">;</span>
<span class="comments">; HISTORY:</span>
<span class="comments">;       version 1  D. Lindler Feb. 1987</span>
<span class="comments">;       Accept undefined values of rows, columns   W. Landsman August 1997</span>
<span class="comments">;       New FTINFO calling sequence    W. Landsman   May 2000</span>
<span class="comments">;       Parse scalar string with STRSPLIT   W. Landsman  July 2002</span>
<span class="comments">;       Fix format display of row number  W. Landsman March 2003</span>
<span class="comments">;       Fix format display of row number again  W. Landsman May 2003</span>
<span class="comments">;-</span>
<span class="comments">; On_error,2</span>
  compile_opt idl2
<span class="comments">;</span>
<span class="comments">; set defaulted parameters</span>
<span class="comments">;</span>
 if N_params() LT 2 then begin
   print,'Syntax -  FTPRINT, h, tab, [ columns, rows, TEXTOUT= ]'
   return
 endif

 defsysv,'!textout',exists = i
 if i EQ 0 then astrolib
 
 if N_elements(columns) EQ 0 then columns = -1
 if N_elements(rows) EQ 0 then rows= -1
 if  not keyword_set(TEXTOUT)  then textout = !TEXTOUT

<span class="comments">; make sure rows is a vector</span>

 n = N_elements(rows)
 if n EQ 1 then r = [rows] else r = long(rows)
 ftsize,h,tab,ncols,nrows,tfields,allcols,allrows, ERRMSG = errmsg   <span class="comments">;table size</span>
 if ERRMSG NE '' then message,errmsg
 if r[0] EQ -1 then r = lindgen(nrows)          <span class="comments">;default</span>

 Nr = N_elements(r)
 good = where( (r GE 0) and (r LT nrows), Ngood)
 if Ngood NE Nr then begin
      if Ngood EQ 0 then message,'ERROR - No valid row numbers supplied'
      r = r[good]
 endif
<span class="comments">;</span>
<span class="comments">; extract column info</span>
<span class="comments">;</span>
 title1 = ''
 title2 = ''
 FTINFO,h,ft_str
 
<span class="comments">;</span>
<span class="comments">; if columns is a string, change it to string array</span>
<span class="comments">;</span>
 if size(columns,/TNAME) EQ 'STRING'  then begin 
         colnames = strsplit(columns,',',/EXTRACT) 
         numcol = N_elements(colnames)
        colnames = strupcase(strtrim(colnames,2))
        ttype = strtrim(ft_str.ttype,2)
        colnum = intarr(numcol)
        for i = 0,numcol-1 do begin
             icol = where(ttype EQ colnames[i], Nfound) 
             if Nfound EQ 0 then message, $
               'ERROR - Field ' + colnames[i] + ' not found in FITS ASCII table'
             colnum[i] = icol[0] 
       endfor
   end else begin                       <span class="comments">;user supplied vector</span>
        colnum = fix(columns) -1                <span class="comments">;make sure it is integer</span>
        numcol = N_elements(colnum)     <span class="comments">;number of elements</span>
        if numcol EQ 1 then begin
            if colnum[0] LT 0 then begin 
              colnum = indgen(tfields) & numcol = tfields
        endif & endif
 end

 flen = ft_str.width[colnum]
 colpos = ft_str.tbcol[colnum]
 ttype = strtrim( ft_str.ttype[colnum],2)
 tunit = strtrim( ft_str.tunit[colnum],2)
<span class="comments">;</span>
<span class="comments">; create header lines</span>
<span class="comments">;</span>
  for i=0,numcol-1 do begin
        name = strn(ttype[i],padtype=2,len=flen[i] )
        unit = strn(tunit[i],padtype=2,len=flen[i] ) 
        title1 = title1 + ' ' + name
        title2 = title2 + ' ' + unit
  endfor
<span class="comments">;</span>
<span class="comments">; open output file</span>
<span class="comments">;</span>
 textopen,'FTPRINT',TEXTOUT=textout, MORE_SET = more_set

 ifmt = fix(alog10(max(r)+1)) > 3
 title1 = strn('ROW',padtype=2,len = ifmt) +  title1
 title2 = string(replicate(32b,ifmt+1)) + title2
 ifmt = strtrim(ifmt,2)
<span class="comments">;</span>
<span class="comments">; loop on rows </span>
<span class="comments">;</span>
 printf,!TEXTUNIT,title1
 printf,!TEXTUNIT,title2
 printf,!TEXTUNIT,' '

  for i = 0, Nr-1 do begin
<span class="comments">;</span>
<span class="comments">; loop on columns</span>
<span class="comments">;</span>
        line = string(r[i],format='(i' + ifmt + ')')     <span class="comments">;print line</span>
        for j = 0,numcol-1 do begin
                cpos=colpos[j]-1                        <span class="comments">;column number</span>
                val = string(tab[cpos:cpos+flen[j]-1,r[i]])
                line = line+' '+ val
        endfor
        printf,!TEXTUNIT,line
        if more_set then if (!ERR EQ 1) then goto, DONE
 endfor
<span class="comments">;</span>
<span class="comments">; done</span>
<span class="comments">;</span>
DONE: 
 textclose,textout=textout

 return
 end
</code>
    </div>
  </body>
</html>