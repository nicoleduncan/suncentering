<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:19 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>biweight_mean.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="biweight_mean.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source">FUNCTION  BIWEIGHT_MEAN,Y,SIGMA, WEIGHTs
<span class="comments">;</span>
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;	BIWEIGHT_MEAN </span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;	Calculate the center and dispersion (like mean and sigma) of a </span>
<span class="comments">;	distribution using bisquare weighting.</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;	Mean = BIWEIGHT_MEAN( Vector, [ Sigma, Weights ] ) </span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;	Vector = Distribution in vector form</span>
<span class="comments">;</span>
<span class="comments">; OUTPUT:</span>
<span class="comments">;	Mean - The location of the center.</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL OUTPUT ARGUMENTS:</span>
<span class="comments">;</span>
<span class="comments">;	Sigma = An outlier-resistant measure of the dispersion about the </span>
<span class="comments">;	      center, analogous to the standard deviation. </span>
<span class="comments">;</span>
<span class="comments">;	Weights = The weights applied to the data in the last iteration, </span>
<span class="comments">;                 floating point vector</span>
<span class="comments">;</span>
<span class="comments">; NOTES:</span>
<span class="comments">;       Since a sample mean  scaled by sigma/sqrt(N), has a Student's T </span>
<span class="comments">;       distribution, the half-width of the  95% confidence interval for </span>
<span class="comments">;       the sample mean  can be determined as follows: </span>
<span class="comments">;          ABS( T_CVF( .975, .7*(N-1) )*SIGMA/SQRT(N) ) </span>
<span class="comments">;       where N = number of  points, and  0.975 = 1 - (1 - 0.95)/2. </span>
<span class="comments">; PROCEDURES USED:</span>
<span class="comments">;       ROBUST_SIGMA()</span>
<span class="comments">; REVISION HISTORY</span>
<span class="comments">;	Written,  H. Freudenreich, STX, 12/89</span>
<span class="comments">;	Modified 2/94, H.T.F.: use a biweighted standard deviation rather than</span>
<span class="comments">;		median absolute deviation.</span>
<span class="comments">;	Modified 2/94, H.T.F.: use the fractional change in SIGMA as the </span>
<span class="comments">;		convergence criterion rather than the change in center/SIGMA.</span>
<span class="comments">;       Modified May 2002  Use MEDIAN(/EVEN)</span>
<span class="comments">;       Modified October 2002, Faster computation of weights </span>
<span class="comments">;       Corrected documentation on 95% confidence interval of mean </span>
<span class="comments">;                 P.Broos/W. Landsman   July 2003 </span>
<span class="comments">;-</span>

  ON_ERROR,2
  maxit = 20 <span class="comments">; Allow 20 iterations, this should nearly always be sufficient</span>
  eps = 1.0e-24

  n = n_elements(y)
  close_enough =.03*sqrt(.5/(n-1)) <span class="comments">; compare to fractional change in width</span>

  diff = 1.0e30
  itnum = 0

<span class="comments">; As an initial estimate of the center, use the median:</span>
  y0=median(y,/even)

<span class="comments">; Calculate the weights:</span>
  dev = y-y0
  sigma = ROBUST_SIGMA( dev ) 

  if sigma lt EPS then begin
<span class="comments">;    The median is IT. Do we need the weights?</span>
     if arg_present(weights)  then begin
<span class="comments">;       Flag any value away from the median:</span>
        limit=3.*sigma
        weights = float(abs(dev) LE limit)
     endif
     diff = 0. <span class="comments">; (skip rest of routine)</span>
  endif

<span class="comments">; Repeat:</span>
  while( (diff gt close_enough) and (itnum lt maxit) )do begin
    itnum = itnum + 1
    uu = ( (y-y0)/(6.*sigma) )^2
    uu = uu &lt<span class="comments">; 1.</span>
    weights=(1.-uu)^2       & weights=weights/total(weights)
    y0 = total( weights*y ) 
    dev = y-y0
    prev_sigma = sigma      & sigma = robust_sigma( dev,/zero )
    if sigma gt eps then diff=abs(prev_sigma-sigma)/prev_sigma else diff=0.
  endwhile

return,y0
end
</code>
    </div>
  </body>
</html>