<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:58:07 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>tbhelp.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="tbhelp.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="tbhelp:source"></a>pro tbhelp,h, TEXTOUT = textout
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;       TBHELP</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;       Routine to print a description of a FITS binary table header</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;       TBHELP, h, [TEXTOUT = ]</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;       h - FITS header for a binary table, string array</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUT KEYWORD:</span>
<span class="comments">;       TEXTOUT - scalar number (0-7) or string (file name) controling </span>
<span class="comments">;               output device (see TEXTOPEN).  Default is TEXTOUT=1, output </span>
<span class="comments">;               to the user's terminal    </span>
<span class="comments">;</span>
<span class="comments">; METHOD:</span>
<span class="comments">;       FITS Binary Table keywords NAXIS*,EXTNAME,TFIELDS,TTYPE*,TFORM*,TUNIT*,</span>
<span class="comments">;       are read from the header and displayed at the terminal</span>
<span class="comments">;</span>
<span class="comments">;       A FITS header is recognized as bein for a binary table if the keyword </span>
<span class="comments">;       XTENSION has the value 'BINTABLE' or 'A3DTABLE'</span>
<span class="comments">;</span>
<span class="comments">; NOTES:</span>
<span class="comments">;       Certain fields may be truncated in the display</span>
<span class="comments">; SYSTEM VARIABLES:</span>
<span class="comments">;       Uses the non-standard system variables !TEXTOUT and !TEXTUNIT.   These</span>
<span class="comments">;       are automatically defined by TBHELP if they have not been defined</span>
<span class="comments">;       previously. </span>
<span class="comments">; PROCEDURES USED:</span>
<span class="comments">;       REMCHAR, SXPAR(), TEXTCLOSE, TEXTOPEN, ZPARCHECK </span>
<span class="comments">; HISTORY:</span>
<span class="comments">;       W. Landsman       February, 1991</span>
<span class="comments">;       Parsing of a FITS binary header made more robust    May, 1992</span>
<span class="comments">;       Added TEXTOUT keyword      August 1997</span>
<span class="comments">;       Define !TEXTOUT if not already present   W. Landsman  November 2002</span>
<span class="comments">;       Slightly more compact display   W. Landsman August 2005</span>
<span class="comments">;       Fix Aug 2005 error omitting TFORM display W. Landsman Sep 2005</span>
<span class="comments">;-</span>
 compile_opt idl2
 On_error,2

 if N_params() LT 1 then begin
     print,'Syntax - tbhelp, hdr, [TEXTOUT= ]'     
     return
 endif
<span class="comments">; Define !TEXTOUT and !TEXTUNIT if not already present</span>
 defsysv,'!TEXTOUT',exists=ex                  <span class="comments">; Check if !TEXTOUT exists.</span>
 if ex eq 0 then defsysv,'!TEXTOUT',1          <span class="comments">; If not define it.</span>
 defsysv,'!TEXTUNIT',exists=ex                 <span class="comments">; Check if !TEXTUNIT exists.</span>
 if ex eq 0 then defsysv,'!TEXTUNIT',0         <span class="comments">; If not define it.</span>

 zparcheck, 'TBHELP', h, 1, 7, 1, 'Table Header'

 naxis = sxpar( h, 'NAXIS*')
 if N_elements(naxis) LT 2 then $
         message,'ERROR - FITS Binary table must have NAXIS = 2'

 ext_type = strmid( strtrim( sxpar( h, 'XTENSION'), 2 ), 0, 8)
 if (ext_type NE 'A3DTABLE') and (ext_type NE 'BINTABLE') then message, $
 'WARNING - Header type of ' + ext_type + ' is not for a FITS Binary Table',/CON

 n = sxpar( h, 'TFIELDS', Count = N_tfields)  
 if N_tfields EQ 0 then message, $
        'ERROR - Required TFIELDS keyword is missing from binary table header'

 tform = sxpar(h,'TFORM*', Count = N_tform)      <span class="comments">;Get required TFORM* values</span>
 n = n > N_tform
 
 if not keyword_set(TEXTOUT) then textout = !TEXTOUT
 textopen,'tbhelp',TEXTOUT=textout

 printf,!TEXTUNIT,'FITS Binary Table: ' + $
        'Size ',strtrim(naxis[0],2),' by ',strtrim(naxis[1],2)
 extname = sxpar(h,'EXTNAME', Count=N_ext)	
 if N_ext GT 0 then printf,!TEXTUNIT, 'Extension Name:   ',sxpar(h,'EXTNAME')

 tnull =  strarr(n)
 tunit = tnull & ttype =tnull & tcomm = tnull
 key = strmid( h, 0, 5)
 for i = 1, N_elements(h)-1 do begin

 case key[i] of
 'TTYPE':   begin
           j = fix(strtrim(strmid(h[i],5,3),2))
          apos = strpos( h[i], "'") 
          ttype[j-1] = strmid( h[i], apos+1, 20)
          slash = strpos(h[i],'/')
          if slash GT 0 then $
              tcomm[j-1] = strcompress( strmid(h[i], slash+1, 55))
          end

 'TUNIT':  begin 
          apos = strpos( h[i], "'") 
          tunit[fix(strtrim(strmid(h[i],5,3),2))-1] = strmid(h[i],apos+1,20)
          end
 'TNULL':  begin
          tnull[fix(strtrim(strmid(h[i],5,3),2))-1] = $
                                 strtrim( strmid( h[i], 10, 20 ),2)
          end
 'END  ':  goto, DONE 
 ELSE :
 endcase
 endfor

DONE:
 remchar,ttype,"'" & ttype = strtrim(ttype,2)
 remchar,tunit,"'" & tunit = strtrim(tunit,2)
 tform = strtrim(tform,2)
 remchar,tnull,"'" & tnull = strtrim(tnull,2)
 len_ttype = strtrim( max(strlen(ttype)) > 4,2)
 len_tunit = strtrim( max(strlen(tunit)) > 4,2)
 len_tform = strtrim( max(strlen(tform)) > 4,2)
 len_tnull = strtrim( max(strlen(tnull)) > 4,2)


 fmt = '(A5,1x,A' + len_ttype +',1x,A' + len_tunit + ',1x,A' + len_tform + $
        ',1x,A' + len_tnull +',1x,A)'

 printf,!TEXTUNIT,'Field','Name','Unit','Frmt','Null','Comment',f=fmt
 
 field = strtrim(sindgen(n)+1,2)
 for i=0,n-1 do begin 
        printf,!TEXTUNIT,field[i],ttype[i],tunit[i],tform[i],tnull[i],tcomm[i], $
                format=fmt
 endfor

 textclose, TEXTOUT = textout
 return
 end
</code>
    </div>
  </body>
</html>