<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:39 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>get_coords.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="get_coords.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="GET_COORDS:source"></a>pro GET_COORDS, Coords, PromptString, NumVals, InString=InString, Quiet=Quiet
<span class="comments">;*******************************************************************************</span>
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;       GET_COORDS</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;       Converts a string with angular coordinates  to floating point values.  </span>
<span class="comments">; EXPLANATION:</span>
<span class="comments">;       Although called by ASTRO.PRO, this is a general purpose routine.</span>
<span class="comments">;       The user may input as floating point or sexagesimal.  If user inputs </span>
<span class="comments">;       calling procedure's job to convert hours to degrees if needed.</span>
<span class="comments">;       Since the input string is parsed character-by-character, ANY character</span>
<span class="comments">;       that is not a digit, minus sign or decimal point may be used as a </span>
<span class="comments">;       delimiter, i.e. acceptable examples of user input are:</span>
<span class="comments">;</span>
<span class="comments">;       1:03:55 -10:15:31</span>
<span class="comments">;       1 3 55.0 -10 15 31</span>
<span class="comments">;       1*3 55              -10abcd15efghij31</span>
<span class="comments">;       1.065278  hello   -10.25861</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;       GET_COORDS, Coords, [ PromptString, NumVals, INSTRING =, /QUIET ]</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUT:</span>
<span class="comments">;       PromptString - A string to inform the user what data are to be entered</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL KEYWORD INPUT:</span>
<span class="comments">;       InString - a keyword that, if set, is assumed to already contain the</span>
<span class="comments">;               input data string to be parsed.  If this keyword is set, then</span>
<span class="comments">;               the user is not prompted for any input.</span>
<span class="comments">;       /Quiet - if set the program won't printout any error messages, but bad</span>
<span class="comments">;               input is still flagged by Coords=[-999,-999].</span>
<span class="comments">;</span>
<span class="comments">; OUTPUT:</span>
<span class="comments">;       Coords - a 2 element floating array containing the coordinates.  The</span>
<span class="comments">;               vector [-999,-999] is returned if there has been an error.</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL OUTPUT:</span>
<span class="comments">;       NumVals - the number of separate values entered by the user:  2 if the</span>
<span class="comments">;               user entered the coordinates as floating point numbers, 6 if </span>
<span class="comments">;               the user entered the coordinates as sexagesimal numbers.  Some</span>
<span class="comments">;               calling procedures might find this information useful (e.g., to</span>
<span class="comments">;               to print some output in the same format as the user's input).</span>
<span class="comments">;</span>
<span class="comments">; REVISION HISTORY:</span>
<span class="comments">;       Written by Joel Parker, 5 MAR 90</span>
<span class="comments">;       Included InString and Quiet keywords.  Cleaned up some of the code and</span>
<span class="comments">;       comments.  JWmP,  16 Jun 94</span>
<span class="comments">;</span>
<span class="comments">;*******************************************************************************</span>
<span class="comments">;       Converted to IDL V5.0   W. Landsman   September 1997</span>
<span class="comments">;-</span>

On_error,2

if (N_params() eq 0) then begin
      print,'Syntax - ' + $
         'GET_COORDS, Coords, [PromptString, NumVals, INSTRING=, /QUIET]'
      return
endif 

<span class="comments">;</span>
<span class="comments">;   Define some parameters and variables.</span>
<span class="comments">;</span>
if (N_Params() lt 2) then PromptString = " Please input the coordinates"
Bell     = string(7B)
Minus    = 45      <span class="comments">; ascii of "-"</span>
Decimal  = 46      <span class="comments">; ascii of "."</span>
Zero     = 48      <span class="comments">; ascii of "0"</span>
Nine     = 57      <span class="comments">; ascii of "9"</span>
ValArr   = dblarr(6)
SignArr  = intarr(6) + 1
NumVals  = 0
StartPos = -1

<span class="comments">;</span>
<span class="comments">;    If the InString keyword is not set, then prompt the user for input.  If </span>
<span class="comments">; nothing is entered, return [-999,-999] as a warning flag to the calling </span>
<span class="comments">; procedure.</span>
<span class="comments">;</span>
if keyword_set(InString) then begin
   Coords = InString
endif else begin
   Coords = ""
   print,form =  "$(1X,A,$)", + PromptString + " {RETURN to exit} "
   read, Coords
endelse

Coords = strtrim(Coords) + " "  <span class="comments">; The final space is needed for parsing purposes</span>
if (Coords eq " ") then begin
   Coords = [-999,-999]
   return
endif

<span class="comments">;</span>
<span class="comments">;   All's well.  Get the byte values for the characters in the input string.</span>
<span class="comments">;</span>
BCoords = byte(Coords)

<span class="comments">;</span>
<span class="comments">;   Begin the loop that parses the input string.</span>
<span class="comments">;   Start by loading the byte value of the next character into the BC variable.</span>
<span class="comments">; Check to see if the character is a minus sign (if so, set the flag in the </span>
<span class="comments">; SignArr array to -1).  Check to see if the character is a numeral between 0-9 </span>
<span class="comments">; or a decimal (if so, then the NumFlag is set to 1).</span>
<span class="comments">;</span>
for N = 0,(strlen(Coords)-1) do begin
   BC = BCoords[N]
   if (BC eq Minus) then SignArr[NumVals] = -1
   NumFlag = ((BC ge Zero) and (BC le Nine)) or (BC eq Decimal)

<span class="comments">;</span>
<span class="comments">;   If the number flag is set, but StartPos = -1, then we are starting a new </span>
<span class="comments">; value.  Load the character's position in StartPos.</span>
<span class="comments">;</span>
   if (NumFlag and (StartPos eq -1)) then StartPos = N

<span class="comments">;</span>
<span class="comments">;     If the number flag is NOT set, but StartPos > -1, then we have just </span>
<span class="comments">; finished reading a number.  Read the number from StartPos to the current </span>
<span class="comments">; position, and reset StartPos to -1.</span>
<span class="comments">;   Put the resulting number in the ValArr.</span>
<span class="comments">;</span>
   if (~(NumFlag) && (StartPos gt -1)) then begin
      if (NumVals lt 6) then begin
         ValArr[NumVals] = float(strmid(Coords, StartPos, (N - StartPos)))
      endif
      StartPos = -1
      NumVals  = NumVals + 1
   endif
endfor

<span class="comments">;</span>
<span class="comments">;   Coords should be a 2 or 6 element vector {depending on the type of input}.</span>
<span class="comments">; It is converted to a 2 element vector such that Coords = [RA/Long, Dec/Lat].</span>
<span class="comments">;</span>
case NumVals of

   2 : Coords = (ValArr * SignArr)[0:1]

   6 : begin
      Temp = where(SignArr[0:2] eq -1)
      if (Temp[0] eq -1) then XSign = 1 else XSign = -1
      Temp = where(SignArr[3:5] eq -1)
      if (Temp[0] eq -1) then YSign = 1 else YSign = -1
      X = (ValArr[0] + (ValArr[1] / 60.) + (ValArr[2] / 3600.)) * XSign
      Y = (ValArr[3] + (ValArr[4] / 60.) + (ValArr[5] / 3600.)) * YSign
      Coords = [X,Y]
   end

   else : begin
      Coords = [-999,-999]
      if ~keyword_set(Quiet) then begin
         print, Bell
         print, "ERROR - Invalid Input!"
         print, "Coordinates must be input as 2 or 6 values."
         print, "For example:  1.568 -10.343   or  1 34 4.8  10 20 34.8"
      endif
   endelse

endcase

return
end   <span class="comments">;   procedure GET_COORDS   by   Joel Parker   16 Jun 94</span>
</code>
    </div>
  </body>
</html>