<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:58:04 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>sxhwrite.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="sxhwrite.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="sxhwrite:source"></a>pro sxhwrite,name,h
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;       SXHWRITE</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;       Procedure to write an STSDAS or FITS header to disk as a *.hhh file.</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;       SXHWRITE,name,h</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;       name - file name. If an extension is supplied it must be 3 characters</span>
<span class="comments">;               ending in "h".</span>
<span class="comments">;       h - FITS header, string array</span>
<span class="comments">;</span>
<span class="comments">; SIDE EFFECTS:</span>
<span class="comments">;       File with specified name is written.  If qualifier not specified</span>
<span class="comments">;       then .hhh is used</span>
<span class="comments">;   </span>
<span class="comments">;       SXHWRITE will modify the header in the following ways, if necessary</span>
<span class="comments">;       (1)  If not already present, an END statement is added as the </span>
<span class="comments">;               last line.   Lines after an existing END statment are</span>
<span class="comments">;               deleted.</span>
<span class="comments">;       (2)  Spaces are appended to force each line to be 80 characters.</span>
<span class="comments">;       (3)  On Unix machines, a carriage return is appended at the end</span>
<span class="comments">;               of each line.   This is consistent with STSDAS and allows</span>
<span class="comments">;               the file to be directly displayed on a stream device</span>
<span class="comments">;</span>
<span class="comments">; PROCEDURES USED:</span>
<span class="comments">;       zparcheck, fdecomp</span>
<span class="comments">; HISTORY:</span>
<span class="comments">;       version 1  D. Lindler  June 1987</span>
<span class="comments">;       conversion cleaned up.  M. Greason, June 1990</span>
<span class="comments">;       Add carriage return at the end of Unix files   W. Landsman Oct 1991</span>
<span class="comments">;       Use SYSTIME() instead of !STIME for V5.0 compatibility Aug 1997</span>
<span class="comments">;       Assume since V55, remove VMS support</span>
<span class="comments">;-</span>
<span class="comments">;----------------------------------------------------------------</span>
 compile_opt idl2
 On_error,2 
 if N_params() LT 2 then begin
    print,'Syntax - SXHWRITE, name, hdr'
    return
 endif

<span class="comments">; Create output file name</span>

 ZPARCHECK, 'SXHWRITE', name, 1, 7, 0, 'Disk file name'  <span class="comments">;Check for valid param</span>
 FDECOMP,name, disk, dir, file, qual
 if ( qual EQ '' ) then qual = 'hhh'                    <span class="comments">;default qualifier</span>

<span class="comments">; Check for valid qualifier</span>

 if ( strlen(qual) NE 3 ) || ( strupcase(strmid(qual,2,1)) NE 'H' ) then $
        message,'Qualifier on file name must be 3 characters, ending in h'

 hname = disk + dir + file + '.' + qual           <span class="comments">;header file name</span>

<span class="comments">; Check that valid FITS header was supplied</span>

 ZPARCHECK, 'SXHWRITE', h, 2, 7, 1, 'FITS header'

 sxdelpar,'XTENSION',h       <span class="comments">;For SDAS header SIMPLE must be the first line</span>
 SXADDPAR, h, 'SIMPLE', 'F', ' Written by IDL:  ' + systime()

<span class="comments">; Determine if an END line occurs, and add one if necessary</span>

 endline = where( strtrim( strmid(h,0,8), 2) EQ 'END', Nend)
 if Nend EQ 0 then begin

    message, /INF, $
        'WARNING - An END statement has been appended to the FITS header'
    h = [ h, 'END' + string( replicate(32b,77) ) ]
    endline = N_elements(h) - 1 

 endif
 nmax = endline[0] + 1

<span class="comments">; Convert to byte and force into 80 character lines</span>

 temp = replicate( 32b, 80, nmax)
 for n = 0, endline[0] do temp[0,n] = byte( h[n] )

<span class="comments">; Under Unix append a carriage return ( = string(10b) )</span>

 temp = [ temp, rotate( replicate(10b,nmax), 1 ) ]

<span class="comments">; Open the output file and write as byte array.</span>

 openw, unit, hname, 80, /GET_LUN
 writeu, unit, temp
 free_lun,unit

 return
 end
</code>
    </div>
  </body>
</html>