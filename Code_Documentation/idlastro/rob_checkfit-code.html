<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:58:01 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>rob_checkfit.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="rob_checkfit.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source">FUNCTION ROB_CHECKFIT,Y, YFIT, EPS, DEL, SIG, FRACDEV, NGOOD,W,B,$
                      BISQUARE_LIMIT=BLIM
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;	ROB_CHECKFIT</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;	Used by ROBUST_... routines to determine the quality of a fit and to</span>
<span class="comments">;	return biweights.</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;	status = ROB_CHECKFIT( Y, YFIT, EPS, DEL, SIG, FRACDEV, NGOOD, W, B</span>
<span class="comments">;				BISQUARE_LIMIT = )</span>
<span class="comments">; INPUT:</span>
<span class="comments">;	Y     = the data</span>
<span class="comments">;	YFIT  = the fit to the data</span>
<span class="comments">;	EPS   = the "too small" limit</span>
<span class="comments">;	DEL   = the "close enough" for the fractional median abs. deviations</span>
<span class="comments">; RETURNS:</span>
<span class="comments">;	Integer status. if =1, the fit is considered to have converged</span>
<span class="comments">;</span>
<span class="comments">; OUTPUTS:</span>
<span class="comments">;	SIG   = robust standard deviation analog</span>
<span class="comments">;	FRACDEV = the fractional median absolute deviation of the residuals</span>
<span class="comments">;	NGOOD   = the number of input point given non-zero weight in the </span>
<span class="comments">;		calculation</span>
<span class="comments">;	W     = the bisquare weights of Y</span>
<span class="comments">;	B     = residuals scaled by sigma</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUT KEYWORD:</span>
<span class="comments">;	BISQUARE_LIMIT = allows changing the bisquare weight limit from </span>
<span class="comments">;			default 6.0</span>
<span class="comments">; PROCEDURES USED:</span>
<span class="comments">;       ROBUST_SIGMA()</span>
<span class="comments">; REVISION HISTORY:</span>
<span class="comments">;	Written, H.T. Freudenreich, HSTX, 1/94</span>
<span class="comments">;-</span>

  ISTAT = 0

  IF KEYWORD_SET(BLIM) THEN BFAC=BLIM ELSE BFAC=6.

  DEV = Y-YFIT

  SIG=ROBUST_SIGMA(DEV,/ZERO)
<span class="comments">; If the standard deviation = 0 then we're done:</span>
  IF SIG LT EPS THEN GOTO,DONE 

  IF DEL GT 0. THEN BEGIN
   <span class="comments">; If the fraction std. deviation ~ machine precision, we're done:</span>
     Q=WHERE( ABS(YFIT) GT EPS, COUNT )
     IF COUNT LT 3 THEN FRACDEV = 0. ELSE $
                        FRACDEV = MEDIAN(ABS( DEV[Q]/YFIT[Q] ),/EVEN )
     IF FRACDEV LT DEL THEN GOTO,DONE
  ENDIF

  ISTAT = 1

<span class="comments">; Calculate the (bi)weights:</span>
  B = ABS(DEV)/(BFAC*SIG)
  S = WHERE( B GT 1.0,COUNT )  &  IF COUNT GT 0 THEN B[S] = 1.
  NGOOD = N_ELEMENTS(Y)-COUNT
  
  W=(1.-B^2)
  W=W/TOTAL(W)
DONE:
RETURN, ISTAT
END
</code>
    </div>
  </body>
</html>