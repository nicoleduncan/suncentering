<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:57 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>qtrap.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="qtrap.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id=":source"></a>pro  qtrap, func, A, B, S, EPS=eps, MAX_ITER = max_iter, _EXTRA = _Extra
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;       QTRAP</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;       Integrate using trapezoidal rule to specified accuracy.</span>
<span class="comments">; EXPLANATION:</span>
<span class="comments">;       Integrate a function to specified accuracy using the extended </span>
<span class="comments">;       trapezoidal rule.   Adapted from Numerical Recipes (1992, 2nd edition),</span>
<span class="comments">;       Section 4.2. </span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;       QTRAP, func, A, B, S, [EPS = , MAX_ITER =, _EXTRA = ]</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;       func - scalar string giving name of function of one variable to </span>
<span class="comments">;               be integrated</span>
<span class="comments">;       A,B  - numeric scalars giving the lower and upper bound of the </span>
<span class="comments">;               integration</span>
<span class="comments">;</span>
<span class="comments">; OUTPUTS:</span>
<span class="comments">;       S - Scalar giving the approximation to the integral of the specified</span>
<span class="comments">;               function between A and B.</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL KEYWORD PARAMETERS:</span>
<span class="comments">;       EPS - scalar specify the fractional accuracy before ending the </span>
<span class="comments">;             iteration.    Default = 1E-6</span>
<span class="comments">;       MAX_ITER - Integer specifying the total number iterations at which </span>
<span class="comments">;               QTRAP will terminate even if the specified accuracy has not yet</span>
<span class="comments">;               been met.    The maximum number of function evaluations will </span>
<span class="comments">;               be 2^(MAX_ITER).   Default value is MAX_ITER = 20</span>
<span class="comments">;</span>
<span class="comments">;       Any other keywords are passed directly to the user-supplied function</span>
<span class="comments">;       via the _EXTRA facility.</span>
<span class="comments">; NOTES:</span>
<span class="comments">;       QTRAP is robust way of doing integrals that are not very smooth.  If the</span>
<span class="comments">;       function has a continuous 3rd derivative then the function QSIMP will </span>
<span class="comments">;          likely be more efficient at performing the integral.</span>
<span class="comments">; EXAMPLE:</span>
<span class="comments">;       Compute the integral of sin(x) from 0 to !PI/3.</span>
<span class="comments">;    </span>
<span class="comments">;       IDL> QTRAP, 'sin', 0, !PI/3, S   & print,S</span>
<span class="comments">;   </span>
<span class="comments">;       The value obtained should be cos(!PI/3) = 0.5</span>
<span class="comments">;</span>
<span class="comments">; PROCEDURES CALLED:</span>
<span class="comments">;       TRAPZD, ZPARCHECK</span>
<span class="comments">; REVISION HISTORY:</span>
<span class="comments">;       W. Landsman         ST Systems Co.         August, 1991</span>
<span class="comments">;       Continue after Max Iter warning message, W. Landsman  March 1996</span>
<span class="comments">;       Converted to IDL V5.0   W. Landsman   September 1997</span>
<span class="comments">;       Pass keyword to function via _EXTRA facility  W. Landsman July 1999</span>
<span class="comments">;-</span>
 On_error,2                                      <span class="comments">;Return to caller</span>
 compile_opt idl2

 if N_params() LT 4 then begin
    print,'Syntax - QTRAP, func, A, B, S, [ Eps = , MAX_ITER = ]
    print,' func - scalar string giving function name
    print,' A,B - endpoints of integration, S - output sum'
    return
 endif

 zparcheck, 'QTRAP', func, 1, 7, 0, 'Function name'          <span class="comments">;Valid inputs?</span>
 zparcheck, 'QTRAP', A, 2, [1,2,3,4,5], 0, 'Lower limit of Integral'
 zparcheck, 'QTRAP', B, 3, [1,2,3,4,5], 0, 'Upper limit of Integral'

 if ~keyword_set( EPS ) then eps = 1.e-6
 if ~keyword_set( MAX_ITER ) then max_iter = 20
 olds = -1.e30

 for i = 0, max_iter-1 do begin

    trapzd, func, A, B, S, it, _EXTRA = _EXTRA
    if ( abs(S-oldS) LT eps*abs(oldS) ) then return
    olds = s

 endfor

 message,/CON, $
        'WARNING - Sum did not converge after '+ strtrim(max_iter,2) + ' steps'

 return
 end
</code>
    </div>
  </body>
</html>