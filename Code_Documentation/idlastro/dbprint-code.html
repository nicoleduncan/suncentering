<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:27 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>dbprint.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="dbprint.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="dbprint:source"></a>pro dbprint,list,items, FORMS=forms, TEXTOUT=textout, NoHeader = noheader, $
           Adjustformat = adjustformat
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;     DBPRINT</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;     Procedure to print specified items from a list of database entries</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:     </span>
<span class="comments">;     dbprint, list, [items, FORMS= , TEXTOUT= , /AdjustFormat, /NoHeader]  </span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;     list  - list of entry numbers to be printed, vector or scalar </span>
<span class="comments">;               if list = -1, then all entries will be printed.</span>
<span class="comments">;               An error message is returned if any entry number is larger</span>
<span class="comments">;               than the number of entries in the database</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUT-OUTPUT:</span>
<span class="comments">;     items - items to be printed, specified in any of the following ways:</span>
<span class="comments">;</span>
<span class="comments">;               form 1  scalar string giving item(s) as list of names</span>
<span class="comments">;                       separated by commas</span>
<span class="comments">;               form 2  string array giving list of item names</span>
<span class="comments">;               form 3  string of form '$filename' giving name</span>
<span class="comments">;                       of text file containing items (one item per</span>
<span class="comments">;                       line)</span>
<span class="comments">;               form 4  integer scalar giving single item number or</span>
<span class="comments">;                         integer vector list of item numbers</span>
<span class="comments">;               form 5  Null string specifying interactive selection.   This</span>
<span class="comments">;                       is the default if 'items' is not supplied</span>
<span class="comments">;               form 6  '*'     select all items, printout will be in</span>
<span class="comments">;                       table format. </span>
<span class="comments">;</span>
<span class="comments">;            If items was undefined or a null string on input, then</span>
<span class="comments">;            on output it will contain the items interactively selected.</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUT KEYWORDS:</span>
<span class="comments">;       /ADJUSTFORMAT -  If set, then the format length for string items will</span>
<span class="comments">;               be adjusted to the maximum length for the entries to be printed.</span>
<span class="comments">;               This option will slow down DBPRINT because it requires the </span>
<span class="comments">;               string items be extracted and their maximum length determined </span>
<span class="comments">;               prior to any printing.   However, it enables the display of</span>
<span class="comments">;               string items without any truncation or wasted space. </span>
<span class="comments">;</span>
<span class="comments">;       FORMS - The number of printed lines per page. If forms is not </span>
<span class="comments">;               present, output assumed to be in PORTRAIT form, and </span>
<span class="comments">;               a heading and 47 lines are printed on each page, with</span>
<span class="comments">;               a page eject between each page.  For LANDSCAPE form with</span>
<span class="comments">;               headings on each page, and a page eject between pages, set </span>
<span class="comments">;               forms = 34.  For a heading only on the first page, and no</span>
<span class="comments">;               page eject, set forms = 0.   This is the default for output</span>
<span class="comments">;               to the terminal.</span>
<span class="comments">;</span>
<span class="comments">;       TEXTOUT - Integer (0-7) or string used to determine output device (see </span>
<span class="comments">;               TEXTOPEN for more info).  If not present, the !TEXTOUT system </span>
<span class="comments">;               variable is used.</span>
<span class="comments">;               textout=0       Nowhere</span>
<span class="comments">;               textout=1       if a TTY then TERMINAL using /more option</span>
<span class="comments">;                                   otherwise standard (Unit=-1) output</span>
<span class="comments">;               textout=2       if a TTY then TERMINAL without /more option</span>
<span class="comments">;                                   otherwise standard (Unit=-1) output</span>
<span class="comments">;               textout=3       dbprint.prt (file)</span>
<span class="comments">;               textout=4       laser.tmp</span>
<span class="comments">;               textout=5       user must open file</span>
<span class="comments">;               textout=7      same as 3 but text is appended to &lt;program>.prt</span>
<span class="comments">;               textout = filename   (default extension of .prt)</span>
<span class="comments">;</span>
<span class="comments">;       /NOHEADER - If this keyword is set, then the column headers will not</span>
<span class="comments">;               be printed</span>
<span class="comments">;</span>
<span class="comments">; EXAMPLE:</span>
<span class="comments">;       The following example shows how a multiple valued item DATAMAX can be </span>
<span class="comments">;       printed as separate columns.   In the WFPC2 target database, DATAMAX</span>
<span class="comments">;       is an item with 4 values, one for each of the 4 chips</span>
<span class="comments">;</span>
<span class="comments">;       IDL> dbopen,'wflog'</span>
<span class="comments">;       IDL> dbprint,list,'entry,datamax(0),datamax(1),datamax(2),datamax(3)'</span>
<span class="comments">;</span>
<span class="comments">; SYSTEM VARIABLES:</span>
<span class="comments">;       Output device controlled by non-standard system varaible !TEXTOUT, if </span>
<span class="comments">;       TEXTOUT keyword is not used.    </span>
<span class="comments">;</span>
<span class="comments">; NOTES:</span>
<span class="comments">;       Users may want to adjust the default lines_per_page value given at</span>
<span class="comments">;       the beginning of the program for their own particular printer.</span>
<span class="comments">; PROCEDURE CALLS:</span>
<span class="comments">;       db_info(), db_item_info(), dbtitle(), dbxval(), textopen, textclose</span>
<span class="comments">;       zparcheck</span>
<span class="comments">; HISTORY:</span>
<span class="comments">;       version 2  D. Lindler  Nov. 1987 (new db format)</span>
<span class="comments">;       Test if user pressed 'Q' in response to /MORE W. Landsman  Sep 1991</span>
<span class="comments">;       Apply STRTRIM to free form (table) output    W. Landsman   Dec 1992</span>
<span class="comments">;       Test for string value of TEXTOUT         W. Landsman   Feb 1994</span>
<span class="comments">;       William Thompson, GSFC, 3 November 1994</span>
<span class="comments">;                       Modified to allow ZDBASE to be a path string.</span>
<span class="comments">;       W. Landsman, GSFC, July, 1997, Use CATCH to catch errors</span>
<span class="comments">;       Removed STRTRIM in table format output to handle byte values April 1999</span>
<span class="comments">;       Fixed occasional problem when /NOHEADER is supplied   Sep. 1999</span>
<span class="comments">;       Only byteswap when necessary for improved performance  Feb. 2000</span>
<span class="comments">;       Change loop index for table listing to type LONG  W. Landsman Aug 2000</span>
<span class="comments">;       Entry vector can be any integer type   W. Landsman Aug. 2001</span>
<span class="comments">;       Replace DATATYPE() with size(/TNAME)   W. Landsman  Nov. 2001</span>
<span class="comments">;       No page eject for TEXTOUT =5           W. Landsman  Nov. 2001</span>
<span class="comments">;       No initial page eject                  W. Landsman  Jan. 2002</span>
<span class="comments">;       Added AdjustFormat keyword             W. Landsman  Sep. 2002</span>
<span class="comments">;       Assume since V5.3 (STRJOIN)            W. Landsman Feb. 2004</span>
<span class="comments">;       Fix display on GUI terminals           W. Landsman March 2006</span>
<span class="comments">;       Remove VMS statements                  W. Landsman Sep 2006</span>
<span class="comments">;       Remove EXECUTE statement               W. Landsman Jan 2007</span>
<span class="comments">;       Fix display of multi element items     W. Landsman  Aug 2010</span>
<span class="comments">;       Fix problem with linked databases      W. Landsman Dec 2011</span>
<span class="comments">;-</span>
<span class="comments">;</span>
 On_error,2                                <span class="comments">;Return to caller</span>
 compile_opt idl2

 if N_params() EQ 0 then begin
       print,'Syntax - DBPRINT, list, items, '
       print,'             [ FORMS = , TEXTOUT =, /NoHeader, /AdjustFormat ]'
       return
 endif

 lines_per_page = 47                 <span class="comments">;Default # of lines per page</span>
 zparcheck, 'DBPRINT', list, 1, [1,2,3,4,5,12,13,14,15], [0,1],  $
            'Entry List Vector'

 catch, error_status
 if error_status NE 0 then begin 
       print,!ERR_STRING
       return
  endif


<span class="comments">; Make list a vector</span>

 nentry = db_info( 'ENTRIES', 0)
 if nentry EQ 0 then message,'ERROR - Database contains no entries'
 if list[0] EQ -1 then list = lindgen(nentry) + 1 
 dbname = strlowcase( db_info( 'NAME', 0 ))

 if max(list) GT nentry then message, dbname + $
     ' entry numbers must be between 1 and ' + strtrim( nentry, 2 )
  nv = N_elements(list)                 <span class="comments">;number of entries requested</span>

<span class="comments">; No need for byteswapping if data is not external or it is a big endian machine</span>

   noconvert = ~db_info('EXTERNAL',0) || is_ieee_big()      <span class="comments">;Updated Dec 11</span>
    
<span class="comments">; Determine items to print</span>

 if N_params() EQ 1 then begin

      file = find_with_def(dbname +'.items', 'ZDBASE')
      if file NE '' then items = '$' + file else items = '' 

 endif
 
 db_item, items, it, ivalnum, dtype, sbyte, numvals, nbytes
 numvals = numvals&lt<span class="comments">;1                    ;can't print vectors</span>
 nvalues = db_item_info( 'NVALUES', it )        <span class="comments">;number of values in item</span>
 qnumit = db_info( 'ITEMS' )                    <span class="comments">;number of items</span>
 nitems = N_elements( it )                      <span class="comments">;number of items requested</span>
 qnames = db_item_info( 'NAME', it )
 qtitle = db_info( 'TITLE', 0 )         <span class="comments">;data base title</span>

<span class="comments">; Open output text file</span>

 if ~keyword_set(TEXTOUT) then textout = !textout  <span class="comments">;use default output dev.</span>
textopen, dbname, TEXTOUT = textout, more_set = more_set
 if size(TEXTOUT,/TNAME) EQ 'STRING' then text_out = 5 else text_out = textout
 if (nitems EQ qnumit)  then begin

<span class="comments">; Create table listing of each item specified. -------------------------</span>

 for i = 0L, nv-1 do begin
      dbrd, list[i], entry, noconvert = noconvert   <span class="comments">; read an entry.</span>
      printf, !TEXTUNIT, ' '                        <span class="comments">; print  blank line.</span>

<span class="comments">; display name and value for each entry </span>

      for k = 0, qnumit-1  do begin
         <span class="comments">;.</span>
         <span class="comments">; only print entries of reasonable size... &lt; 5 values in item.</span>
       
         if ( nvalues[k] LT 5 ) then begin
            somvar = $        
	    dbxval(entry,dtype[k],nvalues[k],sbyte[k],nvalues[k]*nbytes[k]) 
            if dtype[k] EQ 1 then somvar=fix(somvar)
            printf,!textunit,k,') ',qnames[k], strtrim(somvar,2)
                                                        <span class="comments">;display name,value</span>
         endif                                               
       endfor   <span class="comments">; k</span>

    endfor      <span class="comments">; i</span>

 printf,!textunit,' '                         <span class="comments">;Added 11/90</span>
 
 end else begin

<span class="comments">; get info on items</span>

   formats = db_item_info( 'FORMAT', it )
   flen = db_item_info( 'FLEN', it )            <span class="comments">;field lengths</span>
   nvals = db_item_info( 'NVALUES', it )        <span class="comments">;larger than one for vector items</span>
<span class="comments">;</span>
<span class="comments">; If /AdjustFormat set, then extract all string vectors and find their maximum</span>
<span class="comments">; length.   Then update the formats and flen vectors accordingly</span>
<span class="comments">;</span>
   if keyword_set(adjustFormat) then begin
     stringvar = where(dtype EQ 7, Nstring)
     if Nstring GT 0 then begin
       alen = intarr(Nstring)
       varnames = 'v' + strtrim(indgen(Nstring)+1,2)
       stringitems = strjoin(varnames,',') 
       for i=0, Nstring-1 do begin
            dbext,list,it[stringvar[i]], vv
            alen[i] = max(strlen(strtrim(temporary(vv),2)))
     endfor
       flen[stringvar] = alen
       formats[stringvar] = 'A' + strtrim(alen,2)
     endif
  endif

<span class="comments">; Set up format array</span>

   form = '(' + strtrim(formats,2)      + ')'   <span class="comments">;remove blanks, and add paren</span>

   linelength = total(flen) + nitems            <span class="comments">;length of output lines</span>
   dash = byte('-') & dash = dash[0]
   dashes = ' '+string( replicate( dash, linelength ) )
<span class="comments">;</span>
   if ~keyword_set( NoHeader) then begin

      title = string( replicate(byte(32), linelength>42) )
      strput, title, qtitle, (linelength-40)/2>1           <span class="comments">;center title</span>

<span class="comments">; Extract headers</span>

    headers = db_item_info( 'HEADERS', it )
    c1 = strmid( headers,0,15 )
    c2 = strmid( headers,15,15 )
    c3 = strmid( headers,30,15 )

<span class="comments">; Place value numbers for multiple valued items in h3</span>
    for i = 0,nitems-1 do begin
          if nvals[i] GT 1 then $       <span class="comments">;multiple values?</span>
             c3[i] = '[' + strtrim(string(ivalnum[i]),2) + ']'
    endfor        <span class="comments">;i</span>

    h1 = dbtitle( c1,flen )
    h2 = dbtitle( c2,flen )
    h3 = dbtitle( c3,flen )

 endif

<span class="comments">; Loop on entries</span>

 hardcopy = (text_out GE 2) and (text_out NE 5)     <span class="comments">;Keep track of page eject?</span>
 if ( N_elements(forms) GT 0 ) then begin
        if ( forms GT 0 ) then pcount = forms $ <span class="comments">;lines per page</span>
        else pcount = N_elements(list)          <span class="comments">;no page breaks</span>
 endif else if not hardcopy then pcount = N_elements(list) $
      else pcount = lines_per_page                <span class="comments">;Portrait form default</span>
 limit = pcount - 1

  for j = 0L, N_elements(list)-1 do begin

   if not keyword_set( NoHeader) then begin

        if pcount GT limit then begin           <span class="comments">;new page?</span>
                pcount = 0
                if (j GT 0) and hardcopy then $
                            printf,!textunit,string(byte(12))   $<span class="comments">;eject</span>
                       else printf,!textunit,' '
                printf,!textunit,title                  <span class="comments">;print title</span>
                printf,!textunit,dashes                 <span class="comments">;print headings</span>
                printf,!textunit,h1
                printf,!textunit,h2
                printf,!textunit,h3
                printf,!textunit,dashes
        endif

    endif
        dbrd, list[j], entry, noconvert = noconvert        <span class="comments">;read entry</span>
        <span class="comments">;</span>
        <span class="comments">; loop on items</span>
        <span class="comments">;</span>
        st = ''                                 <span class="comments">;output string</span>
        for i = 0,nitems-1 do  begin

                val = dbxval(entry,dtype[i],numvals[i],sbyte[i],nbytes[i])
                if dtype[i] EQ 1 then val = fix(val)
                if dtype[i] EQ 7 then begin
                   b = byte(val)
                   bad = where(b EQ 0, nbad)
                   if nbad GT 0 then begin
                       b[bad] = 32b
                       val = string(b)
                   endif
                endif
                st = st+' ' + string(val,form[i])

        endfor

        printf, !TEXTUNIT, st                   <span class="comments">;print line</span>
        if more_set then  $       <span class="comments">;Did user press 'Q' in /MORE ?</span>
                if ( !ERR EQ 1 ) then return
        pcount = pcount+1            <span class="comments">;increment line counter</span>
    end                              <span class="comments">; loop on entries</span>

 endelse                             <span class="comments">; N_params > 1</span>

<span class="comments">; Clean up</span>

 textclose, TEXTOUT = textout                   <span class="comments">;close text file</span>

 return
 end
</code>
    </div>
  </body>
</html>