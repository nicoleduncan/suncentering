<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:58:05 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>tab_addcol.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="tab_addcol.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="tab_addcol:source"></a>pro tab_addcol,name,data,tcb,tab
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;	TAB_ADDCOL   </span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;	Procedure to add a new column to an existing STSDAS table.</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;	tab_addcol, name, data, tcb, tab</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;	name - column name</span>
<span class="comments">;	data - sample data of type to be written to the column.</span>
<span class="comments">;		This parameter is only used to determine data type.</span>
<span class="comments">;</span>
<span class="comments">; INPUT/OUTPUTS:</span>
<span class="comments">;	tcb - table control block</span>
<span class="comments">;	tab - table array</span>
<span class="comments">;</span>
<span class="comments">; HISTORY:</span>
<span class="comments">;	version 1  D. Lindler April 89</span>
<span class="comments">;	Converted to IDL V5.0   W. Landsman   September 1997</span>
<span class="comments">;-</span>
<span class="comments">;------------------------------------------------------------------------</span>
<span class="comments">;</span>
<span class="comments">; If column alread exists, do not add it</span>
<span class="comments">;</span>
	tab_col,tcb,name
	if !err gt 0 then return
<span class="comments">;</span>
<span class="comments">; determine data type and change to stsdas table code</span>
<span class="comments">;</span>
	s=size(data) & dtype=s[s[0]+1] & ndim=s[0]
	case dtype of
		0: type=6		<span class="comments">;undefined, assume real*4</span>
		7: type=2		<span class="comments">;string</span>
		1: type=1		<span class="comments">;byte (assume boolean)</span>
		2: type=4		<span class="comments">;integer</span>
		4: type=6		<span class="comments">;real*4</span>
		3: type=4		<span class="comments">;integer</span>
		5: type=7		<span class="comments">;double precision</span>
		6: begin
			print,'TAB_ADDCOL-- complex data type not supported'
			retall
		    end
	endcase
<span class="comments">;</span>
<span class="comments">; determine field width</span>
<span class="comments">;</span>
	case type of
		2: begin		<span class="comments">;string</span>
			width=max(strlen(data))
			width=(width+3)/4*2 <span class="comments">;change to multiple of 4 bytes</span>
		   end
		7: width=4		<span class="comments">;double precision</span>
		else: width=2		<span class="comments">;integer, real, or boolean</span>
	endcase
<span class="comments">;</span>
<span class="comments">; get current table size</span>
<span class="comments">;</span>
	nrows=tcb[3]
	ncols=tcb[5]
	rowlen=tcb[7]
	maxrows=tcb[4]>nrows
	maxcols=tcb[5]
	maxrowlen=tcb[8]>rowlen
<span class="comments">;</span>
<span class="comments">; updated table size</span>
<span class="comments">;</span>
	new_nrows=nrows>n_elements(data)
	new_ncols=ncols+1
	new_rowlen=rowlen+width
<span class="comments">;</span>
<span class="comments">; do we need to expand the table</span>
<span class="comments">;</span>
	if (new_nrows gt maxrows) or (new_ncols gt maxcols) or $
	   (new_rowlen gt maxrowlen) then $
		tab_expand,tcb,tab,new_ncols,new_nrows,new_rowlen
<span class="comments">;</span>
<span class="comments">; construct default print format</span>
<span class="comments">;</span>
	case type of
		1: form='8b'				<span class="comments">;boolean</span>
		2: form=''+strtrim(width*2,2)+'s'	<span class="comments">;string</span>
		4: form='11d'				<span class="comments">;integer</span>
		6: form='16.8g'			<span class="comments">;real*4</span>
		7: form='20.12g'			<span class="comments">;real*8</span>
	endcase
<span class="comments">;</span>
<span class="comments">; insert column information into tcb</span>
<span class="comments">;</span>
	newcol=bytarr(48)
	newcol[0]=byte(name)
	newcol[40]=byte(form)
	tcb[0,new_ncols]=[long(new_ncols),rowlen,width,type,long(newcol,0,12)]
	tcb[5]=new_ncols
	tcb[7]=new_rowlen
<span class="comments">;</span>
<span class="comments">; fill new column with nulls</span>
<span class="comments">;</span>
	if nrows gt 0 then begin
		case type of
			1: null=0L
			2: null=string(0b)
			4: null='80000000'XL
			6: null=1.6e38
			7: null=1.6d38
		endcase
		if type eq 2 then nulls=bytarr(width*2,nrows)+null $
			     else nulls=replicate(null,nrows)
		nulls=byte(nulls,0,width*2,nrows)
		tab[rowlen*2,0]=nulls
	endif
return
end
</code>
    </div>
  </body>
</html>