<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:34 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>fxbfind.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="fxbfind.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source">	PRO FXBFIND,P1,KEYWORD,COLUMNS,VALUES,N_FOUND,DEFAULT, $
                    COMMENTS=COMMENTS
<span class="comments">;+</span>
<span class="comments">; NAME: </span>
<span class="comments">;	FXBFIND</span>
<span class="comments">; Purpose     : </span>
<span class="comments">;	Find column keywords in a FITS binary table header.</span>
<span class="comments">; Explanation : </span>
<span class="comments">;	Finds the value of a column keyword for all the columns in the binary</span>
<span class="comments">;	table for which it is set.  For example,</span>
<span class="comments">;</span>
<span class="comments">;		FXBFIND, UNIT, 'TTYPE', COLUMNS, VALUES, N_FOUND</span>
<span class="comments">;</span>
<span class="comments">;	Would find all instances of the keywords TTYPE1, TTYPE2, etc.  The</span>
<span class="comments">;	array COLUMNS would contain the column numbers for which a TTYPEn</span>
<span class="comments">;	keyword was found, and VALUES would contain the values.  N_FOUND would</span>
<span class="comments">;	contain the total number of instances found.</span>
<span class="comments">;</span>
<span class="comments">; Use         : </span>
<span class="comments">;	FXBFIND, [UNIT or HEADER], KEYWORD, COLUMNS, VALUES, N_FOUND</span>
<span class="comments">;		[, DEFAULT ]</span>
<span class="comments">; Inputs      : </span>
<span class="comments">;	Either UNIT or HEADER must be passed.</span>
<span class="comments">;</span>
<span class="comments">;	UNIT	= Logical unit number of file opened by FXBOPEN.</span>
<span class="comments">;	HEADER	= FITS binary table header.</span>
<span class="comments">;	KEYWORD	= Prefix to a series of FITS binary table column keywords.  The</span>
<span class="comments">;		  keywords to be searched for are formed by combining this</span>
<span class="comments">;		  prefix with the numbers 1 through the value of TFIELDS in the</span>
<span class="comments">;		  header.</span>
<span class="comments">; Opt. Inputs : </span>
<span class="comments">;	DEFAULT	= Default value to use for any column keywords that aren't</span>
<span class="comments">;		  found.  If passed, then COLUMNS and VALUES will contain</span>
<span class="comments">;		  entries for every column.  Otherwise, COLUMNS and VALUES only</span>
<span class="comments">;		  contain entries for columns where values were found.</span>
<span class="comments">; Outputs     : </span>
<span class="comments">;	COLUMNS	= Array containing the column numbers for which values of the</span>
<span class="comments">;		  requested keyword series were found.</span>
<span class="comments">;	VALUES	= Array containing the found values.</span>
<span class="comments">;	N_FOUND	= Number of values found.  The value of this parameter is</span>
<span class="comments">;		  unaffected by whether or not DEFAULT is passed.</span>
<span class="comments">; Opt. Outputs: </span>
<span class="comments">;	None.</span>
<span class="comments">; Output Keywords    : </span>
<span class="comments">;      COMMENTS = Comments associated with each keyword, if any</span>
<span class="comments">; Calls       : </span>
<span class="comments">;	FXBFINDLUN, FXPAR</span>
<span class="comments">; Common      : </span>
<span class="comments">;	Uses common block FXBINTABLE--see "fxbintable.pro" for more</span>
<span class="comments">;	information.</span>
<span class="comments">; Restrictions: </span>
<span class="comments">;	If UNIT is passed, then the file must have been opened with FXBOPEN.</span>
<span class="comments">;	If HEADER is passed, then it must be a legal FITS binary table header.</span>
<span class="comments">;</span>
<span class="comments">;	The type of DEFAULT must be consistent with the values of the requested</span>
<span class="comments">;	keywords, i.e. both most be either of string or numerical type.</span>
<span class="comments">;</span>
<span class="comments">;	The KEYWORD prefix must not have more than five characters to leave</span>
<span class="comments">;	room for the three digits allowed for the column numbers.</span>
<span class="comments">;</span>
<span class="comments">; Side effects: </span>
<span class="comments">;	None.</span>
<span class="comments">; Category    : </span>
<span class="comments">;	Data Handling, I/O, FITS, Generic.</span>
<span class="comments">; Prev. Hist. : </span>
<span class="comments">;	William Thompson, Feb. 1992.</span>
<span class="comments">; Written     : </span>
<span class="comments">;	William Thompson, GSFC, February 1992.</span>
<span class="comments">; Modified    : </span>
<span class="comments">;	Version 1, William Thompson, GSFC, 12 April 1993.</span>
<span class="comments">;		Incorporated into CDS library.</span>
<span class="comments">;       Vectorized implementation improves performance, CM 18 Nov 1999</span>
<span class="comments">;       Added COMMENTS keyword CM Nov 2003</span>
<span class="comments">;       Remove use of obsolete !ERR system variable W. Landsman April 2010</span>
<span class="comments">;       Fix error introduced April 2010  W. Landsman</span>
<span class="comments">; Version     : </span>
<span class="comments">;	Version 3, April 2010.</span>
<span class="comments">;-</span>
<span class="comments">;</span>
@fxbintable
	ON_ERROR,2
<span class="comments">;</span>
<span class="comments">;  Check the number of parameters.</span>
<span class="comments">;</span>
	IF N_PARAMS() LT 5 THEN MESSAGE,	$
		'Syntax:  FXBFIND,[UNIT/HEADER],KEYWORD,COLUMNS,VALUES,' + $
		'N_FOUND [,DEFAULT]'
<span class="comments">;</span>
<span class="comments">;  Get the header.</span>
<span class="comments">;</span>
	IF N_ELEMENTS(P1) EQ 1 THEN BEGIN
		ILUN = FXBFINDLUN(P1)
		HEADER = HEAD[*,ILUN]
	END ELSE HEADER = P1
<span class="comments">;</span>
<span class="comments">;  Get the value of TFIELDS from HEADER.</span>
<span class="comments">;</span>
	TFIELDS0 = FXPAR(HEADER,'TFIELDS')
	IF TFIELDS0 EQ 0 THEN MESSAGE,'No columns found in HEADER'

<span class="comments">;</span>
<span class="comments">;  Extract the keyword values all in one pass</span>
<span class="comments">;        </span>
        KEYVALUES = FXPAR(HEADER, STRTRIM(KEYWORD,2)+'*', $
                          COMMENT=COMMENT_STRS, DATATYPE=DEFAULT, COUNT=NKEY)
        N_FOUND = 0L

<span class="comments">;</span>
<span class="comments">;  INDEX is used as an array index to fill in the final output</span>
<span class="comments">;   </span>
        IF NKEY GT 0 THEN BEGIN
            N_FOUND = N_ELEMENTS(KEYVALUES)
            INDEX   = LINDGEN(N_FOUND)
        ENDIF


<span class="comments">;</span>
<span class="comments">;  INDEX is used as an array index to fill in the final output</span>
<span class="comments">;</span>
        IF N_FOUND GT 0 THEN INDEX   = LINDGEN(N_FOUND)
 
<span class="comments">;</span>
<span class="comments">;  If a default was given, then we are a little more careful to </span>
<span class="comments">;  reproduce the correct number of values.</span>
<span class="comments">;</span>
        IF N_ELEMENTS(DEFAULT) GT 0 THEN BEGIN
            <span class="comments">;; If no values were found we need to fill KEYVALUES with</span>
            <span class="comments">;; *something*.</span>
            IF N_FOUND LE 0 THEN KEYVALUES = DEFAULT
            COLUMNS  = LINDGEN(TFIELDS0) + 1

            <span class="comments">;; Make an array with the number of columns in the table</span>
            SZ_VALUE = SIZE(KEYVALUES[0])
            VALUES   = MAKE_ARRAY(TFIELDS0, TYPE=SZ_VALUE[1], VALUE=DEFAULT)
            COMMENTS = STRARR(TFIELDS0)

            <span class="comments">;; Fill the columns which had this keyword</span>
            IF N_FOUND GT 0 THEN BEGIN
                VALUES[INDEX] = KEYVALUES
                COMMENTS[INDEX] = COMMENT_STRS
            ENDIF

        ENDIF ELSE BEGIN

<span class="comments">;</span>
<span class="comments">;  If no default was given, we can simply return the values returned</span>
<span class="comments">;  by FXPAR.</span>
<span class="comments">;</span>
            IF N_FOUND GT 0 THEN BEGIN
                COLUMNS = INDEX + 1
                VALUES  = KEYVALUES
                COMMENTS = COMMENT_STRS
            ENDIF

        ENDELSE
        RETURN
            
	END
</code>
    </div>
  </body>
</html>