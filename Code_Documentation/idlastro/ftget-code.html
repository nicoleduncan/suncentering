<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:32 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>ftget.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="ftget.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="ftget:source"></a>function ftget,hdr_or_ftstr,tab,field,rows,nulls
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;      FTGET </span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;      Function to return value(s) from specified column in a FITS ASCII table</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE</span>
<span class="comments">;      values = FTGET( h, tab, field, [ rows, nulls ] )</span>
<span class="comments">;                    or</span>
<span class="comments">;      values = FTGET( ft_str, tab, field. [rows, nulls]</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;      h - FITS ASCII extension header (e.g. as returned by FITS_READ)</span>
<span class="comments">;                            or</span>
<span class="comments">;      ft_str - FITS table structure extracted from FITS header by FTINFO</span>
<span class="comments">;                Use of the IDL structure will improve processing speed</span>
<span class="comments">;      tab - FITS ASCII table array (e.g. as returned by FITS_READ)</span>
<span class="comments">;      field - field name or number</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUTS:</span>
<span class="comments">;      rows -  scalar or vector giving row number(s)</span>
<span class="comments">;               Row numbers start at 0.  If not supplied or set to</span>
<span class="comments">;               -1 then values for all rows are returned</span>
<span class="comments">;</span>
<span class="comments">; OUTPUTS:</span>
<span class="comments">;       the values for the row are returned as the function value.</span>
<span class="comments">;       Null values are set to 0 or blanks for strings.</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL OUTPUT:</span>
<span class="comments">;       nulls - null value flag of same length as the returned data.</span>
<span class="comments">;               It is set to 1 at null value positions and 0 elsewhere.</span>
<span class="comments">;               If supplied then the optional input, rows, must also </span>
<span class="comments">;               be supplied.</span>
<span class="comments">;</span>
<span class="comments">; EXAMPLE:</span>
<span class="comments">;       Read the columns labeled 'WAVELENGTH' and 'FLUX' from the second</span>
<span class="comments">;       (ASCII table) extension of a FITS file 'spectra.fit'</span>
<span class="comments">;</span>
<span class="comments">;       IDL> fits_read,'spectra.fit',tab,htab,exten=2     ;Read 2nd extension</span>
<span class="comments">;       IDL> w = ftget( htab, tab,'wavelength')      ;Wavelength vector</span>
<span class="comments">;       IDL> f = ftget( htab, tab,'flux')            ;Flux vector</span>
<span class="comments">;</span>
<span class="comments">;       Slightly more efficient would be to first call FTINFO</span>
<span class="comments">;       IDL> ftinfo, htab, ft_str                     ;Extract structure</span>
<span class="comments">;       IDL> w = ftget(ft_str, tab,'wavelength')      ;Wavelength vector</span>
<span class="comments">;       IDL> f = ftget(ft_str, tab,'flux')            ;Flux vector</span>
<span class="comments">;</span>
<span class="comments">; NOTES:</span>
<span class="comments">;       (1) Use the higher-level procedure FTAB_EXT to extract vectors </span>
<span class="comments">;               directly from the FITS file.</span>
<span class="comments">;       (2) Use FTAB_HELP or FTHELP to determine the columns in a particular</span>
<span class="comments">;               ASCII table.</span>
<span class="comments">; HISTORY:</span>
<span class="comments">;       coded by D. Lindler  July, 1987</span>
<span class="comments">;       Always check for null values    W. Landsman          August 1990</span>
<span class="comments">;       More informative error message  W. Landsman          Feb. 1996</span>
<span class="comments">;       Converted to IDL V5.0   W. Landsman   September 1997</span>
<span class="comments">;       Allow structure rather than FITS header  W. Landsman   May 2000</span>
<span class="comments">;       No case sensitivity in TTYPE name      W. Landsman   February 2002</span>
<span class="comments">;-</span>
<span class="comments">;------------------------------------------------------------------</span>
<span class="comments">; On_error,2</span>

  sz = size(tab)
  nrows = sz(2)

<span class="comments">; get characteristics of specified field</span>

 size_hdr = size(hdr_or_ftstr)
 case size_hdr[size_hdr[0]+1] of 
      7: ftinfo,hdr_or_ftstr,ft_str
      8: ft_str = hdr_or_ftstr
      else: message,'ERROR - Invalid FITS header or structure supplied' 
 endcase
 
 sz = size(field)
 if ((sz[0] ne 0) or (sz[1] EQ 0)) then $
      message,'Invalid field specification, it must be a scalar'

 if sz[1] EQ 7 then begin
    field = strupcase(strtrim(field,2))
    ttype = strupcase( strtrim(ft_str.ttype,2) )
    ipos = where(ttype EQ field, Npos)
    if Npos EQ 0 then message, $ 
        'Specified field ' + strupcase(strtrim(field,2)) + ' not in table'
 endif else ipos = field -1
 ipos = ipos[0]

 tbcol = ft_str.tbcol[ipos]-1                   <span class="comments">;IDL starts at zero not one</span>
 width = ft_str.width[ipos]
 tnull = ft_str.tnull[ipos]
 idltype = ft_str.idltype[ipos]

<span class="comments">; if rows not supplied then return all rows</span>

 if N_params() LT 4 then rows = -1

<span class="comments">; determine if scalar supplied</span>

 row = rows
 s = size(row) & ndim = s[0]
 if ndim EQ 0 then begin                <span class="comments">;scalar?</span>
        if row LT 0 then begin  <span class="comments">; -1 get all rows</span>
                ndim = 1
                row = lindgen(nrows)
           end else begin
                row = lonarr(1) + row
        end
 end

<span class="comments">; check for valid row numbers</span>

 if (min(row) lt 0) or (max(row) gt (nrows-1)) then $
        message,'ERROR - Row numbers must be between 0 and ' + $
                strtrim((nrows-1),2)

<span class="comments">; get column</span>

 if ndim EQ 0 then begin                                        <span class="comments">;scalar?</span>
        dd = string(tab[tbcol:tbcol+width-1,row[0]])
        data = strarr(1)
        data[0] = dd
    end else begin                                      <span class="comments">;vector</span>
        data = string(tab[tbcol:tbcol+width-1,*])
        data = data[row]
 end

<span class="comments">; check for null values</span>
   n = N_elements(data)
   d = make_array(size=[1,n,idltype,n])
  
 if strlen(tnull) GT 0 then begin  
    len = strlen(data[0])       <span class="comments">;field size</span>
    while strlen(tnull) LT len do tnull = tnull + ' '   <span class="comments">;pad with blanks</span>
    if strlen(tnull) GT len then tnull = strmid(tnull,0,len)
    nulls = data EQ tnull
    valid = where(nulls EQ 0b, nvalid)

<span class="comments">; convert data to the correct type</span>

    if nvalid GT 0 then d[valid] = data[valid]

 endif else d[0] = strtrim(data,2)

    return,d
 end
</code>
    </div>
  </body>
</html>