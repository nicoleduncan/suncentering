<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:54 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>partvelvec.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="partvelvec.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;      PARTVELVEC</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;       Plot the velocity vectors of particles at their positions</span>
<span class="comments">; EXPLANATION:</span>
<span class="comments">;       This procedure plots the velocity vectors of particles (at the</span>
<span class="comments">;       positions of the particles).</span>
<span class="comments">;</span>
<span class="comments">; CATEGORY:</span>
<span class="comments">;       Plotting, Two-dimensional.</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;       PARTVELVEC, VELX, VELY, POSX, POSY [, X, Y]</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;       VELX:  An array of any dimension, containing the x-components</span>
<span class="comments">;              of the particle velocities.</span>
<span class="comments">;       VELY:  An array of the same dimension as velx, containing the</span>
<span class="comments">;              y-components of the particle velocities.</span>
<span class="comments">;       POSX:  An array of the same dimension as velx, containing the</span>
<span class="comments">;              x-components of the particle positions.</span>
<span class="comments">;       POSY:  An array of the same dimension as velx, containing the</span>
<span class="comments">;              y-components of the particle positions.</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUTS:</span>
<span class="comments">;       X:   Optional abcissae values. X must be a vector.</span>
<span class="comments">;       Y:   Optional ordinate values. Y must be a vector. If only X</span>
<span class="comments">;            is specified, then Y is taken equal to be equal to X.</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUT KEYWORD PARAMETERS:</span>
<span class="comments">;       FRACTION:   The fraction of the vectors to plot. They are</span>
<span class="comments">;                   taken at random from the complete sample.    Default is</span>
<span class="comments">;              FRACTION = 1.0, use all vectors</span>
<span class="comments">;</span>
<span class="comments">;       LENGTH:     The maximum vectorlength relative to the plot data</span>
<span class="comments">;                   window.   Default = 0.08</span>
<span class="comments">;</span>
<span class="comments">;       COLOR:      Color for the vectors, axes and titles by string name or</span>
<span class="comments">;                   number (see cgCOLOR).   Note that if VECCOLORS is </span>
<span class="comments">;                   supplied, then the COLOR keyword still specifies the </span>
<span class="comments">;                   color of the axes and title.    Default  = 'Opposite'</span>
<span class="comments">;</span>
<span class="comments">;       OVER:       Plot over the previous plot</span>
<span class="comments">;</span>
<span class="comments">;       VECCOLORS:  The vector colors. Must be either a scalar, or</span>
<span class="comments">;                   a vector (nmeric or string) the same size as VELX. </span>
<span class="comments">;                   Set to COLOR by default.</span>
<span class="comments">;       WINDOW - Set this keyword to plot to a resizeable graphics window</span>
<span class="comments">;</span>
<span class="comments">;       Plot        All other keywords available to cgPlot (e.g. AXISCOLOR,</span>
<span class="comments">;       Keywords:   LINESTYLE, XRANGE) are available (via _EXTRA)</span>
<span class="comments">;</span>
<span class="comments">; OUTPUTS:</span>
<span class="comments">;       This procedure plots the velocity vectors (VELX,VELY) at the</span>
<span class="comments">;       positions of the particles, (POSX,POSY). If X and Y are not</span>
<span class="comments">;       specified, then the size of the plot is such that all vectors</span>
<span class="comments">;       just fit within in the plot data window.</span>
<span class="comments">;</span>
<span class="comments">; SIDE EFFECTS:</span>
<span class="comments">;       Plotting on the current device is performed.</span>
<span class="comments">;</span>
<span class="comments">; EXAMPLE:</span>
<span class="comments">;       Generate some particle positions and velocities.</span>
<span class="comments">;</span>
<span class="comments">;         POSX=RANDOMU(seed,200)</span>
<span class="comments">;         POSY=RANDOMU(seed,200)</span>
<span class="comments">;         VELX=RANDOMU(seed,200)-0.5</span>
<span class="comments">;         VELY=RANDOMU(seed,200)-0.5</span>
<span class="comments">;</span>
<span class="comments">;       Plot the particle velocities.</span>
<span class="comments">;</span>
<span class="comments">;         PARTVELVEC, VELX, VELY, POSX, POSY</span>
<span class="comments">;</span>
<span class="comments">;       Example using vector colors.</span>
<span class="comments">;</span>
<span class="comments">;         POSX=RANDOMU(seed,200)</span>
<span class="comments">;         POSY=RANDOMU(seed,200)</span>
<span class="comments">;         VELX=RANDOMU(seed,200)-0.5</span>
<span class="comments">;         VELY=RANDOMU(seed,200)-0.5</span>
<span class="comments">;         magnitude = SQRT(velx^2 + vely^2)</span>
<span class="comments">;         LOADCT, 5, NCOLORS=254, BOTTOM=1 ; Load vector colors</span>
<span class="comments">;         colors = BytScl(magnitude, Top=254) + 1B</span>
<span class="comments">;         PARTVELVEC, VELX, VELY, POSX, POSY, COLOR='green', VECCOLORS=colors</span>
<span class="comments">;</span>
<span class="comments">; MODIFICATION HISTORY:</span>
<span class="comments">;       Written by:  Joop Schaye (jschaye@astro.rug.nl), Sep 1996.</span>
<span class="comments">;       Added /OVER keyword   Theo Brauers (th.brauers@fz-juelich.de) Jul 2002</span>
<span class="comments">;       Added VECCOLORS keyword. David Fanning (david@dfanning.com) March, 2005</span>
<span class="comments">;       Incorporate the Coyote Graphics (cg) plot programs  WL  January 2011</span>
<span class="comments">;-</span>

PRO partvelvec,velx,vely,posx,posy,x,y, OVER = over, VECCOLORS=vecColors, $
               FRACTION=fraction,LENGTH=length,COLOR=color,WINDOW=window, $
	       _EXTRA=extra


<span class="comments">;---------------------------------------------</span>
<span class="comments">; Various settings, modify these to customize</span>
<span class="comments">;---------------------------------------------</span>

c = {customize, $
   length: 0.08, $     <span class="comments">; Maximum vector length relative to plot region. (*)</span>
   lengtharrow: 0.3, $ <span class="comments">; Length of arrowhead legs relative to vectorlength.</span>
   angle: 22.5 }       <span class="comments">; 1/2 times the angle between the arrowhead legs.</span>

<span class="comments">; (*) Not used if keyword LENGTH is present</span>


<span class="comments">;---------------------</span>
<span class="comments">; Some error handling</span>
<span class="comments">;---------------------</span>

on_error,2  <span class="comments">; Return to caller if an error occurs.</span>

nparams=n_params()
IF nparams NE 4 THEN BEGIN
    IF (nparams NE 5 AND nparams NE 6) THEN BEGIN
        message,'Wrong number of parameters!',/continue
        message,'Syntax: PARTVELVEC, VELX, VELY, POSX, POSY [, X, Y]', $
          /noname,/noprefix
    ENDIF
    IF nparams EQ 5 THEN y=x
    sizex = size(x)
    sizey = size(y)
    IF (sizex[0] NE 1 || sizey[0] NE 1) THEN $
      message,'X and Y must be vectors!'
ENDIF

sizevelx = size(velx)
sizevely = size(vely)
sizeposx = size(posx)
sizeposy = size(posy)

IF (total(sizevelx[0:sizevelx[0]]-sizevely[0:sizevelx[0]]) NE 0 $
    || total(sizevelx[0:sizevelx[0]]-sizeposx[0:sizevelx[0]]) NE 0 $
    || total(sizevelx[0:sizevelx[0]]-sizeposy[0:sizevelx[0]]) NE 0) THEN $
  message,'All arguments must have the same dimension and size!'

IF n_elements(fraction) GT 0 THEN $
  IF (fraction LT 0.0 || fraction GT 1.0) THEN $
  message,'Fraction has to be between 0.0 and 1.0.'


<span class="comments">;--------------</span>
<span class="comments">; Prepare plot</span>
<span class="comments">;--------------</span>

 nvecs = n_elements(velx)  <span class="comments">; Number of particles.</span>
 vel = sqrt(velx^2+vely^2)  <span class="comments">; Total velocity.</span>
 maxvel = max(vel)  <span class="comments">; Maximum velocity.</span>

<span class="comments">; Compute maximum length of vectors.</span>
IF n_elements(length) LE 0 THEN length=c.length
minposx = min(posx)
maxposx = max(posx)
minposy = min(posy)
maxposy = max(posy)
length = length*((maxposx-minposx) > (maxposy-minposy))

<span class="comments">; Convert velocities.</span>
vx = length*velx/maxvel
vy = length*vely/maxvel
vel = length*temporary(vel)/maxvel

<span class="comments">; Make sure no vectors extend beyond the plot data window.</span>
x1 = posx+vx  <span class="comments">; End of vector.</span>
y1 = posy+vy
IF nparams EQ 4 THEN BEGIN
    minposx = min(x1)&lt<span class="comments">;minposx</span>
    maxposx = max(x1)>maxposx
    minposy = min(y1)&lt<span class="comments">;minposy</span>
    maxposy = max(y1)>maxposy
ENDIF

angle = c.angle*!dtor  <span class="comments">; Convert from degrees to radians.</span>
sinangle = sin(angle)  <span class="comments">; Need these.</span>
cosangle = cos(angle)


<span class="comments">;-----------</span>
<span class="comments">; Plot axes</span>
<span class="comments">;-----------</span>

if N_elements(color) EQ 0 then color = cgcolor('opposite')
IF n_elements(veccolors) EQ 0 THEN BEGIN
   veccolors = Replicate(cgcolor('opposite'), nvecs)
ENDIF ELSE BEGIN
   nvc = N_Elements(veccolors)
   CASE nvc OF
      1: veccolors = Replicate(veccolors, nvecs)
      nvecs:
      ELSE: Message, 'Vector color array VECCOLORS must be same size as VELX.'
   ENDCASE
ENDELSE
IF n_elements(over) EQ 0 THEN BEGIN
IF nparams EQ 4 THEN $
  cgPlot,[minposx,maxposx],[minposy,maxposy], axiscolor=color,$
  /nodata,/xstyle,/ystyle,COLOR=color,window=window,_EXTRA=extra $
ELSE cgPlot,x,y,/nodata,/xstyle,/ystyle,COLOR=color,window=window,_EXTRA=extra
ENDIF
if keyword_set(window) then cgcontrol,execute=0
<span class="comments">;--------------</span>
<span class="comments">; Plot vectors</span>
<span class="comments">;--------------</span>

IF (n_elements(fraction) GT 0) && (fraction NE 1.0) THEN BEGIN
   nrgood=long(fraction*nvecs)  <span class="comments">; # of vectors to plot.</span>
    IF nrgood EQ 0 THEN return
    <span class="comments">; Compute indices of vectors to plot. I use two lines to get more</span>
    <span class="comments">; random "random numbers".</span>
    good=long(randomu(seed,nrgood+1)*(nvecs-1.0))
    good=good[1:*]
    vx = temporary(vx[good])
    vy = temporary(vy[good])
    px = posx[good]  <span class="comments">; Can't use temporary if we wan't to keep the data.</span>
    py = posy[good]
    x1 = temporary(x1[good])
    y1 = temporary(y1[good])
    nvecs=nrgood
ENDIF ELSE BEGIN
    px=posx
    py=posy
ENDELSE

FOR i=0l,nvecs-1l DO BEGIN  <span class="comments">; Loop over particles.</span>
    <span class="comments">; Note that we cannot put the next three lines outside the loop,</span>
    <span class="comments">; because we want the arrow size to be relative to the vector length.</span>
    r = c.lengtharrow*vel[i]  <span class="comments">; Length of arrow head.</span>
    rsin = r*sinangle
    rcos = r*cosangle
    <span class="comments">; Draw basis, arrow leg, same arrow leg, other arrow leg.</span>
    <span class="comments">; One arrow leg is drawn twice, because we need to return to the end</span>
    <span class="comments">; of the vector to draw the other leg.</span>

    cgPlots,[px[i],x1[i],x1[i]-(vx[i]*rcos+vy[i]*rsin)/vel[i], $
           x1[i],x1[i]-(vx[i]*rcos-vy[i]*rsin)/vel[i]], $
          [py[i],y1[i],y1[i]-(vy[i]*rcos-vx[i]*rsin)/vel[i], $
           y1[i],y1[i]-(vy[i]*rcos+vx[i]*rsin)/vel[i]],COLOR=veccolors[i],$
	   ADDCMD = window
	
ENDFOR
 if keyword_set(window) then cgcontrol,execute=1
 return
END  <span class="comments">; End of procedure PARTVELVEC.</span>
</code>
    </div>
  </body>
</html>