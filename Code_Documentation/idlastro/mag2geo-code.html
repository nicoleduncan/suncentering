<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:46 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>mag2geo.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="mag2geo.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;      MAG2GEO()</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;     Convert from geomagnetic to geographic coordinates</span>
<span class="comments">;</span>
<span class="comments">; EXPLANATION:</span>
<span class="comments">; </span>
<span class="comments">;     Converts from GEOMAGNETIC (latitude,longitude) to GEOGRAPHIC (latitude,</span>
<span class="comments">;    longitude).    (altitude remains the same)</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;       gcoord=mag2geo(mcoord)</span>
<span class="comments">;</span>
<span class="comments">; INPUT:</span>
<span class="comments">;       mcoord = a 2-element array of magnetic [latitude,longitude], or an </span>
<span class="comments">;                array [2,n] of n such coordinates.</span>
<span class="comments">;</span>
<span class="comments">; KEYWORD INPUTS:</span>
<span class="comments">;               None</span>
<span class="comments">;</span>
<span class="comments">; OUTPUT:</span>
<span class="comments">;       a 2-element array of geographic [latitude,longitude], or an array [2,n]</span>
<span class="comments">;            of n such coordinates                   </span>
<span class="comments">;</span>
<span class="comments">; COMMON BLOCKS:</span>
<span class="comments">;               None</span>
<span class="comments">;</span>
<span class="comments">; EXAMPLES:</span>
<span class="comments">;       IDL> gcoord=mag2geo([90,0])       ; coordinates of magnetic south pole</span>
<span class="comments">;       IDL> print,gcoord</span>
<span class="comments">;       79.300000      -71.409990</span>
<span class="comments">;</span>
<span class="comments">; MODIFICATION HISTORY:</span>
<span class="comments">;       Written by Pascal Saint-Hilaire (Saint-Hilaire@astro.phys.ethz.ch), </span>
<span class="comments">;        May 2002</span>
<span class="comments">;-</span>
<span class="comments">;====================================================================================</span>
FUNCTION mag2geo,incoord

        <span class="comments">; SOME 'constants'...</span>
        Dlong=288.59D   <span class="comments">; longitude (in degrees) of Earth's magnetic south pole</span>
                        <span class="comments">; (which is near the geographic north pole!) (1995)</span>
        Dlat=79.30D     <span class="comments">; latitude (in degrees) of same (1995)</span>
        R = 1D          <span class="comments">; distance from planet center (value unimportant -- </span>
                <span class="comments">;just need a length for conversion to rectangular coordinates)</span>

        <span class="comments">; convert first to radians</span>
        Dlong=Dlong*!DPI/180.
        Dlat=Dlat*!DPI/180.

        mlat=DOUBLE(incoord[0,*])*!DPI/180.
        mlon=DOUBLE(incoord[1,*])*!DPI/180.
        malt=mlat * 0. + R
        
        coord=[mlat,mlon,malt]

        <span class="comments">;convert to rectangular coordinates</span>
        <span class="comments">;       X-axis: defined by the vector going from Earth's center towards</span>
        <span class="comments">;            the intersection of the equator and Greenwich's meridian.</span>
        <span class="comments">;       Z-axis: axis of the geographic poles</span>
        <span class="comments">;       Y-axis: defined by Y=Z^X</span>
        x=coord[2,*]*cos(coord[0,*])*cos(coord[1,*])
        y=coord[2,*]*cos(coord[0,*])*sin(coord[1,*])
        z=coord[2,*]*sin(coord[0,*])

        <span class="comments">;First rotation : in the plane of the current meridian from magnetic </span>
        <span class="comments">;pole to geographic pole.</span>
        togeolat=dblarr(3,3)
        togeolat[0,0]=cos(!DPI/2-Dlat)
        togeolat[0,2]=sin(!DPI/2-Dlat)
        togeolat[2,0]=-sin(!DPI/2-Dlat)
        togeolat[2,2]=cos(!DPI/2-Dlat)
        togeolat[1,1]=1.
        out= togeolat # [x,y,z]

        <span class="comments">;Second rotation matrix : rotation around plane of the equator, from</span>
        <span class="comments">;the meridian containing the magnetic poles to the Greenwich meridian.</span>
        maglong2geolong=dblarr(3,3)
        maglong2geolong[0,0]=cos(Dlong)
        maglong2geolong[0,1]=-sin(Dlong)
        maglong2geolong[1,0]=sin(Dlong)
        maglong2geolong[1,1]=cos(Dlong)
        maglong2geolong[2,2]=1.
        out=maglong2geolong # out

        <span class="comments">;convert back to latitude, longitude and altitude</span>
        glat=atan(out[2,*],sqrt(out[0,*]^2+out[1,*]^2))
        glat=glat*180./!DPI
        glon=atan(out[1,*],out[0,*])
        glon=glon*180./!DPI
        <span class="comments">;galt=sqrt(out[0,*]^2+out[1,*]^2+out[2,*]^2)-R  ; I don't care about that one...just put it there for completeness' sake </span>

        RETURN,[glat,glon]
END
<span class="comments">;====================================================================================</span>
</code>
    </div>
  </body>
</html>