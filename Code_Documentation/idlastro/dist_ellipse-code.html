<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:28 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>dist_ellipse.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="dist_ellipse.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="dist_ellipse:source"></a>pro dist_ellipse,im,n,xc,yc,ratio,pos_ang, DOUBLE = double
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;       DIST_ELLIPSE</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;       Create a mask array useful for elliptical aperture photemetry</span>
<span class="comments">; EXPLANATION:</span>
<span class="comments">;       Form an array in which the value of each element is equal to the</span>
<span class="comments">;       semi-major axis of the ellipse of specified center, axial ratio, and </span>
<span class="comments">;       position  angle, which passes through that element.  Useful for </span>
<span class="comments">;       elliptical aperture photometry.</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;       DIST_ELLIPSE, IM, N, XC, YC, RATIO, POS_ANG, /DOUBLE</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;       N = either  a scalar specifying the size of the N x N square output</span>
<span class="comments">;               array, or a 2 element vector specifying the size of the</span>
<span class="comments">;               M x N rectangular output array.</span>
<span class="comments">;       XC,YC - Scalars giving the position of the ellipse center.   This does</span>
<span class="comments">;               not necessarily have to be within the image</span>
<span class="comments">;       RATIO - Scalar giving the ratio of the major to minor axis.   This </span>
<span class="comments">;               should be greater than 1 for postion angle to have its </span>
<span class="comments">;               standard meaning.</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUTS:</span>
<span class="comments">;       POS_ANG - Position angle of the major axis, measured counter-clockwise</span>
<span class="comments">;               from the Y axis.  For an image in standard orientation </span>
<span class="comments">;               (North up, East left) this is the astronomical position angle.</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUT KEYWORD:</span>
<span class="comments">;       /DOUBLE - If this keyword is set and nonzero, the output array will</span>
<span class="comments">;               be of type DOUBLE rather than floating point.</span>
<span class="comments">;</span>
<span class="comments">; OUTPUT:</span>
<span class="comments">;       IM - REAL*4 elliptical mask array, of size M x N.  THe value of each </span>
<span class="comments">;               pixel is equal to the semi-major axis of the ellipse of center</span>
<span class="comments">;                XC,YC, axial ratio RATIO, and position angle POS_ANG, which </span>
<span class="comments">;               passes through the pixel.</span>
<span class="comments">;</span>
<span class="comments">; EXAMPLE:</span>
<span class="comments">;       Total the flux in a elliptical aperture with a major axis of 3', an</span>
<span class="comments">;       axial ratio of 2.3, and a position angle of 25 degrees centered on </span>
<span class="comments">;       a specified RA and DEC.   The image array, IM is 200 x 200, and has </span>
<span class="comments">;       an associated FITS header H.</span>
<span class="comments">;</span>
<span class="comments">;       ADXY, H, ra, dec, x, y       ;Get X and Y corresponding to RA and Dec</span>
<span class="comments">;       GETROT, H, rot, cdelt        ;CDELT gives plate scale degrees/pixel</span>
<span class="comments">;       cdelt = abs( cdelt)*3600.    ;CDELT now in arc seconds/pixel</span>
<span class="comments">;       DIST_ELLIPSE, ell, 200, x, y, 2.3, 25  ;Create a elliptical image mask</span>
<span class="comments">;       ell = ell*cdelt(0)           ;Distances now given in arcseconds</span>
<span class="comments">;       good = where( ell lt 180 )   ;Within 3 arc minutes</span>
<span class="comments">;       print,total( im(good) )      ;Total pixel values within 3'</span>
<span class="comments">;</span>
<span class="comments">; RESTRICTIONS:</span>
<span class="comments">;       The speed of DIST_ELLIPSE decreases and the the demands on virtual</span>
<span class="comments">;       increase as the square of the output dimensions.   Users should</span>
<span class="comments">;       dimension the output array as small as possible, and re-use the</span>
<span class="comments">;       array rather than re-calling DIST_ELLIPSE</span>
<span class="comments">;</span>
<span class="comments">; REVISION HISTORY:</span>
<span class="comments">;       Written    W. Landsman             April, 1991</span>
<span class="comments">;       Somewhat faster algorithm          August, 1992</span>
<span class="comments">;       Allow rectangular output array     June, 1994</span>
<span class="comments">;       Converted to IDL V5.0   W. Landsman   September 1997</span>
<span class="comments">;       Added /DOUBLE keyword   W. Landsman   July 2000</span>
<span class="comments">;-</span>
 On_error,2                             <span class="comments">;Return to caller</span>

 if N_params() LT 6 then begin
    print,'Syntax - DIST_ELLIPSE, im, n, xc, yc, ratio, pos_ang, /DOUBLE'
    print,'   im - output elliptical mask image array'
    print,'   n -  size of output image mask, scalar or 2 element vector'
    print,'   xc,yc - coordinates of ellipse center, scalars'
    print,'   ratio - ratio of major to minor axis of ellipse, scalar'
    print,'   pos_ang - position angle, counterclockwise from up'
    return
 endif
                                          <span class="comments">;Check some parameters</span>
 if N_elements(ratio) NE 1 then message, $
     'ERROR - Axial ratio (fifth parameter) must be a scalar value'

 if N_elements(pos_ang) NE 1 then message, $
     'ERROR - Position angle (sixth parameter) must be a scalar value'

 ang = pos_ang /!RADEG                      <span class="comments">;Convert to radians</span>
 cosang = cos(ang)
 sinang = sin(ang)

 if N_elements(N) EQ 2 then begin
        nx = n[0]
        ny = n[1] 
 endif else if N_elements(N) EQ 1 then begin
        ny = n
        nx = n                    <span class="comments">;Make a row</span>
 endif else message, $
        'ERROR - Output size parameter N must contain 1 or 2 elements'
        
 if keyword_set(double) then begin
    x = dindgen(nx) - xc
    y = dindgen(ny) - yc
    im = dblarr(nx, ny, /NOZERO)
 endif else begin
    x = findgen( nx ) - xc
    y = findgen( ny ) - yc
    im = fltarr( nx, ny, /NOZERO )
 endelse
                         <span class="comments">;Rotate pixels to match ellipse orientation</span>
 xcosang = x*cosang
 xsinang = x*sinang

 for i = 0,ny-1 do begin
   xtemp =  xcosang + y[i]*sinang
   ytemp = -xsinang + y[i]*cosang
   im[0,i] = sqrt( (xtemp*ratio)^2 + ytemp^2 )
 endfor

 return
 end
</code>
    </div>
  </body>
</html>