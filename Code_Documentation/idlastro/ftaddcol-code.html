<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:32 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>ftaddcol.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="ftaddcol.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="ftaddcol:source"></a>pro ftaddcol,h,tab,name,idltype,tform,tunit,tscal,tzero,tnull
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;      FTADDCOL</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;      Routine to add a field to a FITS ASCII table</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;      ftaddcol, h, tab, name, idltype, [ tform, tunit, tscal, tzero, tnull ]</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;      h - FITS table header.  It will be updated as appropriate</span>
<span class="comments">;      tab - FITS table array.  Number of columns will be increased if</span>
<span class="comments">;               neccessary.</span>
<span class="comments">;      name - field name, scalar string</span>
<span class="comments">;      idltype - idl data type (as returned by SIZE function) for field,</span>
<span class="comments">;               For string data (type=7) use minus the string length.</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUTS:</span>
<span class="comments">;       tform - format specification 'qww.dd' where q = A, I, E, or D</span>
<span class="comments">;       tunit - string giving physical units for the column.</span>
<span class="comments">;       tscal - scale factor</span>
<span class="comments">;       tzero - zero point for field</span>
<span class="comments">;       tnull - null value for field</span>
<span class="comments">;</span>
<span class="comments">;       Use '' as the value of tform,tunit,tscal,tzero,tnull if you want</span>
<span class="comments">;       the default or no specification of them in the table header.</span>
<span class="comments">;</span>
<span class="comments">; OUTPUTS:</span>
<span class="comments">;       h,tab - updated to allow new column of data</span>
<span class="comments">;</span>
<span class="comments">; PROCEDURES USED:</span>
<span class="comments">;       FTINFO, FTSIZE, GETTOK(), SXADDPAR</span>
<span class="comments">; HISTORY:</span>
<span class="comments">;       version 1  D. Lindler   July, 1987</span>
<span class="comments">;       Converted to IDL V5.0   W. Landsman   September 1997</span>
<span class="comments">;       Updated call to new FTINFO   W. Landsman   April 2000</span>
<span class="comments">;-</span>
  On_error,2
  if N_params() LT 2 then begin
      print,'Syntax - FTADDCOL, h, tab, name, idltype, ' 
      print,'                [ tform, tunit, tscal, tzero, tnull ]'
      return
  endif

<span class="comments">; get table size</span>

 ftsize,h,tab,ncols,nrows,tfields,allcols,allrows

<span class="comments">; check to see if column name is a string</span>

 s = size(name)
 if (s[0] NE 0) or (s[1] NE 7) then $
        message,'Column name must be a string'

<span class="comments">; check to see if column already exists</span>

 ftinfo,h,ft_str, Count = count
 if Count GT 0 then begin
    g = where(strtrim(ft_str.ttype,2) EQ strupcase(name), Ng)
    if Ng GT 0 then message,'ERROR - Column '+name+' already exists'
 endif

<span class="comments">; set non specified inputs to ''</span>

 npar = N_params()
 if npar lt 5 then tform = ''
 if npar lt 6 then tunit = ''
 if npar lt 7 then tscal = ''
 if npar lt 8 then tzero = ''
 if npar lt 9 then tnull = ''

<span class="comments">; create default format if not supplied</span>

 if tform eq '' then begin
        case idltype of
                1:      tform = 'I4'            <span class="comments">;byte</span>
                2:      tform = 'I6'            <span class="comments">;integer*2</span>
                4:      tform = 'E15.8'         <span class="comments">;real*4</span>
                3:      tform = 'I11'           <span class="comments">;longword</span>
                5:      tform = 'D23.8'         <span class="comments">;real*8</span>
                else: begin
                        if idltype LT 0 then begin      <span class="comments">;string</span>
                            tform = 'A'+strtrim(fix(abs(idltype)),2)
                            idltype = 7
                          end else message,'Invalid idltype specified'
                      end
        end<span class="comments">; case</span>
 end

<span class="comments">; get field width from format</span>

 width = fix(gettok(strmid(tform,1,strlen(tform)-1),'.'))

<span class="comments">;</span>
<span class="comments">; is present allocated table size large enough?</span>
<span class="comments">;</span>
<span class="comments">;  If the new field is not a string, put a zero in the leftmost position</span>
<span class="comments">;  of the record so that a "Type conversion error" won't occur.</span>
<span class="comments">;</span>
 if (width+ncols) GT allcols then begin
    tab = [ tab, replicate(32B,width,allrows)]          <span class="comments">;increase size  </span>
    if (idltype NE 7) then tab[allcols,*] = 48B
 endif

<span class="comments">;</span>
<span class="comments">; update header</span>
<span class="comments">;</span>
 tfields = tfields+1
 apos = strtrim(tfields,2)
 ttype = strupcase(name)                                        <span class="comments">;ttype</span>
 while strlen(ttype) lt 8 do ttype = ttype+' '
 sxaddpar,h,'TTYPE'+apos,ttype,'','HISTORY'

<span class="comments">;</span>
 sxaddpar,h,'TBCOL'+apos,ncols+1,'','HISTORY'           <span class="comments">;tbcol (WBL 2-88)</span>

<span class="comments">;</span>
 while strlen(tform) lt 8 do tform = tform+' '          <span class="comments">;tform</span>
 sxaddpar,h,'TFORM'+apos,tform,'','HISTORY'


 if tunit NE '' then begin                              <span class="comments">;tunit</span>
        while strlen(tunit) lt 8 do tunit = tunit+' '
        sxaddpar,h,'tunit'+apos,tunit,'','HISTORY'
 end

 if string(tscal) NE '' then $
        sxaddpar,h,'tscal'+apos,tscal,'','HISTORY'      <span class="comments">;tscal</span>


 if string(tzero) NE '' then $
        sxaddpar,h,'tzero'+apos,tzero,'','HISTORY'      <span class="comments">;tzero</span>

 if string(tnull) NE '' then begin                      <span class="comments">;tnull</span>
        s = size(tnull) & type = s[s[0]+1]
        if type NE 1 then stnull = string(tnull,'('+strtrim(tform)+')') $
                     else stnull = tnull
        while strlen(stnull) LT 8 do stnull = stnull+' '
        sxaddpar, h, 'TNULL' + apos, stnull, '', 'HISTORY'
 end

<span class="comments">;</span>
<span class="comments">; increase table size in header</span>
<span class="comments">;</span>
 sxaddpar,h,'TFIELDS',tfields
 sxaddpar,h,'NAXIS1',ncols+width

 return
 end
</code>
    </div>
  </body>
</html>