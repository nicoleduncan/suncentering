<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:58:07 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>tbdelcol.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="tbdelcol.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="tbdelcol:source"></a>pro tbdelcol,h,tab,name                                               
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;       TBDELCOL</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;       Delete a column of data from a FITS binary table</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;       TBDELCOL, h, tab, name</span>
<span class="comments">;</span>
<span class="comments">; INPUTS-OUPUTS</span>
<span class="comments">;       h,tab - FITS binary table header and data array.  H and TAB will</span>
<span class="comments">;               be updated with the specified column deleted</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;       name - Either (1) a string giving the name of the column to delete</span>
<span class="comments">;                       or (2) a scalar giving the column number to delete</span>
<span class="comments">;</span>
<span class="comments">; EXAMPLE:</span>
<span class="comments">;       Delete the column "FLUX" from FITS binary table test.fits</span>
<span class="comments">;</span>
<span class="comments">;       IDL> tab = readfits('test.fits',h,/ext)    ;Read table</span>
<span class="comments">;       IDL> tbdelcol, h, tab, 'FLUX'              ;Delete Flux column</span>
<span class="comments">;       IDL> modfits,'test.fits',tab,h,/ext        ;Write back table</span>
<span class="comments">;</span>
<span class="comments">; PROCEDURES USED:</span>
<span class="comments">;       SXADDPAR, TBINFO, TBSIZE</span>
<span class="comments">; REVISION HISTORY:                                           </span>
<span class="comments">;       Written   W. Landsman        STX Co.     August, 1988</span>
<span class="comments">;       Use new structure returned by TBINFO,  August, 1997</span>
<span class="comments">;       Use SIZE(/TNAME) instead of DATATYPE()   October 2001</span>
<span class="comments">;       Use /NOSCALE in call to TBINFO, update TDISP   W. Landsman   March 2007</span>
<span class="comments">;- </span>
 compile_opt idl2
 On_error, 2

 if N_params() LT 3 then begin
     print,'Syntax - tbdelcol, h, tab, name'
     return
 endif

 s = size(name)

 tbsize, h, tab, ncol, nrows, tfields, allcols, allrows

<span class="comments">; Make sure column exists</span>

 tbinfo,h,tb_str,/NOSCALE

 case size(name,/TNAME) of
 'STRING': begin
      field = where(tb_str.ttype eq strupcase(name),nfound)
      if nfound eq 0 then $ 
         message,'Field '+strupcase(name) + ' not found in header'
      end
 'UNDEFINED':message,'Third parameter must be field name or number'
 ELSE: begin
      field = name-1
      if (field LT 0 ) or (field GT tfields) then $
            message,'Field number must be between 1 and ' +strtrim(tfields,2)
      end
 endcase

 fname = strtrim(strupcase(name),2)
 field = field[0]

<span class="comments">; Eliminate relevant columns from TAB</span>

 tcol = tb_str.tbcol[field] & w = tb_str.width[field]*tb_str.numval[field]

 case 1 of 
        tcol eq 0: tab = tab[w:*,*]                     <span class="comments">;First column</span>
        tcol eq ncol-w: tab = tab[0:tcol-1,*]          <span class="comments">;Last column</span>
        else: tab = [tab[0:tcol-1,*],tab[tcol+w:*,*]]  <span class="comments">;All other columns</span>
 endcase

<span class="comments">; Parse the header.  Remove specified keyword from header.  Lower</span>
<span class="comments">; the index of subsequent keywords.  Update the TBCOL*** index of</span>
<span class="comments">; subsequent keywords</span>

 nlines = N_elements(h)
 field = field + 1
 hnew = strarr(nlines)
 j = 0
 for i = 0,nlines-1 DO BEGIN    <span class="comments">;Loop over each element in header</span>

 key = strupcase(strmid(h[i],0,5))
 if (key eq 'TTYPE') OR (key eq 'TFORM') or (key eq 'TUNIT') or $
   (key eq 'TNULL') or (key EQ 'TDISP') then begin
        row = h[i]                    
        ifield = fix(strtrim(strmid(row,5,3)))    
        if ifield gt field then begin    <span class="comments">;Subsequent field?</span>
                if ifield le 10 then fmt = "(I1,' ')" else fmt ='(I2)'
                strput,row,string(ifield-1,format=fmt),5
        endif 
        if ifield ne field then hnew[j] = row else j=j-1
  endif else hnew[j] = h[i]      

 j = j+1

 endfor  

 sxaddpar,hnew,'TFIELDS',tfields-1 <span class="comments">;Reduce number of fields by 1</span>
 sxaddpar,hnew,'NAXIS1',ncol-w <span class="comments">;Reduce num. of columns by WIDTH</span>

 h = hnew[0:j-1]

 message,'Field '+fname+' has been deleted from the FITS table',/INF

 return  
 end
</code>
    </div>
  </body>
</html>