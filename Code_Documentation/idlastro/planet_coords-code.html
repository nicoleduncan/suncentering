<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:55 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>planet_coords.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="planet_coords.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="planet_coords:source"></a>pro planet_coords, date, ra, dec, planet=planet, jd = jd, jpl = jpl
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;    PLANET_COORDS</span>
<span class="comments">; PURPOSE:  </span>
<span class="comments">;    Find low or high precision RA and DEC for the planets given a date</span>
<span class="comments">;</span>
<span class="comments">; EXPLANATION:</span>
<span class="comments">;    For low precision this routine uses HELIO to get the heliocentric ecliptic</span>
<span class="comments">;    coordinates of the planets at the given date, then converts these to </span>
<span class="comments">;    geocentric ecliptic coordinates ala "Astronomical Algorithms" by Jean </span>
<span class="comments">;    Meeus (1991, p 209). These are then converted to RA and Dec using EULER.</span>
<span class="comments">;    The accuracy between the years 1800 and 2050 is better than 1 arcminute </span>
<span class="comments">;    for  the terrestial planets, but reaches 10 arcminutes for Saturn.    </span>
<span class="comments">;    Before 1850 or after 2050 the accuracy can get much worse.   </span>
<span class="comments">;</span>
<span class="comments">;    For high precision use the /JPL option ito use the full JPL ephemeris.</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;    PLANET_COORDS, DATE, RA, DEC, [ PLANET = , /JD, /JPL]</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;       DATE - If /JD is not set, then date is a 3-6 element vector containing</span>
<span class="comments">;              year,month (1-12), day, and optionally hour, minute, & second.</span>
<span class="comments">;              If /JD is set then DATE is a Julian date.   An advantage of the</span>
<span class="comments">;              /JD option is that it allows the use of vector dates.</span>
<span class="comments">; OUTPUTS:</span>
<span class="comments">;       RA - right ascension of planet(s), J2000 degrees, double precision</span>
<span class="comments">;       DEC - declination of   planet(s), J2000 degrees, double precision</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUT KEYWORD:</span>
<span class="comments">;       PLANET - scalar string giving name of a planet, e.g. 'venus'. Default </span>
<span class="comments">;               is to compute coords for all of them (except Earth).</span>
<span class="comments">;       /JD - If set, then the date parameter should be supplied as Julian date</span>
<span class="comments">;       JPL - if /JPL set, then PLANET_COORDS will call the procedure </span>
<span class="comments">;             JPLEPHINTERP to compute positions using the full JPL ephemeris.   </span>
<span class="comments">;             The JPL ephemeris FITS file JPLEPH.405 must exist in either the </span>
<span class="comments">;             current directory, or in the directory specified by the </span>
<span class="comments">;             environment variable ASTRO_DATA.   Alternatively, the JPL keyword</span>
<span class="comments">;             can be set to the full path and name of the ephemeris file.</span>
<span class="comments">;             A copy of the JPL ephemeris FITS file JPLEPH.405 is available in</span>
<span class="comments">;                 http://idlastro.gsfc.nasa.gov/ftp/data/         </span>
<span class="comments">; EXAMPLES:</span>
<span class="comments">;    (1)  Find the RA, Dec of Venus on 1992 Dec 20</span>
<span class="comments">;          IDL> planet_coords, [1992,12,20], ra,dec    ;Compute for all planets</span>
<span class="comments">;          IDL> print,adstring(ra[1],dec[1],1)         ;Venus is second planet</span>
<span class="comments">;     ====> RA = 21 05  2.66  Dec = -18 51 45.7</span>
<span class="comments">;    This position is 37" from the full DE406 ephemeris position of</span>
<span class="comments">;          RA = 21 05  5.24        -18 51 43.1</span>
<span class="comments">;</span>
<span class="comments">;    (2) Return the current RA and Dec of all 8 planets using JPL ephemeris</span>
<span class="comments">;          IDL> get_juldate, jd                 ;Get current Julian Date</span>
<span class="comments">;          IDL> planet_coords,jd,ra,dec,/jd,/jpl  ;Find positions of all planets</span>
<span class="comments">;          IDL> forprint,adstring(ra,dec,0)     ;Display positions   </span>
<span class="comments">;</span>
<span class="comments">;    (3) Plot the declination of Mars for every day in the year 2001</span>
<span class="comments">;          IDL> jdcnv,2001,1,1,0,jd      ;Get Julian date of midnight on Jan 1 </span>
<span class="comments">;               Now get Mars RA,Dec for 365 consecutive days</span>
<span class="comments">;          IDL> planet_coords,jd+indgen(365),ra,dec,/jd, planet = 'mars'     </span>
<span class="comments">;          IDL> plot,indgen(365)+1,dec</span>
<span class="comments">; NOTES:</span>
<span class="comments">;          HELIO is based on the two-body problem and neglects interactions </span>
<span class="comments">;           between the planets.   This is why the worst results are for</span>
<span class="comments">;           Saturn.   Use the /JPL option or the online ephemeris generator </span>
<span class="comments">;           http://ssd.jpl.nasa.gov/horizons.cgi for more accuracy. </span>
<span class="comments">;</span>
<span class="comments">;           The procedure returns astrometric coordinates, i.e. no correction</span>
<span class="comments">;           for aberration.   A correction for light travel time is applied</span>
<span class="comments">;           when /JPL is set, but not for the default low-precision calculation.</span>
<span class="comments">; PROCEDURES USED:</span>
<span class="comments">;        JULDATE </span>
<span class="comments">;        EULER, HELIO  - if /JPL is not set</span>
<span class="comments">;        JPLEPHREAD, JPLEPHINTERP - if /JPL is set</span>
<span class="comments">; REVISION HISTORY:</span>
<span class="comments">;        Written P.Plait & W. Landsman     August 2000</span>
<span class="comments">;        Fixed Julian date conversion   W. Landsman August 2000</span>
<span class="comments">;        Added /JPL keyword  W. Landsman   July 2001</span>
<span class="comments">;        Allow vector Julian dates with JPL ephemeris W. Landsman December 2002</span>
<span class="comments">;-   </span>
<span class="comments">; On_error,2</span>
 if N_params() LT 1 then begin
     print,'Syntax - PLANET_COORDS, date, ra,dec, [PLANET =, /JD , JPL= ]'
     print,'      date - either 3-6 element date or Julian date (if /JD is set)'
     print,'      ra,dec - output ra and dec in degrees'
     print,'      PLANET - name of planet (optional)'
     return
 endif

 radeg = 180.0d/!DPI
 c = 2.99792458d5

<span class="comments">;convert input date to real JD</span>
  
  if keyword_set(jd) then begin 
       jj = date
       if N_elements(jj) GT 0 then if N_elements(planet) GT 1 then $
       message,'ERROR - A planet name must be supplied for vector dates'
  endif else begin 
           juldate,date,jj
            jj = jj + 2400000.0d
  endelse 

<span class="comments">;make output arrays to include each planet</span>
<span class="comments">; note that we need Earth to convert from heliocentric</span>
<span class="comments">; ecliptic coordinates to geocentric and then to RA and DEC</span>

   if keyword_set(planet) then begin
       planetlist = ['MERCURY','VENUS','MARS', $
        'JUPITER','SATURN','URANUS','NEPTUNE','PLUTO']
        index = 1+ where(planetlist eq strupcase(strtrim(planet,2)), Nfound) 
        if index[0] GE 3 then index = index + 1
       if Nfound EQ 0 then message,'Unrecognized planet of ' + planet
   endif else index = [1,2,4,5,6,7,8,9]

   if keyword_set(JPL) then begin
       if size(jpl,/TNAME) EQ 'STRING' then jplfile = jpl else $
            jplfile = find_with_def('JPLEPH.405','ASTRO_DATA')

        if jplfile EQ '' then message,'ERROR - Cannot find JPL ephemeris file' 
<span class="comments">;Read ephemeris FITS file</span>
        JPLEPHREAD,jplfile, pinfo, pdata, [long(min(jj)-1), long(max(jj)+1)]
        np = N_elements(index)
        njd = n_elements(jj)
        ra = dblarr(njd,np)   & dec = dblarr(njd,np)

        for i=0, Np-1 do begin
        JPLEPHINTERP, pinfo, pdata, jj, x,y,z, $
                       objectname=index[i],center='EARTH'
<span class="comments">;  Compute distance to planet(s) and adjust Julian date for light travel time</span>
<span class="comments">; and recompute planet positions</span>
       dis = sqrt(x^2 + y^2 + z^2)
       jj1 = jj - dis/c/86400.0d

<span class="comments">; Compute position of Earth at current time, but position of planet at time</span>
<span class="comments">; light started traveling </span>
       JPLEPHINTERP, pinfo, pdata, jj, xe,ye,ze, /EARTH
       JPLEPHINTERP, pinfo, pdata, jj1, x,y,z, objectname=index[i]
       x = x-xe & y = y-ye & z = z-ze
         ra[0,i] = atan(y,x) * radeg
       g = where(ra LT 0, Ng)
       if Ng GT 0 then ra[g] = ra[g] + 360.0d
       dec[0,i]   = atan(z,sqrt(x*x + y*y)) * radeg
       endfor
       ra = reform(ra) & dec = reform(dec)
       return
   endif

   helio,jj,index,rad,lon,lat,/radian

<span class="comments">; extract Earth's info</span>

   helio,jj,3,rade,lone,late,/radian

<span class="comments">;get rectangular coords of planets</span>

   x = rad * cos(lat) * cos(lon) - rade * cos(late) * cos(lone)
   y = rad * cos(lat) * sin(lon) - rade * cos(late) * sin(lone)
   z = rad * sin(lat)            - rade * sin(late)

<span class="comments">;get geocentric longitude lambda and geo latitude, beta</span>

   lambda = atan(y,x) * radeg
   beta   = atan(z,sqrt(x*x + y*y)) * radeg

<span class="comments">;convert to Ra and Dec</span>

   euler, lambda, beta, ra, dec, 4

   return
   end
</code>
    </div>
  </body>
</html>