<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:25 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>dbdelete.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="dbdelete.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="dbdelete:source"></a>pro dbdelete, list, name, DEBUG = debug
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;       DBDELETE</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;       Deletes specified entries from data base</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;       DBDELETE, list, [ name, /DEBUG ]   </span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;       list - list of entries to be deleted, scalar or vector</span>
<span class="comments">;       name - optional name of data base, scalar string.  If not specified</span>
<span class="comments">;               then the data base file must be previously opened for update </span>
<span class="comments">;               by DBOPEN.</span>
<span class="comments">;</span>
<span class="comments">; OPERATIONAL NOTES:</span>
<span class="comments">;       !PRIV must be at least 3 to execute.</span>
<span class="comments">;</span>
<span class="comments">; SIDE EFFECTS:</span>
<span class="comments">;       The data base file (ZDBASE:name.dbf) is modified by removing the</span>
<span class="comments">;       specified entries and reordering the remaining entry numbers</span>
<span class="comments">;       accordingly (ie. if you delete entry 100, it will be replaced</span>
<span class="comments">;       by entry 101 and the database will contain 1 less entry.</span>
<span class="comments">;</span>
<span class="comments">; EXAMPLE:</span>
<span class="comments">;        Delete entries in a database STARS where RA=DEC = 0.0</span>
<span class="comments">;</span>
<span class="comments">;        IDL> !PRIV= 3                           ;Set privileges</span>
<span class="comments">;        IDL> dbopen,'STARS',1                   ;Open for update</span>
<span class="comments">;        IDL> list = dbfind('ra=0.0,dec=0.0')    ;Obtain LIST vector</span>
<span class="comments">;        IDL> dbdelete, list             ;Delete specified entries from db</span>
<span class="comments">;</span>
<span class="comments">; NOTES:</span>
<span class="comments">;       The procedure is rather slow because the entire database is re-</span>
<span class="comments">;       created with the specified entries deleted.</span>
<span class="comments">; OPTIONAL KEYWORD INPUT:</span>
<span class="comments">;        DEBUG - if this keyword is set and non-zero, then additional </span>
<span class="comments">;               diagnostics will be printed as each entry is deleted.</span>
<span class="comments">; COMMON BLOCKS:</span>
<span class="comments">;       DBCOM</span>
<span class="comments">; PROCEDURE CALLS:</span>
<span class="comments">;       DBINDEX, DB_INFO(), DBOPEN, DBPUT, ZPARCHECK</span>
<span class="comments">; HISTORY</span>
<span class="comments">;       Version 2  D. Lindler  July, 1989</span>
<span class="comments">;       Updated documentation   W. Landsman    December 1992</span>
<span class="comments">;       William Thompson, GSFC, 28 February 1995</span>
<span class="comments">;                       Fixed bug when external representation used.</span>
<span class="comments">;       Fixed for case where second parameter supplied W. Landsman April 1996</span>
<span class="comments">;       Use keyword DEBUG rather than !DEBUG   W. Landsman    May 1997</span>
<span class="comments">;       Don't call DBINDEX if no indexed items  W. Landsman May 2006  </span>
<span class="comments">;       Use TRUNCATE_LUN if V5.6 or later W. Landsman   Sep 2006 </span>
<span class="comments">;       Fix problem when deleting last entry   W. Landsman Mar 2007</span>
<span class="comments">;       Assume since V5.6 so TRUNCATE_LUN is available   W. Landsman</span>
<span class="comments">;       </span>
<span class="comments">;-</span>
<span class="comments">;-------------------------------------------------------------------------------</span>
  On_error,2
  compile_opt idl2

  if N_params() EQ 0 then begin
      print,'Syntax - DBDELETE, entry, [ dbname ]'
      return
  endif 

<span class="comments">; data base common block</span>

 common db_com,QDB,QITEMS,QDBREC

<span class="comments">; Check parameters</span>

 zparcheck, 'DBDELETE', list, 1, [1,2,3], [0,1], 'entry list'
 if N_params() GT 1 then $
        zparcheck, 'dbdelete', name, 2, 7, 0, 'data base name'
 
 if !PRIV lt 3 then $
        message,'!priv must be at least 3 to execute'

<span class="comments">; Open data base if name supplied</span>

  if N_params() GT 1 then dbopen,name,1 else begin    <span class="comments">;Open specified database</span>

     if not db_info( 'OPEN') then $
        message,'No database open for update'
     if not db_info('update') then $
            message,'Database '+ db_info('NAME',0) + ' not open for update'
  
   endelse

<span class="comments">; Determine whether or not the database uses external data representation.</span>

 external = qdb[119] eq 1


<span class="comments">; Create vector if list is a scalar</span>

  outrec = 0L                           <span class="comments">; Create counter of output record</span>
  len = db_info('length')
 
<span class="comments">; loop on entries in data base</span>

  qnentry = db_info('ENTRIES',0)
  
  for i = 1L, qnentry do begin

        <span class="comments">; Is it to be kept?</span>

        found = where( list EQ i, Nfound)

        if keyword_set(debug) then print,i,nfound           <span class="comments">; allow diags.</span>

        if ( Nfound LE 0 ) then begin
                outrec = outrec + 1                <span class="comments">; increment counter</span>
                if ( outrec NE i ) then begin
                        entry = qdbrec[i]
                        tmp = outrec
                        if external then byteorder,tmp,/htonl
                        dbput, 0, tmp, entry   <span class="comments">; modify entry number</span>
                        qdbrec[outrec] = entry
                endif
        endif
  endfor

<span class="comments">; Update adjusted total number of entries.</span>

  qdb[84] = byte( outrec,0,4 )

<span class="comments">; Truncate the .dbf file at the current position.</span>

  unit = db_info('unit_dbf')
  point_lun, unit, long64(outrec+1)*len
  truncate_lun, unit

<span class="comments">; Update index file</span>

  indextype = db_item_info( 'INDEX')
  if total(indextype) NE 0 then dbindex

  if N_params() GT 1 then dbclose

  return  <span class="comments">; dbdelete</span>
  end  <span class="comments">; dbdelete</span>
</code>
    </div>
  </body>
</html>