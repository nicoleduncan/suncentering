<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:37 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>fxmove.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="fxmove.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source">FUNCTION FXMOVE, UNIT, EXTEN, SILENT = Silent, EXT_NO = ext_no, ERRMSG=errmsg

<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;     FXMOVE</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;     Skip to a specified extension number or name in a FITS file</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;     STATUS=FXMOVE(UNIT, EXT, /Silent)</span>
<span class="comments">;     STATUS=FXMOVE(UNIT, EXTNAME, /Silent, EXT_NO=, ERRMSG= )</span>
<span class="comments">;</span>
<span class="comments">; INPUT PARAMETERS:</span>
<span class="comments">;     UNIT     = An open unit descriptor for a FITS data stream.</span>
<span class="comments">;     EXTEN   = Number of extensions to skip.</span>
<span class="comments">;                              or</span>
<span class="comments">;             Scalar string giving extension name (in the EXTNAME keyword)           </span>
<span class="comments">; OPTIONAL INPUT PARAMETER:</span>
<span class="comments">;     /SILENT - If set, then any messages about invalid characters in the </span>
<span class="comments">;               FITS file are suppressed.</span>
<span class="comments">; OPTIONAL OUTPUT PARAMETER:</span>
<span class="comments">;       ERRMSG  = If this keyword is present, then any error messages will be</span>
<span class="comments">;                 returned to the user in this parameter rather than</span>
<span class="comments">;                 depending on the MESSAGE routine in IDL.  If no errors are</span>
<span class="comments">;                 encountered, then a null string is returned.</span>
<span class="comments">;       EXT_NO - Extension number, scalar integer, useful if the user supplied </span>
<span class="comments">;                an extension name in the EXTEN parameter</span>
<span class="comments">; RETURNS:</span>
<span class="comments">;     0 if successful.</span>
<span class="comments">;    -1 if an error is encountered.</span>
<span class="comments">;</span>
<span class="comments">; COMMON BLOCKS:</span>
<span class="comments">;      None.</span>
<span class="comments">; SIDE EFFECTS:</span>
<span class="comments">;      Repositions the file pointer.</span>
<span class="comments">; PROCEDURE:</span>
<span class="comments">;      Each FITS header is read in and parsed, and the file pointer is moved</span>
<span class="comments">;      to where the next FITS extension header until the desired</span>
<span class="comments">;      extension is reached.</span>
<span class="comments">; PROCEDURE CALLS:</span>
<span class="comments">;      FXPAR(), MRD_HREAD, MRD_SKIP</span>
<span class="comments">; MODIFICATION HISTORY:</span>
<span class="comments">;      Extracted from FXPOSIT 8-March-2000 by T. McGlynn</span>
<span class="comments">;      Added /SILENT keyword  14-Dec-2000 by W. Landsman</span>
<span class="comments">;      Save time by not reading the full header  W. Landsman   Feb. 2003</span>
<span class="comments">;      Allow extension name to be specified, added EXT_NO, ERRMSG keywords</span>
<span class="comments">;         W. Landsman  December 2006</span>
<span class="comments">;      Make search for EXTNAME case-independent  W.Landsman March 2007 </span>
<span class="comments">;      Avoid round-off error for very large extensions N. Piskunov Dec 2007</span>
<span class="comments">;      Assume since V6.1 (/INTEGER keyword available to PRODUCT() ) Dec 2007</span>
<span class="comments">;      Capture error message from MRD_HREAD (must be used with post-June 2009</span>
<span class="comments">;        version of MRD-HREAD)   W. Landsman  July 2009</span>
<span class="comments">;-</span>
     On_error, 2
     compile_opt idl2

         DO_NAME = SIZE( EXTEN,/TNAME) EQ 'STRING'
	 PRINT_ERROR = ~ARG_PRESENT(ERRMSG)
         ERRMSG = ''
         IF DO_NAME THEN BEGIN 
	              FIRSTBLOCK = 0
		      EXT_NO = 9999
		      ENAME = STRTRIM( STRUPCASE(EXTEN), 2 )
		      ON_IOERROR, ALLOW_PLUN
		      POINT_LUN, -UNIT, DUM
		      ON_IOERROR, NULL
         ENDIF ELSE BEGIN 
	              FIRSTBLOCK = 1
		      EXT_NO = EXTEN
	ENDELSE 	            
		
        FOR I = 1, EXT_NO DO BEGIN
               
<span class="comments">;</span>
<span class="comments">;  Read the next header, and get the number of bytes taken up by the data.</span>
<span class="comments">; </span>

                IF EOF(UNIT) THEN BEGIN 
		    IF DO_NAME THEN ERRMSG = $
	'Extension name ' + ename + ' not found in FITS file' ELSE ERRMSG = $	    
	'EOF encountered while moving to specified extension'
	        if PRINT_ERROR then message,errmsg	
		RETURN, -1
		ENDIF
           
                <span class="comments">; Can't use FXHREAD to read from pipe, since it uses</span>
                <span class="comments">; POINT_LUN.  So we read this in ourselves using mrd_hread</span>

                MRD_HREAD, UNIT, HEADER, STATUS, SILENT = Silent, $
		    FIRSTBLOCK=FIRSTBLOCK, ERRMSG = ERRMSG
		   
                IF STATUS LT 0 THEN BEGIN 
		    IF PRINT_ERROR THEN MESSAGE,ERRMSG   <span class="comments">;Typo fix 04/10</span>
		    RETURN, -1
		ENDIF    
                        
                <span class="comments">; Get parameters that determine size of data</span>
                <span class="comments">; region.</span>
                IF DO_NAME THEN IF I GT 1 THEN BEGIN
		       EXTNAME = STRTRIM(SXPAR(HEADER,'EXTNAME',COUNT=N_name),2)
			 if N_NAME GT 0 THEN $
			  IF ENAME EQ STRUPCASE(EXTNAME) THEN BEGIN
			        EXT_NO= I-1
				BLOCK = 1 + ((N_ELEMENTS(HEADER)-1)/36)
				POINT_LUN, -UNIT, CURR_POSS
				POINT_LUN, UNIT, CURR_POSS - BLOCK*2880 
			        BREAK
			ENDIF	
		ENDIF	         
                BITPIX = FXPAR(HEADER,'BITPIX')
                NAXIS  = FXPAR(HEADER,'NAXIS')
                GCOUNT = FXPAR(HEADER,'GCOUNT') 
                IF GCOUNT EQ 0 THEN GCOUNT = 1
                PCOUNT = FXPAR(HEADER,'PCOUNT')
                
                IF NAXIS GT 0 THEN BEGIN 
                        DIMS = FXPAR(HEADER,'NAXIS*')           <span class="comments">;Read dimensions</span>
			NDATA = PRODUCT(DIMS,/INTEGER) 
                ENDIF ELSE NDATA = 0
                
                NBYTES = LONG64(ABS(BITPIX) / 8) * GCOUNT * (PCOUNT + NDATA)
<span class="comments">;</span>
<span class="comments">;  Move to the next extension header in the file.</span>
<span class="comments">;</span>
                NREC = (NBYTES + 2879) / 2880
                MRD_SKIP, UNIT, NREC*2880L 

        ENDFOR
	        
        RETURN, 0
ALLOW_PLUN:
        
        ERRMSG =  $
	'Extension name cannot be specified unless POINT_LUN access is available'
	if PRINT_ERROR then message,errmsg	
	RETURN, -1        
END
</code>
    </div>
  </body>
</html>