<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:58:01 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>sigrange.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="sigrange.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source">	FUNCTION SIGRANGE,ARRAY,FRACTION=FRACTION,MISSING=MISSING,RANGE=RANGE
<span class="comments">;+</span>
<span class="comments">; NAME: </span>
<span class="comments">;	SIGRANGE()</span>
<span class="comments">; PURPOSE: </span>
<span class="comments">;	Selects the most significant data range in an image.</span>
<span class="comments">; EXPLANATION: </span>
<span class="comments">;	Selects out the most significant range in the data to be used in </span>
<span class="comments">;	displaying images.  The histogram of ARRAY is used to select the most</span>
<span class="comments">;	significant range.      Useful for scaling an image display.</span>
<span class="comments">; CALLING SEQUENCE: </span>
<span class="comments">;	OUTPUT = SIGRANGE( ARRAY )</span>
<span class="comments">; INPUTS: </span>
<span class="comments">;	ARRAY	 = Array to take most significant range of.</span>
<span class="comments">; OPTIONAL INPUTS: </span>
<span class="comments">;	None.</span>
<span class="comments">; OUTPUTS: </span>
<span class="comments">;	The function returns an array where values above and below the</span>
<span class="comments">;	selected range are set equal to the maximum and minimum of the</span>
<span class="comments">;	range respectively.</span>
<span class="comments">; OPTIONAL INPUT KEYWORDS: </span>
<span class="comments">;	FRACTION = Fraction of data to consider most significant.</span>
<span class="comments">;		   Defaults to 0.99</span>
<span class="comments">;	MISSING	 = Value used to flag missing points.  Data points with this</span>
<span class="comments">;		   value are not considered or changed.</span>
<span class="comments">; OPTIONAL OUTPUT KEYWORD</span>
<span class="comments">;	RANGE    = 2 element vector, giving the range (minimum and maxmimum) </span>
<span class="comments">;		used</span>
<span class="comments">;</span>
<span class="comments">; NOTES:</span>
<span class="comments">;       If the image array contains more than 10,000 points then SIGRANGE() </span>
<span class="comments">;       uses random indexing of a subset of the points to determine the range</span>
<span class="comments">;       (for speed).    Thus identical calls to SIGRANGE() might not yield</span>
<span class="comments">;       identical results (although they should be very close).     </span>
<span class="comments">; RESTRICTIONS: </span>
<span class="comments">;	ARRAY must have more than two points.  Fraction must be greater than 0 </span>
<span class="comments">;	and less than 1.</span>
<span class="comments">;</span>
<span class="comments">;	SIGRANGE was originally part of the SERTS image display package.   </span>
<span class="comments">;	Other routines from this package are available at </span>
<span class="comments">;</span>
<span class="comments">;	http://sohowww.nascom.nasa.gov/solarsoft/gen/idl/image/</span>
<span class="comments">;</span>
<span class="comments">;	Note that this version of SIGRANGE does not include the non-standard </span>
<span class="comments">;	system variables used in the SERTS package.</span>
<span class="comments">; REVISION HISTORY: </span>
<span class="comments">;	Version 1, William Thompson, GSFC, 12 May 1993.</span>
<span class="comments">;		Incorporated into CDS library.</span>
<span class="comments">;	Version 2, William Thompson, GSFC, 25 May 1993.</span>
<span class="comments">;		Changed call to HISTOGRAM to be compatible with OpenVMS/ALPHA</span>
<span class="comments">;       Version 3, CDP, RAL, Add RANGE keyword.  16-Apr-96</span>
<span class="comments">;	Version 4, William Thompson, GSFC, 17 April 1996</span>
<span class="comments">;		Corrected some problems when range is too high.</span>
<span class="comments">;	Version 5, 13-Jan-1998, William Thompson, GSFC</span>
<span class="comments">;		Use random numbers to improve statistics when only using a</span>
<span class="comments">;		fraction of the array.</span>
<span class="comments">;	Version 6, 06-Mar-1998, William Thompson, GSFC</span>
<span class="comments">;		Change default to 0.99</span>
<span class="comments">;-</span>
<span class="comments">;</span>
	IF N_ELEMENTS(FRACTION) NE 1 THEN FRACTION = 0.99
	IF N_ELEMENTS(ARRAY) LE 2 THEN BEGIN
	    MESSAGE, /CONTINUE, 'Not enough points to form histogram'
	    RETURN, ARRAY
	END ELSE IF (FRACTION LE 0) OR (FRACTION GE 1) THEN BEGIN
	    MESSAGE, /CONTINUE, 'Fraction must be GT 0 and LT 1'
	    RETURN, ARRAY
	ENDIF
<span class="comments">;</span>
<span class="comments">;  To speed up the process, work on a reduced version of ARRAY.</span>
<span class="comments">;</span>
	IF N_ELEMENTS(ARRAY) LT 10000 THEN ATEMP0 = ARRAY ELSE BEGIN
	    NN = 1000 > (N_ELEMENTS(ARRAY) / 25) &lt<span class="comments">; 100000</span>
	    ATEMP0 = ARRAY[N_ELEMENTS(ARRAY)*RANDOMU(SEED,NN)]
	ENDELSE
<span class="comments">;</span>
<span class="comments">;  Get the total range of the data, excluding any missing points.</span>
<span class="comments">;</span>
        IF N_ELEMENTS(MISSING) EQ 1 THEN BEGIN
                W = WHERE(ATEMP0 NE MISSING, COUNT)
                IF COUNT GT 0 THEN ATEMP0 = ATEMP0(W)
	ENDIF 
	N_TOTAL = N_ELEMENTS(ATEMP0)
	AMAX = 1.*MAX(ATEMP0)
	AMIN = 1.*MIN(ATEMP0)
	IF AMIN EQ AMAX THEN GOTO, EXIT_POINT
<span class="comments">;</span>
<span class="comments">;  Set up some initial parameters for the reiteration.</span>
<span class="comments">;</span>
	ATEMP = ATEMP0
	DELTA = 0
<span class="comments">;</span>
<span class="comments">;  Form the histogram, and calculate an array expressing the fraction of points</span>
<span class="comments">;  that fall within or below the given bin.</span>
<span class="comments">;</span>
FIND_RANGE:
	LAST_DELTA = DELTA
	X = AMIN  +  FINDGEN(1001) * (AMAX - AMIN) / 1000.
	H = HISTOGRAM(LONG((ATEMP-AMIN)*1000./(AMAX - AMIN)))
	FOR I = 1,N_ELEMENTS(H)-1 DO H[I] = H[I] + H[I-1]
	H = H / FLOAT(N_TOTAL)
<span class="comments">;</span>
<span class="comments">;  Estimate the endpoints corresponding to the specified range, and calculate</span>
<span class="comments">;  the values at these endpoints.  Limit the array to be within these values.</span>
<span class="comments">;</span>
	IMIN = (MIN( WHERE( H GT ((1. - FRACTION) / 2.) )) - 1) > 0
	IMAX =  MIN( WHERE( H GT ((1. + FRACTION) / 2.) ))
	IF IMAX LT 0 THEN IMAX = 1000
	AMIN = X[IMIN]
	AMAX = X[IMAX]
<span class="comments">;</span>
<span class="comments">;  If the calculated range is zero, then use 2% of the full range of the data.</span>
<span class="comments">;</span>
	IF AMAX EQ AMIN THEN BEGIN
		BMAX = MAX(ATEMP0, MIN=BMIN)
		AMAX = MAX(ATEMP0(WHERE(ATEMP0 LE (AMAX + 0.01*(BMAX-BMIN)))))
		AMIN = MIN(ATEMP0(WHERE(ATEMP0 GE (AMIN - 0.01*(BMAX-BMIN)))))
	ENDIF
<span class="comments">;</span>
<span class="comments">;  If the range calculated has changed by more than 5% from the last iteration,</span>
<span class="comments">;  the reiterate.</span>
<span class="comments">;</span>
	ATEMP = AMIN > ATEMP0 &lt<span class="comments">; AMAX</span>
	DELTA = AMAX - AMIN
	RATIO = (DELTA - LAST_DELTA) / (DELTA + LAST_DELTA)
	IF ABS(RATIO) GT 0.05 THEN GOTO, FIND_RANGE
<span class="comments">;</span>
<span class="comments">;  If a missing pixel flag value was passed, then reset those points to the</span>
<span class="comments">;  flag value.  Return the adjusted array.</span>
<span class="comments">;</span>
EXIT_POINT:
	ATEMP = AMIN > ARRAY &lt<span class="comments">; AMAX</span>
	IF N_ELEMENTS(MISSING) EQ 1 THEN BEGIN
		WW = WHERE(ARRAY EQ MISSING,N_MISSING)
		IF N_MISSING GT 0 THEN ATEMP[WW] = MISSING
	ENDIF
        RANGE = [AMIN,AMAX]
	RETURN, ATEMP
	END
</code>
    </div>
  </body>
</html>