<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:36 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>fxbtform.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="fxbtform.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source">	PRO FXBTFORM,HEADER,TBCOL,IDLTYPE,FORMAT,NUMVAL,MAXVAL,ERRMSG=ERRMSG
<span class="comments">;+</span>
<span class="comments">; NAME: </span>
<span class="comments">;	FXBTFORM</span>
<span class="comments">; PURPOSE     : </span>
<span class="comments">;	Returns information about FITS binary table columns.</span>
<span class="comments">; EXPLANATION : </span>
<span class="comments">;	Procedure to return information about the format of the various columns</span>
<span class="comments">;	in a FITS binary table.</span>
<span class="comments">; Use         : </span>
<span class="comments">;	FXBTFORM,HEADER,TBCOL,IDLTYPE,FORMAT,NUMVAL,MAXVAL</span>
<span class="comments">; Inputs      : </span>
<span class="comments">;	HEADER	= Fits binary table header.</span>
<span class="comments">; Opt. Inputs : </span>
<span class="comments">;	None.</span>
<span class="comments">; Outputs     : </span>
<span class="comments">;	TBCOL	= Array of starting column positions in bytes.</span>
<span class="comments">;	IDLTYPE	= IDL data types of columns.</span>
<span class="comments">;	FORMAT	= Character code defining the data types of the columns.</span>
<span class="comments">;	NUMVAL	= Number of elements of the data arrays in the columns.</span>
<span class="comments">;	MAXVAL	= Maximum number of elements for columns containing variable</span>
<span class="comments">;		  length arrays, or zero otherwise.</span>
<span class="comments">; Opt. Outputs: </span>
<span class="comments">;	None.</span>
<span class="comments">; Keywords    : </span>
<span class="comments">;	ERRMSG	  = If defined and passed, then any error messages will be</span>
<span class="comments">;		    returned to the user in this parameter rather than</span>
<span class="comments">;		    depending on the MESSAGE routine in IDL.  If no errors are</span>
<span class="comments">;		    encountered, then a null string is returned.  In order to</span>
<span class="comments">;		    use this feature, ERRMSG must be defined first, e.g.</span>
<span class="comments">;</span>
<span class="comments">;			ERRMSG = ''</span>
<span class="comments">;			FXBTFORM, ERRMSG=ERRMSG, ...</span>
<span class="comments">;			IF ERRMSG NE '' THEN ...</span>
<span class="comments">;</span>
<span class="comments">; Calls       : </span>
<span class="comments">;	FXPAR</span>
<span class="comments">; Common      : </span>
<span class="comments">;	None.</span>
<span class="comments">; Restrictions: </span>
<span class="comments">;	None.</span>
<span class="comments">; Side effects: </span>
<span class="comments">;	None.</span>
<span class="comments">; Category    : </span>
<span class="comments">;	Data Handling, I/O, FITS, Generic.</span>
<span class="comments">; Prev. Hist. : </span>
<span class="comments">;	W. Thompson, Feb. 1992, from TBINFO by D. Lindler.</span>
<span class="comments">;	W. Thompson, Jan. 1993, renamed to be compatible with DOS limitations.</span>
<span class="comments">; Written     : </span>
<span class="comments">;	William Thompson, GSFC, February 1992.</span>
<span class="comments">; Modified    : </span>
<span class="comments">;	Version 1, William Thompson, GSFC, 12 April 1993.</span>
<span class="comments">;		Incorporated into CDS library.</span>
<span class="comments">;	Version 2, William Thompson, GSFC, 21 June 1994</span>
<span class="comments">;		Added ERRMSG keyword.</span>
<span class="comments">;       Version 3, William Thompson, GSFC, 23 June 1994</span>
<span class="comments">;               Modified so that ERRMSG is not touched if not defined.</span>
<span class="comments">;	Version 4, William Thompson, GSFC, 9 April 1997</span>
<span class="comments">;		Modified so that variable length arrays can be read, even if</span>
<span class="comments">;		the maximum array size is not in the header.</span>
<span class="comments">;	Version 5  Wayne Landsman, GSFC, August 1997</span>
<span class="comments">;		Recognize double complex array type if since IDL version 4.0</span>
<span class="comments">;       Version 6  Optimized FXPAR call, CM 1999 Nov 18</span>
<span class="comments">;       Version 7: Wayne Landsman, GSFC Feb 2006</span>
<span class="comments">;               Added support for 64bit integer K format</span>
<span class="comments">; Version:</span>
<span class="comments">;       Version 8: Wayne Landsman GSFC Apr 2010</span>
<span class="comments">;               Remove use of obsolete !ERR variable</span>
<span class="comments">;-</span>
<span class="comments">;</span>
	ON_ERROR,2
        COMPILE_OPT IDL2
<span class="comments">;</span>
<span class="comments">;  Check the number of parameters.</span>
<span class="comments">;</span>
	IF N_PARAMS() LT 1 THEN BEGIN
		MESSAGE = 'Syntax:  FXBTFORM,HEADER,TBCOL,IDLTYPE,FORMAT,' + $
			'NUMVAL,MAXVAL'
		IF N_ELEMENTS(ERRMSG) NE 0 THEN BEGIN
			ERRMSG = MESSAGE
			RETURN
		END ELSE MESSAGE, MESSAGE
	ENDIF
<span class="comments">;</span>
<span class="comments">;  Get the number of fields.</span>
<span class="comments">;</span>
	TFIELDS = FXPAR(HEADER,'TFIELDS', START=0L, COUNT=N_TFIELDS)
	IF N_TFIELDS LE 0 THEN BEGIN
		MESSAGE = 'Invalid FITS header -- keyword TFIELDS is missing'
		IF N_ELEMENTS(ERRMSG) NE 0 THEN BEGIN
			ERRMSG = MESSAGE
			RETURN
		END ELSE MESSAGE, MESSAGE
	END ELSE IF TFIELDS EQ 0 THEN BEGIN
		MESSAGE = 'FIT binary table has no columns'
		IF N_ELEMENTS(ERRMSG) NE 0 THEN BEGIN
			ERRMSG = MESSAGE
			RETURN
		END ELSE MESSAGE, MESSAGE
	ENDIF
<span class="comments">;</span>
<span class="comments">;  Initialize the arrays.</span>
<span class="comments">;</span>
	WIDTH	= INTARR(TFIELDS)
	IDLTYPE	= INTARR(TFIELDS)
	TBCOL	= LONARR(TFIELDS)
	FORMAT	= STRARR(TFIELDS)
	NUMVAL	= LONARR(TFIELDS)
	MAXVAL	= LONARR(TFIELDS)
<span class="comments">;</span>
<span class="comments">;  Get the column formats.</span>
<span class="comments">;</span>
	TFORM = FXPAR(HEADER,'TFORM*', COUNT=N_TFORM)
	IF N_TFORM LE 0 THEN BEGIN
		MESSAGE = 'Invalid FITS table header -- keyword TFORM ' + $
			'not present'
		IF N_ELEMENTS(ERRMSG) NE 0 THEN BEGIN
			ERRMSG = MESSAGE
			RETURN
		END ELSE MESSAGE, MESSAGE
	ENDIF
	TFORM =  STRUPCASE(STRTRIM(TFORM,2))
<span class="comments">;</span>
<span class="comments">;  Parse the values of the TFORM keywords.</span>
<span class="comments">;</span>
	LEN = STRLEN(TFORM)
	FOR I = 0,N_ELEMENTS(TFORM)-1 DO BEGIN
<span class="comments">;</span>
<span class="comments">;  Step through each character in the format, until a non-numerical character</span>
<span class="comments">;  is encountered.</span>
<span class="comments">;</span>
		ICHAR = 0
NEXT_CHAR:
		IF ICHAR GE LEN[I] THEN BEGIN
			MESSAGE = 'Invalid format specification for ' +	$
				'keyword TFORM ' + STRTRIM(I+1)
			IF N_ELEMENTS(ERRMSG) NE 0 THEN BEGIN
				ERRMSG = MESSAGE
				RETURN
			END ELSE MESSAGE, MESSAGE
		ENDIF
		CHAR = STRUPCASE(STRMID(TFORM[I],ICHAR,1))
		IF ((CHAR GE '0') AND (CHAR LE '9')) THEN BEGIN
			ICHAR = ICHAR + 1
			GOTO, NEXT_CHAR
		ENDIF
<span class="comments">;</span>
<span class="comments">;  Get the number of elements.</span>
<span class="comments">;</span>
		IF ICHAR EQ 0 THEN NUMVAL[I] = 1 ELSE	$
			NUMVAL[I] = LONG(STRMID(TFORM[I],0,ICHAR))
<span class="comments">;</span>
<span class="comments">;  If the character is "P" then the next character is the actual data type,</span>
<span class="comments">;  followed by the maximum number of elements surrounded by quotes.</span>
<span class="comments">;</span>
		IF CHAR EQ "P" THEN BEGIN
			CHAR = STRUPCASE(STRMID(TFORM[I],ICHAR+1,1))
			MAXVAL[I] = LONG(STRMID(TFORM[I],ICHAR+3,	$
				LEN[I]-ICHAR-4))
			IF MAXVAL[I] EQ 0 THEN MAXVAL[I] = 1
		ENDIF
<span class="comments">;</span>
<span class="comments">;  Get the IDL data type, and the size of an element.</span>
<span class="comments">;</span>
		FORMAT[I] = CHAR
		CASE CHAR OF
			'L':  BEGIN & IDLTYPE[I] = 1 & WIDTH[I] = 1 & END
			'A':  BEGIN & IDLTYPE[I] = 7 & WIDTH[I] = 1 & END
			'B':  BEGIN & IDLTYPE[I] = 1 & WIDTH[I] = 1 & END
			'I':  BEGIN & IDLTYPE[I] = 2 & WIDTH[I] = 2 & END
			'J':  BEGIN & IDLTYPE[I] = 3 & WIDTH[I] = 4 & END
			'E':  BEGIN & IDLTYPE[I] = 4 & WIDTH[I] = 4 & END
			'D':  BEGIN & IDLTYPE[I] = 5 & WIDTH[I] = 8 & END
			'C':  BEGIN & IDLTYPE[I] = 6 & WIDTH[I] = 8 & END
			'M':  BEGIN & IDLTYPE[I] = 9 & WIDTH[I] =16 & END 
			'K':  BEGIN & IDLTYPE[I] =14 & WIDTH[I] = 8 & END 
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;  Treat bit arrays as byte arrays with 1/8 the number of elements.</span>
<span class="comments">;</span>
			'X':  BEGIN
				IDLTYPE[I] = 1
				WIDTH[I] = 1
				IF MAXVAL[I] GT 0 THEN BEGIN
					MAXVAL[I] = LONG((MAXVAL[I]+7)/8)
				END ELSE BEGIN
					NUMVAL[I] = LONG((NUMVAL[I]+7)/8)
				ENDELSE
				END

			ELSE:  BEGIN
				MESSAGE = 'Invalid format specification ' + $
					'for keyword TFORM' + STRTRIM(I+1,2)
				IF N_ELEMENTS(ERRMSG) NE 0 THEN BEGIN
					ERRMSG = MESSAGE
					RETURN
				END ELSE MESSAGE, MESSAGE
				END
		ENDCASE
<span class="comments">;</span>
<span class="comments">;  Variable length array pointers always take up eight bytes.</span>
<span class="comments">;</span>
		IF MAXVAL[I] GT 0 THEN WIDTH[I] = 8
<span class="comments">;</span>
<span class="comments">;  Calculate the starting byte for each column.</span>
<span class="comments">;</span>
		IF I GE 1 THEN TBCOL[I] = TBCOL[I-1] + WIDTH[I-1]*NUMVAL[I-1]
	ENDFOR
<span class="comments">;</span>
        IF N_ELEMENTS(ERRMSG) NE 0 THEN ERRMSG = ''
	RETURN
	END
</code>
    </div>
  </body>
</html>