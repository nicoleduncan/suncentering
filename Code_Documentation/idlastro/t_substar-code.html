<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:58:05 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>t_substar.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="t_substar.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="t_substar:source"></a>pro t_substar,image,fitsfile,id,psfname, VERBOSE = verbose, NOPSF = nopsf
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;       T_SUBSTAR</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;       Driver procedure (for SUBSTAR) to subtract scaled PSF values </span>
<span class="comments">; EXPLANATION:</span>
<span class="comments">;       Computes residuals of the PSF fitting program</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;       T_SUBSTAR, image, fitsfile, id,[ psfname, /VERBOSE, /NOPSF ]</span>
<span class="comments">;</span>
<span class="comments">; INPUT-OUTPUT:</span>
<span class="comments">;       IMAGE -  On input, IMAGE is the original image array.  A scaled</span>
<span class="comments">;               PSF will be subtracted from IMAGE at specified star positions.</span>
<span class="comments">;               Make a copy of IMAGE before calling SUBSTAR, if you want to</span>
<span class="comments">;               keep a copy of the unsubtracted image array</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;       FITSFILE  - scalar string giving the name of the disk FITS ASCII </span>
<span class="comments">;               produced as an output from T_NSTAR.   </span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUTS:</span>
<span class="comments">;       ID -  Index vector indicating which stars are to be subtracted.  If</span>
<span class="comments">;               omitted, (or set equal to -1), then stars will be subtracted </span>
<span class="comments">;               at all positions specified by the X and Y vectors.</span>
<span class="comments">;               (IDL convention - zero-based subscripts)</span>
<span class="comments">;       PSFNAME - Name of the FITS file containing the PSF residuals, as</span>
<span class="comments">;               generated by GETPSF.  SUBSTAR will prompt for this parameter</span>
<span class="comments">;               if not supplied.      </span>
<span class="comments">; OPTIONAL INPUT KEYWORD:</span>
<span class="comments">;       /VERBOSE - If this keyword is set and non-zero, then the value of each</span>
<span class="comments">;               star number will be displayed as it is processed.</span>
<span class="comments">;       /NOPSF - if this keyword is set and non-zero, then all stars will be </span>
<span class="comments">;               be subtracted *except* those used to determine the PSF.</span>
<span class="comments">;               An improved PSF can then be derived from the subtracted image.</span>
<span class="comments">;               If NOPSF is supplied, then the ID parameter is ignored</span>
<span class="comments">; NOTES:</span>
<span class="comments">;       T_SUBSTAR does not modify the input FITS table.</span>
<span class="comments">;</span>
<span class="comments">; PROCEDURES USED:</span>
<span class="comments">;       FTGET(), FTINFO, READFITS(), REMOVE, SUBSTAR</span>
<span class="comments">; REVISION HISTORY:</span>
<span class="comments">;       Written, R. Hill, ST Sys. Corp., 22 August 1991</span>
<span class="comments">;       Added NOPSF keyword   W. Landsman        March, 1996</span>
<span class="comments">;       Use FITS format for PSF resduals         July, 1997</span>
<span class="comments">;       Converted to IDL V5.0   W. Landsman   September 1997</span>
<span class="comments">;       Call FTINFO first to improve efficiency   W. Landsman  May 2000</span>
<span class="comments">;-</span>
 On_Error,2

 if N_params() LT 2 then begin
    print,'Syntax -  T_SUBSTAR, im, fitsfile,[id, psfname, /VERBOSE, /NOPSF ]'
    print,'      im - Image Array'
    print,'      fitsfile - name of disk FITS ASCII table (from T_NSTAR)'
    print,"      id - vector of Star ID's to subtract (optional)"
    print,'      psfname - Name of FITS file containing the PSF'
    return
 endif 

 tab = readfits(fitsfile, htab,/exten)
 ftinfo, htab, ft_str
 x = ftget(ft_str,tab,'X_PSF') - 1.0
 y = ftget(ft_str,tab,'Y_PSF') - 1.0
 mag = ftget(ft_str,tab,'PSF_MAG')
 IF (N_elements(id) EQ 0) THEN id = -1
 if keyword_set(NOPSF) then begin 
        g = where(ft_str.ttype EQ 'PSF_CODE', Ng)
        if Ng EQ 0 then message,'ERROR -- FITS table missing PSF_CODE column'
        idpsf = ftget(ft_str,tab,'PSF_CODE')
        ipsf = where(idpsf)
        id = indgen(N_elements(x) )
        remove, ipsf, id
 endif
 if not keyword_set( VERBOSE )  then verbose = 0
 substar,image,x,y,mag,id,psfname, VERBOSE = verbose  <span class="comments">;Subtract scaled PSF stars</span>

 RETURN
 END
</code>
    </div>
  </body>
</html>