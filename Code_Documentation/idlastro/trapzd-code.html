<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:58:09 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>trapzd.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="trapzd.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="trapzd:source"></a>pro trapzd, func, a, b, s, step, _EXTRA = _EXTRA
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;       TRAPZD</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;       Compute the nth stage of refinement of an extended trapezoidal rule.</span>
<span class="comments">; EXPLANATION:</span>
<span class="comments">;       This procedure is called by QSIMP and QTRAP.   Algorithm from Numerical</span>
<span class="comments">;       Recipes, Section 4.2.   TRAPZD is meant to be called iteratively from</span>
<span class="comments">;       a higher level procedure.</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;       TRAPZD, func, A, B, S, step, [ _EXTRA = ]</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;       func - scalar string giving name of function to be integrated.   This</span>
<span class="comments">;               must be a function of one variable.</span>
<span class="comments">;       A,B -  scalars giving the limits of the integration</span>
<span class="comments">;</span>
<span class="comments">; INPUT-OUTPUT:</span>
<span class="comments">;       S -    scalar giving the total sum from the previous iterations on </span>
<span class="comments">;               input and the refined sum after the current iteration on output.</span>
<span class="comments">;</span>
<span class="comments">;       step - LONG scalar giving the number of points at which to compute the</span>
<span class="comments">;               function for the current iteration.   If step is not defined on</span>
<span class="comments">;               input, then S is intialized using the average of the endpoints</span>
<span class="comments">;               of limits of integration.</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUT KEYWORDS:</span>
<span class="comments">;       Any supplied keywords will be passed to the user function via the </span>
<span class="comments">;       _EXTRA facility. </span>
<span class="comments">;</span>
<span class="comments">; NOTES:</span>
<span class="comments">;       (1) TRAPZD will check for math errors (except for underflow) when </span>
<span class="comments">;       computing the function at the endpoints, but not on subsequent </span>
<span class="comments">;       iterations.</span>
<span class="comments">;</span>
<span class="comments">;       (2) TRAPZD always uses double precision to sum the function values</span>
<span class="comments">;       but the call to the user-supplied function is double precision only if </span>
<span class="comments">;       one of the limits A or B is double precision.</span>
<span class="comments">; REVISION HISTORY:</span>
<span class="comments">;       Written         W. Landsman                 August, 1991</span>
<span class="comments">;       Always use double precision for TOTAL       March, 1996</span>
<span class="comments">;       Pass keyword to function via _EXTRA facility  W. Landsman July 1999</span>
<span class="comments">;       Don't check for floating underflow  W.Landsman  April 2008</span>
<span class="comments">;-</span>
 On_error,2
 compile_opt idl2

 kpresent = keyword_set(_EXTRA)
 if N_elements(step) EQ 0 then begin          <span class="comments">;Initialize?</span>

<span class="comments">;If a math error occurs, it is likely to occur at the endpoints</span>
     junk = check_math()                    <span class="comments">;</span>
     if kpresent then s1 = CALL_FUNCTION(func,A, _EXTRA= _EXTRA) $
                 else s1 = CALL_FUNCTION(func,A)
     if check_math(mask=211) NE 0 then $
        message,'ERROR - Illegal lower bound of '+strtrim(A,2)+ $
                ' to function ' + strupcase(func)
     if kpresent then s2 = CALL_FUNCTION(func,B, _EXTRA = _EXTRA) $
                 else s2 = CALL_FUNCTION(func,B)
     if check_math(mask=211) NE 0 then $
        message,'ERROR - Illegal upper bound of '+strtrim(B,2) + $
                ' to function ' + strupcase(func)
     junk= check_math()		
     s = 0.5d * ( double(B)-A ) * ( s1+s2 )    <span class="comments">;First approx is average of endpoints</span>
     step = 1l

 endif else begin

     tnm = float( step )               
     del = ( B - A ) / tnm                    <span class="comments">;Spacing of the points to add</span>
     x = A + 0.5*del + findgen( step ) * del  <span class="comments">;Grid of points @ compute function</span>
     if kpresent then sum = CALL_FUNCTION( func, x, _EXTRA = _EXTRA) $
                 else sum = CALL_FUNCTION( func, x)
     S = 0.5d * ( S + (double(B)-A) * total( sum, /DOUBLE )/tnm )     
     step = 2*step

 endelse

 return
 end 
</code>
    </div>
  </body>
</html>