<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:58:01 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>robust_sigma.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="robust_sigma.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source">FUNCTION  ROBUST_SIGMA,Y, ZERO=REF, GOODVEC = Q
<span class="comments">;</span>
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;	ROBUST_SIGMA  </span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;	Calculate a resistant estimate of the dispersion of a distribution.</span>
<span class="comments">; EXPLANATION:</span>
<span class="comments">;	For an uncontaminated distribution, this is identical to the standard</span>
<span class="comments">;	deviation.</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;	result = ROBUST_SIGMA( Y, [ /ZERO, GOODVEC = ] )</span>
<span class="comments">;</span>
<span class="comments">; INPUT: </span>
<span class="comments">;	Y = Vector of quantity for which the dispersion is to be calculated</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUT KEYWORD:</span>
<span class="comments">;	/ZERO - if set, the dispersion is calculated w.r.t. 0.0 rather than the</span>
<span class="comments">;		central value of the vector. If Y is a vector of residuals, this</span>
<span class="comments">;		should be set.</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL OUPTUT KEYWORD:</span>
<span class="comments">;       GOODVEC = Vector of non-trimmed indices of the input vector</span>
<span class="comments">; OUTPUT:</span>
<span class="comments">;	ROBUST_SIGMA returns the dispersion. In case of failure, returns </span>
<span class="comments">;	value of -1.0</span>
<span class="comments">;</span>
<span class="comments">; PROCEDURE:</span>
<span class="comments">;	Use the median absolute deviation as the initial estimate, then weight </span>
<span class="comments">;	points using Tukey's Biweight. See, for example, "Understanding Robust</span>
<span class="comments">;	and Exploratory Data Analysis," by Hoaglin, Mosteller and Tukey, John</span>
<span class="comments">;	Wiley & Sons, 1983, or equation 9 in Beers et al. (1990, AJ, 100, 32)</span>
<span class="comments">;</span>
<span class="comments">; REVSION HISTORY: </span>
<span class="comments">;	H. Freudenreich, STX, 8/90</span>
<span class="comments">;       Replace MED() call with MEDIAN(/EVEN)  W. Landsman   December 2001</span>
<span class="comments">;       Don't count NaN values  W.Landsman  June 2010</span>
<span class="comments">;</span>
<span class="comments">;-</span>
 On_error,2
 compile_opt idl2
 
 EPS = 1.0E-20
 IF KEYWORD_SET(REF) THEN Y0=0. ELSE Y0  = MEDIAN(Y,/EVEN)

<span class="comments">; First, the median absolute deviation MAD about the median:</span>

 MAD = MEDIAN( ABS(Y-Y0), /EVEN )/0.6745

<span class="comments">; If the MAD=0, try the MEAN absolute deviation:</span>
 IF MAD LT EPS THEN MAD = MEAN( ABS(Y-Y0) )/.80
 IF MAD LT EPS THEN RETURN, 0.0

<span class="comments">; Now the biweighted value:</span>
 U   = (Y-Y0)/(6.*MAD)
 UU  = U*U
 Q   = WHERE(UU LE 1.0, COUNT)
 IF COUNT LT 3 THEN BEGIN
   PRINT,'ROBUST_SIGMA: This distribution is TOO WEIRD! Returning -1'
   SIGGMA = -1.
   RETURN,SIGGMA
 ENDIF

 N = TOTAL(FINITE(Y),/INT)      <span class="comments">;In case Y has NaN values          ;</span>
 NUMERATOR = TOTAL( (Y[Q]-Y0)^2 * (1-UU[Q])^4 )
 DEN1  = TOTAL( (1.-UU[Q])*(1.-5.*UU[Q]) )
 SIGGMA = N*NUMERATOR/(DEN1*(DEN1-1.))
 
 IF SIGGMA GT 0. THEN RETURN, SQRT(SIGGMA) ELSE RETURN, 0.

 END
</code>
    </div>
  </body>
</html>