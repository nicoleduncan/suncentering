<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:58:04 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>sxhread.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="sxhread.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="sxhread:source"></a>pro sxhread, name, header
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;       SXHREAD</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;       Procedure to read a STSDAS header from disk.</span>
<span class="comments">; EXPLANATION:</span>
<span class="comments">;       This version of SXHREAD can read two types of disk files</span>
<span class="comments">;       (1)  Unix stream files with a CR after every 80 bytes</span>
<span class="comments">;       (2)  Variable length record files </span>
<span class="comments">;       (3)  Fixed length (80 byte) record files</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;       sxhread, name, header</span>
<span class="comments">;</span>
<span class="comments">; INPUT:</span>
<span class="comments">;       name - file name, scalar string.  An extension of .hhh is appended</span>
<span class="comments">;               if not already supplied.   (Note STSDAS headers are required</span>
<span class="comments">;               to have a 3 letter extension ending in 'h'.)   gzip extensions</span>
<span class="comments">;               .gz will be recognized as compressed.</span>
<span class="comments">; OUTPUT:</span>
<span class="comments">;       header - STSDAS header, string array</span>
<span class="comments">; NOTES:</span>
<span class="comments">;       SXHREAD  does not do any checking to see if the file is a valid</span>
<span class="comments">;       STSDAS header.    It simply reads the file into a string array with</span>
<span class="comments">;       80 byte elements</span>
<span class="comments">;</span>
<span class="comments">; HISTORY:</span>
<span class="comments">;       Version 1  D. Lindler  July, 1987</span>
<span class="comments">;       Version 2  M. Greason, August 1990</span>
<span class="comments">;       Use READU for certain ST VAX GEIS files   W. Landsman January, 1992</span>
<span class="comments">;       Read variable length Unix files  E. Deutsch/W. Landsman November, 1994</span>
<span class="comments">;       Converted to IDL V5.0   W. Landsman   September 1997</span>
<span class="comments">;       Updated by E. Artigau to handle gzipped fits  August 2004</span>
<span class="comments">;       Remove VMS support, W. Lnadsman September 2006</span>
<span class="comments">;-</span>
<span class="comments">;--------------------------------------------------------------------</span>
 compile_opt idl2
 On_error,2                              <span class="comments">;Return to caller</span>

 if N_params() LT 2 then begin
     print,'Syntax - SXHREAD, name, header'
     return
 endif

<span class="comments">; Add extension name if needed</span>

 hname = strtrim(name,2)
 if strpos(hname,'.',strpos(hname,']') ) EQ -1 then hname = hname + '.hhh'
 compress =  (strmid(name,strlen(name)-2,2) eq 'gz') 
 openr, unit, hname, /GET_LUN, ERROR = err,COMPRESS = compress

 if err LT 0 then goto, BADFILE

 len = 80  & ai = 99                    <span class="comments">;Usual header length is 80 bytes</span>
    <span class="comments">;but Unix files may have an</span>
                                        <span class="comments">;embedded carriage returns to make</span>
   atmp = assoc(unit,bytarr(85))           <span class="comments">;header length 81 bytes</span>
   a=atmp[0] & ai=0
   while (a[ai] ne 10) and (a[ai] ne 13) and (ai lt 84) do ai=ai+1
   if (ai EQ 80) then len=81
   Point_lun, unit, 0            <span class="comments">;Back to the beginning of the file</span>



<span class="comments">; Get the number of lines in the header</span>

 status = fstat(unit)
 nlines = status.size/len                      <span class="comments">;Number of lines in file</span>
 if (ai lt 80) then goto,VAR_LENGTH

<span class="comments">; Read header</span>

 header =  bytarr(len,nlines ,/NOZERO)
 On_ioerror, VAR_LENGTH        <span class="comments">;READU cannot be used on variable length records</span>
 readu, unit, header
 header = string(header)
 On_ioerror,NULL

 free_lun,unit             <span class="comments">;Close and free file unit</span>

<span class="comments">; Trim to the END line, and delete carriage returns if necessary</span>

 endline = where( strmid(header,0,8) EQ 'END     ',nfound)
 if nfound gt 0 then header = header[0:endline[0]] else $
     message,'WARNING: No END statement found in header',/inform
 if len EQ 81 then header = strmid(header,0,80)
 return

VAR_LENGTH:                 <span class="comments">;Now try to read as variable length records</span>

 Point_lun, unit, 0          <span class="comments">;Back to the beginning of file</span>
 h = ''  & header = strarr( nlines)
 i = 0

 On_ioerror,NOEND            <span class="comments">;Can't use EOF function on certain GEIS files</span>
 while ( strtrim( strmid(h,0,8), 2) NE 'END') do begin
    readf, unit, h
    if (strlen(h) LT 80) then h=h+string(replicate(32b,80-strlen(h)))
    header[i] = h                  <span class="comments">;Swapped with line above 95-Aug</span>
    i = i + 1
    if i EQ nlines then begin
            header = [header,strarr(100)]
            nlines = nlines + 100
     endif
 endwhile
 header = header[0:i-1]
 free_lun,unit
 return

NOEND:
   message,'WARNING - No END statement found in header', /INFORM
   free_lun,unit
   return

BADFILE:
   message,'Error opening file ' + ' ' + hname
   return

end
</code>
    </div>
  </body>
</html>