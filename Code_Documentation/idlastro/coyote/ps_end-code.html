<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:58:31 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>ps_end.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="ps_end.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">; docformat = 'rst'</span>
<span class="comments">;</span>
<span class="comments">; NAME:</span>
<span class="comments">;   PS_END</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;    The purpose of PS_START and PS_END is to make it easy to set-up</span>
<span class="comments">;    and close a PostScript file. These programs are used extensively</span>
<span class="comments">;    in all Coyote Graphics routines.</span>
<span class="comments">;******************************************************************************************;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  Copyright (c) 2011, by Fanning Software Consulting, Inc. All rights reserved.           ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  Redistribution and use in source and binary forms, with or without                      ;</span>
<span class="comments">;  modification, are permitted provided that the following conditions are met:             ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;      * Redistributions of source code must retain the above copyright                    ;</span>
<span class="comments">;        notice, this list of conditions and the following disclaimer.                     ;</span>
<span class="comments">;      * Redistributions in binary form must reproduce the above copyright                 ;</span>
<span class="comments">;        notice, this list of conditions and the following disclaimer in the               ;</span>
<span class="comments">;        documentation and/or other materials provided with the distribution.              ;</span>
<span class="comments">;      * Neither the name of Fanning Software Consulting, Inc. nor the names of its        ;</span>
<span class="comments">;        contributors may be used to endorse or promote products derived from this         ;</span>
<span class="comments">;        software without specific prior written permission.                               ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  THIS SOFTWARE IS PROVIDED BY FANNING SOFTWARE CONSULTING, INC. ''AS IS'' AND ANY        ;</span>
<span class="comments">;  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES    ;</span>
<span class="comments">;  OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT     ;</span>
<span class="comments">;  SHALL FANNING SOFTWARE CONSULTING, INC. BE LIABLE FOR ANY DIRECT, INDIRECT,             ;</span>
<span class="comments">;  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED    ;</span>
<span class="comments">;  TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;         ;</span>
<span class="comments">;  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND             ;</span>
<span class="comments">;  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT              ;</span>
<span class="comments">;  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS           ;</span>
<span class="comments">;  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.                            ;</span>
<span class="comments">;******************************************************************************************;</span>
<span class="comments">;</span>
<span class="comments">;+</span>
<span class="comments">; The purpose of PS_START and PS_END is to make it easy to set-up</span>
<span class="comments">; and close a PostScript file. These programs are used extensively</span>
<span class="comments">; in all Coyote Graphics routines.</span>
<span class="comments">;</span>
<span class="comments">; If `ImageMagick  &lt;http://www.imagemagick.org/script/index.php>` is installed </span>
<span class="comments">; on your computer, you can easily convert PostScript output to GIF, JPEG, PNG, and TIFF</span>
<span class="comments">; raster output. If `Ghostscript &lt;http://www.ghostscript.com/download/>` is installed</span>
<span class="comments">; you can convert PostScript output to PDF files. See the appropriate keywords below.</span>
<span class="comments">; </span>
<span class="comments">; When PS_START is called, the current graphics device is set to "PS" (the PostScript </span>
<span class="comments">; device). When PS_END is called the current graphics device is returned to the device</span>
<span class="comments">; in effect when PS_START was called.</span>

<span class="comments">; :Categories:</span>
<span class="comments">;    Utilities, Graphics</span>
<span class="comments">;    </span>
<span class="comments">; :Keywords:</span>
<span class="comments">;     allow_transparent: in, optional, type=boolean, default=0</span>
<span class="comments">;         To make the background of some image files white, rather than transparent,</span>
<span class="comments">;         you have to set the "-alpha off" string in the ImageMagick call. This</span>
<span class="comments">;         string is automatically added to the ImageMagick call unless this keyword</span>
<span class="comments">;         is set, in which case the string is not added and the image background will</span>
<span class="comments">;         be transparent.  </span>
<span class="comments">;     bmp: in, optional, type=boolean, default=0                 </span>
<span class="comments">;        Set this keyword to convert the PostScript output file to a BMP image. Requires ImageMagick.</span>
<span class="comments">;     delete_ps: in, optional, type=boolean, default=0            </span>
<span class="comments">;        Setting this keyword will delete the PostScript file that is used as the intermediate</span>
<span class="comments">;        file in the conversion to other file types.</span>
<span class="comments">;     density: in, optional, type=integer, default=300</span>
<span class="comments">;        The horizontal and vertical density (in dots per inch, DPI) of the image when the PostScript file</span>
<span class="comments">;        is converted to a raster format by ImageMagick. </span>
<span class="comments">;     filetype: in, optional, type='string', default=""</span>
<span class="comments">;        This keyword provides a generic way of setting the `BMP`, `GIF`, `JPEG`, `PNG`, and `TIFF` </span>
<span class="comments">;        keywords. Set this keyword to the type of file output desired, and the correct "output"</span>
<span class="comments">;        keyword will be set.</span>
<span class="comments">;     gif: in, optional, type=boolean, default=0                 </span>
<span class="comments">;        Set this keyword to convert the PostScript output file to a GIF image. Requires ImageMagick.</span>
<span class="comments">;     gs_path: in, optional, type=string</span>
<span class="comments">;        This program assumes that UNIX users can access Ghostscript with the "gs"</span>
<span class="comments">;        command. It assumes WINDOWS users have installed Ghostscript in either</span>
<span class="comments">;        the C:\gs or C:\Program Files\gs directories. If either of these assumptions</span>
<span class="comments">;        is incorrect, you can specify the directory where the Ghostscript executable</span>
<span class="comments">;        resides with this keyword. (The Windows 32-bit executable is named gswin32c.exe</span>
<span class="comments">;        and the 64-bit executable is named gswin64c.exe.) Passed directly to cgPS2PDF.</span>
<span class="comments">;     im_options: in, optional, type=string, default=""</span>
<span class="comments">;        A string of ImageMagick "convert" options that can be passed to the ImageMagick convert </span>
<span class="comments">;        command. No error checking occurs with this string.</span>
<span class="comments">;     jpeg: in, optional, type=boolean, default=0                 </span>
<span class="comments">;        Set this keyword to convert the PostScript output file to a JPEG image. Requires ImageMagick.</span>
<span class="comments">;     nofix: in, optional, type=boolean, default=0  </span>
<span class="comments">;        If this keyword is set, then the cgFixPS program to fix IDL landscape</span>
<span class="comments">;        PostScript files is not called.</span>
<span class="comments">;     nomessage: in, optional, type=boolean, default=0                  </span>
<span class="comments">;        If this keyword is set, then no error messages are issued. The keyword is used primarily </span>
<span class="comments">;        to allow PS_END to reset the internal structure without a lot of ruckus.  </span>
<span class="comments">;     outfilename: out, optional, type=string</span>
<span class="comments">;        The name of the output filename created by the program.             </span>
<span class="comments">;     pdf: in, optional, type=boolean, default=0                 </span>
<span class="comments">;        Set this keyword to convert the PostScript output file to a PDF file. Requires Ghostscript.</span>
<span class="comments">;     png: in, optional, type=boolean, default=0                 </span>
<span class="comments">;        Set this keyword to convert the PostScript output file to a PNG image. Requires ImageMagick.</span>
<span class="comments">;        Normally, 24-bit PNG files are created. However, if the IM_PNG8 keyword is set with</span>
<span class="comments">;        cgWindow_SetDefs, then PS_End will create an 8-bit PNG file instead.</span>
<span class="comments">;     resize: in, optional, type=integer, default=25</span>
<span class="comments">;        If an image is being created from the PostScript file, it is often resized by some </span>
<span class="comments">;        amount. You can use this keyword to change the value (e.g, RESIZE=100).</span>
<span class="comments">;        The value is passed on to resize argument as a percentage in the ImageMagick call.</span>
<span class="comments">;     showcmd: in, optional, type=boolean, default=0</span>
<span class="comments">;        Set this command to show the command used to do any PostScript coversions.</span>
<span class="comments">;     tiff: in, optional, type=boolean, default=0                 </span>
<span class="comments">;        Set this keyword to convert the PostScript output file to a TIFF image. Requires ImageMagick.</span>
<span class="comments">;     unix_convert_cmd: in, optional, type=string</span>
<span class="comments">;         There are a number of commands on UNIX machines for converting PostScript files</span>
<span class="comments">;         to PDF files. This program assumes you are using Ghostscript to do the conversion</span>
<span class="comments">;         for you. The Ghostscript command on most UNIX machines is "gs", which is used if</span>
<span class="comments">;         this keyword is undefined. However, if you would prefer to use another program to do</span>
<span class="comments">;         the conversion for you, you can specify the name of the command here. For example,</span>
<span class="comments">;         "pstopdf" or "epstopdf". In creating the actual command, this command will be</span>
<span class="comments">;         separated by a space from the input file name. In other words, if the alternative</span>
<span class="comments">;         conversion command was "pstopdf", the actual command would be "pstopdf" + " " + ps_file.</span>
<span class="comments">;         Any output filename is ignored. This command does not apply to Macintosh or Windows </span>
<span class="comments">;         computers. Passed directly to cgPS2PDF.</span>
<span class="comments">;     width: in, optional, type=integer</span>
<span class="comments">;         Set the keyword to the final pixel width of the output raster image. Applies</span>
<span class="comments">;         only to raster image file output (e.g., JPEG, PNG, TIFF, etc.). The height of</span>
<span class="comments">;         the image is chosen to preserve the image aspect ratio.</span>
<span class="comments">;          </span>
<span class="comments">; :Examples:</span>
<span class="comments">;    To create a line plot in a PostScript file named lineplot.ps and</span>
<span class="comments">;    also create a PNG file named lineplot.png for display in a browser,</span>
<span class="comments">;    type these commands::</span>
<span class="comments">;</span>
<span class="comments">;        PS_Start, FILENAME='lineplot.ps'</span>
<span class="comments">;        cgPlot, Findgen(11), COLOR='navy', /NODATA, XTITLE='Time', YTITLE='Signal'</span>
<span class="comments">;        cgPlot, Findgen(11), COLOR='indian red', /OVERPLOT</span>
<span class="comments">;        cgPlot, Findgen(11), COLOR='olive', PSYM=2, /OVERPLOT</span>
<span class="comments">;        PS_End, /PNG</span>
<span class="comments">;       </span>
<span class="comments">; :Author:</span>
<span class="comments">;       FANNING SOFTWARE CONSULTING::</span>
<span class="comments">;           David W. Fanning </span>
<span class="comments">;           1645 Sheely Drive</span>
<span class="comments">;           Fort Collins, CO 80526 USA</span>
<span class="comments">;           Phone: 970-221-0438</span>
<span class="comments">;           E-mail: david@idlcoyote.com</span>
<span class="comments">;           Coyote's Guide to IDL Programming: http://www.idlcoyote.com</span>
<span class="comments">;</span>
<span class="comments">; :History:</span>
<span class="comments">;     Change History::</span>
<span class="comments">;       Written by: David W. Fanning, 20 May 2008.</span>
<span class="comments">;       Slight modification to allow filenames with spaces in them.</span>
<span class="comments">;       Added NoMatch keyword. 17 March 2009. DWF.</span>
<span class="comments">;       Added a number of keywords to make these commands more configurable. 19 March 2009. DWF.</span>
<span class="comments">;       Only set thickness system variables if starting system variables are set to their</span>
<span class="comments">;           default values (namely, 0). This allows users to set their own system variables</span>
<span class="comments">;           before they call PS_START, rather than after. 23 March  2009. DWF.</span>
<span class="comments">;       Moved PS_END to its own file to allow the IDLExBr_Assistant to work properly. 7 April 2009. DWF.</span>
<span class="comments">;       Reordered ImageMagick commands to put them in the proper sequence to get "alpha" switch to work. 23 April 2009. DWF.</span>
<span class="comments">;       Put the switches *ahead* of the PostScript file name. Now resizing works and default size reduction</span>
<span class="comments">;           returned to 25%. 23 April 2009. DWF.</span>
<span class="comments">;       Still having a devil of a time getting the ImageMagick "convert" command right. Fonts</span>
<span class="comments">;           have become a problem. Now trying a "flatten" option in the command. 12 May 2009. DWF.</span>
<span class="comments">;       If the PostScript file is in Landscape mode, it is now "fixed" with cgFixPS to allow it</span>
<span class="comments">;           to be displayed right-side up in PostScript viewers. 8 August 2009. DWF.</span>
<span class="comments">;       Fixed a problem in not checking the GIF keyword properly. 4 December 2009. DWF.</span>
<span class="comments">;       Added NOFIX keyword to the program. 1 November 2010. DWF.</span>
<span class="comments">;       Added better handing of errors coming from cgFixPS after update to FIXPS. 15 November 2010. DWF.</span>
<span class="comments">;       Added DELETE_PS keyword. 16 Jan 2011. DWF.</span>
<span class="comments">;       Better protection of code from not finding ImageMagick. 17 Jan 2011. DWF.</span>
<span class="comments">;       Collecting result of SPAWN command. Only printing if QUIET=0. 16 Feb 2011. DWF.</span>
<span class="comments">;       Changes to handle inability to create raster files from PS encapsulated files in </span>
<span class="comments">;           landscape mode. Added NOMESSAGE keyword. 26 Aug 2011. DWF.</span>
<span class="comments">;        Added PDF keyword. Requires Ghostscript to use. 6 Dec 2011. DWF.</span>
<span class="comments">;        Added SHOWCMD keyword. 9 Dec 2011. DWF.</span>
<span class="comments">;        Added OUTFILENAME keyword. 11 Dec 2011. DWF.</span>
<span class="comments">;        Just realized a BMP case is missing from one of the CASE statements. 12 Dec 2011. DWF.</span>
<span class="comments">;        Added GS_PATH and UNIX_CONVERT_CMD keywords to support PDF output. 14 Dec 2011. DWF.</span>
<span class="comments">;        Add the WIDTH keyword. 3 April 2012. DWF.</span>
<span class="comments">;        Added a check for IM_PNG8 keyword, using cgWindow_GetDefs to see if an 8-bit or 24-bit</span>
<span class="comments">;           PNG file should be created. 3 April 2012. DWF.</span>
<span class="comments">;        Modified the ImageMagick commands that resizes the image to a particular width. Necessary</span>
<span class="comments">;           to accommodate PNG8 file output. Using ImageMagick 6.7.2-9. 4 April 2012. DWF.</span>
<span class="comments">;        Added FILETYPE keyword to provide a generic way of creating raster file output. 30 August 2012. DWF.</span>
<span class="comments">;        Modified to use the cgPS2Raster program so code doesn't have to be maintained in </span>
<span class="comments">;            two places. 15 Oct 2012. DWF.</span>
<span class="comments">;</span>
<span class="comments">; :Copyright:</span>
<span class="comments">;     Copyright (c) 2008-2012, Fanning Software Consulting, Inc.</span>
<span class="comments">;-</span>
PRO PS_END, $
    ALLOW_TRANSPARENT=allow_transparent, $
    BMP=bmp, $
    DELETE_PS=delete_ps, $
    DENSITY=density, $
    IM_OPTIONS=im_options, $
    FILETYPE=filetype, $
    GIF=gif, $
    GS_PATH=gs_path, $
    JPEG=jpeg, $
    NOFIX=nofix, $
    NOMESSAGE=nomessage, $
    OUTFILENAME=outfilename, $
    PDF=pdf, $
    PNG=png, $
    RESIZE=resize, $
    SHOWCMD=showcmd, $
    TIFF=tiff, $
    UNIX_CONVERT_CMD=unix_convert_cmd, $
    WIDTH=width
            

   COMMON _$FSC_PS_START_, ps_struct
   
   Catch, theError
   IF theError NE 0 THEN BEGIN
   
       Catch, /CANCEL
   
       <span class="comments">; Issue an error message, unless messages are turned off.</span>
       IF ~Keyword_Set(nomessage) THEN void = Error_Message()
   
       <span class="comments">; Clean up.</span>
       IF ps_struct.currentDevice NE "" THEN Set_Plot, ps_struct.currentDevice
       !P = ps_struct.p
       !X = ps_struct.x
       !Y = ps_struct.y
       !Z = ps_struct.z
       ps_struct.setup = 0
       ps_struct.currentDevice = ""
       ps_struct.filename = ""
       ps_struct.convert = ""
       
       RETURN
       
   ENDIF
   
   <span class="comments">; Close the PostScript file, if this is PostScript device.</span>
   IF !D.Name EQ 'PS' THEN Device, /CLOSE_FILE
   xsize = !D.X_Size
   ysize = !D.Y_Size
   ps_filename = ps_struct.filename
   showcmd = Keyword_Set(showcmd)
   
   <span class="comments">; If the file is in landscape mode, then fix it so that the plot</span>
   <span class="comments">; is right-side up.</span>
   IF ps_struct.landscape THEN BEGIN
        IF ~Keyword_Set(nofix) THEN BEGIN
            cgFixPS, ps_struct.filename, PAGETYPE=ps_struct.pagetype, SUCCESS=success, QUIET=1
            IF success EQ 0 THEN Print, 'Encountered problem fixing landscape PostScript file. Proceeding...'
        ENDIF
   ENDIF
   
   <span class="comments">; Need to convert the PostScript to a raster file?</span>
   needRaster = 0
   allow_transparent = Keyword_Set(allow_transparent)
   IF N_Elements(filetype) EQ 0 THEN filetype = ""
   CASE StrUpCase(filetype) OF
       'BMP': bmp = 1
       'GIF': gif = 1
       'PDF': pdf = 1
       'PNG': png = 1
       'JPEG': jpeg = 1
       'JPG': jpeg = 1
       'TIFF': tiff = 1
       'TIF': tiff = 1
       "": 
       ELSE: BEGIN
           void = Dialog_Message('File type ' + StrUpCase(filetype) + ' invalid. No raster created.')
           needRaster = 0
           END
   ENDCASE
   IF Keyword_Set(bmp) THEN needRaster = 1
   IF Keyword_Set(gif) THEN needRaster = 1
   IF Keyword_Set(pdf) THEN needRaster = 1
   IF Keyword_Set(png) THEN needRaster = 1
   IF Keyword_Set(jpeg) THEN needRaster = 1
   IF Keyword_Set(tiff) THEN needRaster = 1
   SetDefaultValue, density, 300
   SetDefaultValue, resize, 25
   IF needRaster THEN BEGIN
       cgPS2Raster, ps_filename, raster_filename, $
          ALLOW_TRANSPARENT=allow_transparent, $
          BMP=bmp, $
          DELETE_PS=delete_ps, $
          DENSITY=density, $
          IM_OPTIONS=im_options, $
          FILETYPE=filetype, $
          GIF=gif, $
          JPEG=jpeg, $
          OUTFILENAME=outfilename, $
          PDF=pdf, $
          PNG=png, $
          PORTRAIT=portrait, $
          RESIZE=resize, $
          SHOWCMD=showcmd, $
          SILENT=silent, $
          SUCCESS=success, $
          TIFF=tiff, $
          WIDTH=width
   ENDIF
   
   <span class="comments">; Clean up.</span>
   IF ps_struct.currentDevice NE "" THEN Set_Plot, ps_struct.currentDevice
   !P = ps_struct.p
   !X = ps_struct.x
   !Y = ps_struct.y
   !Z = ps_struct.z
   ps_struct.setup = 0
   ps_struct.currentDevice = ""
   ps_struct.filename = ""
   ps_struct.convert = ""

END <span class="comments">;---------------------------------------------------------------</span>



</code>
    </div>
  </body>
</html>