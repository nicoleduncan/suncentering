<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:58:19 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>cgtext.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="cgtext.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">; docformat = 'rst'</span>
<span class="comments">;</span>
<span class="comments">; NAME:</span>
<span class="comments">;   cgText</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;   Provides a device-independent and color-model-independent way to write text into</span>
<span class="comments">;   a graphics window. It is a wrapper to the XYOUTS command.</span>
<span class="comments">;</span>
<span class="comments">;******************************************************************************************;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  Copyright (c) 2010, by Fanning Software Consulting, Inc. All rights reserved.           ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  Redistribution and use in source and binary forms, with or without                      ;</span>
<span class="comments">;  modification, are permitted provided that the following conditions are met:             ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;      * Redistributions of source code must retain the above copyright                    ;</span>
<span class="comments">;        notice, this list of conditions and the following disclaimer.                     ;</span>
<span class="comments">;      * Redistributions in binary form must reproduce the above copyright                 ;</span>
<span class="comments">;        notice, this list of conditions and the following disclaimer in the               ;</span>
<span class="comments">;        documentation and/or other materials provided with the distribution.              ;</span>
<span class="comments">;      * Neither the name of Fanning Software Consulting, Inc. nor the names of its        ;</span>
<span class="comments">;        contributors may be used to endorse or promote products derived from this         ;</span>
<span class="comments">;        software without specific prior written permission.                               ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  THIS SOFTWARE IS PROVIDED BY FANNING SOFTWARE CONSULTING, INC. ''AS IS'' AND ANY        ;</span>
<span class="comments">;  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES    ;</span>
<span class="comments">;  OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT     ;</span>
<span class="comments">;  SHALL FANNING SOFTWARE CONSULTING, INC. BE LIABLE FOR ANY DIRECT, INDIRECT,             ;</span>
<span class="comments">;  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED    ;</span>
<span class="comments">;  TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;         ;</span>
<span class="comments">;  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND             ;</span>
<span class="comments">;  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT              ;</span>
<span class="comments">;  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS           ;</span>
<span class="comments">;  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.                            ;</span>
<span class="comments">;******************************************************************************************;</span>
<span class="comments">;</span>
<span class="comments">;+</span>
<span class="comments">;   Provides a device-independent and color-model-independent way to write text into</span>
<span class="comments">;   a graphics window. It is a wrapper to the XYOUTS command.</span>
<span class="comments">;</span>
<span class="comments">; :Categories:</span>
<span class="comments">;    Graphics</span>
<span class="comments">;    </span>
<span class="comments">; :Params:</span>
<span class="comments">;    xloc: in, required, type=depends</span>
<span class="comments">;       The X location of the text. </span>
<span class="comments">;    yloc: in, required, type=depends</span>
<span class="comments">;       The Y location of the text. </span>
<span class="comments">;    text: in, optional, type=string</span>
<span class="comments">;        The text to output. By default, the calling sequence of the program.</span>
<span class="comments">;       </span>
<span class="comments">; :Keywords:</span>
<span class="comments">;     addcmd: in, optional, type=boolean, default=0</span>
<span class="comments">;        Set this keyword to add the command to an cgWindow. Setting this keyword</span>
<span class="comments">;        automatically sets the WINDOW keyword, but the command does not erase the</span>
<span class="comments">;        graphics window as it would normally.</span>
<span class="comments">;     alignment: in, optional, type=integer, default=0</span>
<span class="comments">;         Set this keyword to indicate the alignment of the text with respect to the</span>
<span class="comments">;         x and y location. 0 is left aligned, 0.5 is centered, and 1.0 is right aligned.</span>
<span class="comments">;         The alignment is set to 0.5 if PLACE is set and ALIGNMENT is unspecified. </span>
<span class="comments">;         Otherwise, the default is 0.</span>
<span class="comments">;     charsize: in, optional, type=float, default=cgDefCharSize()</span>
<span class="comments">;         The character size for axes annotations. Uses cgDefCharSize to select default</span>
<span class="comments">;         character size, unless !P.Charsize is set, in which case !P.Charsize is always used.</span>
<span class="comments">;     color: in, optional, type=string/integer/long, default="opposite"</span>
<span class="comments">;         The color of the text. Color names are those used with cgColor. </span>
<span class="comments">;     data: in, optional, type=boolean</span>
<span class="comments">;         Set this keyword to indicate xloc and yloc are in data coordinates. Data coordinates</span>
<span class="comments">;         are the default, unless DEVICE or NORMAL is set.</span>
<span class="comments">;     device: in, optional, type=boolean</span>
<span class="comments">;         Set this keyword to indicate xloc and yloc are in device coordinates.</span>
<span class="comments">;     font: in, optional, type=integer, default=!P.Font</span>
<span class="comments">;         The type of font desired. By default, !P.Font.</span>
<span class="comments">;     map_object: in, optional, type=object</span>
<span class="comments">;        If you are drawing on a map projection set up with Map_Proj_Init</span>
<span class="comments">;        and using projected meter space, rather than lat/lon space, then you can use this</span>
<span class="comments">;        keyword to provide a cgMap object that will allow you to convert the `x` and `y`</span>
<span class="comments">;        parameters from longitude and latitude, respectively, to projected meter space</span>
<span class="comments">;        before drawing.</span>
<span class="comments">;     normal: in, optional, type=boolean</span>
<span class="comments">;         Set this keyword to indicate xloc and yloc are in normalized coordinates.</span>
<span class="comments">;     orientation: in, optional, type=float, default=0.0</span>
<span class="comments">;         Use this keyword to specify the counterclockwise angle of rotation of the text</span>
<span class="comments">;         in degrees from the horizontal.</span>
<span class="comments">;     outloc: out, optional, type=various</span>
<span class="comments">;         Only used if PLACE is set, this is a two-element array containing the xloc and yloc</span>
<span class="comments">;         of the cursor position in the window.</span>
<span class="comments">;     place: in, optional, type=boolean</span>
<span class="comments">;          Set this keyword if you wish to click the cursor in the graphics window to place</span>
<span class="comments">;          the text. If this keyword is set, you do not need to specify the `xloc` and `yloc`</span>
<span class="comments">;          positional parameters. The first positional parameter is assumed to be the text.</span>
<span class="comments">;          The clicked location will be returned in the `OutLoc` variable. If the `Alignment`</span>
<span class="comments">;          keyword is not set, it will be set to 0.5 to set "center" as the default placement</span>
<span class="comments">;          alignment. This has been modified to allow this keyword to work in a resizeable</span>
<span class="comments">;          graphics window as well. Clicking once in the window will set the parameters so </span>
<span class="comments">;          you don't have to click every time the window is resized.</span>
<span class="comments">;     tt_font: in, optional, type=string</span>
<span class="comments">;         The true-type font to use for the text. Only used if FONT=1.</span>
<span class="comments">;     width: out, optional, type=float</span>
<span class="comments">;         Set this keyword to a named variable in which to return the width of the text string, </span>
<span class="comments">;         in normalized coordinate units. Note that output keyword values cannot be returned</span>
<span class="comments">;         from the routine if the command is being executed in a cgWindow.</span>
<span class="comments">;     window: in, optional, type=boolean</span>
<span class="comments">;         Set this keyword to add the command to the in the current cgWindow application.</span>
<span class="comments">;     _ref_extra: in, optional</span>
<span class="comments">;          Any keywords appropriate for the XYOUTS command.</span>
<span class="comments">;     </span>
<span class="comments">;          </span>
<span class="comments">; :Examples:</span>
<span class="comments">;    Used like the IDL XYOUTS command::</span>
<span class="comments">;       IDL> cgText, 0.5, 0.5, 'This is sample text', ALIGNMENT=0.5, /NORMAL</span>
<span class="comments">;       IDL> cgText, /PLACE, 'Use the cursor to locate this text', COLOR='dodger blue'</span>
<span class="comments">;       </span>
<span class="comments">; :Author:</span>
<span class="comments">;       FANNING SOFTWARE CONSULTING::</span>
<span class="comments">;           David W. Fanning </span>
<span class="comments">;           1645 Sheely Drive</span>
<span class="comments">;           Fort Collins, CO 80526 USA</span>
<span class="comments">;           Phone: 970-221-0438</span>
<span class="comments">;           E-mail: david@idlcoyote.com</span>
<span class="comments">;           Coyote's Guide to IDL Programming: http://www.idlcoyote.com</span>
<span class="comments">;</span>
<span class="comments">; :History:</span>
<span class="comments">;     Change History::</span>
<span class="comments">;        Written, 19 November 2010. DWF.</span>
<span class="comments">;        Corrected a problem with setting text color and added PLACE and OUTLOC </span>
<span class="comments">;            keywords. 25 Nov 2010. DWF.</span>
<span class="comments">;        Humm, that text color problem got reset to the old way! Sheesh! Fixed. 9 Dec 2010. DWF.</span>
<span class="comments">;        Modified the way the default color is selected. Drawing with DECOMPOSED </span>
<span class="comments">;             if possible. 30 Dec 2010. DWF.</span>
<span class="comments">;        Keywords collected with _REF_EXTRA so WIDTH can be returned. Added WIDTH keyword. 6 Jan 2011. DWF.</span>
<span class="comments">;        Moved setting to decomposed color before color selection process to avoid PostScript</span>
<span class="comments">;             background problems when passed 24-bit color integers. 12 Jan 2011. DWF.   </span>
<span class="comments">;        Added Window keyword. 24 Jan 2011. DWF.</span>
<span class="comments">;        Added ability to return WIDTH from resizeable graphics windows and added ADDCMD </span>
<span class="comments">;              keyword. 24 Feb 2011. DWF.</span>
<span class="comments">;        Modified error handler to restore the entry decomposition state if there is an error. 17 March 2011. DWF</span>
<span class="comments">;        Modified to allow the user to place the text in a resizeable graphics window. 13 Dec 2011. DWF.</span>
<span class="comments">;        Modified to use cgDefaultColor for default color selection. 24 Dec 2011. DWF.</span>
<span class="comments">;        Modifications to the way I obtain the WIDTH when adding the command to a cgWindow. 26 Jan 2012. DWF.</span>
<span class="comments">;        Added MAP_OBJECT keyword so that I can draw text on plots using a cgMap map coordinate object. 29 June 2012. DWF.</span>
<span class="comments">;        Added the ability to use escape characters in plot titles to specify cgSymbol symbols. 27 July 2012. DWF.</span>
<span class="comments">;        Added ORIENTATION keyword to make it explicit, and improved documentation. 3 Aug 2012. DWF.</span>
<span class="comments">;        </span>
<span class="comments">; :Copyright:</span>
<span class="comments">;     Copyright (c) 2010-2012, Fanning Software Consulting, Inc.</span>
<span class="comments">;-</span>
PRO cgText, xloc, yloc, text, $
    ADDCMD=addcmd, $
    ALIGNMENT=alignment, $
    CHARSIZE=charsize, $
    COLOR=scolor, $
    DATA=data, $
    DEVICE=device, $
    FONT=font, $
    MAP_OBJECT=map_object, $
    NORMAL=normal, $
    ORIENTATION=orientation, $
    OUTLOC=outloc, $
    PLACE=place, $
    TT_FONT=tt_font, $
    WIDTH=width, $
    WINDOW=window, $
    _REF_EXTRA=extra
    
    Compile_Opt idl2
    
    <span class="comments">; Catch the error.</span>
    Catch, theError
    IF theError NE 0 THEN BEGIN
        Catch, /CANCEL
        void = Error_Message()
        IF N_Elements(currentState) NE 0 THEN SetDecomposedState, currentState
        RETURN
    ENDIF
    
    <span class="comments">; Did the user pass parameters?</span>
    IF N_Params() EQ 0 THEN BEGIN
        Print, 'USE SYNTAX: cgText, xlocation, ylocation, text'
        RETURN
    ENDIF
    
    <span class="comments">; Did the user want to place the text in a cgWindow?</span>
    IF Keyword_Set(place) && ((Keyword_Set(window) || Keyword_Set(addcmd)) $
         AND ((!D.Flags AND 256) NE 0)) THEN BEGIN
    
        <span class="comments">; Make sure there is a graphics window.</span>
        wid = cgQuery(/CURRENT, COUNT=count)
        IF count EQ 0 THEN Message, 'There is no cgWindow to place text in.'
        WSet, wid
            
        <span class="comments">; There must be a window open.</span>
        IF !D.Window LT 0 THEN $
            Message, 'There is no current graphics window open.'
            
        <span class="comments">; Print some instructions.</span>
        Print, ""
        Print, 'Click in current graphics window (window index ' + $
            StrTrim(!D.Window,2) + ') to place text.'
    
        <span class="comments">; The text string is the only positional parameter.</span>
        text = xloc
        Cursor, x, y, /DOWN, DEVICE=device, NORMAL=normal, DATA=data
        outloc = [x, y]
        xloc = x
        yloc = y
        nparams = 3
        IF N_Elements(alignment) EQ 0 THEN alignment = 0.5
    
     ENDIF     
     
    <span class="comments">; Should this be added to a resizeable graphics window?</span>
    IF (Keyword_Set(window) || Keyword_Set(addcmd)) AND ((!D.Flags AND 256) NE 0) THEN BEGIN
    
        void = cgQuery(COUNT=wincnt)
        IF (wincnt EQ 0) && Keyword_Set(window) THEN cgWindow
        cgWindow, 'cgText', xloc, yloc, text, $
            ALIGNMENT=alignment, $
            CHARSIZE=charsize, $
            COLOR=scolor, $
            DATA=data, $
            DEVICE=device, $
            FONT=font, $
            MAP_OBJECT=map_object, $
            NORMAL=normal, $
            ORIENTATION=orientation, $
            OUTLOC=outloc, $
            TT_FONT=tt_font, $
<span class="comments">;            WIDTH=width, $</span>
            ADDCMD=1, $
            _EXTRA=extra
            
         <span class="comments">; You might want to get the width of the window back. Doing this in</span>
         <span class="comments">; a pixmap puts a small circle in the center of any open IDL graphics</span>
         <span class="comments">; window. I don't know why! But, for the moment, I am just going to</span>
         <span class="comments">; try making the current graphics window the cgWindow. This seems to</span>
         <span class="comments">; work without bad effects</span>
         IF Arg_Present(width) THEN BEGIN
            wid = cgQuery(DIMENSIONS=dims, /CURRENT, OBJECTREF=thisObject)
            WSet, wid
            thisObject -> GetProperty, Background=bcolor
<span class="comments">;            Window, /PIXMAP, XSIZE=dims[0], YSIZE=dims[1], /FREE</span>
            IF N_Elements(font) EQ 0 THEN font = !P.FONT
            IF N_Elements(charsize) EQ 0 THEN charsize = cgDefCharSize(FONT=font)
            XYOUTS, xloc, yloc, text, /NORMAL, WIDTH=width, CHARSIZE=charsize, COLOR=cgColor(bcolor)
<span class="comments">;            WDelete, !D.Window</span>
         ENDIF
            
         RETURN
    ENDIF
    
    <span class="comments">; Set up PostScript device for working with colors.</span>
    IF !D.Name EQ 'PS' THEN Device, COLOR=1, BITS_PER_PIXEL=8
    
    IF Keyword_Set(place) THEN BEGIN
    
        <span class="comments">; Make sure this device is appropriate for a CURSOR command.</span>
        IF ((!D.Flags AND 256) EQ 0) THEN $
            Message, 'Cannot use the PLACE keyword with the current graphics device.'
            
        <span class="comments">; There must be a window open.</span>
        IF !D.Window LT 0 THEN $
            Message, 'There is no current graphics window open.'
            
        <span class="comments">; Print some instructions.</span>
        Print, ""
        Print, 'Click in current graphics window (window index ' + $
            StrTrim(!D.Window,2) + ') to place text.'
    
        <span class="comments">; The text string is the only positional parameter.</span>
        textStr = xloc
        Cursor, x, y, /DOWN, DEVICE=device, NORMAL=normal, DATA=data
        outloc = [x, y]
        IF N_Elements(alignment) EQ 0 THEN alignment = 0.5
    
    ENDIF ELSE BEGIN
    
        <span class="comments">; All three positional parameters are required.</span>
        IF N_Elements(nparams) EQ 0 THEN nparams = N_Params()
        IF nparams NE 3 THEN Message, 'cgText must be called with three positional parameters.'
  
        <span class="comments">; If the text is specified as the first parameter, move things around.</span>
        IF Size(xloc, /TNAME) EQ 'STRING' THEN BEGIN
            temp = xloc
            x = yloc
            y = text
            textStr = temp
        ENDIF ELSE BEGIN
            x = xloc
            y = yloc
            textStr = text
        ENDELSE
        
    ENDELSE
    
    
    <span class="comments">; Check keywords.</span>
    IF N_Elements(font) EQ 0 THEN font = !P.FONT
    IF N_Elements(charsize) EQ 0 THEN charsize = cgDefCharSize(FONT=font)
    IF N_Elements(tt_font) NE 0 THEN BEGIN
        IF font EQ 1 THEN BEGIN
            Device, Set_Font=tt_font, /TT_FONT
        ENDIF
    ENDIF

    <span class="comments">; Write the text. Do this in Decomposed color, if possible.</span>
    SetDecomposedState, 1, CURRENTSTATE=currentState

    <span class="comments">; Get the input color table.</span>
    TVLCT, rr, gg, bb, /Get

    <span class="comments">; If needed create a window first, so the drawing</span>
    <span class="comments">; colors are correct for the window you want to draw into.</span>
    IF ((!D.Flags AND 256) NE 0) && (!D.Window LT 0) THEN cgDisplay

    <span class="comments">; Choose a color.</span>
    color = cgDefaultColor(scolor, MODE=currentState, DEFAULT='OPPOSITE')
    IF Size(color, /TNAME) EQ 'STRING' THEN thisColor = cgColor(color) ELSE thisColor = color
    
    <span class="comments">; Do you have a map obect? If so, you need both an X and a Y vector.</span>
    <span class="comments">; Convert from lon/lat to projected XY.</span>
    IF Obj_Valid(map_object) THEN BEGIN
          xy = map_object -> Forward(x, y)
          xmap = Reform(xy[0,*])
          ymap = Reform(xy[1,*])
    ENDIF 
    
     
    <span class="comments">; Draw the text.</span>
    textStr = cgCheckForSymbols(textStr)
    IF Obj_Valid(map_object) THEN BEGIN
        map_object -> Draw, /NoGraphics
        XYOutS, xmap, ymap, textStr, CHARSIZE=charsize, COLOR=thisColor, FONT=font, ALIGNMENT=alignment, $
            WIDTH=width, ORIENTATION=orientation, _STRICT_EXTRA=extra
    ENDIF ELSE BEGIN
        XYOutS, x, y, textStr, CHARSIZE=charsize, COLOR=thisColor, FONT=font, ALIGNMENT=alignment, $
            DATA=data, DEVICE=device, NORMAL=normal, WIDTH=width, ORIENTATION=orientation, _STRICT_EXTRA=extra
    ENDELSE
    
   SetDecomposedState, currentState
   
   <span class="comments">; Restore the color tables.</span>
   IF (!D.Name NE 'Z') THEN TVLCT, rr, gg, bb
   
END
</code>
    </div>
  </body>
</html>