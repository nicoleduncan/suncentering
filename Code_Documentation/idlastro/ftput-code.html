<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:33 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>ftput.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="ftput.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="ftput:source"></a>pro ftput,h,tab,field,row,values,nulls
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;       FTPUT</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;       Procedure to add or update a field in an FITS ASCII table</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;       FTPUT, htab, tab, field, row, values, [ nulls ]</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;       htab - FITS ASCII table header string array</span>
<span class="comments">;       tab - FITS ASCII table array (e.g. as read by READFITS)</span>
<span class="comments">;       field - string field name or integer field number</span>
<span class="comments">;       row -  either a non-negative integer scalar giving starting row to </span>
<span class="comments">;               update, or a non-negative integer vector specifying rows to </span>
<span class="comments">;               update.   FTPUT will append a new row to a table if the value </span>
<span class="comments">;               of 'row' exceeds the number of rows in the tab array    </span>
<span class="comments">;       values - value(s) to add or update.   If row is a vector</span>
<span class="comments">;               then values must contain the same number of elements.</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUT:</span>
<span class="comments">;       nulls - null value flag of same length as values.</span>
<span class="comments">;               It should be set to 1 at null value positions</span>
<span class="comments">;               and 0 elsewhere.</span>
<span class="comments">;</span>
<span class="comments">; OUTPUTS:</span>
<span class="comments">;       htab,tab will be updated as specified.</span>
<span class="comments">;</span>
<span class="comments">; EXAMPLE:</span>
<span class="comments">;       One has a NAME and RA  and Dec vectors for 500 stars with formats A6,</span>
<span class="comments">;       F9.5 and F9.5 respectively.   Write this information to an ASCII table </span>
<span class="comments">;       named 'star.fits'.</span>
<span class="comments">;</span>
<span class="comments">;       IDL> FTCREATE,24,500,h,tab       ;Create table header and (empty) data</span>
<span class="comments">;       IDL> FTADDCOL,h,tab,'RA',8,'F9.5','DEGREES'   ;Explicity define the</span>
<span class="comments">;       IDL> FTADDCOL,h,tab,'DEC',8,'F9.5','DEGREES'  ;RA and Dec columns</span>
<span class="comments">;       IDL> FTPUT,h,tab,'RA',0,ra       ;Insert RA vector into table</span>
<span class="comments">;       IDL> FTPUT,h,tab,'DEC',0,dec       ;Insert DEC vector into table</span>
<span class="comments">;       IDL> FTPUT, h,tab, 'NAME',0,name   ;Insert NAME vector with default</span>
<span class="comments">;       IDL> WRITEFITS,'stars.fits',tab,h ;Write to a file</span>
<span class="comments">;   </span>
<span class="comments">;      Note that (1) explicit formatting has been supplied for the (numeric)</span>
<span class="comments">;      RA and Dec vectors, but was not needed for the NAME vector, (2) A width</span>
<span class="comments">;      of 24 was supplied in FTCREATE based on the expected formats (6+9+9),</span>
<span class="comments">;      though the FT* will adjust this value as necessary, and (3) WRITEFITS</span>
<span class="comments">;      will create a minimal primary header  </span>
<span class="comments">; NOTES:</span>
<span class="comments">;       (1) If the specified field is not already in the table, then FTPUT will</span>
<span class="comments">;       create a new column for that field using default formatting.   However,</span>
<span class="comments">;        FTADDCOL should be called prior to FTPUT for explicit formatting.</span>
<span class="comments">;</span>
<span class="comments">; PROCEDURES CALLED</span>
<span class="comments">;       FTADDCOL, FTINFO, FTSIZE, SXADDPAR, SXPAR()</span>
<span class="comments">; HISTORY:</span>
<span class="comments">;       version 1  D. Lindler July, 1987</span>
<span class="comments">;       Allow E format         W. Landsman          March 1992</span>
<span class="comments">;       Write in F format if E format will overflow    April 1994</span>
<span class="comments">;       Update documentation W. Landsman   January 1996</span>
<span class="comments">;       Allow 1 element vector  W. Landsman   March 1996</span>
<span class="comments">;       Adjust string length to maximum of input string array   June 1997</span>
<span class="comments">;       Work for more than 32767 elements August 1997</span>
<span class="comments">;       Converted to IDL V5.0   W. Landsman   September 1997</span>
<span class="comments">;       Updated call to the new FTINFO   W. Landsman   May 2000</span>
<span class="comments">;       Fix case where header does not have any columns yet W.Landsman Sep 2002</span>
<span class="comments">;       Assume since V5.2, omit fstring() call  W. Landsman April 2006</span>
<span class="comments">;-</span>
 On_error,2
 compile_opt idl2

 if N_params() LT 5 then begin
    print,'Syntax - FTPUT, htab, tab, field, row, values, [nulls]'
    return
 endif

 nrow = N_elements(row)        <span class="comments">;Number of elements in row vector</span>

 nullflag = N_elements(nulls) GT 0         <span class="comments">;Null values supplied?</span>

 ftsize,h,tab,ncols,nrows,tfields,allcols,allrows     <span class="comments">; Get size of table</span>

<span class="comments">; Make values a vector if scalar supplied</span>

 s = size(values) & ndim = s[0] & type = s[ndim+1]

 if ndim gt 1 then $
        message,'Input values must be scalar or 1-D array'

 sz_row = size(row)
 scalar = sz_row[0] EQ 0

 v = values
 if nullflag then nullvals = nulls

<span class="comments">; Get info on field specified</span>

 ftinfo,h,ft_str, Count = tfields
 if tfields EQ 0 then ipos = -1 else begin
  if size(field,/TNAME) EQ 'STRING' then begin
    field = strupcase(strtrim(field,2))
    ttype = strtrim(ft_str.ttype,2)
    ipos = where(ttype EQ field, Npos)
 endif else ipos = field -1
 endelse

 if ipos[0] EQ -1 then begin            <span class="comments">;Does it exist?</span>

<span class="comments">; Add new column if it doesn't exist</span>

          if type EQ 7 then type = (-max(strlen(v)))
          ftaddcol, h, tab, field, type
          ftinfo,h,ft_str
          ftsize,h,tab,ncols,nrows,tfields,allcols,allrows
          ipos = tfields-1
 endif 

 ipos = ipos[0]
 tbcol = ft_str.tbcol[ipos]-1                   <span class="comments">;IDL starts at zero not one.</span>

<span class="comments">; Convert input vector to string array</span>

 n = N_elements(v)
 data = string(replicate(32b, ft_str.width[ipos], n ) )
 if nrow GT 1 then if (nrow NE n) then $
        message,'Number of specified rows must equal number of values'

 fmt = strupcase(strtrim(ft_str.tform[ipos],2))
 fmt1 = strmid(fmt,0,1)
 if (fmt1 EQ 'D') or (fmt1 EQ 'E') then begin  <span class="comments">;Need at least 6 chars for E fmt</span>
        point = strpos(fmt,'.')
        wid = fix(strmid(fmt,1,point-1))
        decimal = fix(strmid(fmt,point+1,1000))
        if wid-decimal LT 6 then fmt = 'F' + strmid(fmt,1,1000)
 endif
 fmt = '(' + fmt + ')'
 data = string(v, FORMAT = fmt)

<span class="comments">; insert null values</span>

 if nullflag GT 5 then begin
        bad = where(nullvals, Nbad)
        if Nbad GT 0 then for i = 0L, Nbad-1 do data[bad[i]] = tnull
 end

<span class="comments">;</span>
<span class="comments">; Do we need to increase the number of rows in the table?</span>
<span class="comments">;</span>
if scalar then maxrow = row+n else maxrow = max(row) + 1
if maxrow GT allrows then begin         <span class="comments">;expand table size</span>

    <span class="comments">;</span>
    <span class="comments">;  Create a replacement table with the required number of rows.</span>
    <span class="comments">;</span>
    newtab = replicate(32b,allcols,maxrow)
    newtab[0,0] = tab

    <span class="comments">;</span>
    <span class="comments">;  Move the new table into the old table.</span>
    <span class="comments">;</span>
    tab = newtab

end
 if maxrow GT nrows then sxaddpar,h,'naxis2',maxrow

<span class="comments">;</span>
<span class="comments">;  Now insert into table.</span>
<span class="comments">;</span>
  if scalar then tab[tbcol,row] = byte(data) $
  else for i = 0L,N_elements(row)-1 do tab[tbcol,row[i]] = byte(data[i])

<span class="comments">;</span>
<span class="comments">;  Return to calling routine.</span>
<span class="comments">;</span>
 return
 end
</code>
    </div>
  </body>
</html>