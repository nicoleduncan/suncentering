<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:47 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>meanclip.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="meanclip.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source">PRO MEANCLIP, Image, Mean, Sigma, CLIPSIG=clipsig, MAXITER=maxiter, $
    CONVERGE_NUM=converge_num, VERBOSE=verbose, SUBS=subs,DOUBLE=double
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;       MEANCLIP</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;       Computes an iteratively sigma-clipped mean on a data set</span>
<span class="comments">; EXPLANATION:</span>
<span class="comments">;       Clipping is done about median, but mean is returned.</span>
<span class="comments">;       Called by SKYADJ_CUBE</span>
<span class="comments">;</span>
<span class="comments">; CATEGORY:</span>
<span class="comments">;       Statistics</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;       MEANCLIP, Data, Mean, [ Sigma, SUBS =</span>
<span class="comments">;              CLIPSIG=, MAXITER=, CONVERGE_NUM=, /VERBOSE, /DOUBLE ]</span>
<span class="comments">;</span>
<span class="comments">; INPUT POSITIONAL PARAMETERS:</span>
<span class="comments">;       Data:     Input data, any numeric array</span>
<span class="comments">;       </span>
<span class="comments">; OUTPUT POSITIONAL PARAMETERS:</span>
<span class="comments">;       Mean:     N-sigma clipped mean.</span>
<span class="comments">;       Sigma:    Standard deviation of remaining pixels.</span>
<span class="comments">;</span>
<span class="comments">; INPUT KEYWORD PARAMETERS:</span>
<span class="comments">;       CLIPSIG:  Number of sigma at which to clip.  Default=3</span>
<span class="comments">;       MAXITER:  Ceiling on number of clipping iterations.  Default=5</span>
<span class="comments">;       CONVERGE_NUM:  If the proportion of rejected pixels is less</span>
<span class="comments">;           than this fraction, the iterations stop.  Default=0.02, i.e.,</span>
<span class="comments">;           iteration stops if fewer than 2% of pixels excluded.</span>
<span class="comments">;       /VERBOSE:  Set this flag to get messages.</span>
<span class="comments">;       /DOUBLE - if set then perform all computations in double precision.</span>
<span class="comments">;                 Otherwise double precision is used only if the input</span>
<span class="comments">;                 data is double</span>
<span class="comments">; OUTPUT KEYWORD PARAMETER:</span>
<span class="comments">;       SUBS:     Subscript array for pixels finally used.</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; MODIFICATION HISTORY:</span>
<span class="comments">;       Written by:     RSH, RITSS, 21 Oct 98</span>
<span class="comments">;       20 Jan 99 - Added SUBS, fixed misplaced paren on float call, </span>
<span class="comments">;                   improved doc.  RSH</span>
<span class="comments">;       Nov 2005   Added /DOUBLE keyword, check if all pixels are removed  </span>
<span class="comments">;                  by clipping W. Landsman </span>
<span class="comments">;-</span>

IF N_params() LT 1 THEN BEGIN
    print, 'CALLING SEQUENCE:  MEANCLIP, Image, Mean, Sigma'
    print, 'KEYWORD PARAMETERS:  CLIPSIG[=3], MAXITER[=5], CONVERGE_NUM[=0.02], ' $
        + '/VERBOSE, SUBS, /DOUBLE'
    RETURN
ENDIF

prf = 'MEANCLIP:  '

verbose = keyword_set(verbose)
IF n_elements(maxiter) LT 1 THEN maxiter = 5
IF n_elements(clipsig) LT 1 THEN clipsig = 3
IF n_elements(converge_num) LT 1 THEN converge_num = 0.02

subs = where(finite(image),ct)
iter=0
REPEAT BEGIN
    skpix = image[subs]
    iter = iter + 1
    lastct = ct
    medval = median(skpix)
    mom = moment(skpix,max=2,double=double)
    sig = sqrt(mom[1])
    wsm = where(abs(skpix-medval) LT clipsig*sig,ct)
    IF ct GT 0 THEN subs = subs[wsm]         
ENDREP UNTIL (float(abs(ct-lastct))/lastct LE converge_num) $
          OR (iter GT maxiter) or (ct EQ 0)
mom = moment(image[subs],double=double,max=2)
mean = mom[0]
sigma = sqrt(mom[1])
IF verbose THEN BEGIN
    print, prf+strn(clipsig)+'-sigma clipped mean'
    print, prf+'Mean computed in ',iter,' iterations'
    print, prf+'Mean = ',mean,',  sigma = ',sigma
ENDIF

RETURN
END
</code>
    </div>
  </body>
</html>