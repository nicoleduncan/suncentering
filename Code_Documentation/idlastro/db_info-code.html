<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:24 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>db_info.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="db_info.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="db_info:source"></a>function db_info,request,dbname
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;       DB_INFO</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;       Function to obtain information on opened data base file(s)</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCES:</span>
<span class="comments">;       1)  result = db_info(request)</span>
<span class="comments">;       2)  result = db_info(request,dbname)</span>
<span class="comments">; INPUTS (calling sequence 1):</span>
<span class="comments">;</span>
<span class="comments">;       request - string specifying requested value(s)</span>
<span class="comments">;               value of request          value returned in result</span>
<span class="comments">;                       'open'          Flag set to 1 if data base(s) are opened</span>
<span class="comments">;                       'number'        Number of data base files opened</span>
<span class="comments">;                       'items'         Total number of items (all db's opened)</span>
<span class="comments">;                       'update'        update flag (1 if opened for update)</span>
<span class="comments">;                       'unit_dbf'      Unit number of the .dbf files</span>
<span class="comments">;                       'unit_dbx'      Unit number of the .dbx files</span>
<span class="comments">;                       'entries'       Number of entries in the db's</span>
<span class="comments">;                       'length'        Record lengths for the db's</span>
<span class="comments">;                       'external'      True if the db's are in external format</span>
<span class="comments">;</span>
<span class="comments">; INPUTS (calling sequence 2):</span>
<span class="comments">;</span>
<span class="comments">;       request - string specifying requested value(s)</span>
<span class="comments">;                  value of request       value returned in result</span>
<span class="comments">;                       'name'          Name of the data base</span>
<span class="comments">;                       'number'        Sequential number of the db</span>
<span class="comments">;                       'items'         Number of items for this db</span>
<span class="comments">;                       'item1'         Position of item1 for this db</span>
<span class="comments">;                                       in item list for all db's</span>
<span class="comments">;                       'item2'         Position of last item for this db.</span>
<span class="comments">;                       'pointer'       Number of the item which points</span>
<span class="comments">;                                       to this db. 0 for first or primary</span>
<span class="comments">;                                       db.  -1 if link file pointers.</span>
<span class="comments">;                       'length'        Record length for this db.</span>
<span class="comments">;                       'title'         Title of the data base</span>
<span class="comments">;                       'unit_dbf'      Unit number of the .dbf file</span>
<span class="comments">;                       'unit_dbx'      Unit number of the .dbx file</span>
<span class="comments">;                       'entries'       Number of entries in the db</span>
<span class="comments">;                       'seqnum'        Last sequence number used</span>
<span class="comments">;                       'alloc'         Allocated space (# entries)</span>
<span class="comments">;                       'update'        1 if data base opened for update</span>
<span class="comments">;                       'external'      True if data base in external format</span>
<span class="comments">;                       'newdb'         True if new (post Oct 2010) format </span>
<span class="comments">;                                       that allows entries > 32767 bytes</span>
<span class="comments">;</span>
<span class="comments">;       dbname - data base name or number</span>
<span class="comments">; OUTPUTS:</span>
<span class="comments">;       Requested value(s) are returned as the function value.</span>
<span class="comments">;</span>
<span class="comments">; HISTORY:</span>
<span class="comments">;       version 1  D. Lindler    Oct. 1987</span>
<span class="comments">;       changed type from 1 to 7 for IDLV2, J. Isensee, Nov., 1990</span>
<span class="comments">;       William Thompson, GSFC/CDS (ARC), 30 May 1994</span>
<span class="comments">;               Added EXTERNAL request type.</span>
<span class="comments">;       Support new DB format, add NEWDB request type W. Landsman Oct 2010</span>
<span class="comments">;-</span>
<span class="comments">;------------------------------------------------------------------------</span>
on_error,2                       <span class="comments">;Return to caller</span>
<span class="comments">;</span>
<span class="comments">; data base common block</span>
<span class="comments">;</span>
common db_com,QDB,QITEMS,QLINK
<span class="comments">;</span>
<span class="comments">; QDB(*,i) contains the following for each data base opened</span>
<span class="comments">;</span>
<span class="comments">;       bytes</span>
<span class="comments">;         0-18   data base name character*19</span>
<span class="comments">;         19-79  data base title character*61</span>
<span class="comments">;         80-81  number of items (integer*2)</span>
<span class="comments">;         82-83  record length of DBF file (integer*2), old format</span>
<span class="comments">;         84-87  number of entries in file (integer*4)</span>
<span class="comments">;         88-89  position of first item for this file in QITEMS (I*2)</span>
<span class="comments">;         90-91  position of last item for this file (I*2)</span>
<span class="comments">;         92-95  Last Sequence number used (item=SEQNUM) (I*4)</span>
<span class="comments">;         96     Unit number of .DBF file</span>
<span class="comments">;         97     Unit number of .dbx file (0 if none exists)</span>
<span class="comments">;         98-99  Index number of item pointing to this file (0 for first db)</span>
<span class="comments">;         100-103 Number of entries with space allocated</span>
<span class="comments">;         104    Update flag (0 open for read only, 1 open for update)</span>
<span class="comments">;         105-108  record length of DBF file (integer*4), new format</span>
<span class="comments">;         119    True if database is in external (IEEE) format</span>
<span class="comments">;</span>
<span class="comments">;  QITEMS(*,i) contains decription of item number i with following</span>
<span class="comments">;  byte assignments:</span>
<span class="comments">;</span>
<span class="comments">;       0-19    item name (character*20)</span>
<span class="comments">;       20-21   IDL data type (integet*2)</span>
<span class="comments">;       22-23   Number of values for item (1 for scalar) (integer*2)</span>
<span class="comments">;       24-25   Starting byte position in original DBF record (integer*2)</span>
<span class="comments">;       26-27   Number of bytes per data value (integer*2)</span>
<span class="comments">;       28      Index type</span>
<span class="comments">;       29-97   Item description</span>
<span class="comments">;       98-99   Print field length</span>
<span class="comments">;       100     Flag set to one if pointer item</span>
<span class="comments">;       101-119 Data base this item points to</span>
<span class="comments">;       120-125 Print format</span>
<span class="comments">;       126-170 Print headers</span>
<span class="comments">;       171-172 Starting byte in record returned by DBRD, old format</span>
<span class="comments">;       173-174 Data base number in QDB</span>
<span class="comments">;       175-176 Data base number this item points to</span>
<span class="comments">;       177-178 Item number within the specific data base</span>
<span class="comments">;       179-182 Number of values for item (1 for scalar) (integer*4)</span>
<span class="comments">;       183-186  Starting byte position in original DBF record (integer*4)</span>
<span class="comments">;       187-190 Starting byte in record returned by DBRD</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; QLINK(i) contains the entry number in the second data base</span>
<span class="comments">;       corresponding to entry i in the first data base.</span>
<span class="comments">;-------------------------------------------------------------------------</span>
<span class="comments">;</span>
req=strtrim(strupcase(request))         <span class="comments">;requested value</span>
s=size(qdb)
if req eq 'OPEN' then begin
        if s[0] eq 0 then return,0 else return,1
end
if s[0] eq 0 then message,'No data base file(s) opened'
n=s[2]                                  <span class="comments">;number of data bases</span>
<span class="comments">;</span>
<span class="comments">; calling sequence 1  result=db_info(request)</span>
<span class="comments">;</span>
newdb = qdb[118,0]
if N_params() lt 2 then begin
    case req of
        'NUMBER'  : return,n                    <span class="comments">;number of files opened</span>
        'ITEMS'   : begin                       <span class="comments">;total number of items</span>
                        s=size(qitems)
                        return,s[2]
                    end
        'LENGTH'  : begin
                    len = newdb ? long( qdb[105:108,*],0,n) : $
                                   fix(qdb[82:83,*],0,n)
                    return,len
                    end
                                                <span class="comments">;total record length</span>
        'UPDATE'  : return,qdb[104,0]           <span class="comments">;update flag</span>
        'UNIT_DBF'  : return,qdb[96,*]          <span class="comments">;.dbf unit number</span>
        'UNIT_DBX'  : return,qdb[97,*]          <span class="comments">;.dbx unit number</span>
        'ENTRIES'   : return,long(qdb[84:87,*],0,n)     <span class="comments">;number of entries</span>
        'EXTERNAL'  : return,qdb[119,*] eq 1    <span class="comments">;external format?</span>
        'NEWDB'     : return,  newdb         <span class="comments">;New db format?                  </span>
        else :  message,'Invalid request for information'
    endcase
endif
<span class="comments">;</span>
<span class="comments">; second calling sequence:  result=db_info(request,dbname) ----------</span>
<span class="comments">;</span>
s=size(dbname)
ndim=s[0]
type=s[ndim+1]
if (ndim gt 0) or (type eq 0) then goto,abort
<span class="comments">;</span>
<span class="comments">; convert name to number</span>
<span class="comments">;</span>
if type eq 7 then begin
        db_name=strtrim(strupcase(dbname))
        for i=0,n-1 do $
                if db_name eq strtrim(string(qdb[0:18,i])) then goto,found
        goto,abort                                      <span class="comments">;not found</span>
found:  dbnum=i
   end else begin                                       <span class="comments">;number supplied</span>
        dbnum=fix(dbname)
        if (dbnum lt 0) or (dbnum ge n) then goto,abort
end
newdb = qdb[118,dbnum]

case req of
        'NAME'     : return,strtrim(string(qdb[0:18,dbnum]))  <span class="comments">;db name</span>
        'NUMBER'   : return,dbnum                       <span class="comments">;data base number</span>
        'ITEMS'    : begin                              <span class="comments">;number of items</span>
                        x=fix(qdb[80:81,dbnum],0,1)
                        return,x[0]
                     end
        'ITEM1'    : begin                              <span class="comments">;starting item number</span>
                        x=fix(qdb[88:89,dbnum],0,1)
                        return,x[0]
                     end
        'ITEM2'    : begin                              <span class="comments">;last item number</span>
                        x=fix(qdb[90:91,dbnum],0,1)
                        return,x[0]
                     end
        'POINTER'   : begin                             <span class="comments">;item number pointer</span>
                        x=fix(qdb[98:99,dbnum],0,1)
                        return,x[0]
                      end
        'LENGTH'    : begin 
                        x = newdb ? long(qdb[105:108,dbnum],0,1) : $                            <span class="comments">;record length</span>
                                   fix(qdb[82:83,dbnum],0,1)
                      return,long(x[0])
                      end
        'TITLE'     : return,strtrim(string(qdb[19:79,dbnum])) <span class="comments">;data base title</span>
        'UNIT_DBF'  : return,qdb[96,dbnum]              <span class="comments">;.dbf unit number</span>
        'UNIT_DBX'  : return,qdb[97,dbnum]              <span class="comments">;.dbx unit number</span>
        'ENTRIES'   : begin                             <span class="comments">;number of entries</span>
                        x=long(qdb[84:87,dbnum],0,1)
                        return,x[0]
                      end
        'SEQNUM'    : begin                             <span class="comments">;last sequence number</span>
                        x=long(qdb[92:95,dbnum],0,1)
                        return,x[0]
                      end
        'ALLOC'     : begin                             <span class="comments">;allocated size</span>
                        x=long(qdb[100:103,dbnum],0,1)
                        return,x[0]
                      end
        'UPDATE'    : return,qdb[104,dbnum]             <span class="comments">;update flag</span>
        'EXTERNAL'  : begin                             <span class="comments">;External format?</span>
                        x=qdb[119,*] eq 1
                        return,x[0]
                      end
        'NEWDB'     :      return,  newdb         <span class="comments">;New db format?                  </span>
        else: message,'Invalid information request'
endcase
abort:  message,'Invalid data base name or number supplied'
end
</code>
    </div>
  </body>
</html>