<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:58:04 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>sxmake.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="sxmake.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source">Pro sxmake, unit, File, Data, Par, Groups, Header, PSIZE = psize
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;       SXMAKE</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;       Create a basic ST header file from an IDL array prior to writing data.</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;       sxmake, Unit, File, Data, Par, Groups, Header, [ PSIZE = ]</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;       Unit = Logical unit number from 1 to 9.</span>
<span class="comments">;       File = file name of data and header files to create.   If no file name</span>
<span class="comments">;              extension is supplied then the default is to use .hhh for the</span>
<span class="comments">;              header file extension and .hhd for the data file extension    </span>
<span class="comments">;              If an extension is supplied, it should be of the form .xxh</span>
<span class="comments">;              where xx are any alphanumeric characters.</span>
<span class="comments">;       Data = IDL data array of the same type, dimensions and</span>
<span class="comments">;               size as are to be written to file.</span>
<span class="comments">;       Par = # of elements in each parameter block for each data record.  If </span>
<span class="comments">;             set equal to 0, then parameter blocks will not be written.  The </span>
<span class="comments">;             data type of the parameter blocks must be the same as the data </span>
<span class="comments">;             array.   To get around this restriction, use the PSIZE keyword.</span>
<span class="comments">;       Groups = # of groups to write.  If 0 then write in basic</span>
<span class="comments">;               format without groups.  </span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUT PARAMETERS:</span>
<span class="comments">;       Header = String array containing ST header file.  If this</span>
<span class="comments">;               parameter is omitted, a basic header is constructed.</span>
<span class="comments">;               If included, the basic parameters are added to the</span>
<span class="comments">;               header using sxaddpar.  The END keyword must terminate</span>
<span class="comments">;               the parameters in Header.</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL KEYWORD INPUT PARAMETER:</span>
<span class="comments">;        PSIZE - Integer scalar giving the number of bits in the parameter </span>
<span class="comments">;               block.    If the PSIZE keyword is given, then the Par input</span>
<span class="comments">;               parameter is ignored.</span>
<span class="comments">;                </span>
<span class="comments">; OPTIONAL OUTPUT PARAMETERS:</span>
<span class="comments">;       Header = ST header array, an 80 by N character array.</span>
<span class="comments">;</span>
<span class="comments">; COMMON BLOCKS:</span>
<span class="comments">;       Stcommn - as used in sxwrite, sxopen, etc.</span>
<span class="comments">;</span>
<span class="comments">; SIDE EFFECTS:</span>
<span class="comments">;       The header file is created and written and then the</span>
<span class="comments">;       data file is opened on the designated unit.</span>
<span class="comments">;</span>
<span class="comments">; RESTRICTIONS:</span>
<span class="comments">;       Header files must be named .xxh and data files must be</span>
<span class="comments">;       named .xxd, where xx are any alphanumeric characters.</span>
<span class="comments">;</span>
<span class="comments">; PROCEDURE:</span>
<span class="comments">;       Call sxmake to create a header file.  Then call sxwrite</span>
<span class="comments">;       to output each group.</span>
<span class="comments">; </span>
<span class="comments">; PROCEDURES USED:</span>
<span class="comments">;       GET_DATE, SXADDPAR, SXOPEN</span>
<span class="comments">; MODIFICATION HISTORY:</span>
<span class="comments">;       DMS, July, 1983.</span>
<span class="comments">;       converted to new VMS IDL  April 90</span>
<span class="comments">;       Use SYSTIME() instead of !STIME   W. Landsman   Aug 1997</span>
<span class="comments">;       Converted to IDL V5.0   W. Landsman   September 1997</span>
<span class="comments">;       Added optional PSIZE keyword   August 1999 W. Landsman </span>
<span class="comments">;       Recognize unsigned datatype    January 2000   W. Landsman </span>
<span class="comments">;-</span>
        common stcommn, result, filename
<span class="comments">;</span>
        if N_params() LT 2 then begin
           print,'Syntax - SXMAKE,unit,file,data,par,groups,header, [PSIZE = ]'
           return
        endif
<span class="comments">;</span>
        if N_elements(result) ne 200 then begin
                result = lonarr(20,10)  <span class="comments">;define common blks</span>
                filename = strarr(10)
                endif
<span class="comments">;</span>
        if (unit lt 1) or (unit gt 9) then $  <span class="comments">;unit ok?</span>
                message,'Unit number must be from 1 to 9.'
<span class="comments">;</span>
        close,unit
        result[unit,*]=0
<span class="comments">;</span>
        if N_elements(par) EQ 0 then par = 0
        if N_elements(groups) EQ 0 then groups = 0
<span class="comments">;</span>
        s = size(data)                  <span class="comments">;obtain size of array.</span>
        stype = s[s[0]+1]               <span class="comments">;type of data.</span>
        if (par eq 0) and (groups eq 0) and (stype LT 6) then $
                sxaddpar,header,'simple','T','Written by IDL:  '+ systime() $
            else $
                sxaddpar,header,'simple','F','Written by IDL:  '+ systime()
        case stype of
0:      message,'Data parameter is not defined'
7:      message,"Can't write strings to ST files"
1:      begin& bitpix=  8 & d = 'INTEGER*1' & endcase
2:      begin& bitpix= 16 & d = 'INTEGER*2' & endcase
4:      begin& bitpix= 32 & d = 'REAL*4' & endcase
3:      begin& bitpix= 32 & d = 'INTEGER*4' & endcase
5:      begin& bitpix= 64 & d = 'REAL*8' & endcase
6:      begin& bitpix= 64 & d = 'COMPLEX*8' & endcase
12:     begin & bitpix=16 & d='UNSIGNED*2' & endcase
13:     begin & bitpix=32 & d='UNSIGNED*4' & endcase
else:   message,'ERROR -- Unrecognized input data type'

        endcase
<span class="comments">;</span>
        sxaddpar,header,'BITPIX',bitpix
        sxaddpar,header,'NAXIS',S[0]    <span class="comments">;# of dimensions</span>
        for i=1,s[0] do sxaddpar,header,'NAXIS'+strtrim(i,2),s[i]
        sxaddpar,header,'DATATYPE',d,'Type of data'
        Get_date,dte
        sxaddpar,header,'DATE',dte
<span class="comments">;</span>
        if groups eq 0 then $           <span class="comments">;true if not group fmt.</span>
                sxaddpar,header,'GROUPS','F','No groups' $
           else begin                   <span class="comments">;make group params.</span>
                sxaddpar,header,'GROUPS','T'
                sxaddpar,header,'PCOUNT',par
                sxaddpar,header,'GCOUNT',groups
                if N_elements(psize) EQ 0 then psize = bitpix*par
                sxaddpar,header,'PSIZE',psize,'# of bits in parm blk'
           endelse
<span class="comments">;</span>
        sxopen,unit,file,header,hist,'W' <span class="comments">;make header file, etc.</span>
        return
end
</code>
    </div>
  </body>
</html>