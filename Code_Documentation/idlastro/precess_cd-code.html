<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:56 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>precess_cd.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="precess_cd.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="PRECESS_CD:source"></a>pro PRECESS_CD, cd, epoch1, epoch2, crval_old, crval_new, FK4 = FK4     
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;       PRECESS_CD</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;       Precess the CD (coordinate description) matrix from a FITS header </span>
<span class="comments">; EXPLANATION:</span>
<span class="comments">;       The CD matrix is precessed from EPOCH1 to EPOCH2.  Called by HPRECESS</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;       PRECESS_CD, cd, epoch1, epoch2, crval_old, crval_new, [/FK4]  </span>
<span class="comments">;</span>
<span class="comments">; INPUTS/OUTPUT:</span>
<span class="comments">;       CD - 2 x 2 CD (coordinate description) matrix in any units</span>
<span class="comments">;               (degrees or radians).  CD will altered on output to contain </span>
<span class="comments">;               precessed values in the same units.    On output CD will always</span>
<span class="comments">;               be double precision no matter how input.</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;       EPOCH1 - Original equinox of coordinates, scalar (e.g. 1950.0).  </span>
<span class="comments">;       EPOCH2 - Equinox of precessed coordinates, scalar (e.g. 2000.0)</span>
<span class="comments">;       CRVAL_OLD - 2 element vector containing RA and DEC in DEGREES</span>
<span class="comments">;               of the reference pixel in the original equinox</span>
<span class="comments">;       CRVAL_NEW - 2 elements vector giving CRVAL in the new equinox </span>
<span class="comments">;</span>
<span class="comments">; INPUT KEYWORD:</span>
<span class="comments">;       /FK4 - If this keyword is set, then the precession constants are taken</span>
<span class="comments">;             in the FK4 reference frame.   The default is the FK5 frame.</span>
<span class="comments">;</span>
<span class="comments">; RESTRICTIONS:</span>
<span class="comments">;       PRECESS_CD should not be used more than 2.5 centuries from the</span>
<span class="comments">;       year 1900.      </span>
<span class="comments">;</span>
<span class="comments">; PROCEDURE:</span>
<span class="comments">;       Adapted from the STSDAS program FMATPREC.  Precession changes the</span>
<span class="comments">;       location of the north pole, and thus changes the rotation of</span>
<span class="comments">;       an image from north up.  This is reflected in the precession of the</span>
<span class="comments">;       CD matrix.   This is usually a very small change. </span>
<span class="comments">;</span>
<span class="comments">; PROCEDURE CALLS:</span>
<span class="comments">;       PRECESS</span>
<span class="comments">;</span>
<span class="comments">; REVISION HISTORY:</span>
<span class="comments">;       Written, Wayne Landsman, ST Systems  February 1988</span>
<span class="comments">;       Fixed sign error in computation of SINRA     March 1992</span>
<span class="comments">;       Added /FK4 keyword                           Feb 1994</span>
<span class="comments">;       Converted to IDL V5.0   W. Landsman   September 1997</span>
<span class="comments">;       Use B/Jprecess for conversion between 1950 and 2000 W.L. Aug 2009</span>
<span class="comments">;-    </span>
  On_error,2
  compile_opt idl2

  if N_params() LT 3 then begin    
      print,'Syntax: precess_cd, cd, epoch1, epoch2, crval_old, crval_new
      return
   endif 

   deg_to_rad = !DPI/180.0D
   crvalold = crval_old * deg_to_rad
   crvalnew = crval_new * deg_to_rad

   sec_to_rad = deg_to_rad/3600.d0
   t = 0.001d0 * (epoch2-epoch1)

<span class="comments">;   Compute C - inclination of the mean equator in the new equinox relative</span>
<span class="comments">;   to that of the old equinox</span>

   if keyword_set(FK4) then begin

        st = 0.001d0 * (epoch1-1900.d0)

        C = sec_to_rad * T * ( 20046.85D0 - ST*(85.33D0 + 0.37D0*ST) $
                + T*(-42.67D0 - 0.37D0*ST -41.8D0*T))

   endif else begin

        st = 0.001d0*( epoch1 - 2000.d0)

        C = sec_to_rad * T * (20043.109D0 - ST*(85.33D0 + 0.217D0*ST) $
                + T*(-42.665D0 - 0.217D0*ST -41.833D0*T))
   endelse

<span class="comments">; Get RA of old pole in new coordinates</span>

  pole_ra = 0. & pole_dec = 90.d       <span class="comments">;Coordinates of old pole (RA is arbitrary)</span>
  if (epoch1 EQ 2000) && (epoch2 EQ 1950) then begin
    bprecess, pole_ra, pole_dec,pra,pdec
    pole_ra =  pra
  endif else if (epoch1 EQ 1950) and (epoch2 EQ 2000) then begin
     bprecess, pole_ra, pole_dec,pra,pdec
     pole_ra =  pra    
  endif else precess, pole_ra, pole_dec, epoch1, epoch2, FK4 = FK4    

  sind1 = sin( crvalold[1] ) &  sind2 = sin( crvalnew[1] )
  cosd1 = cos( crvalold[1] ) &  cosd2 = cos( crvalnew[1] )
  sinra = sin( crvalnew[0] - pole_ra*deg_to_rad)    <span class="comments">;Fixed sign error Mar-92</span>
  cosfi = (cos(c) - sind1*sind2)/( cosd1*cosd2 )
  sinfi = ( abs(sin(c) ) * sinra) / cosd1 
  r = [ [cosfi, sinfi], [-sinfi, cosfi] ]

  cd = r # cd            <span class="comments">;Rotate to new north pole</span>

  return
  end
</code>
    </div>
  </body>
</html>