<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:42 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>hreverse.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="hreverse.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="hreverse:source"></a>pro hreverse, oldim, oldhd, newim, newhd, subs, SILENT = silent, ERRMSG= errmsg
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;       HREVERSE</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;       Reverse an image about either dimension and update FITS astrometry</span>
<span class="comments">; EXPLANATION:</span>
<span class="comments">;       Reverse an image about either the X or Y axis, and create a new </span>
<span class="comments">;       header with updated astrometry for the reversed image.</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;       HREVERSE,oldim,oldhd, [ subs, /SILENT ]   ;Update input image and header</span>
<span class="comments">;               or</span>
<span class="comments">;       HREVERSE, oldim, oldhd, newim, newhd, [ subs, /SILENT ]   </span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;       OLDIM - the original image array</span>
<span class="comments">;       OLDHD - the original image header</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUTS:</span>
<span class="comments">;       SUBS - Subs equals 1 to reverse the order of the X dimension,</span>
<span class="comments">;               2 to reverse Y order.  If omitted, then HREVERSE will</span>
<span class="comments">;               prompt for this scalar parameter.</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL OUTPUTS:</span>
<span class="comments">;       NEWIM - the rotated image, with the same dimensions as Oldim </span>
<span class="comments">;       NEWHD - header for newim containing updated astrometry info</span>
<span class="comments">;               If output parameters are not supplied, the program</span>
<span class="comments">;               will modify the input parameters OLDIM and OLDHD</span>
<span class="comments">;               to contain the rotated image and updated header.</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL KEYWORD INPUT:</span>
<span class="comments">;       SILENT - if set and non-zero, then informative messages are suppressed.</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL KEYWORD OUTPUT:</span>
<span class="comments">;       ERRMSG - If this keyword is supplied, then any error mesasges will be</span>
<span class="comments">;               returned to the user in this parameter rather than depending on</span>
<span class="comments">;               on the MESSAGE routine in IDL.   If no errors are encountered</span>
<span class="comments">;               then a null string is returned.               </span>
<span class="comments">;</span>
<span class="comments">; SIDE EFFECTS:</span>
<span class="comments">;       A right-handed coordinate system is converted into a left-</span>
<span class="comments">;       handed one, and vice-versa.</span>
<span class="comments">;</span>
<span class="comments">; PROCEDURE:</span>
<span class="comments">;       The User's Library procedure REVERSE is used to reverse the image.</span>
<span class="comments">;       The CD and CRPIX header parameters are updated for the new header.</span>
<span class="comments">;       For AIPS type astrometry, the CDELT parameters are also updated.</span>
<span class="comments">;       A history record is also added to the header</span>
<span class="comments">;</span>
<span class="comments">; PROCEDURES USED:</span>
<span class="comments">;       CHECK_FITS, EXTAST, REVERSE(), STRN(), SXADDPAR </span>
<span class="comments">; MODIFICATION HISTORY:</span>
<span class="comments">;       Written, Aug. 1986 W. Landsman, STI Corp.</span>
<span class="comments">;       Error modifying CROTA angles corrected     9-23-88</span>
<span class="comments">;       Added format keyword, J. Isensee, July, 1990</span>
<span class="comments">;       Work for ST Guide Star images, W. Landsman   HSTX, May 1995</span>
<span class="comments">;       Compute CRPIX1 correctly for X reversal   W. Landsman HSTX August 1995</span>
<span class="comments">;       Converted to IDL V5.0   W. Landsman   September 1997</span>
<span class="comments">;       Added ERRMSG, Use double precision formatting, W. Landsman April 2000</span>
<span class="comments">;       Recognize PC00n00m astrometry matrix   W. Landsman   December 2001</span>
<span class="comments">;- </span>
 On_error, 2
 npar = N_params()
 if npar LE 1 then begin
     print,'Syntax: HREVERSE, oldim, oldhd, [ subs, /SILENT, ERRMSG = ]'
     print,'    or  HREVERSE, oldim, oldhd, newim, newhd, [ subs, /SILENT]'
     return
 endif 

 save_err = arg_present(errmsg)     <span class="comments">;Does user want error msgs returned?</span>
<span class="comments">;                                    Check for valid 2-D image & header</span>
 check_FITS, oldim, oldhd, dimen, /NOTYPE, ERRMSG = errmsg
  if errmsg NE '' then begin
        if not save_err then message,'ERROR - ' + errmsg,/CON
        return
  endif

  if N_elements(dimen) NE 2 then begin 
        errmsg =  'ERROR - Input image array must be 2-dimensional'
        if not save_err then message,'ERROR - ' + errmsg,/CON
        return
 endif

  xsize = dimen[0]  &  ysize = dimen[1]

 if npar EQ 3 then subs = newim 
 READSUBS: if (npar NE 3) and (npar NE 5) then $
 read,'Enter 1 to reverse X dimension, 2 to reverse Y dimension: ',subs
 if  ( subs NE 2 ) and ( subs NE 1 ) then begin
        message,'ERROR - Illegal Value of Subs parameter',/CON
        if npar then npar = npar -1     <span class="comments">;Make npar even</span>
        goto, READSUBS    
 endif

 newhd = oldhd
 axis_name = ['X','Y']
 if not keyword_set(SILENT) then message, /INF, $
'Now reversing ' + strn(xsize) + ' by ' + strn(ysize) + ' image about ' + $
    axis_name[subs-1] + ' dimension'

if npar GE 4 then newim = reverse( oldim,subs ) else $
                  oldim = reverse( oldim,subs )

 label = 'HREVERSE: ' + strmid(systime(),4,20)
 sxaddpar, newhd, 'HISTORY', label+ $ 
        ' Reversed About '+ axis_name[SUBS-1] + ' Dimension'

<span class="comments">; Update astrometry info if it exists</span>

 extast, oldhd, astr, noparams
 if noparams LT 0 then goto, DONE

  if subs EQ 1 then begin

         if strmid( astr.ctype[0],5,3) EQ 'GSS' then begin
                cnpix = -astr.xll -xsize
                sxaddpar, newhd, 'CNPIX1', cnpix
                sxaddpar, newhd, 'XPIXELSZ', -astr.xsz
         endif else begin
                 crpix1 = xsize  - (astr.crpix[0]-1)
                 sxaddpar, newhd, 'CRPIX1', crpix1

         if (noparams LT 2) or (noparams EQ 3) then $
                sxaddpar, newhd, 'CDELT1', -astr.cdelt[0] $

         else begin           <span class="comments">;If so, then convert them</span>

                 sxaddpar, newhd, 'CD1_1', -astr.cd[0,0]
                 sxaddpar, newhd, 'CD2_1', -astr.cd[1,0]

         endelse 
 endelse

 endif else  begin

         if strmid(astr.ctype[0],5,3) EQ 'GSS' then begin

                cnpix = -astr.yll -ysize
                sxaddpar, newhd, 'CNPIX2', cnpix
                sxaddpar, newhd, 'YPIXELSZ', -astr.ysz

         endif else begin
                 crpix2 = ysize  - (astr.crpix[1]-1)
                 sxaddpar, newhd, 'CRPIX2', crpix2

         if (noparams LT 2) or (noparams EQ 3) then $      
                sxaddpar, newhd, 'CDELT2', -astr.cdelt[1] $

         else begin           <span class="comments">;If so, then convert them</span>

                 sxaddpar, newhd, 'CD1_2', -astr.cd[0,1]
                 sxaddpar, newhd, 'CD2_2', -astr.cd[1,1]

         endelse 
         endelse

 endelse

DONE:
 if npar LE 3 then oldhd = newhd                <span class="comments">;update old header</span>

return
end
</code>
    </div>
  </body>
</html>