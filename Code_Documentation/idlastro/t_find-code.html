<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:58:05 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>t_find.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="t_find.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="t_find:source"></a>pro t_find,image, im_hdr, fitsfile, hmin, fwhm, sharplim, roundlim,$
           PRINT = print, SILENT = silent
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;        T_FIND</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;       Driver procedure (for FIND) to locate stars in an image.</span>
<span class="comments">; EXPLANATION:</span>
<span class="comments">;       Finds positive brightness perturbations (i.e stars) in a </span>
<span class="comments">;       2 dimensional image.  Output is to a FITS ASCII table.</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;       T_FIND, image, im_hdr, [ fitsfile, hmin, fwhm, sharplim, roundlim, </span>
<span class="comments">;                                       PRINT = , /SILENT ]</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;       image - 2 dimensional image array (integer or real) for which one</span>
<span class="comments">;               wishes to identify the stars present</span>
<span class="comments">;       im_hdr - FITS header associated with image array</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUTS: </span>
<span class="comments">;       T_FIND will prompt for these parameters if not supplied</span>
<span class="comments">;</span>
<span class="comments">;       fitsfile - scalar string specifying the name of the output FITS ASCII</span>
<span class="comments">;               table file</span>
<span class="comments">;       fwhm - FWHM to be used in the convolving filter</span>
<span class="comments">;       hmin - Threshold intensity for a point source - should generally</span>
<span class="comments">;               be 3 or 4 sigma above background level</span>
<span class="comments">;       sharplim - 2 element vector giving low and high Limit for </span>
<span class="comments">;               sharpness statistic (Default: [0.2,1.0] )</span>
<span class="comments">;       roundlim - 2 element vector giving low and high Limit for</span>
<span class="comments">;               roundness statistic (Default: [-1.0,1.0] )</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUT KEYWORDS:</span>
<span class="comments">;       /PRINT - if set and non-zero then NSTAR will also write its results to</span>
<span class="comments">;               a file find.prt.   One can specify the output file name by</span>
<span class="comments">;               setting PRINT = 'filename'.</span>
<span class="comments">;       /SILENT -   If this keyword is set and non-zero, then FIND will work</span>
<span class="comments">;               silently, and not display each star found</span>
<span class="comments">;</span>
<span class="comments">; OUTPUTS:</span>
<span class="comments">;       None</span>
<span class="comments">;</span>
<span class="comments">; PROCEDURES CALLED:</span>
<span class="comments">;       CHECK_FITS, FDECOMP, FIND, FTADDCOL, FTCREATE, SXADDHIST, SXADDPAR, </span>
<span class="comments">;       SXDELPAR, SXPAR(), WRITEFITS</span>
<span class="comments">;</span>
<span class="comments">; REVISION HISTORY:</span>
<span class="comments">;       Written W. Landsman, STX  May, 1988</span>
<span class="comments">;       Added phpadu, J. Hill, STX, October, 1990</span>
<span class="comments">;       New calling syntax output to disk FITS table, W. Landsman    May 1996</span>
<span class="comments">;       Work with more than 32767 stars  W. Landsman August 1997</span>
<span class="comments">;       Converted to IDL V5.0   W. Landsman   September 1997</span>
<span class="comments">;       Remove obsolete !ERR system variable   W. Landsman   May 2000</span>
<span class="comments">;-</span>
 On_error,2               <span class="comments">;Return to caller</span>

 if N_params() LT 2 then begin                                  
    print,'Syntax -  ' + $
       'T_FIND, image, hdr, [fitsfile, hmin, fwhm, sharplim, roundlim '
    print,'                       PRINT = ,/SILENT ]'
    return
 endif

 if not keyword_set( SILENT ) then silent = 0

 check_FITS, image, im_hdr, /NOTYPE, ERRMSG = errmsg
 if ERRMSG NE ''  then begin
       message,'ERROR - ' + errmsg, /CON 
       return
 endif
 
 if N_elements(fitsfile) EQ 0 then begin
        fitsfile = ''
        read,'Enter name of output FITS ASCII table file: ', fitsfile
 endif

 find, image, x, y, flux, sharp, round, hmin, fwhm, roundlim, sharplim, $ 
                PRINT = print, SILENT = silent

 nstar = N_elements(x)
 if nstar EQ 0 then message,'No FITS table created'

 ftcreate, 80, nstar, h, tab

 name = sxpar( im_hdr, 'IMAGE', Count = N_name )
 if N_name GT 0 then sxaddpar, h, 'IMAGE',name

 sxaddpar, h, 'EXTNAME', 'IDL DAOPHOT: FIND',' Last DAOPHOT stage'
 sxaddpar, h, 'HMIN', hmin, 'Threshold Above Background'
 sxaddpar, h, 'FWHM', fwhm, 'FIND FWHM'
 sxaddpar, h, 'ROUNDLO', roundlim[0], ' Roundness Limit: Low '
 sxaddpar, h, 'ROUNDHI', roundlim[1], ' Roundness Limit: High'
 sxaddpar, h, 'SHARPLO', sharplim[0], ' Sharpness Limit: Low '
 sxaddpar, h, 'SHARPHI', sharplim[1], ' Sharpness Limit: High'

 bscale = sxpar( im_hdr, 'BSCALE', Count = N_bscale )
 if N_bscale EQ 0 then sxaddpar, h, 'BSCALE', bscale, 'Calibration Const'
 phpadu = sxpar( im_hdr, 'PHPADU', Count = N_phpadu )
 if N_phpadu EQ 0 then sxaddpar, h, 'PHPADU', phpadu, 'Photons Per ADU'

 ftaddcol, h, tab, 'STAR_ID', 4, 'I5'
 ftput, h, tab, 1, 0, lindgen(nstar)+1
 ftaddcol, h, tab, 'X', 8, 'F7.2', 'PIX'
 ftput, h, tab, 2, 0, x+1.              <span class="comments">;Position written in FORTRAN convention</span>
 ftaddcol, h, tab, 'Y', 8, 'F7.2', 'PIX'
 ftput, h, tab, 3, 0, y+1.              
 ftaddcol, h, tab, 'FLUX', 8, 'F8.1', 'ADU'
 ftput, h, tab, 4, 0, flux
 ftaddcol, h, tab, 'SHARP', 8, 'F6.3'
 ftput, h, tab, 5, 0, sharp
 ftaddcol, h, tab, 'ROUND', 8, 'F6.3'
 ftput, h, tab, 6, 0, round
 sxaddhist, 'T_FIND: ' + systime(),h

 hprimary = im_hdr                <span class="comments">;Primary FITS header</span>
 sxdelpar,hprimary,['NAXIS1','NAXIS2']
 sxaddpar,hprimary,'NAXIS',0
 sxaddpar,hprimary,'SIMPLE','T'
 sxaddpar,hprimary,'EXTEND','T',after='NAXIS'

 sxaddpar, h, 'NAXIS1', 80
 message,'Creating FITS ASCII table ' + fitsfile, /INF
 writefits, fitsfile, 0, hprimary
 writefits, fitsfile, tab,h,/append

 return
 end
</code>
    </div>
  </body>
</html>