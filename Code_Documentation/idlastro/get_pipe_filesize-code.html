<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:39 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>get_pipe_filesize.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="get_pipe_filesize.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="get_pipe_filesize:source"></a>pro get_pipe_filesize, unit, nbytes, buffer = buffer
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;       GET_PIPE_FILESIZE</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;       Determine the number of bytes in a unit opened as a pipe with SPAWN</span>
<span class="comments">;</span>
<span class="comments">; EXPLANATION:</span>
<span class="comments">;      Reads into a buffer until the end of file is reached and then counts the</span>
<span class="comments">;      number of bytes read.   Needed because the fstat.size field is not </span>
<span class="comments">;      automatically set for a unit opened as a pipe.</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;       GET_PIPE_FILESIZE,unit, nbytes_in_file, BUFFER = </span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;       unit -   IDL unit number of a previously opened file.    For example,</span>
<span class="comments">;         an FPACK  ( http://heasarc.gsfc.nasa.gov/fitsio/fpack/ ) compressed </span>
<span class="comments">;         FITS file could be opened as follows:</span>
<span class="comments">;</span>
<span class="comments">;        IDL> spawn,'funpack -S test.fits.fz', unit=unit</span>
<span class="comments">; OUTPUTS:</span>
<span class="comments">;       nbytes_in_file - Unsigned long64 integer giving number of bytes in </span>
<span class="comments">;         the file.</span>
<span class="comments">;</span>
<span class="comments">; INPUT KEYWORD PARAMETERS:</span>
<span class="comments">;       BUFFER  Integer giving number of bytes in the buffer.  Default = </span>
<span class="comments">;     .          1000000</span>
<span class="comments">; NOTES:</span>
<span class="comments">;      Unite must be opened prior to calling GET_PIPE_FILESIZE, and the number</span>
<span class="comments">;      of bytes is counted from the current pointer position.  The pointer is </span>
<span class="comments">;      left at the end of the file upon return. </span>
<span class="comments">; PROCEDURES USED:</span>
<span class="comments">;     SETDEFAULTVALUE  </span>
<span class="comments">; REVISION HISTORY:</span>
<span class="comments">;      Written, W. Landsman  Adnet   Dec 2010 </span>

 On_error,2
 compile_opt idl2

 nbytes = 0ULL
 setdefaultvalue, buffer, 1000000
 ON_IOerror,Done
 b= bytarr(buffer,/noz)

 while 1 do begin
   readu,unit,b
   nbytes += buffer
 endwhile

Done:
 On_IOError, null
 nbytes += (fstat(unit)).transfer_count
 
  return
 end
</code>
    </div>
  </body>
</html>