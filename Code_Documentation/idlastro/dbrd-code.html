<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:27 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>dbrd.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="dbrd.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="dbrd:source"></a>pro dbrd,enum,entry,available,dbno, noconvert=noconvert
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;	DBRD</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;	procedure to read an entry from a data base file or from</span>
<span class="comments">;	linked multiple databases.</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;	dbrd, enum, entry, [available, dbno, /NoConvert]</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;	enum - entry number to read, integer scalar</span>
<span class="comments">;</span>
<span class="comments">; OUTPUT:</span>
<span class="comments">;	entry - byte array containing the entry</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL OUTPUT:</span>
<span class="comments">;	available - byte array with length equal to number of data</span>
<span class="comments">;		bases opened.  available(i) eq 1 if an entry (pointed</span>
<span class="comments">;		to) is available.  It always equals 1 for the first </span>
<span class="comments">;		data base, otherwise it is an error condition.</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL  INPUT:</span>
<span class="comments">;	dbno - specification of the data base number to return.  If</span>
<span class="comments">;		supplied, only the record for the requested data base</span>
<span class="comments">;		number is returned in entry.  Normally this input should</span>
<span class="comments">;		not be supplied.  dbno is numbered for 0 to n-1 and gives</span>
<span class="comments">;		the number of the data base opened.  The data bases are </span>
<span class="comments">;		numbered in the order supplied to dbopen.  If dbno is supplied </span>
<span class="comments">;		then the entry number refers to that data base and not the</span>
<span class="comments">;		primary or first data base. If set to -1, then it means all</span>
<span class="comments">;		data bases opened (same as not supplying it)</span>
<span class="comments">; OPTIONAL INPUT KEYWORD:</span>
<span class="comments">;	noconvert - if set then don't convert external to host format.</span>
<span class="comments">;		Assumes that calling program will take care of this</span>
<span class="comments">;		requirement.</span>
<span class="comments">; OPERATIONAL NOTES:</span>
<span class="comments">;	If multiple data base files are opened, the records are</span>
<span class="comments">;	concatenated with each other</span>
<span class="comments">; HISTORY</span>
<span class="comments">;	version 2  D. Lindler  Nov. 1987</span>
<span class="comments">;	William Thompson, GSFC/CDS (ARC), 1 June 1994</span>
<span class="comments">;		Added support for external (IEEE) representation.</span>
<span class="comments">;	Version 3, Richard Schwartz, GSFC/SDAC, 23-Aug-1996</span>
<span class="comments">;			Add noconvert keyword</span>
<span class="comments">;</span>
<span class="comments">;	Converted to IDL V5.0   W. Landsman   September 1997</span>
<span class="comments">;       Version 4, 2 May 2003, W. Thompson</span>
<span class="comments">;               Use BSWAP keyword to DBXVAL instead of calling IEEE_TO_HOST.</span>
<span class="comments">;-</span>
<span class="comments">;</span>
<span class="comments">;-----------------------------------------------------------------------</span>
On_error,2

 if N_params() LT 2 then begin
     print,'Syntax - dbrd, enum, entry, [available, dbno, /NoConvert]'
     return
 endif

 COMMON db_com,qdb,qitems,qdbrec

<span class="comments">; Find out if databases are in external format.</span>
 externali= db_info('EXTERNAL')
 external = externali * (1-keyword_set(noconvert))
 if N_params() LT 4 then dbno = -1

 if dbno GE 0 then begin		<span class="comments">;get only requeseted data base entry</span>
	available = bytarr(1)+1b
    if dbno EQ 0 then begin
	entry = qdbrec[enum]
	if external[0] then db_ent2host, entry, 0
      end else begin
	len = db_info( 'LENGTH', dbno)
	unit = db_info( 'UNIT_DBF', dbno)
	p = assoc(unit,bytarr(len, /NOZERO), enum)
	entry = p[0]		<span class="comments">;read entry</span>
	if external[dbno] then db_ent2host, entry, dbno
    end
    return
 end

<span class="comments">; get info on open data bases</span>

 len = db_info( 'LENGTH' )	<span class="comments">;record lengths</span>
 units = db_info( 'UNIT_DBF' ) 	<span class="comments">;unit numbers</span>
 n = N_elements(len)		<span class="comments">;number of db's opened</span>
 entry = qdbrec[enum]		<span class="comments">;read entry for first db</span>
 if external[0] then db_ent2host, entry, 0
 irec = enum			<span class="comments">;record number</span>
 available = bytarr(n)+1B		<span class="comments">;entry available</span>

 if n GT 1 then begin
	for i = 1,n-1 do begin	<span class="comments">;loop on db's</span>
		pointer = db_info('pointer',i)		<span class="comments">;what points to it</span>
		db_item, pointer,itnum,ival,dtype,sb,nv,nb
		
		<span class="comments">;Make sure irec is in internal format!</span>
		if externali[db_item_info('dbnumber',itnum[0])] and keyword_set(noconvert) $
			 then bswap=1 else bswap=0
		irec = dbxval(entry,dtype[0],1,sb[0],nb[0],bswap=bswap)
		if irec GT 0 then begin
			p = assoc( units[i], bytarr( len[i],/NOZERO ))
			tmp = p[irec]
			if external[i] then db_ent2host, tmp, i
			entry = [ entry, tmp ]	<span class="comments">;add to end</span>
		   end else begin
			available[i] = 0B
			entry = [ entry, bytarr(len[i])]
		end
	end
 end

 return
 end
</code>
    </div>
  </body>
</html>