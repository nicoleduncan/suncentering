<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:58:11 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>valid_num.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="valid_num.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;+</span>
<span class="comments">; NAME: </span>
<span class="comments">;     VALID_NUM()</span>
<span class="comments">; PURPOSE:               </span>
<span class="comments">;     Check if a string is a valid number representation.</span>
<span class="comments">; EXPLANATION:              </span>
<span class="comments">;     The input string is parsed for characters that may possibly</span>
<span class="comments">;     form a valid number.  It is more robust than simply checking</span>
<span class="comments">;     for an IDL conversion error because that allows strings such</span>
<span class="comments">;     as '22.3qwert' to be returned as the valid number 22.3</span>
<span class="comments">;</span>
<span class="comments">;     This function had a major rewrite in August 2008 to use STREGEX</span>
<span class="comments">;     and allow vector input.    It should be backwards compatible.</span>
<span class="comments">; CALLING SEQUENCE: </span>
<span class="comments">;     IDL> status = valid_num(string  [,value]  [,/integer])</span>
<span class="comments">;    </span>
<span class="comments">; INPUTS:</span>
<span class="comments">;     string  -  the string to be tested, scalar or array</span>
<span class="comments">;               </span>
<span class="comments">; RETURNS</span>
<span class="comments">;     status - byte scalar or array, same size as the input string</span>
<span class="comments">;              set to 1 where the string is a  valid number, 0 for invalid</span>
<span class="comments">; OPTIONAL OUTPUT:               </span>
<span class="comments">;     value     - The value the string decodes to, same size as input string.</span>
<span class="comments">;           This will be returned as a double precision number unless </span>
<span class="comments">;           /INTEGER is present, in which case a long integer is returned.</span>
<span class="comments">;           </span>
<span class="comments">; OPTIONAL INPUT KEYWORD:          </span>
<span class="comments">;    /INTEGER   -  if present code checks specifically for an integer.</span>
<span class="comments">; EXAMPLES:</span>
<span class="comments">;     (1) IDL> print,valid_num(3.2,/integer) </span>
<span class="comments">;        --> 0     ;Since 3.2 is not an integer </span>
<span class="comments">;     (2) IDL> str =['-0.03','2.3g', '3.2e12']</span>
<span class="comments">;         IDL> test = valid_num(str,val)</span>
<span class="comments">;              test = [1,0,1]    &  val =  [-0.030000000 ,NaN ,3.2000000e+12]</span>
<span class="comments">; REVISION HISTORY:</span>
<span class="comments">;          Version 1, C D Pike, RAL, 24-May-93</span>
<span class="comments">;          Version 2, William Thompson, GSFC, 14 October 1994</span>
<span class="comments">;                       Added optional output parameter VALUE to allow</span>
<span class="comments">;                       VALID_NUM to replace STRNUMBER in FITS routines.</span>
<span class="comments">;          Version 3 Wayne Landsman rewrite to use STREGEX, vectorize</span>
<span class="comments">;          Version 4 W.L. (fix from C. Markwardt) Better Stregex expression, </span>
<span class="comments">;                    was missing numbers like '134.' before Jan 1 2010</span>
<span class="comments">;-            </span>

FUNCTION valid_num, string, value, INTEGER=integer
 On_error,2
 compile_opt idl2 
 
<span class="comments">; A derivation of the regular expressions below can be found on </span>
<span class="comments">; http://wiki.tcl.tk/989</span>

   if keyword_set(INTEGER) then $ 
    st = '^[-+]?[0-9][0-9]*$'  else $                    <span class="comments">;Integer</span>
     st = '^[-+]?([0-9]+\.?[0-9]*|\.[0-9]+)([eEdD][-+]?[0-9]+)?$' <span class="comments">;F.P.</span>
   
<span class="comments">;Simple return if we just need a boolean test.</span>
    if N_params() EQ 1 then return, stregex(strtrim(string,2),st,/boolean)

   
      vv = stregex(strtrim(string,2),st,/boolean)      
      if size(string,/N_dimen) EQ 0 then begin     <span class="comments">;Scalar</span>
         if vv then $
            value= keyword_set(integer) ? long(string) : double(string) 
      endif else begin                             <span class="comments">;Array </span>
         
      g = where(vv,Ng)
      if Ng GT 0 then begin      <span class="comments">;Need to create output vector</span>
        if keyword_set(integer) then begin 
              value = vv*0L 
              value[g] = long(string[g])
        endif else begin 
                value = replicate(!VALUES.D_NAN,N_elements(vv))
                value[g] = double(string[g])
        endelse 
        endif   
        endelse 
     
       return,vv
      end
</code>
    </div>
  </body>
</html>