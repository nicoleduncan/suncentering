<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:36 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>fxfindend.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="fxfindend.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source">	PRO FXFINDEND,UNIT, EXTENSION
<span class="comments">;+</span>
<span class="comments">; NAME: </span>
<span class="comments">;	FXFINDEND</span>
<span class="comments">; Purpose     : </span>
<span class="comments">;	Find the end of a FITS file.</span>
<span class="comments">; Explanation : </span>
<span class="comments">;	This routine finds the end of the last logical record in a FITS file,</span>
<span class="comments">;	which may be different from that of the physical end of the file.  Each</span>
<span class="comments">;	FITS header is read in and parsed, and the file pointer is moved to</span>
<span class="comments">;	where the next FITS extension header would be if there is one, or to</span>
<span class="comments">;	the end of the file if not.</span>
<span class="comments">; Use         : </span>
<span class="comments">;	FXFINDEND, UNIT [, EXTENSION]</span>
<span class="comments">; Inputs      : </span>
<span class="comments">;	UNIT	= Logical unit number for the opened file.</span>
<span class="comments">; Opt. Inputs : </span>
<span class="comments">;	None.</span>
<span class="comments">; Outputs     : </span>
<span class="comments">;	None.</span>
<span class="comments">; Opt. Outputs: </span>
<span class="comments">;       EXTENSION = The extension number that a new extension would</span>
<span class="comments">;                   have if placed at the end of the file.</span>
<span class="comments">; Keywords    : </span>
<span class="comments">;	None.</span>
<span class="comments">; Calls       : </span>
<span class="comments">;	FXHREAD, FXPAR</span>
<span class="comments">; Common      : </span>
<span class="comments">;	None.</span>
<span class="comments">; Restrictions: </span>
<span class="comments">;	The file must have been opened for block I/O.  There must not be any</span>
<span class="comments">;	FITS "special records" at the end of the file.</span>
<span class="comments">; Side effects: </span>
<span class="comments">;	None.</span>
<span class="comments">; Category    : </span>
<span class="comments">;	Data Handling, I/O, FITS, Generic.</span>
<span class="comments">; Prev. Hist. : </span>
<span class="comments">;	William Thompson, Feb. 1992.</span>
<span class="comments">; Written     : </span>
<span class="comments">;	William Thompson, GSFC, February 1992.</span>
<span class="comments">; Modified    : </span>
<span class="comments">;	Version 1, William Thompson, GSFC, 12 April 1993.</span>
<span class="comments">;		Incorporated into CDS library.</span>
<span class="comments">; Version     : </span>
<span class="comments">;	Version 1, 12 April 1993.</span>
<span class="comments">;	Converted to IDL V5.0   W. Landsman   September 1997</span>
<span class="comments">;       Added EXTENSION parameter, CM 1999 Nov 18</span>
<span class="comments">;       Allow for possible 64bit integer number of bytes W. Landsman Nov 2007</span>
<span class="comments">;       make Ndata a long64 to deal with large files. E. Hivon Mar 2008</span>
<span class="comments">;-</span>
<span class="comments">;</span>
	ON_ERROR,2
<span class="comments">;</span>
<span class="comments">;  Check the number of parameters.</span>
<span class="comments">;</span>
	IF N_PARAMS() EQ 0 THEN MESSAGE,'Syntax:  FXFINDEND, UNIT [,EXTENSION]'
<span class="comments">;</span>
<span class="comments">;  Go to the start of the file.</span>
<span class="comments">;</span>
	POINT_LUN,UNIT,0
        EXTENSION = 0L
<span class="comments">;</span>
<span class="comments">;  Read the next header, and get the number of bytes taken up by the data.</span>
<span class="comments">;</span>
NEXT_EXT:
	FXHREAD,UNIT,HEADER,STATUS
	IF STATUS NE 0 THEN GOTO, DONE
	BITPIX = FXPAR(HEADER,'BITPIX')
	NAXIS  = FXPAR(HEADER,'NAXIS')
	GCOUNT = FXPAR(HEADER,'GCOUNT')  &  IF GCOUNT EQ 0 THEN GCOUNT = 1
	PCOUNT = FXPAR(HEADER,'PCOUNT')
	IF NAXIS GT 0 THEN BEGIN 
		DIMS = FXPAR(HEADER,'NAXIS*')		<span class="comments">;Read dimensions</span>
		NDATA = long64(DIMS[0])
		IF NAXIS GT 1 THEN FOR I=2,NAXIS DO NDATA = NDATA*DIMS[I-1]
	ENDIF ELSE NDATA = 0
	NBYTES = LONG64(ABS(BITPIX) / 8) * GCOUNT * (PCOUNT + NDATA)
<span class="comments">;</span>
<span class="comments">;  Move to the next extension header in the file.</span>
<span class="comments">;</span>
	NREC = (NBYTES + 2879) / 2880
	POINT_LUN, -UNIT, POINTLUN			<span class="comments">;Current position</span>
	POINT_LUN, UNIT, POINTLUN + NREC*2880L		<span class="comments">;Next FITS extension</span>
        EXTENSION = EXTENSION + 1L
	IF NOT EOF(UNIT) THEN GOTO, NEXT_EXT
<span class="comments">;</span>
<span class="comments">;  When done, make sure that the pointer is positioned at the first byte after</span>
<span class="comments">;  the last data set.</span>
<span class="comments">;</span>
DONE:
	POINT_LUN, UNIT, POINTLUN + NREC*2880L
	RETURN
	END
</code>
    </div>
  </body>
</html>