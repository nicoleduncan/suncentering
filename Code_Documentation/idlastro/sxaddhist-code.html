<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:58:03 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>sxaddhist.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="sxaddhist.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="sxaddhist:source"></a>pro sxaddhist,history,header,blank = blank,comment= comment, location=key, $
                            pdu=pdu
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;       SXADDHIST                           </span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;       Procedure to add HISTORY (or COMMENT) line(s) to a FITS header</span>
<span class="comments">;</span>
<span class="comments">; EXPLANATION:</span>
<span class="comments">;       The advantage of using SXADDHIST instead of SXADDPAR is that with </span>
<span class="comments">;       SXADDHIST many HISTORY or COMMENT records can be added in a single call.</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE</span>
<span class="comments">;       sxaddhist, history, header, [ /PDU, /COMMENT ]</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;        history - string or string array containing history or comment line(s)</span>
<span class="comments">;               to add to the FITS header</span>
<span class="comments">; INPUT/OUTPUT</span>
<span class="comments">;       header - FITS header (string array).   Upon output, it will contain the</span>
<span class="comments">;               specified HISTORY records added to the end</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL KEYWORD INPUTS:</span>
<span class="comments">;       /BLANK - If specified then blank ('       ') keywords will be written</span>
<span class="comments">;              rather than 'HISTORY ' keywords.</span>
<span class="comments">;       /COMMENT - If specified, then 'COMMENT ' keyword will be written rather</span>
<span class="comments">;              than 'HISTORY ' keywords.    </span>
<span class="comments">;              Note that according to the FITS definition, any number of </span>
<span class="comments">;              'COMMENT' and 'HISTORY' or blank keywords may appear in a header,</span>
<span class="comments">;              whereas all other keywords may appear only once.   </span>
<span class="comments">;       LOCATION=key - If present, the history will be added before this</span>
<span class="comments">;              keyword.  Otherwise put it at the end.</span>
<span class="comments">;       /PDU - if specified, the history will be added to the primary</span>
<span class="comments">;              data unit header, (before the line beginning BEGIN EXTENSION...)               </span>
<span class="comments">;              Otherwise, it will be added to the end of the header.</span>
<span class="comments">;              This has meaning only for extension headers using the STScI</span>
<span class="comments">;              inheritance convention. </span>
<span class="comments">; OUTPUTS:</span>
<span class="comments">;       header - updated FITS header</span>
<span class="comments">;</span>
<span class="comments">; EXAMPLES:</span>
<span class="comments">;       sxaddhist, 'I DID THIS', header      ;Add one history record</span>
<span class="comments">;</span>
<span class="comments">;       hist = strarr(3)</span>
<span class="comments">;       hist[0] = 'history line number 1'</span>
<span class="comments">;       hist[1[ = 'the next history line'</span>
<span class="comments">;       hist[2] = 'the last history line'</span>
<span class="comments">;       sxaddhist, hist, header              ;Add three history records</span>
<span class="comments">;</span>
<span class="comments">; SIDE EFFECTS:</span>
<span class="comments">;       Header array is truncated to the final END statement</span>
<span class="comments">;       LOCATION overrides PDU.</span>
<span class="comments">; HISTORY:</span>
<span class="comments">;       D. Lindler  Feb. 87</span>
<span class="comments">;       April 90  Converted to new idl  D. Lindler</span>
<span class="comments">;       Put only a single space after HISTORY   W. Landsman  November 1992</span>
<span class="comments">;       Aug. 95   Added PDU keyword parameters</span>
<span class="comments">;       LOCATION added.  M. Greason, 28 September 2004.</span>
<span class="comments">;       Missing minus sign (1 -> -1) in testing for WHERE output when </span>
<span class="comments">;        looking for location to insert a comment  M. Haffner Oct 2012</span>
<span class="comments">;-</span>
<span class="comments">;--------------------------------------------------------------------</span>
        On_error,2

        if N_params() LT 2 then begin
           print, ' Syntax - SXADDHIST, hist, header, '
           print,  '       /PDU, /BLANK, /COMMENT, LOCATION= ] '
           return
        endif

<span class="comments">; Check input parameters</span>

        if (n_elements(key) LE 0) then keynam = ''                      $
                                  else keynam = strupcase(strtrim(key, 2))

        s = size(history) & ndim = s[0] & type = s[ndim+1]
        if type NE 7 then message, $
            'Invalid history lines specified; must be a string or string array'
 
        if keyword_set(COMMENT) then keyword = 'COMMENT ' else $
        if keyword_set(BLANK) then keyword = ' ' else $
                                   keyword = 'HISTORY '
        nadd = N_elements(history)            <span class="comments">;Number of lines to add</span>

        s = size(header) & ndim2 = s[0] & type = s[ndim2+1]
        if (ndim2 NE 1) || (type NE 7) then message, $
                'Invalid FITS header supplied; header must be a string array'

        nlines = N_elements(header)           <span class="comments">;Number of lines in header</span>

<span class="comments">; Find END statement of FITS header</span>
        
        endline = where( strtrim(strmid(header,0,8),2) EQ 'END' )
        n = endline[0]
        if n LT 0 then message, $
                    'Invalid FITS header array, END keyword not found'

        blank = string( replicate(32b,80) )
        n1 = n          <span class="comments">;position to insert</span>
<span class="comments">;</span>
<span class="comments">; if LOCATION was specified and found, make room before it.</span>
<span class="comments">;</span>
        locfnd = 0
        if (strlen(keynam) gt 0) then begin
            extline = where( strupcase(strtrim(strmid(header,0,8),2)) EQ keynam )
            n_ext = extline[0]
            if (n_ext gt -1) then begin
                n1 = n_ext
                locfnd = 1
            endif
        endif
<span class="comments">;</span>
<span class="comments">; if /PDU find beginning of the extension header and make room for the</span>
<span class="comments">; history</span>
<span class="comments">;</span>
        if (keyword_set(PDU) && (locfnd EQ 0)) then begin
            extline = where( strupcase(strtrim(strmid(header,0,8),2)) EQ 'BEGIN EX' )
            n_ext = extline[0]
            if n_ext gt 1 then n1 = n_ext
        end
<span class="comments">;</span>
<span class="comments">; make room in the header</span>
<span class="comments">;</span>
        if n1 eq 0 then header = [replicate(blank,nadd),header[n1:n]] else $
                header = [header[0:n1-1],replicate(blank,nadd),header[n1:n]]

<span class="comments">; Add history records to header starting at position N1</span>

        for i = 0, nadd-1 do begin
        
                newline = blank
                strput, newline, keyword + history[i]
                header[n1+i] = newline

        endfor
 return
 end
</code>
    </div>
  </body>
</html>