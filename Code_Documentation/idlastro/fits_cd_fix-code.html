<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:30 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>fits_cd_fix.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="fits_cd_fix.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="fits_cd_fix:source"></a>pro fits_cd_fix,hdr, REVERSE = reverse
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;    FITS_CD_FIX</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;    Update obsolete representations of the CD matrix in a FITS header   </span>
<span class="comments">;</span>
<span class="comments">; EXPLANATION:</span>
<span class="comments">;    According the paper, "Representations of Celestial Coordinates in FITS"</span>
<span class="comments">;    by Calabretta & Greisen (2002, A&A, 395, 1077, available at </span>
<span class="comments">;    http://fits.gsfc.nasa.gov/fits_wcs.html) the rotation of an image from </span>
<span class="comments">;    standard coordinates is represented by a coordinate description (CD) </span>
<span class="comments">;    matrix.    The standard representation of the CD matrix are PCn_m </span>
<span class="comments">;    keywords, but CDn_m keywords (which include the scale factors) are</span>
<span class="comments">;    also allowed.    However, earliers drafts of the standard allowed the</span>
<span class="comments">;    keywords forms CD00n00m and PC00n00m.      This procedure will convert</span>
<span class="comments">;    FITS CD matrix keywords containing zeros into the standard forms </span>
<span class="comments">;    CDn_m and PCn_m containing only underscores.</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;    FITS_CD_FIX, Hdr</span>
<span class="comments">;</span>
<span class="comments">; INPUT-OUTPUT: </span>
<span class="comments">;       HDR - FITS header, 80 x N string array.   If the header does not</span>
<span class="comments">;           contain 'CD00n00m' or 'PC00n00m' keywords then it is left </span>
<span class="comments">;           unmodified.  Otherwise, the keywords containing integers are</span>
<span class="comments">;           replaced with those containing underscores.</span>
<span class="comments">;   </span>
<span class="comments">; OPTIONAL KEYWORD INPUT</span>
<span class="comments">;      /REVERSE - this keyword does nothing, but is kept for compatibility with</span>
<span class="comments">;            earlier versions.</span>
<span class="comments">; PROCEDURES USED:</span>
<span class="comments">;    SXADDPAR, SXDELPAR, SXPAR()</span>
<span class="comments">; REVISION HISTORY:</span>
<span class="comments">;    Written   W. Landsman             Feb 1990</span>
<span class="comments">;    Major rewrite                     Feb 1994</span>
<span class="comments">;    Converted to IDL V5.0   W. Landsman   September 1997</span>
<span class="comments">;    Use double precision formatting of CD matrix   W. Landsman  April 2000</span>
<span class="comments">;    Major rewrite to convert only to forms recognized by the Greisen</span>
<span class="comments">;       & Calabretta standard   W. Landsman   July 2003</span>
<span class="comments">;-</span>
 On_error,2
 compile_opt idl2

 if N_params() LT 1 then begin
        print,'Syntax - FITS_CD_FIX, hdr'
        return
 endif

 cd00 = ['CD001001','CD001002','CD002001','CD002002']
 pc00 = ['PC001001','PC001002','PC002001','PC002002']

  cd_ = ['CD1_1','CD1_2','CD2_1','CD2_2']
  pc_ = ['PC1_1','PC1_2','PC2_1','PC2_2']
 

 for i= 0 ,3 do begin
   pc = sxpar(hdr,pc00[i], COUNT = N)
   if N GE 1 then begin
        sxaddpar,hdr,pc_[i],pc,'',pc00[i]
        sxdelpar,hdr,pc00[i]
        if i EQ 0 then sxaddhist,'FITS_CD_FIX:' + strmid(systime(),4,20) + $
                  ' PC00n00m keywords changed to PCn_m',hdr
 endif  else begin
      
    cd = sxpar(hdr,cd00[i], COUNT = N )
    if N GE 1 then begin
        sxaddpar,hdr,cd_[i],cd,'',cd00[i]
        sxdelpar,hdr,cd00[i]
        if i EQ 0 then sxaddhist,'FITS_CD_FIX:' + strmid(systime(),4,20) + $
                  ' CD00n00m keywords changed to CDn_m',hdr
 endif
 endelse 
 endfor

 
 return
 end
                                
</code>
    </div>
  </body>
</html>