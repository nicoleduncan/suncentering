<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:21 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>cons_dec.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="cons_dec.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source">FUNCTION CONS_DEC,DEC,X,ASTR,ALPHA        <span class="comments">;Find line of constant Dec</span>
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;       CONS_DEC</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;       Obtain the X and Y coordinates of a line of constant declination</span>
<span class="comments">; EXPLANATION:</span>
<span class="comments">;       Returns a set of Y pixels values, given an image with astrometry, and </span>
<span class="comments">;            either</span>
<span class="comments">;       (1)  A set of X pixel values, and a scalar declination value, or</span>
<span class="comments">;       (2)  A set of declination values, and a scalar X value</span>
<span class="comments">;</span>
<span class="comments">;       Form (1) can be used to find the (X,Y) values of a line of constant</span>
<span class="comments">;       declination.  Form (2) can be used to find the Y positions of a set</span>
<span class="comments">;       declinations, along a line of constant X.</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;       Y = CONS_DEC( DEC, X, ASTR, [ ALPHA ])</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;       DEC - Declination value(s) in DEGREES (-!PI/2 &lt; DEC &lt; !PI/2).  </span>
<span class="comments">;               If X is a vector, then DEC must be a scalar.</span>
<span class="comments">;       X -   Specified X pixel value(s) for line of constant declination </span>
<span class="comments">;               If DEC is a vector, then X must be a scalar.</span>
<span class="comments">;       ASTR - Astrometry structure, as extracted from a FITS header by the</span>
<span class="comments">;               procedure EXTAST</span>
<span class="comments">; OUTPUT:</span>
<span class="comments">;       Y   - Computed set of Y pixel values.  The number of Y values is the</span>
<span class="comments">;               same as either DEC or X, whichever is greater.</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL OUTPUT:</span>
<span class="comments">;       ALPHA - the right ascensions (DEGREES) associated with the (X,Y) points</span>
<span class="comments">;</span>
<span class="comments">; RESTRICTIONS:</span>
<span class="comments">;       Implemented only for the TANgent, SIN and CAR projections</span>
<span class="comments">;</span>
<span class="comments">; NOTES:</span>
<span class="comments">;       The algorithm (and notation) is based on AIPS Memo 27 by Eric Greisen,</span>
<span class="comments">;       with modifications for a coordinate description (CD) matrix as </span>
<span class="comments">;       described in Paper II of Greisen & Calabretta (2002, A&A, 395, 1077).</span>
<span class="comments">;       These documents are available from </span>
<span class="comments">;       http://www.cv.nrao.edu/fits/documents/wcs/wcs.html</span>
<span class="comments">;</span>
<span class="comments">; REVISION HISTORY:</span>
<span class="comments">;       Written, Wayne Landsman  STX Co.                          April 1988</span>
<span class="comments">;       Use new astrometry structure,     W. Landsman    HSTX     Jan. 1994</span>
<span class="comments">;       Use CD matrix, add SIN projection   W. Landsman  HSTX     April, 1996</span>
<span class="comments">;       Converted to IDL V5.0   W. Landsman   September 1997</span>
<span class="comments">;       Fix case where DEC is scalar, X is vector   W. Landsman RITSS Feb. 2000</span>
<span class="comments">;       Fix possible sign error introduced Jan. 2000   W. Landsman  May 2000</span>
<span class="comments">;       Work for the CARee' projection W. Landsman   May 2003</span>
<span class="comments">;-</span>
  On_error,2

  if N_params() lt 3 then begin
        print,'Syntax - Y = CONS_DEC( DEC, X, ASTR, [ALPHA] )'
        return, 0
  endif

  RADEG = 180.0D/!DPI
 
  n = N_elements(x)
  Ndec = N_elements(dec)
  crpix = astr.crpix -1.
  crval = astr.crval/RADEG
  cd =  astr.cd/RADEG
  cdelt = astr.cdelt

  A = -cd[0,0]*cdelt[0] 
  B = -cd[0,1]*cdelt[0] 
  C =  cd[1,0]*cdelt[1]
  D =  cd[1,1]*cdelt[1] 

  xx = x - crpix[0]          <span class="comments">;New coordinate origin</span>
  sdel0 = sin(crval[1]) & cdel0 = cos(crval[1])

  ctype = strupcase( strmid(astr.ctype[0], 5,3))
  case ctype of 

'TAN': begin
  aa = d
  bb = (b*c-d*a)*xx*cdel0 + sdel0*b
  sign = 2*( aa GT 0 ) - 1 
  alpha = crval[0] + atan(bb/aa) + $ 
      sign * asin( tan(dec/RADEG)* ( (B*C-D*A)*xx*sdel0 - B*cdel0)/ $
        sqrt(aa^2+bb^2))
  end

'SIN': begin

  aa = d
  bb = b*sdel0
  sign = 2*( aa GT 0 ) - 1 

  denom =  cos(dec/RADEG)*sqrt(aa^2+bb^2)
  alpha = crval[0] + atan(bb/aa) + $ 
     sign * asin( ( (b*c-a*d)*xx - sin(dec/RADEG)*cdel0*b ) / denom )
  end

'CAR': begin
  alpha = crval[0] + (b*c -a*d)*xx   
  if (N_elements(alpha) EQ 1) and (Ndec GT 1) then $
        alpha = replicate(alpha[0],Ndec)
end

ELSE: message,'ERROR - Program only works for TAN, SIN and CAR projections'
  endcase

   alpha = alpha * RADEG

   if (N_elements(dec) EQ 1) and (n GT 1) then $
   ad2xy, alpha, replicate(dec, n) , astr, x1, y else $
   ad2xy, alpha, dec, astr, x1, y

  return,y
  end
</code>
    </div>
  </body>
</html>