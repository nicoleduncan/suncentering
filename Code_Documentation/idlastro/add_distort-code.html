<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:18 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>add_distort.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="add_distort.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="add_distort:source"></a> pro add_distort, hdr, astr
<span class="comments">; NAME:</span>
<span class="comments">;    ADD_DISTORT</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;    Add the distortion parameters in an astrometry structure to a FITS header.</span>
<span class="comments">; EXPLANATION:</span>
<span class="comments">;    Called by PUTAST to add SIP (http://fits.gsfc.nasa.gov/registry/sip.html ) </span>
<span class="comments">;    in an astrometry structure to a FITS header</span>
<span class="comments">;     </span>
<span class="comments">;    Prior to April 2012, PUTAST did not add distortion parameters so one</span>
<span class="comments">;    had to call ADD_DISTORT after PUTAST. </span>
<span class="comments">;</span>
<span class="comments">;    IDL> putast,h ,astr0</span>
<span class="comments">;    IDL> add_distort,h,astr0</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;     add_distort, hdr, astr    </span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;     HDR -  FITS header, string array.   HDR will be updated to contain</span>
<span class="comments">;             the supplied astrometry.</span>
<span class="comments">;     ASTR - IDL structure containing values of the astrometry parameters</span>
<span class="comments">;            CDELT, CRPIX, CRVAL, CTYPE, LONGPOLE, PV2, and DISTORT</span>
<span class="comments">;            See EXTAST.PRO for more info about the structure definition</span>
<span class="comments">;</span>
<span class="comments">; PROCEDURES USED:</span>
<span class="comments">;       SXADDPAR, TAG_EXIST()</span>
<span class="comments">; REVISION HISTORY:</span>
<span class="comments">;       Written by W. Landsman  May 2005</span>
<span class="comments">;       Enforce i+j = n for ij coefficients of order n  W. Landsman April 2012</span>
<span class="comments">;-</span>
 npar = N_params()

 if ( npar LT 2 ) then begin    <span class="comments">;Was header supplied?</span>
        print,'Syntax: ADD_DISTORT, Hdr, astr'
        return
 endif

  add_distort = tag_exist(astr,'distort')
 
 if add_distort then begin
   sxaddpar,hdr,'CTYPE1','RA---TAN-SIP' 
   sxaddpar,hdr,'CTYPE2','DEC--TAN-SIP' 
    distort = astr.distort
     a_dimen = size(distort.a,/dimen) 
     b_dimen = size(distort.b,/dimen)
     ap_dimen = size(distort.ap,/dimen) 
     bp_dimen = size(distort.bp,/dimen)

  if a_dimen[0] GT 0 then begin
        a_order = a_dimen[0]-1 
        sxaddpar, hdr, 'A_ORDER', a_order, /savec, $
                  'polynomial order, axis 1, detector to sky '
        for i=0, a_order do begin
            for j = 0, a_order-i do begin
             aij = distort.a[i,j]
	     if aij NE 0.0 then $
                sxaddpar, hdr, 'A_' + strtrim(i,2)+ '_' + strtrim(j,2), aij, $
                ' distortion coefficient', /savec
             endfor
         endfor
  endif

  if b_dimen[0] GT 0 then begin
        b_order = b_dimen[0]-1 
        sxaddpar, hdr, 'B_ORDER', a_order, /savec , $
                  'polynomial order, axis 2, detector to sky'
        for i=0, b_order do begin
            for j = 0, b_order-i do begin
             bij = distort.b[i,j]
	     if bij NE 0.0 then $
                sxaddpar, hdr, 'B_' + strtrim(i,2)+ '_' + strtrim(j,2), bij, $
                ' distortion coefficient', /savec
             endfor
         endfor
  endif

  if ap_dimen[0] GT 0 then begin
        ap_order = ap_dimen[0]-1 
        sxaddpar, hdr, 'AP_ORDER', a_order, /savec, $
                  ' polynomial order, axis 1, sky to detector '
        for i=0, ap_order do begin
            for j = 0, ap_order-i do begin
             apij = distort.ap[i,j]
	     if apij NE 0.0 then $
                sxaddpar, hdr, 'AP_' + strtrim(i,2)+ '_' + strtrim(j,2), apij, $
                ' distortion coefficient', /savec
             endfor
         endfor
  endif


  if bp_dimen[0] GT 0 then begin
        bp_order = bp_dimen[0]-1 
        sxaddpar, hdr, 'BP_ORDER', a_order, /savec, $
                  ' polynomial order, axis 2, sky to detector '
        for i=0, bp_order do begin
            for j = 0, bp_order-i do begin
             bpij = distort.bp[i,j]
	     if bpij NE 0.0 then $
                sxaddpar, hdr, 'BP_' + strtrim(i,2)+ '_' + strtrim(j,2), bpij, $
                ' distortion coefficient', /savec
             endfor
         endfor
  endif

 endif

 return
 end
</code>
    </div>
  </body>
</html>