<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:40 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>group.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="group.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source">PRO GROUP, X, Y, RCRIT, NGROUP
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;      GROUP</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;      Assign stars with non-overlapping PSF profiles into distinct groups</span>
<span class="comments">; EXPLANATION:</span>
<span class="comments">;      Part of the IDL-DAOPHOT sequence</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;      GROUP, X, Y, RCRIT, NGROUP</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;      X - vector, giving X coordinates of a set of stars.</span>
<span class="comments">;      Y - vector, giving Y coordinates of a set of stars.</span>
<span class="comments">;           If X and Y are input as integers, then they will be converted to </span>
<span class="comments">;           floating point</span>
<span class="comments">;      RCRIT - scalar, giving minimum distance between stars of two</span>
<span class="comments">;               distinct groups.  Stars less than this distance from</span>
<span class="comments">;               each other are always in the same group.    Stetson suggests</span>
<span class="comments">;               setting the critical distance equal to the PSF radius +</span>
<span class="comments">;               the Fitting radius.</span>
<span class="comments">;</span>
<span class="comments">; OUTPUTS:</span>
<span class="comments">;      NGROUP - integer vector, same number of elements as X and Y,</span>
<span class="comments">;               giving a group number for each star position.  Group</span>
<span class="comments">;               numbering begins with 0.</span>
<span class="comments">;</span>
<span class="comments">; METHOD:</span>
<span class="comments">;      Each position is initially given a unique group number.  The distance</span>
<span class="comments">;      of each star is computed against every other star.   Those distances</span>
<span class="comments">;      less than RCRIT are assigned the minimum group number of the set.   A</span>
<span class="comments">;      check is then made to see if any groups have merged together.</span>
<span class="comments">;</span>
<span class="comments">; PROCEDURES USED:</span>
<span class="comments">;      REM_DUP()</span>
<span class="comments">;</span>
<span class="comments">; REVISION HISTORY:</span>
<span class="comments">;      Written W. Landsman  STX                  April, 1988</span>
<span class="comments">;      Major revision to properly merge groups together  W. Landsman   Sep 1991</span>
<span class="comments">;      Work for more than 32767 points    W. Landsman  March 1997</span>
<span class="comments">;      Converted to IDL V5.0   W. Landsman   September 1997</span>
<span class="comments">;      Avoid overflow if X and Y are integers      W. Landsman  Feb. 1999   </span>
<span class="comments">;-</span>
 On_error,2                                   <span class="comments">;Return to caller</span>

 if N_params() LT 4 then begin
    print,'Syntax - group, x, y, rcrit, ngroup'
    print,'   x,y -   Input position vectors'
    print,'   rcrit - Minimum radius between stars of different groups'
    print,'   ngroup - Output vector of group indices'
    return
 endif

 rcrit2 = rcrit^2                            <span class="comments">;Don't bother taking square roots</span>
 npts = min( [N_elements(x), N_elements(y)] )    <span class="comments">;Number of stars</span>

 if npts LT 2 then message, $
    'ERROR - Input position X,Y vectors must contain at least 2 points'

 x = 1.0*x  &  y = 1.0*y   <span class="comments">;Make sure at least floating point</span>
 ngroup =  lindgen(npts)   <span class="comments">;Initially each star in a separate group</span>

<span class="comments">;  Whenever the positions between two stars are less than the critical</span>
<span class="comments">;  distance, assign both stars the minimum group id.   The tricky part</span>
<span class="comments">;  is to recognize when distinct groups have merged together.</span>

 for i = 0l,npts-2 do begin
      dis2 = (x[i] - x[i+1:*])^2 + (y[i] - y[i+1:*])^2
      good =  where( dis2 LE rcrit2, ngood)
      if ngood GT 0 then begin             <span class="comments">;Any stars within critical radius?</span>

                good = [i,good+i+1]
                groupval = ngroup[good]
                mingroup = min( groupval )
                    if ( mingroup LT i ) then begin      <span class="comments">;Any groups merge?</span>
                       groupval = groupval[ where( groupval LT i, nval) ]
                       if nval GT 1 then $
                         groupval = groupval[ rem_dup(groupval) ]
                         nval = N_elements(groupval)

                           if nval GE 2 then for j= 1, nval-1 do begin  
                             redo = where ( ngroup EQ groupval[j], ndo )
                             if ndo GT 0 then ngroup[redo] = mingroup
                           endfor

                    endif
                ngroup[good] = mingroup
      endif
endfor
<span class="comments">;</span>
<span class="comments">; Star are now placed in distinct groups, but they are not ordered</span>
<span class="comments">; consecutively.  Remove gaps in group ordering</span>
<span class="comments">;</span>
 if max(ngroup) EQ 0 then return               <span class="comments">;All stars in one group ?</span>

 ghist = histogram(ngroup,min=0)
 gmax = max(ghist)
 val = where(ghist GE 1, ngood)  
 if ( ngood GT 0 ) then $ 
          for i = 0, ngood-1 do ngroup[ where( ngroup EQ val[i] ) ] = i

 message,'Number of Groups: '+ strtrim(ngood,2), /INF 
 message,'Largest group size '+ strtrim(gmax,2) + ' stars',/INF

 return
 end
</code>
    </div>
  </body>
</html>