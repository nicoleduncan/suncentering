<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:44 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>jplephtest.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="jplephtest.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;   JPLEPHTEST</span>
<span class="comments">;</span>
<span class="comments">; AUTHOR:</span>
<span class="comments">;   Craig B. Markwardt, NASA/GSFC Code 662, Greenbelt, MD 20770</span>
<span class="comments">;   craigm@lheamail.gsfc.nasa.gov</span>
<span class="comments">;   UPDATED VERSIONs can be found on my WEB PAGE: </span>
<span class="comments">;      http://cow.physics.wisc.edu/~craigm/idl/idl.html</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;   Test JPLEPHTEST with JPL test data set</span>
<span class="comments">;</span>
<span class="comments">; MAJOR TOPICS:</span>
<span class="comments">;   Planetary Orbits, Interpolation</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;   JPLEPHTEST, EPHFILE, TESTFILE</span>
<span class="comments">;</span>
<span class="comments">; DESCRIPTION:</span>
<span class="comments">;</span>
<span class="comments">;   JPLEPHTEST tests the JPLEPHINTERP procedure for precision.  In</span>
<span class="comments">;   order to function, you must have a JPL ephemeris test data set.</span>
<span class="comments">;   The test data set testpo.405 is available in </span>
<span class="comments">;   ftp://idlastro.gsfc.nasa.gov/pub/data</span>
<span class="comments">;</span>
<span class="comments">;   The procedure opens and reads the test set, which contains</span>
<span class="comments">;   precomputed data.  Every tenth value is printed on the screen.</span>
<span class="comments">;   Any deviations that exceed 1.5d-13 AU = 1.5 cm are reported.</span>
<span class="comments">;</span>
<span class="comments">;   The columns are labelled according to the input file, except for</span>
<span class="comments">;   the final column, which is the deviation between the input file</span>
<span class="comments">;   and the computed value.</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; PARAMETERS: </span>
<span class="comments">;</span>
<span class="comments">;   EPHFILE - a scalar string, specifies the name of the ephemeris</span>
<span class="comments">;             file, in FITS format.    JPLEPHTEST will look in the directory</span>
<span class="comments">;             $ASTRO_DATA for the file if it is not in the current directory.</span>
<span class="comments">;</span>
<span class="comments">;   TESTFILE - a scalar string, specifies JPL test data set to compare</span>
<span class="comments">;              against.   JPLEPHTEST will look in the directory</span>
<span class="comments">;             $ASTRO_DATA for the file if it is not in the current directory.</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; EXAMPLE:</span>
<span class="comments">;</span>
<span class="comments">;   Test JPL DE200 and DE405 ephemerides.  Assumes files are in the</span>
<span class="comments">;   current directory.</span>
<span class="comments">;</span>
<span class="comments">;   JPLEPHTEST, 'JPLEPH.200', 'testpo.200'</span>
<span class="comments">;   JPLEPHTEST, 'JPLEPH.405', 'testpo.405'</span>
<span class="comments">;     </span>
<span class="comments">;</span>
<span class="comments">; REFERENCES:</span>
<span class="comments">;</span>
<span class="comments">;   JPL Export Ephemeris FTP Site</span>
<span class="comments">;      ftp://ssd.jpl.nasa.gov/pub/eph/planets/</span>
<span class="comments">;      (see test-data/ for test data sets)</span>
<span class="comments">;   </span>
<span class="comments">;   HORIZONS, JPL Web-based ephermis calculator (Ephemeris DE406)</span>
<span class="comments">;      http://ssd.jpl.nasa.gov/horizons.html</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; SEE ALSO</span>
<span class="comments">;   JPLEPHREAD, JPLEPHINTERP, JPLEPHTEST</span>
<span class="comments">;   </span>
<span class="comments">; MODIFICATION HISTORY:</span>
<span class="comments">;   Written and Documented, CM, Jun 2001</span>
<span class="comments">;   Removed TRANSREAD, improved output, improved docs, CM, 9 Jul 2001</span>
<span class="comments">;</span>
<span class="comments">;  $Id: jplephtest.pro,v 1.4 2001/07/20 13:29:53 craigm Exp $</span>
<span class="comments">;</span>
<span class="comments">;-</span>
<span class="comments">; Copyright (C) 2001, Craig Markwardt</span>
<span class="comments">; This software is provided as is without any warranty whatsoever.</span>
<span class="comments">; Permission to use, copy and distribute unmodified copies for</span>
<span class="comments">; non-commercial purposes, and to modify and use for personal or</span>
<span class="comments">; internal use, is granted.  All other rights are reserved.</span>
<span class="comments">;-</span>

<a id="jplephtest:source"></a>pro jplephtest, ephfile, testfile, pause=pause

  if n_params() EQ 0 then begin
      message, 'USAGE: JPLEPHTEST, EPHFILE, TESTFILE', /info
      return
  endif

  testdata = find_with_def( testfile, 'ASTRO_DATA')
  openr, unit, testdata, /get_lun, error=err
  if err NE 0 then begin
      message, 'ERROR: could not open '+testdata
      return
  endif

  <span class="comments">;; Read header of file, up to and including the EOT line</span>
  repeat begin
      line = ''
      readf, unit, line
  endrep until strupcase(strmid(line,0,3)) EQ 'EOT'

  <span class="comments">;; Read at least 20000 lines from file</span>
  data = replicate({denum:0L, caldate: '', jd: 0D, targ: 0L, $
                    cent: 0L, coord: 0L, value: 0D}, 20000)
  on_ioerror, DONE
  readf, unit, data, format='(I5,A10,D0,I0,I0,I0,D0)'
  DONE:
  rc = floor((fstat(unit)).transfer_count/7)
  on_ioerror, NULL
  free_lun, unit

  if rc LT 10 then begin
      message, 'ERROR: could not read input data'
  endif

  <span class="comments">;; Cull the data out of the structure</span>
  data = data[0:rc-1]
  denum = data.denum & caldate = data.caldate & jd = data.jd 
  targ = data.targ & cent = data.cent & coord = data.coord
  value = data.value
  data = 0
      
  bad = cent*0

  ephdata = find_with_def(ephfile, 'ASTRO_DATA')
  jplephread, ephdata, pinfo, pdata, status=st, errmsg=errmsg
  if st EQ 0 then begin
      message, errmsg
  endif
  if denum[0] NE pinfo.denum then begin
      message, 'ERROR: test file and ephemeris are not of same version'
  endif

  wh = where(jd GE pinfo.tstart AND jd LE pinfo.tstop, totct)
  if totct EQ 0 then begin
      message, 'ERROR: test file and ephemeris do not overlap'
  endif

  j = 0L
  for i = 0L, totct-1 do begin

      if coord[wh[i]] GE 4 then vel = 1 else vel = 0
      if targ[wh[i]] GE 14 then vel = 1  <span class="comments">;; Always for nut. & libr.</span>
      jplephinterp, pinfo, pdata, jd[wh[i]], x, y, z, vx, vy, vz, $
        objectname=targ[wh[i]], center=cent[wh[i]], $
        posunits='AU', velunits='AU/DAY', velocity=vel

      case coord[wh[i]] of 
          1: newval = x
          2: newval = y
          3: newval = z
          4: newval = vx
          5: newval = vy
          6: newval = vz
          else: message, 'ERROR: coordinate '+coord[wh[i]]+' does not exist'
      endcase

      <span class="comments">;; Nutations are handled differently than PLEPH</span>
      if targ[wh[i]] EQ 14 AND coord[wh[i]] GT 2 then begin
          if coord[wh[i]] EQ 3 then newval = vx $
          else                      newval = vy
      endif

      del = abs(newval - value[wh[i]])
      if targ[wh[i]] EQ 15 AND coord[wh[i]] EQ 3 then $
        del = del/(0.23d0*(jd[wh[i]]-2451545.d0))
      if del GE 1.5d-13 OR (i MOD 10) EQ 0 then begin
          if del GE 1.5d-13 then begin
              print, '****** WARNING: Large difference ******'
              bad[wh[i]] = 1
          endif
          if j GT 300 then j = 0L
          if j EQ 0 then $
            print, 'REC#', 'Jul. Day', 'Targ', 'Cent', 'Coor', $
            'Value', 'Deviation', format='(A6,A10,3(A5),1(A20),A22)'
          print, i+1, jd[wh[i]], targ[wh[i]], cent[wh[i]], coord[wh[i]], $
            value[wh[i]], del, $
            format='(I6,D10.1,3(I5),1(D20.13),E22.13)'
      endif

      j = j + 1
  endfor

  if keyword_set(pause) AND total(bad) NE 0 then stop
  wh = where(bad, ct)
  print, ''
  print, '***********************************'
  print, ' Time Range (Julian Days): ', minmax(jd)
  print, ' Number of Records: ', totct
  print, ' Erroneous Records: ', ct

end

</code>
    </div>
  </body>
</html>