<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:32 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>ftab_delrow.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="ftab_delrow.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="ftab_delrow:source"></a>pro ftab_delrow,filename,rows,EXTEN_NO=exten_no, NEWFILE = newfile                      
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;       FTAB_DELROW</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;       Delete rows of data from a FITS ASCII or binary table extension</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;       ftab_delrow, filename, rows, EXTEN_NO =, NEWFILE = ] </span>
<span class="comments">;</span>
<span class="comments">; INPUTS-OUPUTS</span>
<span class="comments">;       filename - scalar string giving name of the FITS file containing an</span>
<span class="comments">;               ASCII or binary table extension. </span>
<span class="comments">; </span>
<span class="comments">;       rows  -  scalar or vector, specifying the row numbers to delete</span>
<span class="comments">;               First row has index 0.   If a vector, it will be sorted and</span>
<span class="comments">;               duplicates will be removed</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL KEYWORD INPUTS:</span>
<span class="comments">;       EXTEN_NO - scalar integer specifying which extension number to process</span>
<span class="comments">;               Default is to process the first extension</span>
<span class="comments">;       NEWFILE - scalar string specifying the name of the new output FITS file</span>
<span class="comments">;               FTAB_DELROW will prompt for this parameter if not supplied</span>
<span class="comments">;</span>
<span class="comments">; EXAMPLE:</span>
<span class="comments">;       Compress the first extension of a FITS file 'test.fits' to include </span>
<span class="comments">;       only non-negative values in the 'FLUX' column</span>
<span class="comments">;</span>
<span class="comments">;       ftab_ext,'test.fits','flux',flux       ;Obtain original flux vector</span>
<span class="comments">;       bad = where(flux lt 0)                 ;Find negative fluxes</span>
<span class="comments">;       ftab_delrow,'test.fits',bad,new='test1.fits'  ;Delete specified rows</span>
<span class="comments">;</span>
<span class="comments">; RESTRICTIONS:</span>
<span class="comments">;       Does not work for variable length binary tables</span>
<span class="comments">;</span>
<span class="comments">; PROCEDURES USED:</span>
<span class="comments">;       FITS_CLOSE, FITS_OPEN, FITS_READ, FITS_WRITE, FTDELROW, TBDELROW        </span>
<span class="comments">;</span>
<span class="comments">; REVISION HISTORY:                                           </span>
<span class="comments">;       Written   W. Landsman        STX Co.     August, 1997</span>
<span class="comments">;       Converted to IDL V5.0   W. Landsman   September 1997</span>
<span class="comments">;       Use COPY_LUN if V5.6 or later     W. Landsman   February 2003</span>
<span class="comments">;       Assume since V5.6, COPY_LUN available   W. Landsman   Sep 2006</span>
<span class="comments">;- </span>
<span class="comments">; On_error,2</span>

 if N_params() LT 2 then begin
     print,'Syntax - FTAB_DELROW, filename, rows, [EXTEN_NO= , NEWFILE= ] '
     return                                                  
 endif

 if not keyword_set(exten_no) then exten_no = 1

 fits_open,filename,fcb_in
 nextend = fcb_in.nextend

 if fcb_in.nextend EQ 0 then $
        message,'ERROR - FITS file contains no table extensions
 if fcb_in.nextend LT exten_no then $
        message,'ERROR - FITS file contains only ' + strtrim(nextend,2) + $
                ' extensions'


 if (N_elements(newfile) EQ 0) then begin
        newfile = ''
        read,prompt='Enter name of updated FITS file: ',newfile
 endif

<span class="comments">; Make sure specified extension contains a table and determine if it is ASCII</span>
<span class="comments">; or binary</span>

 fits_read,fcb_in, tab, htab, exten_no = exten_no, /NO_PDU
 case fcb_in.xtension[exten_no] of
 'A3DTABLE': binary = 1b
 'BINTABLE': binary = 1b
 'TABLE': binary = 0b
 else: message,'ERROR - Extension type of ' + $
                ext_type + 'is not a FITS table format'
 endcase
 if binary then tbdelrow,htab,tab,rows else $
                ftdelrow,htab,tab,rows  

<span class="comments">; Copy primary header and data array unchanged to output file</span>

 fits_open, newfile, fcb_out, /write
 filestat = fstat(fcb_in.unit)
 hstart = fcb_in.start_header
 point_lun,fcb_in.unit,0               <span class="comments">;Back to the start of the file</span>
          copy_lun, fcb_in.unit, fcb_out.unit,hstart[1] 
          fcb_out.nextend = fcb_out.nextend+1       <span class="comments">;flag that primary header is written</span>

 for i = 1, Nextend  do begin
        if i EQ exten_no then begin
                fits_write, fcb_out, tab,htab
        endif else begin
          if i EQ Nextend then nbyte = filestat.size - hstart[i] $
                          else nbyte = hstart[i+1] - hstart[i]
          point_lun,fcb_in.unit,hstart[i]
          copy_lun, fcb_in.unit, fcb_out.unit,nbyte 
         endelse
 endfor
 fits_close,fcb_in
 fits_close,fcb_out

 return  
 end
</code>
    </div>
  </body>
</html>