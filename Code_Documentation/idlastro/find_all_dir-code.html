<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:29 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>find_all_dir.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="find_all_dir.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source">        FUNCTION FIND_ALL_DIR, PATH, PATH_FORMAT=PATH_FORMAT,   $
                PLUS_REQUIRED=PLUS_REQUIRED, RESET=RESET
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;       FIND_ALL_DIR()</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;       Finds all directories under a specified directory.</span>
<span class="comments">; EXPLANATION:</span>
<span class="comments">;       This routine finds all the directories in a directory tree when the</span>
<span class="comments">;       root of the tree is specified.  This provides the same functionality as</span>
<span class="comments">;       having a directory with a plus in front of it in the environment</span>
<span class="comments">;       variable IDL_PATH.</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;       Result = FIND_ALL_DIR( PATH )</span>
<span class="comments">;</span>
<span class="comments">;               PATHS = FIND_ALL_DIR('+mypath', /PATH_FORMAT)</span>
<span class="comments">;               PATHS = FIND_ALL_DIR('+mypath1:+mypath2')</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;       PATH    = The path specification for the top directory in the tree.</span>
<span class="comments">;               Optionally this may begin with the '+' character but the action</span>
<span class="comments">;               is the same unless the PLUS_REQUIRED keyword is set.</span>
<span class="comments">;</span>
<span class="comments">;               One can also path a series of directories separated</span>
<span class="comments">;               by the correct character ("," for VMS, ":" for Unix)</span>
<span class="comments">;</span>
<span class="comments">; OUTPUTS:</span>
<span class="comments">;       The result of the function is a list of directories starting from the</span>
<span class="comments">;       top directory passed and working downward from there.   Normally, this</span>
<span class="comments">;       will be a string array with one directory per array element, but if</span>
<span class="comments">;       the PATH_FORMAT keyword is set, then a single string will be returned,</span>
<span class="comments">;       in the correct format to be incorporated into !PATH.</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUT KEYWORDS:</span>
<span class="comments">;       PATH_FORMAT     = If set, then a single string is returned, in</span>
<span class="comments">;                                 the format of !PATH.</span>
<span class="comments">;</span>
<span class="comments">;       PLUS_REQUIRED   = If set, then a leading plus sign is required</span>
<span class="comments">;                       in order to expand out a directory tree.</span>
<span class="comments">;                       This is especially useful if the input is a</span>
<span class="comments">;                       series of directories, where some components</span>
<span class="comments">;                       should be expanded, but others shouldn't.</span>
<span class="comments">;</span>
<span class="comments">;       RESET   = Often FIND_ALL_DIR is used with logical names.  It</span>
<span class="comments">;               can be rather slow to search through these subdirectories.</span>
<span class="comments">;               The /RESET keyword can be used to redefine an environment</span>
<span class="comments">;               variable so that subsequent calls don't need to look for the</span>
<span class="comments">;               subdirectories.</span>
<span class="comments">;</span>
<span class="comments">;               To use /RESET, the PATH parameter must contain the name of a</span>
<span class="comments">;               *single* environment variable.  For example</span>
<span class="comments">;</span>
<span class="comments">;                               setenv,'FITS_DATA=+/datadisk/fits'</span>
<span class="comments">;                               dir = find_all_dir('FITS_DATA',/reset,/plus)</span>
<span class="comments">;</span>
<span class="comments">;               The /RESET keyword is usually combined with /PLUS_REQUIRED.</span>
<span class="comments">;</span>
<span class="comments">; PROCEDURE CALLS:</span>
<span class="comments">;       DEF_DIRLIST, FIND_WITH_DEF(), BREAK_PATH()</span>
<span class="comments">;</span>
<span class="comments">; RESTRICTIONS:</span>
<span class="comments">;       PATH must point to a directory that actually exists.</span>
<span class="comments">;</span>
<span class="comments">; REVISION HISTORY:</span>
<span class="comments">;               Version 11, Zarro (SM&A/GSFC), 23-March-00</span>
<span class="comments">;                       Removed all calls to IS_DIR</span>
<span class="comments">;               Version 12, William Thompson, GSFC, 02-Feb-2001</span>
<span class="comments">;                       In Windows, use built-in expand_path if able.</span>
<span class="comments">;               Version 13, William Thompson, GSFC, 23-Apr-2002</span>
<span class="comments">;                       Follow logical links in Unix</span>
<span class="comments">;                       (Suggested by Pascal Saint-Hilaire)</span>
<span class="comments">;               Version 14, Zarro (EER/GSFC), 26-Oct-2002</span>
<span class="comments">;                       Saved/restored current directory to protect against</span>
<span class="comments">;                       often mysterious directory changes caused by </span>
<span class="comments">;                       spawning FIND in Unix</span>
<span class="comments">;               Version 15, William Thompson, GSFC, 9-Feb-2004</span>
<span class="comments">;                       Resolve environment variables in Windows.</span>
<span class="comments">;</span>
<span class="comments">; Version     : Version 16 W. Landsman GSFC Sep 2006</span>
<span class="comments">;                        Remove VMS support</span>
<span class="comments">;-</span>
<span class="comments">;</span>
        ON_ERROR, 2
        compile_opt idl2
<span class="comments">;</span>
        IF N_PARAMS() NE 1 THEN MESSAGE,        $
                'Syntax:  Result = FIND_ALL_DIR( PATH )'

<span class="comments">;-- save current directory</span>

   cd,current=current

<span class="comments">;</span>
<span class="comments">;  If more than one directory was passed, then call this routine reiteratively.</span>
<span class="comments">;  Then skip directly to the test for the PATH_FORMAT keyword.</span>
<span class="comments">;</span>
        PATHS = BREAK_PATH(PATH, /NOCURRENT)
        IF N_ELEMENTS(PATHS) GT 1 THEN BEGIN
                DIRECTORIES = FIND_ALL_DIR(PATHS[0],    $
                        PLUS_REQUIRED=PLUS_REQUIRED)
                FOR I = 1,N_ELEMENTS(PATHS)-1 DO DIRECTORIES =  $
                        [DIRECTORIES, FIND_ALL_DIR(PATHS[I],    $
                                PLUS_REQUIRED=PLUS_REQUIRED)]
                GOTO, TEST_FORMAT
        ENDIF
<span class="comments">;</span>
<span class="comments">;  Test to see if the first character is a plus sign.  If it is, then remove</span>
<span class="comments">;  it.  If it isn't, and PLUS_REQUIRED is set, then remove any trailing '/'</span>
<span class="comments">;  character and skip to the end.</span>
<span class="comments">;</span>
        DIR = PATHS[0]
        IF STRMID(DIR,0,1) EQ '+' THEN BEGIN
                DIR = STRMID(DIR,1,STRLEN(DIR)-1)
        END ELSE IF KEYWORD_SET(PLUS_REQUIRED) THEN BEGIN
                DIRECTORIES = PATH
                IF STRMID(PATH,STRLEN(PATH)-1,1) EQ '/' THEN    $
                        DIRECTORIES = STRMID(PATH,0,STRLEN(PATH)-1)
                GOTO, TEST_FORMAT
        ENDIF
<span class="comments">;</span>
<span class="comments">;  For windows,  use the built-in EXPAND_PATH program.   However, first </span>
<span class="comments">;  resolve any environment variables.</span>
<span class="comments">;</span>
        IF !VERSION.OS_FAMILY EQ 'Windows' THEN BEGIN
                WHILE STRMID(DIR,0,1) EQ '$' DO BEGIN
                    FSLASH = STRPOS(DIR,'/')
                    IF FSLASH LT 1 THEN FSLASH = STRLEN(DIR)
                    BSLASH = STRPOS(DIR,'/')
                    IF BSLASH LT 1 THEN BSLASH = STRLEN(DIR)
                    SLASH = FSLASH &lt<span class="comments">; BSLASH</span>
                    TEST = STRMID(DIR,1,SLASH-1)
                    DIR = GETENV(TEST) + STRMID(DIR,SLASH,STRLEN(DIR)-SLASH)
                ENDWHILE
                TEMP = DIR
                TEST = STRMID(TEMP, STRLEN(TEMP)-1, 1)
                IF (TEST EQ '/') OR (TEST EQ '\') THEN  $
                      TEMP = STRMID(TEMP,0,STRLEN(TEMP)-1)
                DIRECTORIES = EXPAND_PATH('+' + TEMP, /ALL, /ARRAY)
<span class="comments">;</span>
<span class="comments">;  On Unix machines spawn the Bourne shell command 'find'.  First, if the</span>
<span class="comments">;  directory name starts with a dollar sign, then try to interpret the</span>
<span class="comments">;  following environment variable.  If the result is the null string, then</span>
<span class="comments">;  signal an error.</span>
<span class="comments">;</span>
        END ELSE BEGIN
                IF STRMID(DIR,0,1) EQ '$' THEN BEGIN
                    SLASH = STRPOS(DIR,'/')
                    IF SLASH LT 0 THEN SLASH = STRLEN(DIR)
                    EVAR = GETENV(STRMID(DIR,1,SLASH-1))
                    IF SLASH EQ STRLEN(DIR) THEN DIR = EVAR ELSE        $
                            DIR = EVAR + STRMID(DIR,SLASH,STRLEN(DIR)-SLASH)
                ENDIF
<span class="comments">;               IF IS_DIR(DIR) NE 1 THEN MESSAGE,       $</span>
<span class="comments">;                       'A valid directory must be passed'</span>
                IF STRMID(DIR,STRLEN(DIR)-1,1) NE '/' THEN DIR = DIR + '/'
                SPAWN,'find ' + DIR + ' -follow -type d -print | sort -', $
                        DIRECTORIES, /SH
<span class="comments">;</span>
<span class="comments">;  Remove any trailing slash character from the first directory.</span>
<span class="comments">;</span>
                TEMP = DIRECTORIES[0]
                IF STRMID(TEMP,STRLEN(TEMP)-1,1) EQ '/' THEN    $
                        DIRECTORIES[0] = STRMID(TEMP,0,STRLEN(TEMP)-1)
        ENDELSE
<span class="comments">;</span>
<span class="comments">;  Reformat the string array into a single string, with the correct separator.</span>
<span class="comments">;  If the PATH_FORMAT keyword was set, then this string will be used.  Also use</span>
<span class="comments">;  it when the RESET keyword was passed.</span>
<span class="comments">;</span>
TEST_FORMAT:
        DIR = DIRECTORIES[0]
        CASE !VERSION.OS_FAMILY OF
                'Windows':  SEP = ';'
                'MacOS': Sep = ','
                ELSE:  SEP = ':'
        ENDCASE
        FOR I = 1,N_ELEMENTS(DIRECTORIES)-1 DO DIR = DIR + SEP + DIRECTORIES[I]
<span class="comments">;</span>
<span class="comments">;  If the RESET keyword is set, and the PATH variable contains a *single*</span>
<span class="comments">;  environment variable, then call SETENV to redefine the environment variable.</span>
<span class="comments">;  If the string starts with a $, then try it both with and without the $.</span>
<span class="comments">;</span>
        IF KEYWORD_SET(RESET) THEN BEGIN
                EVAR = PATH
                TEST = GETENV(EVAR)
                IF TEST EQ '' THEN IF STRMID(EVAR,0,1) EQ '$' THEN BEGIN
                        EVAR = STRMID(EVAR,1,STRLEN(EVAR)-1)
                        TEST = GETENV(EVAR)
                ENDIF
                IF (TEST NE '') AND (TEST NE PATH) AND (DIR NE PATH) THEN $
                        SETENV, STRTRIM(EVAR,2) + '=' + $
			STRTRIM(STRJOIN(DIR,':'),2)
        ENDIF
<span class="comments">;</span>
<span class="comments">;-- restore current directory</span>

        cd,current

        IF KEYWORD_SET(PATH_FORMAT) THEN RETURN, DIR ELSE RETURN, DIRECTORIES
<span class="comments">;</span>
        END
</code>
    </div>
  </body>
</html>