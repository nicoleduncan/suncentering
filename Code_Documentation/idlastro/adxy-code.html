<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:18 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>adxy.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="adxy.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="adxy:source"></a>pro adxy, hdr, a, d, x, y, PRINT = print, ALT = alt        <span class="comments">;Ra, Dec to X,Y</span>
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;       ADXY</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;       Use a FITS header to convert astronomical to pixel coordinates</span>
<span class="comments">; EXPLANATION:</span>
<span class="comments">;       Use an image header to compute X and Y positions, given the</span>
<span class="comments">;       RA and Dec (or longitude, latitude) in decimal degrees.  </span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;       ADXY, HDR               ;Prompt for Ra and DEC </span>
<span class="comments">;       ADXY, hdr, a, d, x, y, [ /PRINT, ALT= ]</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;       HDR - FITS Image header containing astrometry parameters</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUTS:</span>
<span class="comments">;       A - Right ascension in decimal DEGREES, scalar or vector</span>
<span class="comments">;       D - Declination in decimal DEGREES, scalar or vector        </span>
<span class="comments">;</span>
<span class="comments">;       If A and D are not supplied, user will be prompted to supply</span>
<span class="comments">;       them in either decimal degrees or HR,MIN,SEC,DEG,MN,SC format.</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL OUTPUT:</span>
<span class="comments">;       X     - row position in pixels, same number of elements as A and D</span>
<span class="comments">;       Y     - column position in pixels</span>
<span class="comments">;</span>
<span class="comments">;       X and Y will be in standard IDL convention (first pixel is 0) and not</span>
<span class="comments">;       the FITS convention (first pixel is 1).      As in FITS an integral</span>
<span class="comments">;       value corresponds to the center of a pixel.</span>
<span class="comments">; OPTIONAL KEYWORD INPUT:</span>
<span class="comments">;       /PRINT - If this keyword is set and non-zero, then results are displayed</span>
<span class="comments">;               at the terminal.</span>
<span class="comments">;       ALT -  single character 'A' through 'Z' or ' ' specifying an alternate </span>
<span class="comments">;             astrometry system present in the FITS header.    The default is</span>
<span class="comments">;             to use the primary astrometry or ALT = ' '.   If /ALT is set, </span>
<span class="comments">;             then this is equivalent to ALT = 'A'.   See Section 3.3 of </span>
<span class="comments">;             Greisen & Calabretta (2002, A&A, 395, 1061) for information about</span>
<span class="comments">;             alternate astrometry keywords.</span>
<span class="comments">;</span>
<span class="comments">; OPERATIONAL NOTES:</span>
<span class="comments">;       If less than 5 parameters are supplied, or if the /PRINT keyword is</span>
<span class="comments">;       set, then the X and Y positions are displayed at the terminal.</span>
<span class="comments">;</span>
<span class="comments">;       If the procedure is to be used repeatedly with the same header,</span>
<span class="comments">;       then it would be faster to use AD2XY.</span>
<span class="comments">;</span>
<span class="comments">; PROCEDURES CALLED:</span>
<span class="comments">;       AD2XY, ADSTRING(), EXTAST, GETOPT(), TEN()</span>
<span class="comments">;</span>
<span class="comments">; REVISION HISTORY:</span>
<span class="comments">;       W. Landsman                 HSTX          January, 1988</span>
<span class="comments">;       Use astrometry structure   W. Landsman   January, 1994  </span>
<span class="comments">;       Changed default ADSTRING format   W. Landsman    September, 1995</span>
<span class="comments">;       Check if latitude/longitude reversed in CTYPE keyword W. L. Feb. 2004</span>
<span class="comments">;       Added ALT keyword   W. Landsman   September 2004</span>
<span class="comments">;       Work for non-spherical coordinate transformation W. Landsman May 2005 </span>
<span class="comments">;       More informative error message if astrometry missing W.L. Feb 2008</span>
<span class="comments">;       Cosmetic updates W.L. July 2011       </span>
<span class="comments">;-</span>
 Compile_opt idl2
 On_error,2

 npar = N_params()

 if ( npar EQ 0 ) then begin
        print,'Syntax - ADXY, hdr, [a, d, x, y, /PRINT, ALT= ]'
        print,'If supplied, A and D must be in decimal DEGREES'
        return
 endif                                                                  
 
 extast, hdr, astr, noparams, ALT = alt   <span class="comments">;Extract astrometry from FITS header</span>
  if ( noparams LT 0 ) then begin
        if alt EQ '' then $
        message,'ERROR - No astrometry info in supplied FITS header' $
	else  message, $
	'ERROR  - No alt=' + alt + ' astrometry info in supplied FITS header'
  endif	

 
 if npar lt 3 then begin
   RD: print,'Coordinates must be entered in either decimal (2 parameter) ' 
   print,'  or sexagesimal (6 parameter) format'
   inp = ''
   read,'ADXY: Enter coordinates: ',inp
   radec = getopt(inp,'F')
   case N_elements(radec) of 
      2: begin 
         a = radec[0] & d = radec[1]
         end
      6: begin
         a = ten(radec[0:2]*15.) & d = ten(radec[3:5])
         end
   else: begin
         print,'ADXY: ERROR - Either 2 or 6 parameters must be entered'
         return
         end
   endcase 
 endif

 case strmid( astr.ctype[0], 5,3) of
 'GSS': gsssadxy, astr, a, d, x, y       <span class="comments">;HST Guide star astrometry</span>
 else:  ad2xy, a, d, astr, x, y          <span class="comments">;All other cases</span>
 endcase

 if (npar lt 5) || keyword_set( PRINT ) then begin
        npts = N_elements(a)
        tit = strmid(astr.ctype,0,4)
         spherical = strmid(astr.ctype[0],4,1) EQ '-'
	if spherical then begin
        fmt = '(2F9.4,A,2X,2F8.2)'
        str = adstring(a,d,1)
        tit = strmid(astr.ctype,0,4)
        tit = repchr(tit,'-',' ')
        if (tit[0] EQ 'DEC ') || (tit[0] EQ 'ELAT') || $
           (tit[0] EQ 'GLAT') then tit = rotate(tit,2)
        print,'    ' + tit[0] + '    ' + tit[1] + '       ' + tit[0]  + $
              '         ' + tit[1]  + '        X       Y'
        for i = 0l, npts-1 do $
        print,FORMAT = fmt, a[i], d[i], str[i], x[i], y[i] 
        endif else begin
	 unit1 = strtrim( sxpar( hdr, 'CUNIT1'+alt,count = N_unit1),2)
	 if N_unit1 EQ 0 then unit1 = ''
	 unit2 = strtrim( sxpar( hdr, 'CUNIT2'+alt,count = N_unit2),2)
	 if N_unit2 EQ 0 then unit2 = ''
	 print,'   ' + tit[0] + '     ' + tit[1] + '         X       Y'
	 if (N_unit1 GT 0) || (N_unit2 GT 0) then $
	     print,unit1 ,unit2,f='(t5,a,t14,a)'
	     for i=0l, npts-1 do $
	 print, a[i], d[i], x[i], y[i], f='(2F9.4,2X,2F8.2)'
       endelse
  endif
 
 return
 end
</code>
    </div>
  </body>
</html>