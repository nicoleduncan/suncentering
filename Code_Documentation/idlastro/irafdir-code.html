<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:43 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>irafdir.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="irafdir.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="irafdir:source"></a>pro irafdir,directory,TEXTOUT=textout
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;	IRAFDIR</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;	Provide a brief description of the IRAF images on a directory</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;	IRAFDIR, [ directory, TEXTOUT = ]</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUT PARAMETERS:</span>
<span class="comments">;	DIRECTORY - Scalar string giving file name, disk or directory to </span>
<span class="comments">;		be searched </span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUT KEYWORD:</span>
<span class="comments">;	TEXTOUT - specifies output device (see TEXTOPEN)</span>
<span class="comments">;		textout=1	TERMINAL using /more option</span>
<span class="comments">;		textout=2	TERMINAL without /more option</span>
<span class="comments">;		textout=3	&lt;program>.prt</span>
<span class="comments">;		textout=4	laser.tmp</span>
<span class="comments">;		textout=5      user must open file</span>
<span class="comments">;		textout=7       Append to existing &lt;program>.prt file</span>
<span class="comments">;		textout = 'filename' (default extension of .prt)</span>
<span class="comments">;</span>
<span class="comments">; OUTPUT PARAMETERS:</span>
<span class="comments">;	None</span>
<span class="comments">;</span>
<span class="comments">; PROCEDURE:</span>
<span class="comments">;	FINDFILE is used to find all '.imh' files in the directory. </span>
<span class="comments">;	The object name and image size (NAXIS1, NAXIS2) are extracted</span>
<span class="comments">;	from the header. Each header is also searched for the parameters</span>
<span class="comments">;	DATE-OBS (or TDATEOBS), TELESCOP (or OBSERVAT), EXPTIME.</span>
<span class="comments">;  </span>
<span class="comments">; RESTRICTIONS:</span>
<span class="comments">;	(1) Some fields may be truncated since IRAFDIR uses a fixed format </span>
<span class="comments">;		output</span>
<span class="comments">;	(2) No more than 2 dimension sizes are displayed </span>
<span class="comments">; SYSTEM VARIABLES:</span>
<span class="comments">;	If 'textout' keyword is not specified to select an output device,</span>
<span class="comments">;	!TEXTOUT will be the default.    This non-standard system variable</span>
<span class="comments">;	can be added using the procedure ASTROLIB.</span>
<span class="comments">;</span>
<span class="comments">; PROCEDURE CALLS:</span>
<span class="comments">;	EXPAND_TILDE(), FDECOMP, REMCHAR, TEXTOPEN, TEXTCLOSE</span>
<span class="comments">; MODIFICATION HISTORY:</span>
<span class="comments">;	Written, K. Venkatakrishna, ST Systems Corp, August 1991</span>
<span class="comments">;	Work for IRAF V2.11 format   W. Landsman   November 1997</span>
<span class="comments">;	Assume since V5.5 use file_search W. Landsman   Sep 2006</span>
<span class="comments">;-</span>

 On_error,2                          <span class="comments">;Return to caller</span>
 
 ext='*.imh'

 defsysv,'!TEXTUNIT',exist=i
 if i EQ 0 THEN astrolib
 if keyword_set(directory) then begin 
	dir = strlowcase(directory)
	if strpos(dir,'~') GE 0 then dir = expand_tilde(dir)
 endif

 if N_ELEMENTS(dir) eq 0 then cd,current = dir

 dir = dir + path_sep()

 fil = file_search( dir + ext, COUNT=nfiles)
 if nfiles EQ 0 then begin
    message,'No IRAF (*.imh) files found ',/CON
    return
 endif

<span class="comments">; Set output device according to keyword TEXTOUT or system variable !TEXTOUT</span>

 if not keyword_set(textout) then textout=!textout
 textopen,'irafdir',TEXTOUT=textout

<span class="comments">;  Print the title header</span>
 printf,!textunit,format='(a,/)','IRAF file directory  '+strmid(systime(),4,20)
 printf,!textunit,$
'       NAME         SIZE     OBJECT      DATE-OF-OBS     TELESCOP      EXP TIME'

 get_lun,lun1
 fmt = '(a15,1x,i5,1x,i5,2x,a10,4x,a8,7x,a8,5x,a8)'
 dir2 = 'dummy'
 for i=0,nfiles-1 do begin                          <span class="comments">;Loop over each .imh file</span>
   file1 = fil[i]                                       
   fdecomp,file1,disk,dir2,fname,qual             <span class="comments">;Decompose into disk+filename</span>
   openr,lun1,file1,/stream                       <span class="comments">;open the file</span>
   irafver = bytarr(5)
   readu,lun1,irafver
   newformat = string(irafver) EQ 'imhv2'
   point_lun,lun1,0
   tmp = assoc(lun1,bytarr(32))
   hdr = tmp[0]
 
   exptim ='    ?   '                <span class="comments">;Set default values</span>
   telescop = '   ?      '
   date = '   ?      '

 if not newformat then begin
   hdr2 = hdr                                         <span class="comments">;Read the first 572 bytes</span>
   byteorder,hdr,/sswap                               <span class="comments">; Perform byte swaps</span>
   byteorder,hdr,/lswap 
   hdrlen = fix(hdr,12)                               <span class="comments">;Extract header length,</span>
   ndim = fix(hdr,20)                                 <span class="comments">; number of dimensions,</span>
   naxis1 = long(hdr2,24)                             <span class="comments">; dimension vector</span>
   naxis2 = long(hdr2,28)
   if hdrlen EQ 0 then begin
		close,lun1
		goto, PRINTER
   endif
   tmp1 = assoc(lun1,bytarr(hdrlen*4l,/NOZERO))               
   hdr = tmp1[0]                                     <span class="comments">;Read the entire header</span>
   close,lun1
   byteorder,hdr,/sswap  <span class="comments">;</span>
   nfits = (hdrlen*4l-2054)/162                     <span class="comments">; find the number of records</span>
   linelen = 162
   index = 2052l + indgen(80)*2
  
 endif else begin

   hdrlen = fix(hdr,8)                               <span class="comments">;Extract header length,</span>
   ndim = fix(hdr,20)                                 <span class="comments">; number of dimensions,</span>
   naxis1 = long(hdr,22)                             <span class="comments">; dimension vector</span>
   naxis2 = long(hdr,26)
   tmp1 = assoc(lun1,bytarr(hdrlen*2l,/NOZERO))               
   hdr = tmp1[0]                                     <span class="comments">;Read the entire header</span>
   close,lun1
   nfits = (hdrlen*2l-2049)/81                     <span class="comments">; find the number of records</span>
   linelen = 81
   index = 2046l + indgen(80)
  endelse

<span class="comments">; Form the string 'hd', </span>
<span class="comments">; hd will be a FITS style header, that contains all the basic information </span>

 if nfits EQ 0 then goto, PRINTER
 hd = strarr(nfits)                              <span class="comments">; to break the header into</span>
 for j = 0l,nfits-1 do hd[j] = string(hdr[linelen*j + index] )   
 

   keyword = strtrim( strmid(hd,0,8),2 )
   value = strtrim( strmid(hd,10,20),2 )
 l = where(keyword EQ 'TELESCOP',nfound)           <span class="comments">;Search for OBSERVAT keyword</span>
 if nfound EQ 0 then l = where(keyword EQ 'OBSERVAT', nfound)
 if nfound GT 0 then begin
      telescop = value[l[0]]
      remchar,telescop,"'"
 endif 

 l = where(keyword EQ 'EXPTIME',nfound)           <span class="comments">;Search for EXPTIME keyword</span>
 if nfound GT 0 then begin
    exptim = float(value[l[0]])
    if exptim EQ 0. then exptim = '   ?      ' else $
                 exptim = string(exptim,format= '(f7.1)')     
 endif 

 l = where(keyword EQ 'DATE-OBS' ,nfound)       <span class="comments">;Search for DATE-OBS keyword </span>
 if nfound EQ 0 then l = where(keyword EQ 'TDATEOBS', nfound)
 if nfound GT 0 then begin
   date=value[l[0]]
   remchar,date,"'"
 endif 

<span class="comments">;Extract object name</span>
PRINTER:
 if newformat then object = string( hdr[638 + indgen(8)]) else $
		   object = string( hdr[732 + indgen(8)*2]) 

 if dir2 NE dir then begin			<span class="comments">;Has directory changed?   </span>
       if ( dir2 EQ '' ) then cd,current=dir else dir = dir2
       printf,!textunit,format='(/a/)',disk+dir   <span class="comments">;Print new directory</span>
       dir = dir2                                  <span class="comments">;Save new directory</span>
 endif                   
<span class="comments">;                                                  original header </span>

 printf,!textunit,FORMAT=fmt,fname,naxis1,naxis2,object,date,telescop,exptim
 if textout EQ 1 then if !ERR EQ 1 then return
 endfor

 textclose, TEXTOUT=textout
 free_lun, lun1

 return
 end

</code>
    </div>
  </body>
</html>