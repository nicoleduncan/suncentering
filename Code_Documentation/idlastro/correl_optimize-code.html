<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:22 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>correl_optimize.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="correl_optimize.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="correl_optimize:source"></a>pro correl_optimize, image_A, image_B, xoffset_optimum, yoffset_optimum, $
					XOFF_INIT = xoff_init,   $
					YOFF_INIT = yoff_init,   $
					PRINT=print, MONITOR=monitor, $
					NUMPIX=numpix, MAGNIFICATION=Magf, $
					PLATEAU_TRESH = plateau
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;	CORREL_OPTIMIZE</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;	Find the optimal (x,y) pixel offset of image_B relative to image_A</span>
<span class="comments">; EXPLANATION"</span>
<span class="comments">;	Optimal offset is computed by means of maximizing the correlation </span>
<span class="comments">;	function of the two images.</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;	CORREL_OPTIMIZE, image_A, image_B, xoffset_optimum, yoffset_optimum </span>
<span class="comments">;		[ XOFF_INIT=, YOFF_INIT=, MAGNIFICATION=, /PRINT, /NUMPIX, </span>
<span class="comments">;		  /MONITOR, PLATEAU_THRESH=  ]</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;	image_A, image_B = the two images of interest.</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUT KEYWORDS:</span>
<span class="comments">;	XOFF_INIT = initial X pixel offset of image_B relative to image_A,</span>
<span class="comments">;	YOFF_INIT = Y pixel offset, (default offsets are 0 and 0).</span>
<span class="comments">;	MAGNIFICATION = option to determine offsets up to fractional pixels,</span>
<span class="comments">;			(example: MAG=2 means 1/2 pixel accuracy, default=1).</span>
<span class="comments">;	/NUMPIX: sqrt( sqrt( # pixels )) used as correlation weighting factor.</span>
<span class="comments">;	/MONITOR causes the progress of computation to be briefly printed.</span>
<span class="comments">;	/PRINT causes the results of analysis to be printed.</span>
<span class="comments">;	PLATEAU_THRESH = threshold used for detecting plateaus in </span>
<span class="comments">;		the cross-correlation matrix near maximum, (default=0.01),</span>
<span class="comments">;		used only if MAGNIFICATION > 1.    Decrease this value for</span>
<span class="comments">;		high signal-to-noise data</span>
<span class="comments">;</span>
<span class="comments">; OUTPUTS:</span>
<span class="comments">;	xoffset_optimum = optimal X pixel offset of image_B relative to image_A.</span>
<span class="comments">;	yoffset_optimum = optimal Y pixel offset.</span>
<span class="comments">;</span>
<span class="comments">; CALLS:</span>
<span class="comments">;	function  correl_images( image_A, image_B )</span>
<span class="comments">;	pro  corrmat_analyze</span>
<span class="comments">;</span>
<span class="comments">; PROCEDURE:</span>
<span class="comments">;	The combination of function correl_images( image_A, image_B ) and</span>
<span class="comments">;	corrmat_analyze of the result is used to obtain the (x,y) offset</span>
<span class="comments">;	yielding maximal correlation. The combination is first executed at</span>
<span class="comments">;	large REDUCTION factors to speed up computation, then zooming in </span>
<span class="comments">;	recursively on the optimal (x,y) offset by factors of 2.</span>
<span class="comments">;	Finally, the MAGNIFICATION option (if specified)</span>
<span class="comments">;	is executed to determine the (x,y) offset up to fractional pixels.</span>
<span class="comments">;	</span>
<span class="comments">; MODIFICATION HISTORY:</span>
<span class="comments">;	Written, July,1991, Frank Varosi, STX @ NASA/GSFC</span>
<span class="comments">;	Added PLATEAU_THRESH keyword  June 1997,  Wayne Landsman  STX   </span>
<span class="comments">;	Converted to IDL V5.0   W. Landsman   September 1997</span>
<span class="comments">;-</span>
        if N_params() LT 2 then begin
		print,'Syntax - CORREL_OPTIMIZE, imA, imB, Xoffset, Yoffset'
		print,'Keywords - /Monitor, /Print, XoffInit =, YoffInit =' + $
		      ', Magnification =, /Numpix'
		return
        endif

	simA = size( image_A )
	simB = size( image_B )

	if (simA[0] LT 2) OR (simB[0] LT 2) then begin
		message,"first two arguments must be images",/INFO,/CONTIN
		return
	   endif

	if N_elements( xoff_init ) NE 1 then xoff_init=0
	if N_elements( yoff_init ) NE 1 then yoff_init=0
	if N_elements( plateau ) NE 1 then plateau = 0.01
	xoff = xoff_init
	yoff = yoff_init

	reducf = min( [simA[1:2],simB[1:2]] ) / 8	<span class="comments">;Bin average to about</span>
							<span class="comments">; 8 by 8 pixel image.</span>
	if N_elements( Magf ) NE 1 then Magf=1

	xsiz = max( [simA[1],simB[1]] )
	ysiz = max( [simA[2],simB[2]] )
	xshift = xsiz
	yshift = ysiz		<span class="comments">;shift over the whole images first correlation.</span>

	while (reducf GT 1) do begin

		corrmat = correl_images( image_A, image_B, XOFF=xoff,YOFF=yoff,$
					       NUM=numpix, XS=xshift,YS=yshift,$
					       REDUCTION=reducf, MONIT=monitor )

		corrmat_analyze, corrmat, xoff, yoff, XOFF=xoff, YOFF=yoff, $
						PRINT=print, REDUCTION=reducf
		xshift = 2*reducf
		yshift = 2*reducf	<span class="comments">;shift over coarse pixels to refine</span>
		reducf = reducf/2	<span class="comments">; in further correlations.</span>
	  endwhile

	xshift = xshift/2	<span class="comments">;now refine offsets to actual pixels.</span>
	yshift = yshift/2
	corrmat = correl_images( image_A, image_B, XOFF=xoff, YOFF=yoff,$
				 MON=monitor, NUM=numpix, XS=xshift, YS=yshift )

	corrmat_analyze, corrmat, xoffset_optimum, yoffset_optimum, $
					XOFF=xoff, YOFF=yoff, PRINT=print

	if (Magf GE 2) then begin

		xoff = xoffset_optimum		<span class="comments">;refine offsets to</span>
		yoff = yoffset_optimum		<span class="comments">; fractional pixels.</span>

		corrmat = correl_images( image_A, image_B, XOFF=xoff,YOFF=yoff,$
						MAGNIFIC=Magf, MONITOR=monitor )

		corrmat_analyze, corrmat, xoffset_optimum, yoffset_optimum, $
							XOFF=xoff,YOFF=yoff,$
							PRINT=print, MAG=Magf, $
							PLATEAU_THRESH = plateau
	   endif
return
end
</code>
    </div>
  </body>
</html>