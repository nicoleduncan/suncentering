<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:58:34 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>npixfit.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="npixfit.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source">FUNCTION npixfit, inputstruct, inputimage, fixfid
<span class="comments">;+</span>
<span class="comments">;   :Description:</span>
<span class="comments">;       Linear fit to limb strips with an arbitrary number of limb pixels</span>
<span class="comments">;</span>
<span class="comments">;   :Params:</span>
<span class="comments">;       inputstruct: in, required, type=structure</span>
<span class="comments">;           Structure containing all the solar information</span>
<span class="comments">;</span>
<span class="comments">;       inputimage: in, required, type=byte(ndims,2)</span>
<span class="comments">;           Starting input image</span>
<span class="comments">;</span>
<span class="comments">;       fixfid : in, required, type=structure</span>
<span class="comments">;           Strucutre comtaining the fiducial positions to be used for chord checking.</span>
<span class="comments">;</span>
<span class="comments">;   :Keywords:</span>
<span class="comments">;       </span>
<span class="comments">;-</span>

<span class="comments">; Run the program to get our structures</span>
a = cyoalimbstrips(inputstruct,inputimage,fixfid)

xlen    = 0
ylen    = 0
xarr    = FINDGEN(N_ELEMENTS(a[0].limbxstrips[0].startpoints))
yarr    = FINDGEN(N_ELEMENTS(a[0].limbystrips[0].startpoints))
xlenarr = FLTARR(N_ELEMENTS(a[0].limbxstrips),/nozero)
ylenarr = FLTARR(N_ELEMENTS(a[0].limbystrips),/nozero)


<span class="comments">; Collapsed version:</span>
for jj = 0,N_ELEMENTS(a)-1 do begin
    for n = 0, !param.nstrips-1 do begin
        <span class="comments">; Fit line to n limb pixels, n/2 above thresh, n/2 below</span>
        
        x_startresult   = LINFIT(xarr,a[jj].limbxstrips[n].startpoints)
        x_endresult     = LINFIT(xarr,a[jj].limbxstrips[n].endpoints)
        y_startresult   = LINFIT(yarr,a[jj].limbystrips[n].startpoints)
        y_endresult     = LINFIT(yarr,a[jj].limbystrips[n].endpoints)

        x_begusable     = (a[jj].thresh - x_startresult[0])/x_startresult[1]
        x_stripbeg      =  a[jj].limbxstrips[n].startindex + x_begusable
        x_endusable     = (a[jj].thresh - x_endresult[0])/x_endresult[1]
        x_stripend      =  a[jj].limbxstrips[n].endindex + x_endusable
        <span class="comments">;Quick solution is to take the not-infite means, long-term is to get better limb chords</span>
        xlenarr[n]      = MEAN([[x_stripend],[x_stripbeg]],/NaN)


        y_begusable     = (a[jj].thresh - y_startresult[0])/y_startresult[1]
        y_stripbeg      =  a[jj].limbystrips[n].startindex + y_begusable
        y_endusable     = (a[jj].thresh - y_endresult[0])/y_endresult[1]
        y_stripend      =  a[jj].limbystrips[n].endindex + y_endusable
        ylenarr[n]      = MEAN([[y_stripend],[y_stripbeg]],/NaN)
    endfor    

    <span class="comments">; Get the midpoint of the chords</span>
    a[jj].limbxpos = MEAN(xlenarr[WHERE(xlenarr ne 0)],/NaN) + a[jj].xpos - !param.crop_box
    a[jj].limbypos = MEAN(ylenarr[WHERE(ylenarr ne 0)],/NaN) + a[jj].ypos - !param.crop_box
endfor


RETURN,a
END
</code>
    </div>
  </body>
</html>