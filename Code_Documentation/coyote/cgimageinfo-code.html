<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:56:13 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>cgimageinfo.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="cgimageinfo.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">; docformat = 'rst'</span>
<span class="comments">;</span>
<span class="comments">; NAME:</span>
<span class="comments">;   cgImageInfo</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;     The purpose of this program is allow interactive inquiry of image</span>
<span class="comments">;     position and values for images displayed with cgImage.</span>
<span class="comments">;     After a call to cgImage, cgImageInfo can be called and the user</span>
<span class="comments">;     can use the cursor to click in the image display window. If the user clicks</span>
<span class="comments">;     inside the image, the image location and value will be printed out in the</span>
<span class="comments">;     user's IDL console window.</span>
<span class="comments">;     </span>
<span class="comments">;******************************************************************************************;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  Copyright (c) 2011, by Fanning Software Consulting, Inc. All rights reserved.           ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  Redistribution and use in source and binary forms, with or without                      ;</span>
<span class="comments">;  modification, are permitted provided that the following conditions are met:             ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;      * Redistributions of source code must retain the above copyright                    ;</span>
<span class="comments">;        notice, this list of conditions and the following disclaimer.                     ;</span>
<span class="comments">;      * Redistributions in binary form must reproduce the above copyright                 ;</span>
<span class="comments">;        notice, this list of conditions and the following disclaimer in the               ;</span>
<span class="comments">;        documentation and/or other materials provided with the distribution.              ;</span>
<span class="comments">;      * Neither the name of Fanning Software Consulting, Inc. nor the names of its        ;</span>
<span class="comments">;        contributors may be used to endorse or promote products derived from this         ;</span>
<span class="comments">;        software without specific prior written permission.                               ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  THIS SOFTWARE IS PROVIDED BY FANNING SOFTWARE CONSULTING, INC. ''AS IS'' AND ANY        ;</span>
<span class="comments">;  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES    ;</span>
<span class="comments">;  OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT     ;</span>
<span class="comments">;  SHALL FANNING SOFTWARE CONSULTING, INC. BE LIABLE FOR ANY DIRECT, INDIRECT,             ;</span>
<span class="comments">;  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED    ;</span>
<span class="comments">;  TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;         ;</span>
<span class="comments">;  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND             ;</span>
<span class="comments">;  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT              ;</span>
<span class="comments">;  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS           ;</span>
<span class="comments">;  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.                            ;</span>
<span class="comments">;******************************************************************************************;</span>
<span class="comments">;</span>
<span class="comments">;+</span>
<span class="comments">;  The purpose of this program is allow interactive inquiry of image</span>
<span class="comments">;  position and values for images displayed with cgImage.</span>
<span class="comments">;  After a call to cgImage, cgImageInfo can be called and the user</span>
<span class="comments">;  can use the cursor to click in the image display window. If the user clicks</span>
<span class="comments">;  inside the image, the image location and value will be printed out in the</span>
<span class="comments">;  user's IDL console window. The cgImageInfo program blocks the IDL command </span>
<span class="comments">;  line until the RIGHT mouse button is clicked in the image display window.</span>
<span class="comments">;  </span>
<span class="comments">;  This cgImageInfo program is designed to work for the last image displayed with cgImage </span>
<span class="comments">;  on a Windows or X device. Precautions are taken to help you avoid shooting</span>
<span class="comments">;  yourself in the foot, but I can't anticipate every action a user might take at the </span>
<span class="comments">;  IDL command line. Pay particular attention to exiting the program with the RIGHT mouse</span>
<span class="comments">;  button before you close or kill the current graphics window. Failure to do so will </span>
<span class="comments">;  put you into a very strange and precarious state from which no rescue is possible.</span>
<span class="comments">;  You might want to consider using the Catalyst Program `IMGWIN &lt;http://www.idlcoyote.com/catalyst/imgwin.html>`</span>
<span class="comments">;   as an alternative to cgImageInfo.</span>
<span class="comments">;</span>
<span class="comments">; :Categories:</span>
<span class="comments">;    Graphics</span>
<span class="comments">;    </span>
<span class="comments">; :Params:</span>
<span class="comments">;    image: in, required, </span>
<span class="comments">;         A 2D or 3D image array. Values will be returned from this image.</span>
<span class="comments">;         In versions of IDL &lt; 8.0, it is possible to use a HASH object of</span>
<span class="comments">;         keys/images where this program will describe the value for each of</span>
<span class="comments">;         the images in the HASH object.</span>
<span class="comments">;    position: in, optional, type=float</span>
<span class="comments">;         A four-element floating array giving the position of the image in</span>
<span class="comments">;         the display window. If not provided, the image position will be</span>
<span class="comments">;         retrieved from the last image position used with cgImage.</span>
<span class="comments">;         </span>
<span class="comments">; :Examples:</span>
<span class="comments">;     To display an image with axes and then inquire about it::</span>
<span class="comments">;</span>
<span class="comments">;         filename = FILEPATH(SUBDIR=['examples','data'], 'worldelv.dat')</span>
<span class="comments">;         image = BYTARR(360,360)</span>
<span class="comments">;         OPENR, lun, filename, /GET_LUN</span>
<span class="comments">;         READU, lun, image</span>
<span class="comments">;         FREE_LUN, lun</span>
<span class="comments">;</span>
<span class="comments">;         thisPosition = [0.1, 0.1, 0.9, 0.9]</span>
<span class="comments">;         cgImage, image, /KEEP_ASPECT,  POSITION=thisPosition, /AXES</span>
<span class="comments">;         cgImageInfo, image</span>
<span class="comments">;       </span>
<span class="comments">; :Author:</span>
<span class="comments">;       FANNING SOFTWARE CONSULTING::</span>
<span class="comments">;           David W. Fanning </span>
<span class="comments">;           1645 Sheely Drive</span>
<span class="comments">;           Fort Collins, CO 80526 USA</span>
<span class="comments">;           Phone: 970-221-0438</span>
<span class="comments">;           E-mail: david@idlcoyote.com</span>
<span class="comments">;           Coyote's Guide to IDL Programming: http://www.idlcoyote.com</span>
<span class="comments">;</span>
<span class="comments">; :History:</span>
<span class="comments">;     Change History::</span>
<span class="comments">;      Written by: David W Fanning, 16 March 2008.</span>
<span class="comments">;      Added ability to specify position directly in call. 20 March 2008. DWF</span>
<span class="comments">;      Changed cursor operation to conform with expected differences</span>
<span class="comments">;         between Windows and UNIX. 20 March 2008, DWF.</span>
<span class="comments">;      Slightly modified screen directions. 16 November 2010. DWF.</span>
<span class="comments">;      Modified so that multiple images/grids can be described 18 May 2011. MHS</span>
<span class="comments">;</span>
<span class="comments">; :Copyright:</span>
<span class="comments">;     Copyright (c) 2008-2011, Fanning Software Consulting, Inc.</span>
<span class="comments">;-</span>
PRO cgImageInfo, image, position

    COMPILE_OPT idl2

    <span class="comments">; Error Handling.</span>
    CATCH, theError
    IF theError NE 0 THEN BEGIN
        CATCH, /CANCEL
        void = Error_Message()
        
        <span class="comments">; Set the cursor back to original shape.</span>
        IF !D.Name EQ 'WIN' THEN BEGIN
            Device, /CURSOR_ORIGINAL
        ENDIF ELSE BEGIN
            Device, CURSOR_STANDARD=30
        ENDELSE
        RETURN
     ENDIF

    <span class="comments">; Set up a common block to access cgImage informaton.</span>
    COMMON FSC_$CGIMAGE, _cgimage_xsize, _cgimage_ysize, $
                         _cgimage_winxsize, _cgimage_winysize, $
                         _cgimage_position, _cgimage_winID, $
                         _cgimage_current



    <span class="comments">;;  First check to see if we're using a HASH as input for the variable image.</span>
    hsh = ''
    IF total( obj_valid( image ) EQ 1 ) &&  obj_isa( image, 'HASH' ) THEN BEGIN 
       <span class="comments">;; If so, we need to pull out the first image from the hash so that all of the</span>
       <span class="comments">;; information can be set up properly before the user selects data from the</span>
       <span class="comments">;; displayed image</span>
       hsh = image

       IF n_elements( hsh ) EQ 0 THEN Message, 'Must supply a hash of names/images to examine.'
       <span class="comments">;; </span>
       keys = hsh -> keys( ) 
       image = hsh[ keys[ 0 ] ]

       <span class="comments">;; check that each image in the hash has same dimensions.</span>
       void =  Image_Dimensions( image, xsize = first_xsize, ysize = first_ysize )
       FOR k = 1, n_elements( keys ) - 1 DO BEGIN
          img =  hsh[ keys[ k ] ]
          void =  Image_Dimensions( img,  xsize = xsize,  ysize = ysize )
          IF xsize NE first_xsize OR ysize NE first_ysize THEN $
             Message, 'Each Image must have same X & Y dimensions'
       ENDFOR 
       
    ENDIF 

    <span class="comments">; Check to see if we can proceed. First see if we have an image.</span>
    IF N_Elements(image) EQ 0 THEN Message, 'Must supply image for reporting values.'

    <span class="comments">; Only 2D and 24-bit images allowed.</span>
    ndims = Size(image, /N_DIMENSIONS)
    IF ndims LT 2 OR ndims GT 3 THEN Message, 'Image must be 2D or 3D (True-Color).'
    s = Size(image, /Dimensions)

    <span class="comments">; Does this device support windows?</span>
    IF (!D.FLAGS AND 256) EQ 0 THEN Message, 'cgImageInfo only works on devices that support windows.'

    <span class="comments">; Has a call to cgImage preceeded this call?</span>
    IF _cgimage_current EQ 0 THEN Message, 'Must call cgImage prior to calling cgImageInfo.'

    <span class="comments">; Is the image window still open?</span>
    Device, WINDOW_STATE=theWindows
    IF theWindows[_cgimage_winID] EQ 0 THEN Message, 'The image window has been closed.'

    <span class="comments">; Is the image that you got here the same size as the cgImage image?</span>
    void = Image_Dimensions(image, XSIZE=imgxsize, YSIZE=imgysize)
    IF imgxsize NE _cgimage_xsize OR imgysize NE _cgimage_ysize THEN $
        Message, 'Image dimensions to not match those of last displayed image.'

    <span class="comments">; Make the image window the current graphics window.</span>
    thisWindow = !D.Window
    WSet, _cgimage_winID

    <span class="comments">; Are the window sizes still right?</span>
    IF !D.X_Size NE _cgimage_winxsize OR !D.Y_Size NE _cgimage_winysize THEN BEGIN
        WSet, thisWindow
        Message, 'The image window size has changed size from when image was last displayed.'
    ENDIF

    <span class="comments">; If a position was supplied, use that rather than the stored position.</span>
    IF N_Elements(position) NE 0 THEN thePos = position ELSE thePos = _cgimage_position

    <span class="comments">; Print instructions to the user.</span>
    Print, ''
    Print, 'Click cursor in image window (window ' + StrTrim(_cgimage_winID,2) + ') to get image values.'
    Print, 'Use LEFT mouse buton to inquire.'
    Print, 'Use RIGHT mouse button to exit program.'
    Print, ''
    Print, 'Expecting cursor clicks in image window...'

    <span class="comments">; Start the image loop.</span>
    !MOUSE.BUTTON = 0
    WHILE !MOUSE.BUTTON NE 4 DO BEGIN

       <span class="comments">; Change to arrow cursor in window.</span>
       IF !D.Name EQ 'WIN' THEN BEGIN
           Device, CURSOR_STANDARD=32649
       ENDIF ELSE BEGIN
           Device, /CURSOR_ORIGINAL
       ENDELSE

       <span class="comments">; Get the location in the window.</span>
       Cursor, x, y, /NORMAL, /DOWN

       <span class="comments">; Are you inside or outside the image?</span>
       inside = 0
       IF (x GE thePos[0]) AND (x LE thePos[2]) AND $
          (y GE thePos[1]) AND (y LE thePos[3]) THEN inside = 1

       <span class="comments">; If inside, then convert location to image pixel dimension and return value</span>
       <span class="comments">; of the image at the location. Be sure you do this differently for 2D and 3D images.</span>
       IF inside THEN BEGIN

          <span class="comments">; Create vectors for locating image dimensions with VALUE_LOCATE</span>
          xvec = cgScaleVector(Findgen(_cgimage_xsize+1), thePos[0], thePos[2])
          yvec = cgScaleVector(Findgen(_cgimage_ysize+1), thePos[1], thePos[3])
          xpixel = Value_Locate(xvec, x)
          ypixel = Value_Locate(yvec, y)

          <span class="comments">;; If a hash wasn't input, use the old output convention.</span>
          cgImageInfoDescribeValues, image,  xpixel,  ypixel, hsh
          
       ENDIF ELSE Print, 'Outside image'

    ENDWHILE

    <span class="comments">; Set the cursor back to original shape.</span>
    IF !D.Name EQ 'WIN' THEN BEGIN
        Device, /CURSOR_ORIGINAL
    ENDIF ELSE BEGIN
        Device, CURSOR_STANDARD=30
    ENDELSE

    <span class="comments">; Set the window back to entry window.</span>
    WSet, thisWindow

    <span class="comments">; Print confirmation.</span>
    Print, ''
    Print, 'Good-bye. cgImageInfo has returned control to IDL.'
    Print, ''

END
</code>
    </div>
  </body>
</html>