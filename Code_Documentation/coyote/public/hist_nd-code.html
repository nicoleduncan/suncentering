<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:16 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>hist_nd.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="hist_nd.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;       HIST_ND</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;</span>
<span class="comments">;       Perform an N-dimensional histogram, also known as the joint</span>
<span class="comments">;       density function of N variables, ala HIST_2D.</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;       hist=HIST_ND(V,[BINSIZE,MIN=,MAX=,NBINS=,REVERSE_INDICES=])</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;</span>
<span class="comments">;       V: A NxP array representing P data points in N dimensions.  </span>
<span class="comments">;</span>
<span class="comments">;       BINSIZE: The size of the bin to use. Either an N point vector</span>
<span class="comments">;         specifying a separate size for each dimension, or a scalar,</span>
<span class="comments">;         which will be used for all dimensions.  If BINSIZE is not</span>
<span class="comments">;         passed, NBINS must be.</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUTS: </span>
<span class="comments">;</span>
<span class="comments">;       MIN: The minimum value for the histogram.  Either a P point</span>
<span class="comments">;         vector specifying a separate minimum for each dimension, or</span>
<span class="comments">;         a scalar, which will be used for all dimensions.  If</span>
<span class="comments">;         omitted, the natural minimum within the dataset will be</span>
<span class="comments">;         used.</span>
<span class="comments">;</span>
<span class="comments">;       MAX: The maximum value for the histogram.  Either a P point</span>
<span class="comments">;         vector specifying a separate maximmum for each dimension, or</span>
<span class="comments">;         a scalar, which will be used for all dimensions. If omitted,</span>
<span class="comments">;         the natural maximum within the dataset will be used.</span>
<span class="comments">;</span>
<span class="comments">;       NBINS: Rather than specifying the binsize, you can pass NBINS,</span>
<span class="comments">;         the number of bins in each dimension, which can be a P point</span>
<span class="comments">;         vector, or a scalar.  If BINSIZE it also passed, NBINS will</span>
<span class="comments">;         be ignored, otherwise BINSIZE will then be calculated as</span>
<span class="comments">;         binsize=(max-min)/nbins.  Note that *unlike* RSI's version</span>
<span class="comments">;         of histogram as of IDL 5.4, this keyword actually works as</span>
<span class="comments">;         advertised, giving you NBINS bins over the range min to max.</span>
<span class="comments">;</span>
<span class="comments">; KEYWORD PARAMETERS:</span>
<span class="comments">;       </span>
<span class="comments">;       MIN,MAX,NBINS: See above</span>
<span class="comments">;       </span>
<span class="comments">;       REVERSE_INDICES: Set to a named variable to receive the</span>
<span class="comments">;         reverse indices, for mapping which points occurred in a</span>
<span class="comments">;         given bin.  Note that this is a 1-dimensional reverse index</span>
<span class="comments">;         vector (see HISTOGRAM).  E.g., to find the indices of points</span>
<span class="comments">;         which fell in a histogram bin [i,j,k], look up:</span>
<span class="comments">;</span>
<span class="comments">;             ind=[i+nx*(j+ny*k)]</span>
<span class="comments">;             ri[ri[ind]:ri[ind+1]-1]</span>
<span class="comments">;</span>
<span class="comments">;         See also ARRAY_INDICES for converting in the other</span>
<span class="comments">;         direction.</span>
<span class="comments">;</span>
<span class="comments">; OUTPUTS:</span>
<span class="comments">;</span>
<span class="comments">;       hist: The N-Dimensional histogram, an array of size</span>
<span class="comments">;         N1xN2xN3x...xND where the Ni's are the number of bins</span>
<span class="comments">;         implied by the data, and/or the optional inputs min, max and</span>
<span class="comments">;         binsize.</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL OUTPUTS:</span>
<span class="comments">;</span>
<span class="comments">;       The reverse indices.</span>
<span class="comments">;</span>
<span class="comments">; EXAMPLE:</span>
<span class="comments">;       </span>
<span class="comments">;       v=randomu(sd,3,100)</span>
<span class="comments">;       h=hist_nd(v,.25,MIN=0,MAX=1,REVERSE_INDICES=ri)</span>
<span class="comments">;</span>
<span class="comments">; SEE ALSO:</span>
<span class="comments">;</span>
<span class="comments">;       HISTOGRAM, HIST_2D</span>
<span class="comments">;</span>
<span class="comments">; MODIFICATION HISTORY:</span>
<span class="comments">;</span>
<span class="comments">;       Wed Nov 3 17:40:21 2010, J.D. Smith </span>
<span class="comments">;               </span>
<span class="comments">;               Handle 1D input with out of range elements.</span>
<span class="comments">;		</span>
<span class="comments">;</span>
<span class="comments">;       Mon Mar 5 09:45:53 2007, J.D. Smith &lt;jdsmith@as.arizona.edu></span>
<span class="comments">;</span>
<span class="comments">;               Correctly trim out of range elements from the</span>
<span class="comments">;               histogram, when MIN/MAX are specified. Requires IDL</span>
<span class="comments">;               v6.1 or later.</span>
<span class="comments">;</span>
<span class="comments">;       Tue Aug 19 09:13:43 2003, J.D. Smith &lt;jdsmith@as.arizona.edu></span>
<span class="comments">;</span>
<span class="comments">;               Slight update to BINSIZE logic to provide consistency</span>
<span class="comments">;               with HIST_2D.</span>
<span class="comments">;</span>
<span class="comments">;       Fri Oct 11 10:10:01 2002, J.D. Smith &lt;jdsmith@as.arizona.edu></span>
<span class="comments">;</span>
<span class="comments">;               Updated to use new DIMENSION keyword to MAX/MIN.</span>
<span class="comments">;</span>
<span class="comments">;       Fri Apr 20 12:57:34 2001, JD Smith &lt;jdsmith@astro.cornell.edu></span>
<span class="comments">;</span>
<span class="comments">;               Slight update to NBINS logic.  More aggressive keyword</span>
<span class="comments">;               checking.</span>
<span class="comments">;</span>
<span class="comments">;       Wed Mar 28 19:41:10 2001, JD Smith &lt;jdsmith@astro.cornell.edu></span>
<span class="comments">;</span>
<span class="comments">;               Written, based on HIST_2D, and suggestions of CM.</span>
<span class="comments">;</span>
<span class="comments">;-</span>
<span class="comments">;##############################################################################</span>
<span class="comments">;</span>
<span class="comments">; LICENSE</span>
<span class="comments">;</span>
<span class="comments">;  Copyright (C) 2001-2010 J.D. Smith</span>
<span class="comments">;</span>
<span class="comments">;  This file is free software; you can redistribute it and/or modify</span>
<span class="comments">;  it under the terms of the GNU General Public License as published</span>
<span class="comments">;  by the Free Software Foundation; either version 2, or (at your</span>
<span class="comments">;  option) any later version.</span>
<span class="comments">;</span>
<span class="comments">;  This file is distributed in the hope that it will be useful, but</span>
<span class="comments">;  WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="comments">;  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<span class="comments">;  General Public License for more details.</span>
<span class="comments">;</span>
<span class="comments">;  You should have received a copy of the GNU General Public License</span>
<span class="comments">;  along with this file; see the file COPYING.  If not, write to the</span>
<span class="comments">;  Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,</span>
<span class="comments">;  Boston, MA 02110-1301, USA.</span>
<span class="comments">;</span>
<span class="comments">;##############################################################################</span>

<a id="hist_nd:source"></a>function hist_nd,V,bs,MIN=mn,MAX=mx,NBINS=nbins,REVERSE_INDICES=ri
  s=size(V,/DIMENSIONS)
  if n_elements(s) ne 2 then message,'Input must be N (dimensions) x P (points)'
  if s[0] gt 8 then message, 'Only up to 8 dimensions allowed'
  
  imx=max(V,DIMENSION=2,MIN=imn)
  
  if n_elements(mx) eq 0 then mx=imx
  if n_elements(mn) eq 0 then mn=imn
  
  if s[0] gt 1 then begin 
     if n_elements(mn)    eq 1 then mn=replicate(mn,s[0])
     if n_elements(mx)    eq 1 then mx=replicate(mx,s[0])
     if n_elements(bs)    eq 1 then bs=replicate(bs,s[0])
     if n_elements(nbins) eq 1 then nbins=replicate(nbins,s[0])
  endif else begin 
     mn=[mn] & mx=[mx]
  endelse 
  
  if ~array_equal(mn le mx,1b) then $
     message,'Min must be less than or equal to max.'
  
  if n_elements(bs) eq 0 then begin 
     if n_elements(nbins) ne 0 then begin 
        nbins=long(nbins)       <span class="comments">;No fractional bins, please</span>
        bs=float(mx-mn)/nbins   <span class="comments">;a correct formulation</span>
     endif else message,'Must pass either binsize or NBINS'
  endif else nbins=long((mx-mn)/bs+1) 
  
  total_bins=product(nbins,/PRESERVE_TYPE) <span class="comments">;Total number of bins</span>
  h=long((V[s[0]-1,*]-mn[s[0]-1])/bs[s[0]-1])
  
  <span class="comments">;; The scaled indices, s[n]+N[n-1]*(s[n-1]+N[n-2]*(s[n-2]+...</span>
  for i=s[0]-2,0,-1 do h=nbins[i]*temporary(h) + long((V[i,*]-mn[i])/bs[i])
  
  out_of_range=[~array_equal(mn le imn,1b),~array_equal(mx ge imx,1b)]
  if ~array_equal(out_of_range,0b) then begin 
     in_range=1
     if out_of_range[0] then $  <span class="comments">;out of range low</span>
        in_range=total(V ge rebin(mn,s,/SAMP),1,/PRESERVE_TYPE) eq s[0]
     if out_of_range[1] then $  <span class="comments">;out of range high</span>
        in_range AND= total(V le rebin(mx,s,/SAMP),1,/PRESERVE_TYPE) eq s[0]
     h=(temporary(h) + 1L)*temporary(in_range) - 1L
  endif 

  ret=make_array(TYPE=3,DIMENSION=nbins,/NOZERO)
  if arg_present(ri) then $
     ret[0]=histogram(h,MIN=0L,MAX=total_bins-1L,REVERSE_INDICES=ri) $
  else $
     ret[0]=histogram(h,MIN=0L,MAX=total_bins-1L)
  return,ret
end
</code>
    </div>
  </body>
</html>