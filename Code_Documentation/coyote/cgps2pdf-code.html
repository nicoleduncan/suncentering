<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:56:27 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>cgps2pdf.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="cgps2pdf.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">; docformat = 'rst'</span>
<span class="comments">;</span>
<span class="comments">; NAME:</span>
<span class="comments">;   cgPS2PDF</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;   Converts a PostScript file to a PDF file.</span>
<span class="comments">;</span>
<span class="comments">;******************************************************************************************;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  Copyright (c) 2011, by Fanning Software Consulting, Inc. All rights reserved.           ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  Redistribution and use in source and binary forms, with or without                      ;</span>
<span class="comments">;  modification, are permitted provided that the following conditions are met:             ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;      * Redistributions of source code must retain the above copyright                    ;</span>
<span class="comments">;        notice, this list of conditions and the following disclaimer.                     ;</span>
<span class="comments">;      * Redistributions in binary form must reproduce the above copyright                 ;</span>
<span class="comments">;        notice, this list of conditions and the following disclaimer in the               ;</span>
<span class="comments">;        documentation and/or other materials provided with the distribution.              ;</span>
<span class="comments">;      * Neither the name of Fanning Software Consulting, Inc. nor the names of its        ;</span>
<span class="comments">;        contributors may be used to endorse or promote products derived from this         ;</span>
<span class="comments">;        software without specific prior written permission.                               ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  THIS SOFTWARE IS PROVIDED BY FANNING SOFTWARE CONSULTING, INC. ''AS IS'' AND ANY        ;</span>
<span class="comments">;  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES    ;</span>
<span class="comments">;  OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT     ;</span>
<span class="comments">;  SHALL FANNING SOFTWARE CONSULTING, INC. BE LIABLE FOR ANY DIRECT, INDIRECT,             ;</span>
<span class="comments">;  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED    ;</span>
<span class="comments">;  TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;         ;</span>
<span class="comments">;  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND             ;</span>
<span class="comments">;  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT              ;</span>
<span class="comments">;  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS           ;</span>
<span class="comments">;  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.                            ;</span>
<span class="comments">;******************************************************************************************;</span>
<span class="comments">;</span>
<span class="comments">;+</span>
<span class="comments">; Converts a PostScript file to a PDF file. This program requires</span>
<span class="comments">; the `Ghostscript &lt;http://www.ghostscript.com/download/>` program </span>
<span class="comments">; to be installed on the user's computer, unless you are using a </span>
<span class="comments">; Macintosh computer or an alterntive UNIX command to do the conversion</span>
<span class="comments">; for you. If you are on a Macintosh, the supplied pstopdf</span>
<span class="comments">; program is used instead. Use the `UNIX_Convert_Cmd` keyword to select</span>
<span class="comments">; an alternative UNIX command (e.g., pstopdf or epstopdf).</span>
<span class="comments">; </span>
<span class="comments">; The program requires the `Coyote Library &lt;http://www.idlcoyote.com/documents/programs.php>`</span>
<span class="comments">; to be installed on your machine.</span>
<span class="comments">;</span>
<span class="comments">; :Categories:</span>
<span class="comments">;    Utilities, Graphics</span>
<span class="comments">;    </span>
<span class="comments">; :Params:</span>
<span class="comments">;     ps_file: in, required, type=string</span>
<span class="comments">;         The name of the input PostScript file that is being converted to a PDF file.</span>
<span class="comments">;         If not provided, the user will be asked to select a file.</span>
<span class="comments">;     pdf_file: in, optional, type=string</span>
<span class="comments">;         The name of the output PDF file. If not provided, the name is constructed from</span>
<span class="comments">;         the input PostScript file name.</span>
<span class="comments">;</span>
<span class="comments">; :Keywords:</span>
<span class="comments">;     delete_ps: in, optional, type=boolean, default=0</span>
<span class="comments">;         If this keyword is set, the PostScript file will be deleted after conversion.</span>
<span class="comments">;     gs_path: in, optional, type=string</span>
<span class="comments">;         This program assumes that UNIX users can access Ghostscript with the "gs"</span>
<span class="comments">;         command. It assumes WINDOWS users have installed Ghostscript in either</span>
<span class="comments">;         the C:\gs or C:\Program Files\gs directories. If either of these assumptions</span>
<span class="comments">;         is incorrect, you can specify the directory where the Ghostscript executable</span>
<span class="comments">;         resides with this keyword. (The Windows 32-bit executable is named gswin32c.exe</span>
<span class="comments">;         and the 64-bit executable is named gswin64c.exe.)</span>
<span class="comments">;     pagetype: in, optional, type=string, default="LETTER"</span>
<span class="comments">;         Set this keyword to the "type" of page. Possible values are::</span>
<span class="comments">;</span>
<span class="comments">;            "Letter" - 8.5 by 11 inches.</span>
<span class="comments">;            "Legal" - 8.5 by 14 inches.</span>
<span class="comments">;            "Ledger" - 11 by 17 inches.</span>
<span class="comments">;            "A4" - 21.0 by 29.7 centimeters.</span>
<span class="comments">;            </span>
<span class="comments">;     showcmd: in, optional, type=boolean, default=0</span>
<span class="comments">;          Set this keyword to print the command that is spawned in the command output window.</span>
<span class="comments">;     silent: in, optional, type=boolean, default=0</span>
<span class="comments">;          Set this keyword to suppress output messages.</span>
<span class="comments">;     success: out, optional, type=boolean</span>
<span class="comments">;          Set this keyword to a named variable that on output will contain a 1 to </span>
<span class="comments">;          indicate successful completion of the command, or to 0 otherwise.</span>
<span class="comments">;     unix_convert_cmd: in, optional, type=string</span>
<span class="comments">;          There are a number of commands on UNIX machines for converting PostScript files</span>
<span class="comments">;          to PDF files. This program assumes you are using Ghostscript to do the conversion</span>
<span class="comments">;          for you. The Ghostscript command on most UNIX machines is "gs", which is used if</span>
<span class="comments">;          this keyword is undefined. However, if you would prefer to use another program to do</span>
<span class="comments">;          the conversion for you, you can specify the name of the command here. For example,</span>
<span class="comments">;          "pstopdf" or "epstopdf". In creating the actual command, this command will be</span>
<span class="comments">;          separated by a space from the input file name. In other words, if the alternative</span>
<span class="comments">;          conversion command was "pstopdf", the actual command would be "pstopdf" + " " + ps_file.</span>
<span class="comments">;          Any output filename is ignored. This command does not apply to Macintosh or Windows </span>
<span class="comments">;          computers.</span>
<span class="comments">;     version: out, optional, type=string</span>
<span class="comments">;         On exit, contains the version of Ghostscipt that was used. Not available on Macs</span>
<span class="comments">;         or if an alternative UNIX command was used.</span>
<span class="comments">;          </span>
<span class="comments">; :Examples:</span>
<span class="comments">;    A typical sequence of commands to create a test.pdf file::</span>
<span class="comments">;    </span>
<span class="comments">;       PS_Start, Filename='test.ps'</span>
<span class="comments">;       cgHistoplot, cgDemoData(7), /Fill</span>
<span class="comments">;       PS_End</span>
<span class="comments">;       cgPS2PDF, 'test.ps'</span>
<span class="comments">;       </span>
<span class="comments">; :Author:</span>
<span class="comments">;       FANNING SOFTWARE CONSULTING::</span>
<span class="comments">;           David W. Fanning </span>
<span class="comments">;           1645 Sheely Drive</span>
<span class="comments">;           Fort Collins, CO 80526 USA</span>
<span class="comments">;           Phone: 970-221-0438</span>
<span class="comments">;           E-mail: david@idlcoyote.com</span>
<span class="comments">;           Coyote's Guide to IDL Programming: http://www.idlcoyote.com</span>
<span class="comments">;</span>
<span class="comments">; :History:</span>
<span class="comments">;     Change History::</span>
<span class="comments">;        Written, 6 December 2011, from code supplied to me by Paul Krummel. DWF.</span>
<span class="comments">;        I had been using the Mac command pstopdf to create PDF files on Macs. Unfortunately, these</span>
<span class="comments">;           PDF files are rotated incorrectly for plots having a landscape aspect ratio (ie, most plots).</span>
<span class="comments">;           In this version of the software, I have decided to have Macs use Ghostscript and ImageMagick</span>
<span class="comments">;           like all other UNIX machines. However, I have left the pstopdf code in place to accommodate</span>
<span class="comments">;           anyone who prefers that method. You will have to uncomment the appropriate bits of code</span>
<span class="comments">;           (there are two places where this has to happen, search for "DARWIN" in the code). 14 Aug 2013. DWF.</span>
<span class="comments">;</span>
<span class="comments">; :Copyright:</span>
<span class="comments">;     Copyright (c) 2011, Fanning Software Consulting, Inc.</span>
<span class="comments">;-</span>
PRO cgPS2PDF, ps_file, pdf_file, $
   DELETE_PS=delete_ps, $
   GS_PATH=gs_path, $
   PAGETYPE=pagetype, $
   SHOWCMD=showcmd, $
   SILENT=silent, $
   SUCCESS=success, $
   UNIX_CONVERT_CMD=unix_convert_cmd, $
   VERSION=version

   Compile_Opt idl2
   
   <span class="comments">; Error handling.</span>
   Catch, theError
   IF theError NE 0 THEN BEGIN
      Catch, /CANCEL
      IF ~Keyword_Set(silent) THEN void = Error_Message()
      success = 0
      RETURN
   ENDIF

   <span class="comments">; Assume failure. Sigh...</span>
   success = 0

   <span class="comments">; Need an input file?</span>
   IF N_Elements(ps_file) EQ 0 THEN BEGIN
      file = cgPickfile(FILTER='*.ps', TITLE='Select a PostScript file...')
      IF file EQ "" THEN RETURN
      ps_file = file
   ENDIF
   
   <span class="comments">; Need to construct the PDF output file name?</span>
   IF N_Elements(pdf_file) EQ 0 THEN BEGIN
      root_name = cgRootName(ps_file, DIRECTORY=thisDir)
      pdf_file = Filepath(ROOT_DIR=thisDir, root_name + ".pdf")
   ENDIF
   
   <span class="comments">; Set default values for keywords.</span>
   SetDefaultValue, pagetype, "LETTER"
   delete_ps = Keyword_Set(delete_ps)
   showcmd = Keyword_Set(showcmd)
   silent = Keyword_Set(silent)
   
   <span class="comments">; Set up a Windows variable for later, so it doesn't cause problems</span>
   <span class="comments">; for me with Macs and UNIX machines.</span>
   exefile = ""
   
   <span class="comments">; Set the name of the Ghostscript executable or alternative conversion command.</span>
   <span class="comments">; Also set the docmdtest variable. If set to 0, the test to see if we can acutally</span>
   <span class="comments">; execute the command will be skipped. The test cannot be reliably executed on</span>
   <span class="comments">; all machines and for all conversion commands.</span>
   CASE StrUpCase(!Version.OS) OF 
   
      'WIN32': BEGIN

          <span class="comments">; Look for default locations, if not told otherwise.</span>
          IF (N_Elements(gs_path) EQ 0) || (gs_path EQ "") THEN gs_path = ['c:\program files\gs\','c:\gs\']
          IF !Version.Arch EQ 'x86_64' THEN exefile = 'gswin64c.exe' ELSE exefile = 'gswin32c.exe'
          file = File_Search(gs_path, exefile, COUNT=count, /FOLD_CASE)
          IF count EQ 0 THEN BEGIN
             IF ~Keyword_Set(silent) THEN Message, 'The Ghostscript executable file GSWIN32C.EXE cannot be found. Exiting without conversion.', /INFORMATIONAL
             RETURN
          ENDIF ELSE gs_exe = '"' + file[count-1] + '"'
          docmdtest = 1
          END
          
      'DARWIN': BEGIN
      	 
<span class="comments">; If you prefer to use pstopdf to do your PDF file conversion, uncomment this code and comment what is here.</span>
<span class="comments">; It is likely that pstopdf will not rotate the PDF file properly in all cases. There is also some code below</span>
<span class="comments">; this that will have to be uncommented, too.</span>
<span class="comments">;          IF (N_Elements(gs_path) EQ 0) || (gs_path EQ "") THEN gs_path = '/usr/bin/'</span>
<span class="comments">;          file = File_Search(gs_path, 'pstopdf', COUNT=count, /FOLD_CASE)</span>
<span class="comments">;          IF count EQ 0 THEN BEGIN</span>
<span class="comments">;             IF ~Keyword_Set(silent) THEN Message, 'The Ghostscript executable file "pstopdf" cannot be found. Exiting without conversion.', /INFORMATIONAL</span>
<span class="comments">;             RETURN</span>
<span class="comments">;          ENDIF ELSE gs_exe = file[count-1]</span>
<span class="comments">;          docmdtest = 0</span>
<span class="comments">;          END</span>
          
           <span class="comments">; Maybe the user provided an alternative command. If not, use the</span>
           <span class="comments">; standard "gs" command.</span>
           IF (N_Elements(unix_convert_cmd) NE 0) && (unix_convert_cmd NE "") THEN BEGIN
                gs_exe = unix_convert_cmd
                docmdtest = 0
           ENDIF ELSE BEGIN
                IF (N_Elements(gs_path) NE 0) && (gs_path NE "") THEN BEGIN
                    file = File_Search(gs_path, 'gs', COUNT=count)
                    IF count GT 0 THEN gs_exe = file[count-1]
                ENDIF ELSE gs_exe = 'gs'
                docmdtest = 1
           ENDELSE
            
           END
           
       ELSE: BEGIN <span class="comments">; UNIX flavors</span>
        
           <span class="comments">; Maybe the user provided an alternative command. If not, use the</span>
           <span class="comments">; standard "gs" command.</span>
           IF (N_Elements(unix_convert_cmd) NE 0) && (unix_convert_cmd NE "") THEN BEGIN
               gs_exe = unix_convert_cmd
               docmdtest = 0
           ENDIF ELSE BEGIN
               IF (N_Elements(gs_path) NE 0) && (gs_path NE "") THEN BEGIN
                    file = File_Search(gs_path, 'gs', COUNT=count)
                    IF count GT 0 THEN gs_exe = file[count-1]
               ENDIF ELSE gs_exe = 'gs'
               docmdtest = 1
           ENDELSE
            
          END
   ENDCASE
      
   <span class="comments">; Try the command to get the GhostScript version number. If it doesn't work,</span>
   <span class="comments">; we assume we can't use the command. This test cannot be done in all cases.</span>
   IF docmdtest THEN BEGIN
   
       testcmd = gs_exe + ' -version'
       result = ""
       error_result = ""
       
        <span class="comments">; Spawn the command, note the need for extra quotes here to handle spaces in directory names.</span>
        IF StrUpCase(!Version.OS_Family) EQ 'WINDOWS' THEN BEGIN
            Spawn, '"' + testcmd + '"', /HIDE, /LOG_OUTPUT, result, error_result
        ENDIF ELSE BEGIN
            Spawn, testcmd, result, error_result
        ENDELSE
        
        <span class="comments">; If no errors, then you can continue. Otherwise, stop here.</span>
        IF error_result[0] EQ "" THEN BEGIN
           version = result[0]
        ENDIF ELSE BEGIN
           Message, 'Cannot successfully SPAWN a Ghostscript command. No conversion possible.'
        ENDELSE
        
   ENDIF
   
   <span class="comments">; Construct the command that is to be spawned. </span>
   <span class="comments">;IF StrUpCase(!Version.OS) EQ 'DARWIN' THEN BEGIN ; Uncomment this line to use pstopdf on Macs</span>
   IF StrUpCase(!Version.OS) EQ 'FOO' THEN BEGIN <span class="comments">; The "true" section of code should never be executed.</span>
       cmd = gs_exe + " " + ps_file[0] + " -o " + pdf_file
   ENDIF ELSE BEGIN
   
       IF (N_Elements(unix_convert_cmd) NE 0) && (unix_convert_cmd NE "") THEN BEGIN
           cmd = gs_exe + " " + ps_file 
       ENDIF ELSE BEGIN 
           cmd = gs_exe + ' -sDEVICE=pdfwrite -q -dNOPAUSE -dBATCH'+ $
                ' -sPAPERSIZE=' + StrLowCase(pagetype) + $
                ' -sOutputFile="' + pdf_file + '" "' + ps_file + '"'
       ENDELSE
    ENDELSE
    
   <span class="comments">; Spawn the command, note the need for extra quotes here to handle spaces in directory names.</span>
    IF StrUpCase(!Version.OS_Family) EQ 'WINDOWS' THEN BEGIN
        Spawn, '"' + cmd + '"', /HIDE, result, error_result
    ENDIF ELSE BEGIN
        Spawn,  cmd,  result, error_result
    ENDELSE
    
    <span class="comments">; If you generated an error, report it. Errors in the SPAWNed command </span>
    <span class="comments">; don't seem to cause errors on Windows machines. :-(</span>
    IF error_result[0] NE "" THEN Message, error_result[0]
    
    <span class="comments">; If you get here, hurrah!</span>
    IF Keyword_Set(showcmd) THEN Print, cmd
    IF ~Keyword_Set(silent) THEN Print, 'Output PDF file: ' + pdf_file
    success = 1
   
   <span class="comments">; Delete the PostScript file?</span>
   IF Keyword_Set(delete_ps) THEN File_Delete, ps_file
END
</code>
    </div>
  </body>
</html>