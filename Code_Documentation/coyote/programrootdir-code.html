<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:09 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>programrootdir.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="programrootdir.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;*****************************************************************************************************</span>
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;       ProgramRootDir</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;</span>
<span class="comments">;       The purpose of this function is to provide a portable way of finding</span>
<span class="comments">;       the root directory of a program distribution. The directory that is returned</span>
<span class="comments">;       is the directory in which the source file using ProgramRootDir resides.</span>
<span class="comments">;       The program is useful for distributing applications that have a large number</span>
<span class="comments">;       of files in specific program directories.</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; AUTHOR:</span>
<span class="comments">;</span>
<span class="comments">;       FANNING SOFTWARE CONSULTING</span>
<span class="comments">;       1645 Sheely Drive</span>
<span class="comments">;       Fort Collins, CO 80526 USA</span>
<span class="comments">;       Phone: 970-221-0438</span>
<span class="comments">;       E-mail: david@idlcoyote.com</span>
<span class="comments">;</span>
<span class="comments">; SYNTAX:</span>
<span class="comments">;</span>
<span class="comments">;       theDirectory = ProgramRootDir()</span>
<span class="comments">;</span>
<span class="comments">; RETURN_VALUE:</span>
<span class="comments">;</span>
<span class="comments">;       theDirectory:   The directory in which the program module running ProgramRootDir resides.</span>
<span class="comments">;</span>
<span class="comments">; ARGUMENTS:</span>
<span class="comments">;</span>
<span class="comments">;       None.</span>
<span class="comments">;</span>
<span class="comments">; KEYWORDS:</span>
<span class="comments">;</span>
<span class="comments">;       NOMARK: Normally, the directory that is returned contains a path separator at its</span>
<span class="comments">;               end, so that the directory can easily be concatinated with other file names.</span>
<span class="comments">;               If this keyword is set, the final path separator mark is removed from the</span>
<span class="comments">;               directory name.</span>
<span class="comments">;</span>
<span class="comments">;       ONEUP:  Set this keyword if you want to start your search one directory</span>
<span class="comments">;               *above* where your source program resides (i.e., "../Source").</span>
<span class="comments">;               This allows you, for example, to put your source files in a Source</span>
<span class="comments">;               directory that it at the same level as your Data directory, Utility</span>
<span class="comments">;               directory, etc. See the example below.</span>
<span class="comments">;</span>
<span class="comments">;       TWOUP:  Set this keyword if you want to start your search two directories</span>
<span class="comments">;               *above* where your source program resides (i.e., "../../Source").</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; EXAMPLE:</span>
<span class="comments">;</span>
<span class="comments">;       Assume that your application files (and source programs) reside in this root directory:</span>
<span class="comments">;</span>
<span class="comments">;           ../app</span>
<span class="comments">;</span>
<span class="comments">;       You have placed a DATA directory immediately under the APP directiory, and a RESOURCES</span>
<span class="comments">;       directory immedately under the DATA directory. Your directory structure looks like this:</span>
<span class="comments">;</span>
<span class="comments">;           ../app                    ; Contains your application and source (*.pro) files.</span>
<span class="comments">;           ../app/data               ; Contains your application data files.</span>
<span class="comments">;           ...app/data/resources     ; Contains your application resource files.</span>
<span class="comments">;</span>
<span class="comments">;       The end user can install the APP directory wherever he or she likes. In your</span>
<span class="comments">;       program, you will identify the DATA and RESOURCES directory like this:</span>
<span class="comments">;</span>
<span class="comments">;            ; Get icon image in resources directory.</span>
<span class="comments">;            filename = Filepath(Root_Dir=ProgramRootDir(), Subdirectory=['data','resources'], 'myicon.tif')</span>
<span class="comments">;</span>
<span class="comments">;            ; Get default image in data directory.</span>
<span class="comments">;            filename = Filepath(Root_Dir=ProgramRootDir(), Subdirectory='data', 'ctscan.tif')</span>
<span class="comments">;</span>
<span class="comments">;       Alternatively, you might set up an application directory structure like this:</span>
<span class="comments">;</span>
<span class="comments">;           ../app                    ; Contains your application files.</span>
<span class="comments">;           ../app/source             ; Contains your application source (*.pro) files.</span>
<span class="comments">;           ../app/data               ; Contains your application data files.</span>
<span class="comments">;           ...app/data/resources     ; Contains your application resource files.</span>
<span class="comments">;</span>
<span class="comments">;       In this case, you would use the ONEUP keyword to find your data and resource files, like this:</span>
<span class="comments">;</span>
<span class="comments">;            ; Get icon image in resources directory.</span>
<span class="comments">;            filename = Filepath(Root_Dir=ProgramRootDir(/ONEUP), Subdirectory=['data','resources'], 'myicon.tif')</span>
<span class="comments">;</span>
<span class="comments">;            ; Get default image in data directory.</span>
<span class="comments">;            filename = Filepath(Root_Dir=ProgramRootDir(/ONEUP), Subdirectory='data', 'ctscan.tif')</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; MODIFICATION_HISTORY:</span>
<span class="comments">;</span>
<span class="comments">;       Written by: David W. Fanning, 23 November 2003. Based on program SOURCEROOT, written by</span>
<span class="comments">;         Jim Pendleton at RSI (http://www.rsinc.com/codebank/search.asp?FID=35).</span>
<span class="comments">;       Added ONEUP keyword. 10 December 2003. DWF.</span>
<span class="comments">;       Added TWOUP keyword. 8 June 2007. DWF.</span>
<span class="comments">;       Added NOMARK keyword. 8 June 2007. DWF.</span>
<span class="comments">;-</span>
<span class="comments">;******************************************************************************************;</span>
<span class="comments">;  Copyright (c) 2008, by Fanning Software Consulting, Inc.                                ;</span>
<span class="comments">;  All rights reserved.                                                                    ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  Redistribution and use in source and binary forms, with or without                      ;</span>
<span class="comments">;  modification, are permitted provided that the following conditions are met:             ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;      * Redistributions of source code must retain the above copyright                    ;</span>
<span class="comments">;        notice, this list of conditions and the following disclaimer.                     ;</span>
<span class="comments">;      * Redistributions in binary form must reproduce the above copyright                 ;</span>
<span class="comments">;        notice, this list of conditions and the following disclaimer in the               ;</span>
<span class="comments">;        documentation and/or other materials provided with the distribution.              ;</span>
<span class="comments">;      * Neither the name of Fanning Software Consulting, Inc. nor the names of its        ;</span>
<span class="comments">;        contributors may be used to endorse or promote products derived from this         ;</span>
<span class="comments">;        software without specific prior written permission.                               ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  THIS SOFTWARE IS PROVIDED BY FANNING SOFTWARE CONSULTING, INC. ''AS IS'' AND ANY        ;</span>
<span class="comments">;  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES    ;</span>
<span class="comments">;  OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT     ;</span>
<span class="comments">;  SHALL FANNING SOFTWARE CONSULTING, INC. BE LIABLE FOR ANY DIRECT, INDIRECT,             ;</span>
<span class="comments">;  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED    ;</span>
<span class="comments">;  TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;         ;</span>
<span class="comments">;  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND             ;</span>
<span class="comments">;  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT              ;</span>
<span class="comments">;  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS           ;</span>
<span class="comments">;  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.                            ;</span>
<span class="comments">;******************************************************************************************;</span>
FUNCTION ProgramRootDir, OneUp=oneup, TwoUp=twoup, NoMark=nomark

   <span class="comments">; Return to caller on an error.</span>
   On_Error, 2

   <span class="comments">; Get the current call stack.</span>
   Help, Calls=callStack

   <span class="comments">; Get the name of the calling routine.</span>
   callingRoutine = (StrSplit(StrCompress(callStack[1])," ", /Extract))[0]

   <span class="comments">; We don't know if the calling routine is a procedure or a function,</span>
   <span class="comments">; and we don't have a way to get information without knowing this. So,</span>
   <span class="comments">; we are going to try first to see if it is a procedure. If not, we</span>
   <span class="comments">; will try it as a function. Unfortunately, if it is *not* a procedure,</span>
   <span class="comments">; we will cause an error. We have to catch that and handle it silently.</span>

   Catch, theError
   IF theError NE 0 THEN BEGIN
      Catch, /Cancel
      Message, /Reset
      thisRoutine = Routine_Info(callingRoutine, /Functions, /Source)
   ENDIF

   IF N_Elements(thisRoutine) EQ 0 THEN $
      thisRoutine = Routine_Info(callingRoutine, /Source)

   <span class="comments">; If there are no path separators, you are here.</span>
   IF ( StrPos(thisRoutine.Path, Path_Sep()) ) EQ -1 THEN BEGIN
      CD, Current=thisDir
      sourcePath = FilePath(thisRoutine.Path, Root_Dir=thisDir)
   ENDIF ELSE BEGIN
      sourcePath = thisRoutine.Path
   ENDELSE

   <span class="comments">; Strip the root directory off the source path.</span>
   root = StrMid(sourcePath, 0, StrPos(sourcePath, Path_Sep(), /Reverse_Search) + 1)

   <span class="comments">; If ONEUP is set, then climb up the root directory by one directory. This will</span>
   <span class="comments">; be the *second* path separator, since the root directory has a path separator</span>
   <span class="comments">; as its end.</span>
   IF Keyword_Set(oneup) THEN BEGIN
      i = Where( Byte(root) EQ (Byte(Path_Sep()))[0], count)

      IF count GE 2 THEN BEGIN
         sourcePath = StrMid(root, 0, StrLen(root)-1)
         root = StrMid(sourcePath, 0, StrPos(sourcePath, Path_Sep(), /Reverse_Search) + 1)
      ENDIF
   ENDIF

   <span class="comments">; If TWOUP is set, then climb up the root directory by two directories. This will</span>
   <span class="comments">; be the *third* path separator, since the root directory has a path separator</span>
   <span class="comments">; as its end.</span>
   IF Keyword_Set(twoup) THEN BEGIN
      i = Where( Byte(root) EQ (Byte(Path_Sep()))[0], count)

      IF count GE 3 THEN BEGIN
         sourcePath = StrMid(root, 0, StrLen(root)-1)
         root = StrMid(sourcePath, 0, StrPos(sourcePath, Path_Sep(), /Reverse_Search) + 1)
         sourcePath = StrMid(root, 0, StrLen(root)-1)
         root = StrMid(sourcePath, 0, StrPos(sourcePath, Path_Sep(), /Reverse_Search) + 1)
      ENDIF
   ENDIF

   <span class="comments">; Remove last path separation mark, if requested.</span>
   IF Keyword_Set(nomark) THEN RETURN, StrMid(root, 0, StrLen(root)-1) ELSE RETURN, root
END

</code>
    </div>
  </body>
</html>