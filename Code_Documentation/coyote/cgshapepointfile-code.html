<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:56:29 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>cgshapepointfile.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="cgshapepointfile.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">; docformat = 'rst'</span>
<span class="comments">;</span>
<span class="comments">; NAME:</span>
<span class="comments">;   cgShapePointFile</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;   The purpose of this program is to create a shapefile filled with multiple</span>
<span class="comments">;   individual points as entities.</span>
<span class="comments">;</span>
<span class="comments">;******************************************************************************************;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  Copyright (c) 2012, by Fanning Software Consulting, Inc. All rights reserved.           ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  Redistribution and use in source and binary forms, with or without                      ;</span>
<span class="comments">;  modification, are permitted provided that the following conditions are met:             ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;      * Redistributions of source code must retain the above copyright                    ;</span>
<span class="comments">;        notice, this list of conditions and the following disclaimer.                     ;</span>
<span class="comments">;      * Redistributions in binary form must reproduce the above copyright                 ;</span>
<span class="comments">;        notice, this list of conditions and the following disclaimer in the               ;</span>
<span class="comments">;        documentation and/or other materials provided with the distribution.              ;</span>
<span class="comments">;      * Neither the name of Fanning Software Consulting, Inc. nor the names of its        ;</span>
<span class="comments">;        contributors may be used to endorse or promote products derived from this         ;</span>
<span class="comments">;        software without specific prior written permission.                               ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  THIS SOFTWARE IS PROVIDED BY FANNING SOFTWARE CONSULTING, INC. ''AS IS'' AND ANY        ;</span>
<span class="comments">;  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES    ;</span>
<span class="comments">;  OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT     ;</span>
<span class="comments">;  SHALL FANNING SOFTWARE CONSULTING, INC. BE LIABLE FOR ANY DIRECT, INDIRECT,             ;</span>
<span class="comments">;  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED    ;</span>
<span class="comments">;  TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;         ;</span>
<span class="comments">;  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND             ;</span>
<span class="comments">;  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT              ;</span>
<span class="comments">;  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS           ;</span>
<span class="comments">;  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.                            ;</span>
<span class="comments">;******************************************************************************************;</span>
<span class="comments">;</span>
<span class="comments">;+--------------------------------------------------------------------------</span>
<span class="comments">; The purpose of this program is to create a shapefile filled with multiple</span>
<span class="comments">; individual points as entities.</span>
<span class="comments">;</span>
<span class="comments">; :Categories:</span>
<span class="comments">;    Mapping, Utilities</span>
<span class="comments">;       </span>
<span class="comments">; :Author:</span>
<span class="comments">;    FANNING SOFTWARE CONSULTING::</span>
<span class="comments">;       David W. Fanning </span>
<span class="comments">;       1645 Sheely Drive </span>
<span class="comments">;       Fort Collins, CO 80526 USA </span>
<span class="comments">;       Phone: 970-221-0438 </span>
<span class="comments">;       E-mail: david@idlcoyote.com </span>
<span class="comments">;       Coyote's Guide to IDL Programming: http://www.idlcoyote.com</span>
<span class="comments">;       </span>
<span class="comments">; :Params:</span>
<span class="comments">;    xpts: in, required, type=vector</span>
<span class="comments">;       The X location of the input points. Presumed to be longitude values unless</span>
<span class="comments">;       the `MapCoord` keyword is used, in which case they are assumed to be in </span>
<span class="comments">;       projected meters values that will be converted to longitude values for </span>
<span class="comments">;       storage in the shapefile.</span>
<span class="comments">;    ypts: in, required, type=vector</span>
<span class="comments">;       The Y location of the input points. Presumed to be latitude values unless</span>
<span class="comments">;       the `MapCoord` keyword is used, in which case they are assumed to be in </span>
<span class="comments">;       projected meters values that will be converted to latitude values for </span>
<span class="comments">;       storage in the shapefile.</span>
<span class="comments">;       </span>
<span class="comments">; :Keywords:</span>
<span class="comments">;    append: in, optional, type=boolean, default=0</span>
<span class="comments">;       Set this keyword to append the points to a currently existing file. Otherwise,</span>
<span class="comments">;       a new file is created.</span>
<span class="comments">;    attributes: in, optional, type=structure</span>
<span class="comments">;       An array or scalar of "attribute" structures. If an array, it must be the same length as</span>
<span class="comments">;       in input data points. If not provided is will consist of the follow structure: {point:indexValue}. </span>
<span class="comments">;       If appending to a file, it must be defined in exactly the same way as the original file attributes.</span>
<span class="comments">;    filename: in, optional, type=string</span>
<span class="comments">;       The name of the shapefile. If not provided, the user will be asked to select a shape</span>
<span class="comments">;       file. If the file currently exists, it will be written over.</span>
<span class="comments">;    mapcoord: in, optional, type=object</span>
<span class="comments">;       A MapCoord object (e.g., cgMap) which will be used to convert the input points from</span>
<span class="comments">;       projected meter space to lat/lon space prior to saving the data in the shapefile.</span>
<span class="comments">;         </span>
<span class="comments">; :Examples:</span>
<span class="comments">;    Add two cities to a shapefile::</span>
<span class="comments">;       num = 2</span>
<span class="comments">;       x = FltArr(num)</span>
<span class="comments">;       y = FltArr(num)</span>
<span class="comments">;       attr = Replicate({namedStruct, state:"", city:""}, num)</span>
<span class="comments">;       x[0] = -104.87270</span>
<span class="comments">;       y[0] =   39.768040</span>
<span class="comments">;       attr[0] ={namedStruct, 'CO', 'DENVER'}</span>
<span class="comments">;       x[1] = -105.1</span>
<span class="comments">;       y[1] =   40.6</span>
<span class="comments">;       attr[1] ={nameStruct, 'CO', 'FORT COLLINS'}</span>
<span class="comments">;       cgShapePointFile, x, y, ATTRIBUTES=attr, FILENAME='test.shp'</span>
<span class="comments">;       </span>
<span class="comments">;    Add two more cities to the same shapefile::</span>
<span class="comments">;       num = 2</span>
<span class="comments">;       x = FltArr(num)</span>
<span class="comments">;       y = FltArr(num)</span>
<span class="comments">;       attr = Replicate({namedStruct, state:"", city:""}, num)</span>
<span class="comments">;       x[0] = -122.7</span>
<span class="comments">;       y[0] =   45.5</span>
<span class="comments">;       attr[0] ={namedStruct, 'OR', 'Portland'}</span>
<span class="comments">;       x[1] = -122.3</span>
<span class="comments">;       y[1] =   47.6</span>
<span class="comments">;       attr[1] ={namedStruct, 'WA', 'Seattle'}</span>
<span class="comments">;       cgShapePointFile, x, y, ATTRIBUTES=attr, FILENAME='test.shp', /APPEND</span>
<span class="comments">;</span>
<span class="comments">;    View the file you just created::</span>
<span class="comments">;       cgShapeInfo, 'test.shp'</span>
<span class="comments">;    </span>
<span class="comments">; :History:</span>
<span class="comments">;    Modification History::</span>
<span class="comments">;       Written by David W. Fanning, 23 August 2012.</span>
<span class="comments">;       </span>
<span class="comments">; :Copyright:</span>
<span class="comments">;    Copyright (c) 2012, Fanning Software Consulting, Inc.</span>
<span class="comments">;- </span>
PRO cgShapePointFile, xpts, ypts, $
   APPEND=appending, $
   ATTRIBUTES=attributes, $
   FILENAME=filename, $
   MAPCOORD=mapCoord
   
   Compile_Opt idl2
   
   <span class="comments">; Standard error handling.</span>
   Catch, theError
   IF theError NE 0 THEN BEGIN
       Catch, /CANCEL
       void = Error_Message()
       Obj_Destroy, shapefile
       RETURN
   ENDIF
   
   <span class="comments">; Need point input parameters of points.</span>
   IF N_Params() NE 2 THEN BEGIN
      void = Dialog_Message('Calling sequence: cgShapePointFile, xpts, ypts, ATTRIBUTES=attributes, FILENAME=filename')
      RETURN
   ENDIF
   
   <span class="comments">; Do we need a filename?</span>
   IF N_Elements(filename) EQ 0 THEN BEGIN
      filename = cgPickfile(/Write, Title='Select a SHAPEFILE for Writing...')
      IF filename EQ "" THEN RETURN
   ENDIF
   
   <span class="comments">; If the file exists, and you are not appending to it, then delete it.</span>
   appending = Keyword_Set(appending)
   IF File_Test(filename) && ~appending THEN BEGIN
      <span class="comments">; Print, 'Deleting current file: ' + filename</span>
      File_Delete, filename
   ENDIF

   <span class="comments">; Do the points have to be converted to lat/lon?</span>
   IF Obj_Valid(mapCoord) THEN BEGIN
       xy = mapCoord -> Inverse(xpts, ypts)
       x = Reform(xy[0,*])
       y = Reform(xy[1,*])
   ENDIF ELSE BEGIN
       x = xpts
       y = ypts
   ENDELSE
   
   IF N_Elements(xpts) NE N_Elements(ypts) THEN Message, 'The point vectors must be the same length.'
   numPts = N_Elements(xpts)
   
   <span class="comments">; Do we have an attibute structure?</span>
   IF N_Elements(attributes) EQ 0 THEN BEGIN
       struct = {point:0L}
       attributes = Replicate(struct, numPts)
       attributes.point = LIndgen(numPts)
   ENDIF
   IF N_Elements(attributes) EQ 1 THEN attributes = Replicate(attributes, numPts)
   IF N_Elements(attributes) NE numPts THEN $
      Message, 'The number of attribute structures must match the number of points being added.'
   
   <span class="comments">; Open the shapefile for writing point data.</span>
   IF appending THEN BEGIN
      shapefile = Obj_New('IDLffShape', filename, /UPDATE)
   ENDIF ELSE BEGIN
      shapefile = Obj_New('IDLffShape', filename, /UPDATE, ENTITY_TYPE=1)
   ENDELSE
   
   <span class="comments">; Define the attribute names if you are not appending to an already existing shapefile.</span>
   IF ~appending THEN BEGIN
   
       <span class="comments">; Set the attribute names.</span>
       struct = attributes[0]
       
       <span class="comments">; Make sure attribute names are less than 11 characters in length.</span>
       attrnames = Tag_Names(struct)
       index = Where(StrLen(attrnames) GT 11, count)
       IF count GT 0 THEN Message, 'Attribute names cannot be longer than 11 characters.'
       
       <span class="comments">; Get the attribute type.</span>
       FOR j=0,N_Elements(attrnames)-1 DO BEGIN
           value = struct.(j)
           dataType = Size(value, /TYPE)
           CASE dataType OF
               1: attrtype = 3
               2: attrtype = 3
               3: attrtype = 3
               4: attrtype = 5
               5: attrtype = 5
               7: attrtype = 7
               12: attrtype = 3
               13: attrtype = 3
               14: attrtype = 3
               ELSE: Message, 'Attribute value of type: ' + Size(value, /TNAME) + ' is not supported.'
           ENDCASE
           
           <span class="comments">; Define the new attribute.</span>
           CASE attrtype OF
               3: shapefile -> AddAttribute, attrnames[j], attrtype, 16
               5: shapefile -> AddAttribute, attrnames[j], attrtype, 20, Precision=8
               7: shapefile -> AddAttribute, attrnames[j], attrtype, 25
           ENDCASE
           
       ENDFOR
       
   ENDIF
   
   <span class="comments">; Loop, creating entities for all the points. Points are saved in the BOUNDS field.</span>
   FOR j=0,numPts-1 DO BEGIN
   
       <span class="comments">; Get a new entity structure.</span>
       entNew = {IDL_SHAPE_ENTITY}
       
       <span class="comments">; Define the new values.</span>
       entNew.SHAPE_TYPE = 1
       entNew.BOUNDS[0] = x[j]
       entNew.BOUNDS[1] = y[j]
       entNew.BOUNDS[2] = 0.00000000
       entNew.BOUNDS[3] = 0.00000000
       entNew.BOUNDS[4] = x[j]
       entNew.BOUNDS[5] = x[j]
       entNew.BOUNDS[6] = 0.00000000
       entNew.BOUNDS[7] = 0.00000000
       entNew.N_VERTICES = 1 
       
       <span class="comments">; Create a new attribute structure.</span>
       attrNew = shapefile -> GetAttributes(/ATTRIBUTE_STRUCTURE)
       
       thisAttrStruct = attributes[j]
       FOR k=0, N_Tags(attrNew)-1 DO BEGIN
            attrNew.(k) = thisAttrStruct.(k)
       ENDFOR
       
       <span class="comments">; Add the entity to the shapefile.</span>
       shapefile -> PutEntity, entNew
       
        <span class="comments">; Get the entity index.</span>
        shapefile -> GetProperty, N_ENTITIES=numEntities
        entity_index = numEntities-1
   
       <span class="comments">; Add the attributes to the shapefile</span>
       shapefile -> SetAttributes, entity_index, attrNew
   
   ENDFOR
   
   Obj_Destroy, shapefile
END
</code>
    </div>
  </body>
</html>