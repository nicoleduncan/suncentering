<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:56:20 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>cgmap_gshhs.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="cgmap_gshhs.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">; docformat = 'rst'</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">; </span>
<span class="comments">;      Uses files from the Globally Self-consistent Hierarchical High-resolution Shoreline</span>
<span class="comments">;      (GSHHS) data base to draw shorelines in the manner of MAP_CONTINENTS. In other words,</span>
<span class="comments">;      it is assumed that a map coordinate data space has been established prior to calling</span>
<span class="comments">;      this routine. See the example below. The GSHHS data files are</span>
<span class="comments">;      `available for downloading &lt;http://www.ngdc.noaa.gov/mgg/shorelines/gshhs.html>`.</span>
<span class="comments">;      An `article describing how to use this program &lt;http://www.idlcoyote.com/map_tips/gshhs.html>`</span>
<span class="comments">;      is also available.</span>
<span class="comments">;         </span>
<span class="comments">;      Note, the authors of the GSHHS software *continually* change the header</span>
<span class="comments">;      structure, which you MUST know to read the data file. There are are now</span>
<span class="comments">;      at least four different structures in common use. Please find the one</span>
<span class="comments">;      you need from the commented list below. The current code uses the structure</span>
<span class="comments">;      for the 2.2 version of the GSHHS software.</span>
<span class="comments">;</span>
<span class="comments">;******************************************************************************************;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  Copyright (c) 2011, by Fanning Software Consulting, Inc. All rights reserved.           ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  Redistribution and use in source and binary forms, with or without                      ;</span>
<span class="comments">;  modification, are permitted provided that the following conditions are met:             ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;      * Redistributions of source code must retain the above copyright                    ;</span>
<span class="comments">;        notice, this list of conditions and the following disclaimer.                     ;</span>
<span class="comments">;      * Redistributions in binary form must reproduce the above copyright                 ;</span>
<span class="comments">;        notice, this list of conditions and the following disclaimer in the               ;</span>
<span class="comments">;        documentation and/or other materials provided with the distribution.              ;</span>
<span class="comments">;      * Neither the name of Fanning Software Consulting, Inc. nor the names of its        ;</span>
<span class="comments">;        contributors may be used to endorse or promote products derived from this         ;</span>
<span class="comments">;        software without specific prior written permission.                               ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  THIS SOFTWARE IS PROVIDED BY FANNING SOFTWARE CONSULTING, INC. ''AS IS'' AND ANY        ;</span>
<span class="comments">;  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES    ;</span>
<span class="comments">;  OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT     ;</span>
<span class="comments">;  SHALL FANNING SOFTWARE CONSULTING, INC. BE LIABLE FOR ANY DIRECT, INDIRECT,             ;</span>
<span class="comments">;  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED    ;</span>
<span class="comments">;  TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;         ;</span>
<span class="comments">;  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND             ;</span>
<span class="comments">;  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT              ;</span>
<span class="comments">;  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS           ;</span>
<span class="comments">;  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.                            ;</span>
<span class="comments">;******************************************************************************************;</span>
<span class="comments">;</span>
<span class="comments">;+--------------------------------------------------------------------------</span>
<span class="comments">; The program uses files from the Globally Self-consistent Hierarchical High-resolution Shoreline</span>
<span class="comments">; (GSHHS) data base to draw shorelines in the manner of MAP_CONTINENTS. In other words,</span>
<span class="comments">; it is assumed that a map coordinate data space has been established prior to calling</span>
<span class="comments">; this routine. See the example below. The GSHHS data files are</span>
<span class="comments">; `available for downloading &lt;http://www.ngdc.noaa.gov/mgg/shorelines/gshhs.html>`.</span>
<span class="comments">; An `article describing how to use this program &lt;http://www.idlcoyote.com/map_tips/gshhs.html>`</span>
<span class="comments">; is also available.</span>
<span class="comments">;         </span>
<span class="comments">; Note, the authors of the GSHHS software *continually* change the header</span>
<span class="comments">; structure, which you MUST know to read the data file. There are are now</span>
<span class="comments">; at least four different structures in common use. Please find the one</span>
<span class="comments">; you need from the commented list in the code itself. The current code uses the structure</span>
<span class="comments">; for the 2.2 version of the GSHHS software.</span>
<span class="comments">; </span>
<span class="comments">; I have noticed that the polygon areas in the 2.2 version of the GSHHS software seem</span>
<span class="comments">; to contain completely bogus information. For example, the Great Lakes polygon is 1.7e7 </span>
<span class="comments">; square kilometers, while a tiny lake near-by is listed as 3.5e7 square kilometers. I have</span>
<span class="comments">; no explanation for why these values seem to be so wrong. I haven't tested this on other</span>
<span class="comments">; GSHHS versions of the data.</span>
<span class="comments">;</span>
<span class="comments">; :Categories:</span>
<span class="comments">;    Graphics, Map Projections</span>
<span class="comments">;    </span>
<span class="comments">; :Params:</span>
<span class="comments">;    filename: in, optional, type=string</span>
<span class="comments">;       The name of the GSHHS file to open. If not provided, the user will</span>
<span class="comments">;       be asked to select the file with a file selection tool.</span>
<span class="comments">;       </span>
<span class="comments">; :Keywords:</span>
<span class="comments">;    addcmd: in, optional, type=boolean, default=0</span>
<span class="comments">;        If this keyword is set, the object is added to the resizeable graphics</span>
<span class="comments">;        window, cgWindow. Note that a map projection command must be </span>
<span class="comments">;        added to the window before this command is added to be effective.</span>
<span class="comments">;    color: in, optional, type=string, default="opposite"</span>
<span class="comments">;        The name of the drawing color.</span>
<span class="comments">;    fill: in, optional, type=boolean, default=0</span>
<span class="comments">;        Set this keyword to draw filled outlines.</span>
<span class="comments">;    land_color: in, optional, type=string, default="tan8"</span>
<span class="comments">;        The name of the land color (for FILL). </span>
<span class="comments">;    level: in, optional, type=integer, default=2</span>
<span class="comments">;        The polygon LEVEL. All polygons less than or equal to this value</span>
<span class="comments">;        are drawn. 1-land, 2-lakes, 3-island in lake, 4-pond in island.</span>
<span class="comments">;        By default, 2 (land and lake outlines).</span>
<span class="comments">;    map_structure: in, optional, type=varies</span>
<span class="comments">;        A map projection structure (as created from MAP_PROJ_INIT) or a map coordinate</span>
<span class="comments">;        object (i.e., cgMap). If using a map projection structure, a map coordinate system </span>
<span class="comments">;        must be set up for the entire display window.</span>
<span class="comments">;    minarea: in, optional, type=float, default=500</span>
<span class="comments">;        The minimum feature area in square kilometers. Features with area below</span>
<span class="comments">;        the minimum area will not be drawn on the map.</span>
<span class="comments">;    noclip: in, optional, type=boolean, default=0</span>
<span class="comments">;        Normally the polygons and outlines are clipped to the plot boundaries.</span>
<span class="comments">;        Set this keyword to turn this feature off.</span>
<span class="comments">;    outline: in, optional, type=boolean</span>
<span class="comments">;        Set this keyword to draw outlines on filled polygons. Set to 1, by default, </span>
<span class="comments">;        if FILL=0. Set to zero to not draw outlines on filled polygons.</span>
<span class="comments">;    thick: in, optional, type=integer, default=!P.Thick</span>
<span class="comments">;        Set this keyword to the thickness of the lines that are drawn.</span>
<span class="comments">;    water_color: in, optional, type=string, default="sky blue"</span>
<span class="comments">;        The name of color to draw water features in.</span>
<span class="comments">;      </span>
<span class="comments">; :Author:</span>
<span class="comments">;    FANNING SOFTWARE CONSULTING::</span>
<span class="comments">;    David W. Fanning </span>
<span class="comments">;    1645 Sheely Drive </span>
<span class="comments">;    Fort Collins, CO 80526 USA </span>
<span class="comments">;    Phone: 970-221-0438 &lt;</span>
<span class="comments">;    E-mail: david@idlcoyote.com </span>
<span class="comments">;    Coyote's Guide to IDL Programming: http://www.idlcoyote.com</span>
<span class="comments">;</span>
<span class="comments">; :Examples:</span>
<span class="comments">;     Example using cgMAP_SET to set up the map coordinate space::</span>
<span class="comments">;</span>
<span class="comments">;         datafile = 'gshhs_h.b'</span>
<span class="comments">;         cgDisplay, 500, 350</span>
<span class="comments">;         pos = [0.1,0.1, 0.9, 0.8]</span>
<span class="comments">;         cgMap_Set, -25.0, 135.0, Position=pos, /Mercator, Scale=64e6, Color='black'</span>
<span class="comments">;         cgColorfill, [pos[0], pos[0], pos[2], pos[2], pos[0]], $</span>
<span class="comments">;                      [pos[1], pos[3], pos[3], pos[1], pos[1]], $</span>
<span class="comments">;                      /Normal, Color='sky blue'</span>
<span class="comments">;         cgMap_GSHHS, datafile, Fill=1, Level=3, Color='black', /Outline</span>
<span class="comments">;         cgText, 0.5, 0.85, 'Australia', Font=0, Color='black', /Normal, Alignment=0.5</span>
<span class="comments">;         cgPlotS, [pos[0], pos[0], pos[2], pos[2], pos[0]], $</span>
<span class="comments">;                  [pos[1], pos[3], pos[3], pos[1], pos[1]], $</span>
<span class="comments">;                  /Normal, Color='black', Thick=2</span>
<span class="comments">;</span>
<span class="comments">;     Example using MAP_PROJ_INIT to set up the map coordinate space::</span>
<span class="comments">;</span>
<span class="comments">;         datafile = 'gshhs_h.b'</span>
<span class="comments">;         cgDisplay</span>
<span class="comments">;         map = Obj_New('cgMap', "Lambert Azimuthal", Limit=[40, -95, 50, -75], $</span>
<span class="comments">;             Center_Lat=45, Center_Lon=-85)</span>
<span class="comments">;         map -> SetProperty, Position=[0.1, 0.1, 0.90, 0.75], /Draw</span>
<span class="comments">;         cgMap_GSHHS, datafile, /Fill, Level=3, Map_Structure=map, $</span>
<span class="comments">;             Water='DODGER BLUE'</span>
<span class="comments">;         cgMap_Grid, /Label, /Box, Color='charcoal', Map_Structure=map</span>
<span class="comments">;         cgMap_Continents, /USA, Map_Structure=map</span>
<span class="comments">;         cgText, 0.5, 0.85, 'Great Lakes Region', Font=0, Color='charcoal', $</span>
<span class="comments">;             /Normal, Alignment=0.5</span>
<span class="comments">;</span>
<span class="comments">; :History:</span>
<span class="comments">;    Modification History::</span>
<span class="comments">;        Written by David W. Fanning, from Map_GSHHS_Shoreline program, 12 November 2011.</span>
<span class="comments">;        Added THICK keyword. 28 Dec 2011. DWF.</span>
<span class="comments">;        Modified so you can pass a map object with the MAP_STRUCTURE keyword and not</span>
<span class="comments">;           have it change the object to a structure. 5 April 2012. DWF.</span>
<span class="comments">;    </span>
<span class="comments">; :Copyright:</span>
<span class="comments">;     Copyright (c) 2011, Fanning Software Consulting, Inc.</span>
<span class="comments">;---------------------------------------------------------------------------</span>
PRO cgMap_GSHHS, filename, $         <span class="comments">; The name of the GSHHS data file to open</span>
   ADDCMD=addcmd, $                  <span class="comments">; Add this command to a resizeable graphics window.</span>
   COLOR=color, $                    <span class="comments">; The name of the drawing color. </span>
   FILL=fill, $                      <span class="comments">; Set this keyword to draw filled outlines.</span>
   LAND_COLOR=land_color, $          <span class="comments">; The name of the land color (for FILL). </span>
   LEVEL=level, $                    <span class="comments">; The polygon LEVEL. </span>
   MAP_STRUCTURE=map_structure, $    <span class="comments">; A map projection structure (from MAP_PROJ_INIT).</span>
   MINAREA=minarea, $                <span class="comments">; The minimum feature area. By default, 500 km^2.</span>
   NOCLIP=noclip, $                  <span class="comments">; Clip the polygons and lines to the plot boundaries.</span>
   OUTLINE=outline, $                <span class="comments">; Set this keyword to draw shorelines. Set by default if FILL=0.</span>
   THICK=thick, $                    <span class="comments">; The thickness of the line that is drawn.</span>
   WATER_COLOR=water_color           <span class="comments">; The name of the water color. </span>


   <span class="comments">; Error handling.</span>
   Catch, theError
   IF theError NE 0 THEN BEGIN
      Catch, /Cancel
      void = Error_Message()
      IF N_Elements(lun) NE 0 THEN Free_Lun, lun
      IF N_Elements(thisState) NE 0 THEN SetDecomposedState, thisState
      IF N_Elements(r) NE 0 THEN TVLCT, r, g, b
      RETURN
   ENDIF

    IF Keyword_Set(addcmd) THEN BEGIN
    
       cgWindow, 'cgMap_GSHHS', filename, $ <span class="comments">; The name of the GSHHS data file to open</span>
           COLOR=color, $                    <span class="comments">; The name of the drawing color. </span>
           FILL=fill, $                      <span class="comments">; Set this keyword to draw filled outlines.</span>
           LAND_COLOR=land_color, $          <span class="comments">; The name of the land color (for FILL). </span>
           LEVEL=level, $                    <span class="comments">; The polygon LEVEL. </span>
           MAP_STRUCTURE=map_structure, $    <span class="comments">; A map projection structure (from MAP_PROJ_INIT).</span>
           MINAREA=minarea, $                <span class="comments">; The minimum feature area. By default, 500 km^2.</span>
           OUTLINE=outline, $                <span class="comments">; Set this keyword to draw shorelines. Set by default if FILL=0.</span>
           THICK=thick, $                    <span class="comments">; The thickness of the line that is drawn.</span>
           WATER_COLOR=water_color, $        <span class="comments">; The name of the water color. </span>
           ADDCMD=1
          
       RETURN
       
    ENDIF
    
   <span class="comments">; Do this in decomposed color mode if possible.</span>
   SetDecomposedState, 1, CurrentState=thisState
   TVLCT, r, g, b, /Get
   
   <span class="comments">; Default values.</span>
   IF N_Elements(filename) EQ 0 THEN BEGIN
      filename = Dialog_Pickfile(Filter='*.b', Title='Select GSHHS File...')
      IF filename EQ "" THEN RETURN
   ENDIF
   
   <span class="comments">; Make sure the filename exists.</span>
   IF ~File_Test(filename, /Read) THEN Message, 'Cannot find or read the file ' + filename + '.'
   
   IF Keyword_Set(fill) THEN temp_outline = 0 ELSE temp_outline = 1
   fill = Keyword_Set(fill)
   
   <span class="comments">; If you are doing graphics on a display device and there is no window</span>
   <span class="comments">; open one so you can do Convert_Coord correctly.)</span>
   IF (!D.Name EQ 'WIN') || (!D.Name EQ 'X') && (!D.Window LT 0) THEN cgDisplay
 
   <span class="comments">; If you got a map object, use it to recover a map structure</span>
   <span class="comments">; and to set up the map coordinate space.</span>
   IF N_Elements(map_structure) NE 0 THEN BEGIN
       IF Obj_Valid(map_structure) THEN BEGIN
          mapObj = map_structure
          mapStruct = mapObj -> GetMapStruct()           
          mapObj -> Draw, /NoGraphics
       ENDIF ELSE mapStruct = map_structure
   ENDIF 
   
   IF N_Elements(outline) EQ 0 THEN outline = temp_outline ELSE outline = Keyword_Set(outline)
   IF N_Elements(level) EQ 0 THEN level = 2 ELSE level = 1 > level &lt<span class="comments">; 4</span>
   SetDefaultValue, minArea, 500.0 <span class="comments">; square kilometers.</span>
   noclip = Keyword_Set(noclip)
   SetDefaultValue, color, 'opposite'
   SetDefaultValue, water_color, 'sky blue'
   SetDefaultValue, land_color, 'tan8'
   SetDefaultValue, thick, !P.Thick

   <span class="comments">; Open the GSHHS data file.</span>
   OPENR, lun, filename, /Get_Lun, /Swap_If_Little_Endian

<span class="comments">;   ; Define the polygon header. This is for versions of the GSHHS software of 1.3 and earlier.</span>
<span class="comments">;   header = { id: 0L, $        ; A unique polygon ID number, starting at 0.</span>
<span class="comments">;              npoints: 0L, $   ; The number of points in this polygon.</span>
<span class="comments">;              polygonLevel: 0L, $ ; 1 land, 2 lake, 3 island-in-lake, 4 pond-in-island.</span>
<span class="comments">;              west: 0L, $      ; West extent of polygon boundary in micro-degrees.</span>
<span class="comments">;              east: 0L, $      ; East extent of polygon boundary in micro-degrees.</span>
<span class="comments">;              south: 0L, $     ; South extent of polygon boundary in micro-degrees.</span>
<span class="comments">;              north: 0L, $     ; North extent of polygon boundary in micro-degrees.</span>
<span class="comments">;              area: 0L, $      ; The area of polygon in 1/10 km^2.</span>
<span class="comments">;              version: 0L, $   ; Polygon version, always set to 3 in this version.</span>
<span class="comments">;              greenwich: 0S, $ ; Set to 1 if Greenwich median is crossed by polygon.</span>
<span class="comments">;              source: 0S }     ; Database source: 0 WDB, 1 WVS.</span>

   <span class="comments">; Define the polygon header, for GSHHS software 1.4 through 1.11, which uses a 40 byte</span>
   <span class="comments">; header structure. For example, gshhs_i.b from the gshhs_1.10.zip file.</span>
<span class="comments">;   header = { id: 0L, $        ; A unique polygon ID number, starting at 0.</span>
<span class="comments">;              npoints: 0L, $   ; The number of points in this polygon.</span>
<span class="comments">;              flag: 0L, $      ; Contains polygonlevel, version, greenwich, and source values.</span>
<span class="comments">;              west: 0L, $      ; West extent of polygon boundary in micro-degrees.</span>
<span class="comments">;              east: 0L, $      ; East extent of polygon boundary in micro-degrees.</span>
<span class="comments">;              south: 0L, $     ; South extent of polygon boundary in micro-degrees.</span>
<span class="comments">;              north: 0L, $     ; North extent of polygon boundary in micro-degrees.</span>
<span class="comments">;              area: 0L, $      ; Database source: 0 WDB, 1 WVS.</span>
<span class="comments">;              junk:bytarr(8)}  ; Eight bytes of junk to pad header.     </span>

   <span class="comments">; Define the polygon header, for GSHHS software 1.4 through 1.11, which uses a 32 byte</span>
   <span class="comments">; header structure. For example, gshhs_h.b from the gshhs_1.11.zip.</span>
<span class="comments">;   header = { id: 0L, $        ; A unique polygon ID number, starting at 0.</span>
<span class="comments">;              npoints: 0L, $   ; The number of points in this polygon.</span>
<span class="comments">;              flag: 0L, $      ; Contains polygonlevel, version, greenwich, and source values.</span>
<span class="comments">;              west: 0L, $      ; West extent of polygon boundary in micro-degrees.</span>
<span class="comments">;              east: 0L, $      ; East extent of polygon boundary in micro-degrees.</span>
<span class="comments">;              south: 0L, $     ; South extent of polygon boundary in micro-degrees.</span>
<span class="comments">;              north: 0L, $     ; North extent of polygon boundary in micro-degrees.</span>
<span class="comments">;              area: 0L}        ; Database source: 0 WDB, 1 WVS.</span>
              
   <span class="comments">; Define the polygon header, for GSHHS software 2.0, which uses a 44 byte</span>
   <span class="comments">; header structure. For example, gshhs_h.b from the gshhs_2.0.zip.</span>
   header = { id: 0L, $        <span class="comments">; A unique polygon ID number, starting at 0.</span>
              npoints: 0L, $   <span class="comments">; The number of points in this polygon.</span>
              flag: 0L, $      <span class="comments">; Contains polygon level, version, greenwich, source, and river values.</span>
              west: 0L, $      <span class="comments">; West extent of polygon boundary in micro-degrees.</span>
              east: 0L, $      <span class="comments">; East extent of polygon boundary in micro-degrees.</span>
              south: 0L, $     <span class="comments">; South extent of polygon boundary in micro-degrees.</span>
              north: 0L, $     <span class="comments">; North extent of polygon boundary in micro-degrees.</span>
              area: 0L, $      <span class="comments">; Area of polygon in 1/10 km^2.</span>
              area_full: 0L, $ <span class="comments">; Area of origiinal full-resolution polygon in 1/10 km^2.</span>
              container: 0L, $ <span class="comments">; ID of container polygon that encloses this polygon (-1 if "none").</span>
              ancestor: 0L }   <span class="comments">; ID of ancestor polygon in the full resolution set that was the source</span>
                               <span class="comments">; of this polygon (-1 of "none").</span>

   <span class="comments">; Read the data and plot if required.</span>
   count = 0L
   WHILE (EOF(lun) NE 1) DO BEGIN
   
      READU, lun, header
      
      <span class="comments">; Parse the flag. Version 6 corresponds to 1.1x. Version 7 cooresponds to 2.0.</span>
      f = header.flag
      version = ISHFT(f, -8) AND 255B
      IF version LT 7 THEN BEGIN
          IF version GT 3 THEN BEGIN
             polygonLevel = (f AND 255B) 
          ENDIF ELSE BEGIN
             polygonLevel = header.level
          ENDELSE
          greenwich = ISHFT(f, -16) AND 255B
          source = ISHFT(f, -24) AND 255B
      ENDIF ELSE BEGIN
          polygonLevel = (f AND 255B) 
          greenwich = ISHFT(f, -16) AND 1B
          source = ISHFT(f, -24) AND 1B
          river = ISHFT(f, -25) AND 1B
      ENDELSE
      
      <span class="comments">; Get the polygon coordinates. Convert to lat/lon.</span>
      polygon = LonArr(2, header.npoints, /NoZero)
      READU, lun, polygon
      lon = Reform(polygon[0,*] * 1.0e-6)
      lat = Reform(polygon[1,*] * 1.0e-6)
      Undefine, polygon

      <span class="comments">; Discriminate polygons based on header information.</span>
      polygonArea = header.area * 0.1
   
      IF polygonLevel GT level THEN CONTINUE
      IF polygonArea LE minArea THEN CONTINUE

      <span class="comments">; If you have a MAP_STRUCTURE variable, use it to warp LAT/LON coordinates.</span>
      <span class="comments">; No point in displaying polygons that are completely outside plot</span>
      <span class="comments">; area set up by a map projection (MAP_SET) or some other plotting</span>
      <span class="comments">; command.</span>
      IF N_Elements(mapStruct) NE 0 THEN BEGIN
      
         <span class="comments">; Convert lons from -180 to 180 to 0 to 360.</span>
         lon = ((lon + 180) MOD 360) - 180
         <span class="comments">;lon = (lon + 360.0) MOD 360.0</span>
         xy = Map_Proj_Forward(lon, lat, MAP_STRUCTURE=mapStruct)
         lon = Reform(xy[0,*])
         lat = Reform(xy[1,*])
         
      ENDIF
      
      xy = Convert_Coord(lon, lat, /Data, /To_Normal)
      check = ((xy[0,*] GE !X.Window[0]) AND (xy[0,*] LE !X.Window[1])) AND $
              ((xy[1,*] GE !Y.Window[0]) AND (xy[1,*] LE !Y.Window[1]))
      usePolygon = Max(check)

      IF usePolygon EQ 0 THEN CONTINUE

      <span class="comments">; Draw polygons. Outlines drawn with PLOTS, filled polygons drawn with</span>
      <span class="comments">; POLYFILL. Assumes lat/lon data coordinate space and colors are set up.</span>
      IF Keyword_Set(fill) THEN BEGIN
         IF (polygonLevel EQ 1) OR (polygonLevel EQ 3) THEN BEGIN
             POLYFILL, lon, lat, Color=cgColor(land_color), NOCLIP=noclip 
         ENDIF ELSE BEGIN
             POLYFILL, lon, lat, Color=cgColor(water_color), NOCLIP=noclip
         ENDELSE

      ENDIF ELSE BEGIN

         PLOTS, lon, lat, Color=cgColor(color), NOCLIP=noclip, Thick=thick

      ENDELSE

      <span class="comments">; Need outlines with a fill?</span>
      IF Keyword_Set(fill) AND Keyword_Set(outline) THEN $
         PLOTS, lon, lat, Color=cgColor(color), NOCLIP=noclip, Thick=thick

   ENDWHILE
   Free_Lun, lun

   <span class="comments">; Restore decomposition state.</span>
   SetDecomposedState, thisState
   
   IF !D.NAME NE 'Z' THEN TVLCT, r, g, b
END
</code>
    </div>
  </body>
</html>