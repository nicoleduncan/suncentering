<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:56:14 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>cgkml_file__define.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="cgkml_file__define.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">; docformat = 'rst'</span>
<span class="comments">;</span>
<span class="comments">; NAME:</span>
<span class="comments">;   cgKML_File</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;   This program creates a KML file that can be displayed with Google Earth.</span>
<span class="comments">;</span>
<span class="comments">;******************************************************************************************;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  Copyright (c) 2012, by Fanning Software Consulting, Inc. All rights reserved.           ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  Redistribution and use in source and binary forms, with or without                      ;</span>
<span class="comments">;  modification, are permitted provided that the following conditions are met:             ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;      * Redistributions of source code must retain the above copyright                    ;</span>
<span class="comments">;        notice, this list of conditions and the following disclaimer.                     ;</span>
<span class="comments">;      * Redistributions in binary form must reproduce the above copyright                 ;</span>
<span class="comments">;        notice, this list of conditions and the following disclaimer in the               ;</span>
<span class="comments">;        documentation and/or other materials provided with the distribution.              ;</span>
<span class="comments">;      * Neither the name of Fanning Software Consulting, Inc. nor the names of its        ;</span>
<span class="comments">;        contributors may be used to endorse or promote products derived from this         ;</span>
<span class="comments">;        software without specific prior written permission.                               ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  THIS SOFTWARE IS PROVIDED BY FANNING SOFTWARE CONSULTING, INC. ''AS IS'' AND ANY        ;</span>
<span class="comments">;  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES    ;</span>
<span class="comments">;  OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT     ;</span>
<span class="comments">;  SHALL FANNING SOFTWARE CONSULTING, INC. BE LIABLE FOR ANY DIRECT, INDIRECT,             ;</span>
<span class="comments">;  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED    ;</span>
<span class="comments">;  TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;         ;</span>
<span class="comments">;  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND             ;</span>
<span class="comments">;  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT              ;</span>
<span class="comments">;  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS           ;</span>
<span class="comments">;  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.                            ;</span>
<span class="comments">;******************************************************************************************;</span>
<span class="comments">;</span>
<span class="comments">;+</span>
<span class="comments">;   This program creates a KML file that can be displayed with Google Earth.</span>
<span class="comments">;   It implements some (not all) of the objects or elements allowed in KML files. For </span>
<span class="comments">;   reference, see  the `Google KML Reference Documentation &lt;https://developers.google.com/kml/documentation/kmlreference>`.</span>
<span class="comments">;</span>
<span class="comments">; :Categories:</span>
<span class="comments">;    Graphics, FileIO</span>
<span class="comments">;    </span>
<span class="comments">; :Examples:</span>
<span class="comments">;    To create an image overlay object::</span>
<span class="comments">;    </span>
<span class="comments">;      kml = Obj_New('cgKML_File', 'test.kml')</span>
<span class="comments">;      overlay = Obj_New('cgKML_GroundOverlay', $</span>
<span class="comments">;          HREF='myimage.tif', $</span>
<span class="comments">;          LATLONBOX=[])</span>
<span class="comments">;      kml -> Add, overlay</span>
<span class="comments">;      kml -> Save</span>
<span class="comments">;      kml -> Destroy</span>
<span class="comments">;       </span>
<span class="comments">; :Author:</span>
<span class="comments">;    FANNING SOFTWARE CONSULTING::</span>
<span class="comments">;       David W. Fanning </span>
<span class="comments">;       1645 Sheely Drive</span>
<span class="comments">;       Fort Collins, CO 80526 USA</span>
<span class="comments">;       Phone: 970-221-0438</span>
<span class="comments">;       E-mail: david@idlcoyote.com</span>
<span class="comments">;       Coyote's Guide to IDL Programming: http://www.idlcoyote.com</span>
<span class="comments">;</span>
<span class="comments">; :History:</span>
<span class="comments">;     Change History::</span>
<span class="comments">;        Written, 28 October 2012 by David W. Fanning.</span>
<span class="comments">;</span>
<span class="comments">; :Copyright:</span>
<span class="comments">;     Copyright (c) 2012, Fanning Software Consulting, Inc.</span>
<span class="comments">;-</span>


<span class="comments">;+</span>
<span class="comments">; The purpose of this method is to establish the name of a KML file that is to be written. Optionally,</span>
<span class="comments">; a hint attribute can be specified that indicated to Google Earth that is should switch to sky view or</span>
<span class="comments">; to another celestial body, such as Mars.</span>
<span class="comments">;</span>
<span class="comments">; :Params:</span>
<span class="comments">;     filename: in, optional, type=string</span>
<span class="comments">;         The name of the KML file to be created. The output file should have a file extension of *.kml.</span>
<span class="comments">;         </span>
<span class="comments">; :Keywords:</span>
<span class="comments">;     hint: in, optional, type=string</span>
<span class="comments">;         A hint attribute (http://simplekml.readthedocs.org/en/latest/kml.html). Hint attributes are</span>
<span class="comments">;         used as a signal to Google Earth to switch to sky view or to another celestial body, such as Mars.</span>
<span class="comments">;-</span>
FUNCTION cgKML_File::INIT, filename, HINT=hint

  Compile_Opt idl2
  
  Catch, theError
  IF theError NE 0 THEN BEGIN
     Catch, /CANCEL
     void = Error_Message()
     RETURN, 0
  ENDIF
  
  <span class="comments">; Need a filename?</span>
  IF N_Elements(filename) EQ 0 THEN BEGIN
     filename = cgPickfile(Filter='*.kml', Title='Select a KML Filename...', /WRITE)
     IF filename EQ "" THEN RETURN, 0
  ENDIF
    
  <span class="comments">; Call the superclass object's INIT method.</span>
  IF ~self -> cgContainer::INIT(_Strict_Extra=extra) THEN RETURN, 0

  <span class="comments">; Load the object.</span>
  self.filename = filename
  IF N_Elements(hint) NE 0 THEN self.hint = hint

  RETURN, 1

END


<span class="comments">;+</span>
<span class="comments">; This method allows KML objects to be added to the KML file.</span>
<span class="comments">; </span>
<span class="comments">; :Params:</span>
<span class="comments">;     theobject: in, required, type=object</span>
<span class="comments">;         Only objects of class cgKML_OBJECT can be added to a KML file object.</span>
<span class="comments">;-</span>
PRO cgKML_File::Add, theObject

  Compile_Opt idl2
  
  Catch, theError
  IF theError NE 0 THEN BEGIN
     Catch, /CANCEL
     void = Error_Message()
     RETURN
  ENDIF
  
  <span class="comments">; Error checking</span>
  IF N_Elements(theObject) EQ 0 THEN Message, 'An object is required in this method.'
  IF Obj_Valid(theObject) EQ 0 THEN Message, 'The object to be added in invalid.'

  <span class="comments">; Add the object, if it is of the correct type.</span>
  IF Obj_ISA(theObject, 'cgKML_OBJECT') THEN BEGIN
  
      <span class="comments">; Add yourself as the parent of this object.</span>
      theObject -> SetProperty, PARENT=parent
      self -> IDL_CONTAINER::Add, theObject 
      
  ENDIF ELSE Message, 'Object must be of type cgKML_OBJECT to be added to a KML file.'
      
END


<span class="comments">;+</span>
<span class="comments">; This method writes the contents of each KML object included in the file</span>
<span class="comments">; to the file in a recursive way.</span>
<span class="comments">; </span>
<span class="comments">; :Keywords:</span>
<span class="comments">;     lun: in, required, type=integer</span>
<span class="comments">;         The logical unit number that the KML file is attached to.</span>
<span class="comments">;-</span>
PRO cgKML_File::Body, LUN=lun

  Compile_Opt idl2
  
  Catch, theError
  IF theError NE 0 THEN BEGIN
     Catch, /CANCEL
     void = Error_Message()
     RETURN
  ENDIF
  
  <span class="comments">; A logical unit number is required.</span>
  IF N_Elements(lun) EQ 0 THEN Message, 'A logical unit number must be supplied with the LUN keyword.'
  
  <span class="comments">; How many objects are in the container?</span>
  numObjects = self -> Count()
  
  <span class="comments">; Call them one after the other.</span>
  FOR j=0,numObjects-1 DO BEGIN
      thisObject = self -> Get(Position=j)
      IF Obj_Valid(thisObject) THEN BEGIN
         thisObject -> Build, LUN=lun
      ENDIF ELSE Message, 'Object ' + StrTrim(j,2) + ' is invalid.', /Informational
  ENDFOR

END


<span class="comments">;+</span>
<span class="comments">; This method destroys the KML_File object.</span>
<span class="comments">;-</span>
PRO cgKML_File::Destroy
   Obj_Destroy, self
END


<span class="comments">;+</span>
<span class="comments">; This method allows the user to obtain properties of the object.</span>
<span class="comments">;</span>
<span class="comments">; :Keywords:</span>
<span class="comments">;     filename: out, optional, type=string</span>
<span class="comments">;         The name of the KML file being created.</span>
<span class="comments">;     hint: out, optional, type=string</span>
<span class="comments">;         The hint attribute that was input to the file via the INIT or SetProperty methods.</span>
<span class="comments">;     level: out, optional, type=integer</span>
<span class="comments">;         The heirarchtical level of this object.</span>
<span class="comments">;     </span>
<span class="comments">;-</span>
PRO cgKML_File::GetProperty, $
  FILENAME=filename, $
  HINT=hint, $
  LEVEL=level, $
  _REF_EXTRA=extra

  IF Arg_Present(filename) THEN filename = self.filename
  IF Arg_Present(hint) THEN hint = self.hint
  IF Arg_Present(level) THEN level = self.level
  IF N_Elements(extra) NE 0 THEN self -> cgCONTAINER::GetProperty, _EXTRA=extra
  
END

<span class="comments">;+</span>
<span class="comments">; This method opens the &lt;kml> element and writes it to the file.</span>
<span class="comments">;</span>
<span class="comments">; :Keywords:</span>
<span class="comments">;     lun: in, required, type=integer</span>
<span class="comments">;         The logical unit number that the KML file is attached to.</span>
<span class="comments">;-</span>
PRO cgKML_File::Head, LUN=lun

  Compile_Opt idl2
  
  Catch, theError
  IF theError NE 0 THEN BEGIN
     Catch, /CANCEL
     void = Error_Message()
     RETURN
  ENDIF
  
  <span class="comments">; A logical unit number is required.</span>
  IF N_Elements(lun) EQ 0 THEN Message, 'A logical unit number must be supplied with the LUN keyword.'
  
  <span class="comments">; The opening xml tag. Google and Atom extensions are also present.</span>
  IF N_Elements(lun) EQ 0 THEN Message, 'A logical unit number must be supplied with LUN keyword.'
  PrintF, lun, '&lt;?xml version="1.0" encoding="UTF-8"?>'
  PrintF, lun, '&lt;kml xmlns="http://www.opengis.net/kml/2.2"'
  IF self.hint NE "" THEN  PrintF, lun, ' hint="target=' + self.hint  
  PrintF, lun, ' xmlns:gx="http://www.google.com/kml/ext/2.2"'
  PrintF, lun, ' xmlns:atom="http://www.w3.org/2005/Atom">'
  PrintF, lun, '&lt;Document>'
  
END


<span class="comments">;+</span>
<span class="comments">; This method saves the KML file and writes it to disk.</span>
<span class="comments">; </span>
<span class="comments">; :Keywords:</span>
<span class="comments">;     supportfiles: in, optional, type=string</span>
<span class="comments">;         A string array of files that should be included in the KMZ file</span>
<span class="comments">;         along with the KML file. Will search for files, in not included.</span>
<span class="comments">;     kmz: in, required, type=boolean, default=0</span>
<span class="comments">;         If this keyword is set, the KML file is zipped into a KMZ. Only available for IDL 8.0</span>
<span class="comments">;         and higher.</span>
<span class="comments">;-</span>
PRO cgKML_File::Save, KMZ=kmz, SupportFiles=supportFiles

  Compile_Opt idl2
  
  Catch, theError
  IF theError NE 0 THEN BEGIN
     Catch, /CANCEL
     void = Error_Message()
     RETURN
  ENDIF
  
  <span class="comments">; Open the file for writing.</span>
  Get_Lun, lun
  OpenW, lun, self.filename
  
  <span class="comments">; Write the file contents.</span>
  self -> Head, LUN=lun
  self -> Body, LUN=lun
  self -> Tail, LUN=lun
  
  <span class="comments">; Free up the logical unit number</span>
  Free_Lun, lun
  
  <span class="comments">; Need to move this file and support files to a KMZ file?</span>
  IF Keyword_Set(kmz) THEN cgKML2KMZ, self.filename, supportFiles
  
END


<span class="comments">;+</span>
<span class="comments">; This method allows the user to set properties of the object.</span>
<span class="comments">;</span>
<span class="comments">; :Keywords:</span>
<span class="comments">;     filename: in, optional, type=string</span>
<span class="comments">;         The name of the KML file being created.</span>
<span class="comments">;     hint: in, optional, type=string</span>
<span class="comments">;         A hint attribute (http://simplekml.readthedocs.org/en/latest/kml.html). Hint attributes are</span>
<span class="comments">;         used as a signal to Google Earth to switch to sky view or to another celestial body, such as Mars.     </span>
<span class="comments">;-</span>
PRO cgKML_File::SetProperty, $
  FILENAME=filename, $
  HINT=hint, $
  _REF_EXTRA=extra

  IF Arg_Present(filename) THEN filename = self.filename
  IF Arg_Present(hint) THEN hint = self.hint
  IF N_Elements(extra) NE 0 THEN self -> cgCONTAINER::SetProperty, _EXTRA=extra
  
END


<span class="comments">;+</span>
<span class="comments">; This method closes the &lt;kml> element.</span>
<span class="comments">;</span>
<span class="comments">; :Keywords:</span>
<span class="comments">;     lun: in, required, type=integer</span>
<span class="comments">;         The logical unit number that the KML file is attached to.</span>
<span class="comments">;-</span>
PRO cgKML_File::Tail, LUN=lun

  Compile_Opt idl2
  
  Catch, theError
  IF theError NE 0 THEN BEGIN
     Catch, /CANCEL
     void = Error_Message()
     RETURN
  ENDIF
  
  <span class="comments">; A logical unit number is required.</span>
  IF N_Elements(lun) EQ 0 THEN Message, 'A logical unit number must be supplied with the LUN keyword.'
  
  <span class="comments">; Close the element.</span>
  PrintF, lun, '&lt;/Document>'
  PrintF, lun, '&lt;/kml>'
  
END


<span class="comments">;+</span>
<span class="comments">; The purpose of this method is to destroy anything we created that may leak</span>
<span class="comments">; memory or need to be released from use.</span>
<span class="comments">;-</span>
PRO cgKML_File::CLEANUP

    <span class="comments">; Destroy all the objects in this container.</span>
    childObjs = self -> Get(/ALL, COUNT=count)
    FOR j=0,count-1 DO Obj_Destroy, childObjs
    
    <span class="comments">; Call the superclass object's CLEANUP method</span>
    self -> cgContainer::Cleanup
    
END


<span class="comments">;+</span>
<span class="comments">; The cgKML_FILE class definition module.</span>
<span class="comments">;</span>
<span class="comments">; :Params:</span>
<span class="comments">;     class: out, optional, type=structure</span>
<span class="comments">;         The class definition returned as a structure variable. Occassionally useful.</span>
<span class="comments">;-</span>
PRO cgKML_File__Define, class

   Compile_Opt idl2
   
   class = { cgKML_FILE, $
             INHERITS cgContainer, $   <span class="comments">; A modified IDL_CONTAINER.</span>
             filename: "", $           <span class="comments">; The name of the KML file being created.</span>
             hint: "", $               <span class="comments">; A hint attribute for Google Earth.</span>
             level: 0 $                <span class="comments">; The input level. Used to indent KML output.</span>
           }
END
</code>
    </div>
  </body>
</html>