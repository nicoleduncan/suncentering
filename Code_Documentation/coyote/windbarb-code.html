<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:14 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>windbarb.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="windbarb.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;       WINDBARB</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;</span>
<span class="comments">;       This is routine for drawing wind barbs on a map.</span>
<span class="comments">;</span>
<span class="comments">; AUTHOR:</span>
<span class="comments">;</span>
<span class="comments">;       FANNING SOFTWARE CONSULTING</span>
<span class="comments">;       David Fanning, Ph.D.</span>
<span class="comments">;       1645 Sheely Drive</span>
<span class="comments">;       Fort Collins, CO 80526 USA</span>
<span class="comments">;       Phone: 970-221-0438</span>
<span class="comments">;       E-mail: david@idlcoyote.com</span>
<span class="comments">;       Coyote's Guide to IDL Programming: http://www.idlcoyote.com</span>
<span class="comments">;</span>
<span class="comments">; CATEGORY:</span>

<span class="comments">;       Graphics.</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;</span>
<span class="comments">;       Windbarb, x, y, speed, direction</span>
<span class="comments">;</span>
<span class="comments">; REQUIRED INPUTS:</span>
<span class="comments">;</span>
<span class="comments">;       x:            The X location of the wind barb, expressed in data coordinates.</span>
<span class="comments">;                     Positive X is pointing in EAST direction.</span>
<span class="comments">;</span>
<span class="comments">;       y:            The Y location of the wind barb, expressed in data coordinates.</span>
<span class="comments">;                     Positive Y is pointing in NORTH direction.</span>
<span class="comments">;</span>
<span class="comments">;       speed:        The wind speed, expressed in knots.</span>
<span class="comments">;</span>
<span class="comments">;       direction:    The wind direction in degrees clockwise from north. Winds from</span>
<span class="comments">;                     the NE come at 45 degrees, and the wind "arrow" points in the</span>
<span class="comments">;                     direction from which the window is blowing. (The wind arrow</span>
<span class="comments">;                     points in the direction of the station circle, with the "barbs"</span>
<span class="comments">;                     of the arrow at the end of the arrow from which the wind is coming.)</span>
<span class="comments">;</span>
<span class="comments">; KEYWORDS:</span>
<span class="comments">;</span>
<span class="comments">;      ASPECT:        The aspect ratio of the map or plot in the display window.</span>
<span class="comments">;</span>
<span class="comments">;      CLIP:          A four-element array in normalized coordinates [x0,y0,x1,y1] giving</span>
<span class="comments">;                     the lower-left and upper-right corner of a cliping rectangle. This</span>
<span class="comments">;                     is normally the extent of your plot. See the example below.</span>
<span class="comments">;</span>
<span class="comments">;      COLOR:         The name of the color to draw the wind barbs in. May be a vector</span>
<span class="comments">;                     the same length as X.</span>
<span class="comments">;</span>
<span class="comments">;      LENGTH:        The approximate length of the wind barb in normalized coordinates.</span>
<span class="comments">;                     Will be set to 0.066 of the plot distance in the X direction by default.</span>
<span class="comments">;</span>
<span class="comments">;      MAP_ROTATION:  The clockwise rotation in degrees of the map North from the</span>
<span class="comments">;                     top of the plot. Will be set to 0.0 by default.</span>
<span class="comments">;</span>
<span class="comments">;      SOUTHERN_HEMISPHERE: Windbarb "feathers" are traditionally drawn in the clockwise</span>
<span class="comments">;                     direction in the northern hemispere and countercolockwise in the</span>
<span class="comments">;                     southern hemisphere. Default is "northern" type feathers. Set this</span>
<span class="comments">;                     keyword to select "southern" type feathers.</span>
<span class="comments">;</span>
<span class="comments">;      STATION:       Set this keyword if you want to draw the wind barbs with station symbols.</span>
<span class="comments">;                     (Requires STATIONPLOT from the Coyote Library.)</span>
<span class="comments">;</span>
<span class="comments">; RESTRICTIONS:</span>
<span class="comments">;</span>
<span class="comments">;       Requires cgColor and STATIONPLOT from the Coyote Library:</span>
<span class="comments">;</span>
<span class="comments">;           http://www.idlcoyote.com/programs/cgColor.pro</span>
<span class="comments">;           http://www.idlcoyote.com/programs/stationplot.pro</span>
<span class="comments">;</span>
<span class="comments">; EXAMPLE:</span>
<span class="comments">;</span>
<span class="comments">;    Window, Title='Wind Barbs', /Free</span>
<span class="comments">;    seed = -3L</span>
<span class="comments">;    lon = Randomu(seed, 9) * 360 - 180</span>
<span class="comments">;    lat = Randomu(seed, 9) * 180 - 90</span>
<span class="comments">;    speed = Randomu(seed, 9) * 100 + 5.0</span>
<span class="comments">;    direction = Indgen(9)*45</span>
<span class="comments">;    Erase, Color=cgColor('Ivory', !P.Background)</span>
<span class="comments">;    Polyfill,[0.1, 0.1, 0.9, 0.9, 0.1], [0.1, 0.9, 0.9, 0.1, 0.1], /Normal, Color=cgColor('light gray')</span>
<span class="comments">;    Map_Set, /Cylindrical, Position=[0.1, 0.1, 0.9, 0.9], Color=cgColor('Steel Blue'), /NoErase</span>
<span class="comments">;    Map_Grid, Color=cgColor('Charcoal', !D.Table_Size-2)</span>
<span class="comments">;    Map_Continents, Color=cgColor('Sea Green', !D.Table_Size-3)</span>
<span class="comments">;    Windbarb, lon, lat, speed, direction, /Station, Color='Indian Red', /Southern_Hemisphere</span>
<span class="comments">;</span>
<span class="comments">;    To clip the windbards that fall outside the plot, substitute these two lines</span>
<span class="comments">;    for the last line in the example above:</span>
<span class="comments">;</span>
<span class="comments">;    clip = [0.1, 0.1, 0.9, 0.9]</span>
<span class="comments">;    Windbarb, lon, lat, speed, direction, /Station, Color='Indian Red', Clip=clip</span>
<span class="comments">;</span>
<span class="comments">; MODIFICATION HISTORY:</span>
<span class="comments">;</span>
<span class="comments">;       Written by:  David W. Fanning, 20 May 2003.</span>
<span class="comments">;       It has been called to my attention that the wind barbs are pointing</span>
<span class="comments">;         in *exactly* the wrong direction. Sigh... Rotated by 180 degrees. DWF. 8 June 2004.</span>
<span class="comments">;       Now someone complains that the *corrected* version is off by 180 degrees! Sheesh!</span>
<span class="comments">;         Clearly, I'm no meteorologist. Both lines of code are in the file. Please use the one</span>
<span class="comments">;         you like the best. :-) (Line 177-178) 20 July 2004. DWF.</span>
<span class="comments">;       Added a CLIP keyword so you can clip the output to the extend of your graphics plot. 12 Nov 2004. DWF.</span>
<span class="comments">;       Added THICK keyword 23 February 2005. DWF.</span>
<span class="comments">;       After further research, I've reverted to the direction specified originally.</span>
<span class="comments">;       And I have changed the "feathers" to point clockwise normally, and counterdlockwise</span>
<span class="comments">;         if the SOUTHERN_HEMISPHERE keyword is set. Here are my sources (21 July 2005. DWF):</span>
<span class="comments">;</span>
<span class="comments">;            http://ww2010.atmos.uiuc.edu/(Gh)/guides/maps/sfcobs/wnd.rxml</span>
<span class="comments">;            http://www.al.noaa.gov/WWWHD/pubdocs/windbarb.html</span>
<span class="comments">;      Fixed a small CLIP problem. 21 July 2005. DWF.</span>
<span class="comments">;</span>
<span class="comments">;-</span>
<span class="comments">;******************************************************************************************;</span>
<span class="comments">;  Copyright (c) 2008, by Fanning Software Consulting, Inc.                                ;</span>
<span class="comments">;  All rights reserved.                                                                    ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  Redistribution and use in source and binary forms, with or without                      ;</span>
<span class="comments">;  modification, are permitted provided that the following conditions are met:             ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;      * Redistributions of source code must retain the above copyright                    ;</span>
<span class="comments">;        notice, this list of conditions and the following disclaimer.                     ;</span>
<span class="comments">;      * Redistributions in binary form must reproduce the above copyright                 ;</span>
<span class="comments">;        notice, this list of conditions and the following disclaimer in the               ;</span>
<span class="comments">;        documentation and/or other materials provided with the distribution.              ;</span>
<span class="comments">;      * Neither the name of Fanning Software Consulting, Inc. nor the names of its        ;</span>
<span class="comments">;        contributors may be used to endorse or promote products derived from this         ;</span>
<span class="comments">;        software without specific prior written permission.                               ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  THIS SOFTWARE IS PROVIDED BY FANNING SOFTWARE CONSULTING, INC. ''AS IS'' AND ANY        ;</span>
<span class="comments">;  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES    ;</span>
<span class="comments">;  OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT     ;</span>
<span class="comments">;  SHALL FANNING SOFTWARE CONSULTING, INC. BE LIABLE FOR ANY DIRECT, INDIRECT,             ;</span>
<span class="comments">;  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED    ;</span>
<span class="comments">;  TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;         ;</span>
<span class="comments">;  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND             ;</span>
<span class="comments">;  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT              ;</span>
<span class="comments">;  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS           ;</span>
<span class="comments">;  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.                            ;</span>
<span class="comments">;******************************************************************************************;</span>

PRO Windbarb, x, y, wspeed, wdirection, $
   Aspect=aspect, $
   Clip=clip, $
   Color=color, $
   Length=length, $
   Map_Rotation=map_rotation, $
   Station=station, $
   Southern_Hemisphere=southFeathers, $
   Thick=thick

   On_Error, 2

   <span class="comments">; Check positional parameters.</span>

   IF N_PARAMS() NE 4 THEN BEGIN
      Print, 'Required Syntax: Windbard x, y, speed, direction, Aspect=aspect, Length=length, Map_Rotation=map_rotation'
      Message, 'Incorrect number of positional parameters.'
   ENDIF

   <span class="comments">; Check keywords</span>

   IF N_Elements(aspect) EQ 0 THEN BEGIN
      IF Total(!X.Window) EQ 0 THEN BEGIN
         aspect = Float(!D.Y_Size) / !D.X_Size
      ENDIF ELSE BEGIN
         aspect = ((!Y.Window[1] - !Y.Window[0]) * !D.Y_Size) / ((!X.Window[1] - !X.Window[0]) * !D.X_Size)
      ENDELSE
   ENDIF
   IF N_Elements(color) EQ 0 THEN color = Make_Array(N_Elements(x), /String, Value='Yellow')
   IF N_Elements(color) EQ 1 THEN color = Replicate(color, N_Elements(x))
   IF N_Elements(length) EQ 0 THEN BEGIN
      IF Total(!X.Window) EQ 0 THEN BEGIN
         length = 1.0 / 15.0
      ENDIF ELSE BEGIN
         length = (!X.Window[1] - !X.Window[0]) / 15.0
      ENDELSE
   ENDIF
   IF N_Elements(map_rotation) EQ 0 THEN map_rotation = 0.0
   IF N_Elements(thick) EQ 0 THEN thick = 1.0

   <span class="comments">; Initialize variables.</span>

   sr = length * 0.25
   staff_len = length - sr
   barb_len = staff_len * 0.8
   half_len = staff_len * 0.45

   coord = Convert_Coord(x, y, /Data, /To_Normal)
   xx = coord[0,*]
   yy = coord[1,*]

   <span class="comments">; Make sure you have a clipping rectangle.</span>
   IF N_Elements(clip) EQ 0 THEN BEGIN
      minxx = Min(xx, Max=maxxx)
      minyy = Min(yy, Max=maxyy)
      clip = [minxx-0.25, minyy-0.25, maxxx+0.25, maxyy+0.25]
   ENDIF

   <span class="comments">; Loop through all the elements of the array.</span>

   FOR j=0L, N_Elements(x) - 1 DO BEGIN

      <span class="comments">; If the speed is less that 2.5 knots, draw a station plot, if needed.</span>

      IF wspeed[j] LT 2.5 THEN BEGIN
         IF Keyword_Set(station) THEN StationPlot, x[j], y[j], Radius=sr, Color=color[j], Thick=thick
         CONTINUE
      ENDIF

      <span class="comments">; Set up directions for staff and barbs.</span>

      dr  = (wdirection[j] + map_rotation) * !DtoR
      IF dr GT (2*!Pi) THEN dr = dr - (2 * !Pi)
      drb = (wdirection[j] + 60 + map_rotation) * !DtoR

      IF Keyword_Set(southFeathers) THEN BEGIN
         sindr =  Sin(dr)
         sindrb = -Sin(drb)
         cosdr =  Cos(dr)
         cosdrb = -Cos(drb)
      ENDIF ELSE BEGIN
         sindr =  Sin(dr)
         sindrb = Sin(drb)
         cosdr =  Cos(dr)
         cosdrb = Cos(drb)
      ENDELSE

      <span class="comments">; Count the number of 50 knot pennants and 10 knot barbs we will need.</span>

      num50 = 0
      num10 = 0
      sp = wspeed[j] + 2.5 <span class="comments">; Rounded to nearest 2.5 knots.</span>
      WHILE sp GE 50 DO BEGIN
         num50 = num50 + 1
         sp = sp - 50
      ENDWHILE
      WHILE sp GE 10 DO BEGIN
         num10 = num10 + 1
         sp = sp - 10
      ENDWHILE

      <span class="comments">; Draw the staff.</span>

      x1 = clip[0] > (xx[j] + sindr * sr) &lt<span class="comments">; clip[2]</span>
      y1 = clip[1] > (yy[j] + cosdr * sr * aspect) &lt<span class="comments">; clip[3]</span>
      x2 = clip[0] > (x1 + sindr * staff_len) &lt<span class="comments">; clip[2]</span>
      y2 = clip[1] > (y1 + cosdr * staff_len * aspect) &lt<span class="comments">; clip[3]</span>
      IF Keyword_Set(station) THEN StationPlot, x[j], y[j], Radius=sr, Color=color[j]
      PLOTS, [x1, x2], [y1,y2], /Normal, Color=cgColor(color[j]), Clip=clip, Thick=thick

      <span class="comments">; Draw any half-barbs.</span>

      IF sp GE 5 THEN BEGIN
         x1 = x2 + sindrb * half_len
         y1 = y2 + cosdrb * half_len * aspect
         IF x1 LT clip[0] OR x1 GT clip[2] THEN CONTINUE
         IF x2 LT clip[0] OR x2 GT clip[2] THEN CONTINUE
         IF y1 LT clip[1] OR y1 GT clip[3] THEN CONTINUE
         IF y2 LT clip[1] OR y2 GT clip[3] THEN CONTINUE
         PLOTS, [x1, x2], [y1,y2], /Normal, Color=cgColor(color[j]), Clip=clip, Thick=thick
         IF (num50 EQ 0) AND (num10 EQ 0) THEN BEGIN
            x1 = x2 + sindr * half_len
            y1 = y2 + cosdr * half_len * aspect
            IF x1 LT clip[0] OR x1 GT clip[2] THEN CONTINUE
            IF x2 LT clip[0] OR x2 GT clip[2] THEN CONTINUE
            IF y1 LT clip[1] OR y1 GT clip[3] THEN CONTINUE
            IF y2 LT clip[1] OR y2 GT clip[3] THEN CONTINUE
            PLOTS, [x1, x2], [y1,y2], /Normal, Color=cgColor(color[j]), Clip=clip, Thick=thick
         ENDIF
      ENDIF

      x1 = x2
      y1 = y2

      <span class="comments">; Draw full barbs.</span>

      FOR i = 1, num10 DO BEGIN
         x2 = x1 + sindr * half_len
         y2 = y1 + cosdr * half_len * aspect
         x3 = x2 + sindrb * staff_len
         y3 = y2 + cosdrb * staff_len * aspect
         IF x1 LT clip[0] OR x1 GT clip[2] THEN CONTINUE
         IF x2 LT clip[0] OR x2 GT clip[2] THEN CONTINUE
         IF x3 LT clip[0] OR x3 GT clip[2] THEN CONTINUE
         IF y1 LT clip[1] OR y1 GT clip[3] THEN CONTINUE
         IF y2 LT clip[1] OR y2 GT clip[3] THEN CONTINUE
         IF y3 LT clip[1] OR y3 GT clip[3] THEN CONTINUE
         PLOTS, [x1, x2, x3], [y1, y2, y3], /Normal, Color=cgColor(color[j]), Clip=clip, Thick=thick
         x1 = x2
         y1 = y2
      ENDFOR

      <span class="comments">; Draw pennants.</span>

      FOR i = 1, num50 DO BEGIN

         x0 = x1
         y0 = y1

         x2 = x1 + sindr * half_len
         y2 = y1 + cosdr * half_len * aspect
         x3 = x2 + sindrb * staff_len
         y3 = y2 + cosdrb * staff_len * aspect

         x1 = x2
         y1 = y2

         x2p = x0 + sindr * half_len
         y2p = y0 + cosdr * half_len * aspect

         x2 = x1 + sindr * half_len
         y2 = y1 + cosdr * half_len * aspect
         IF x0 LT clip[0] OR x0 GT clip[2] THEN CONTINUE
         IF x2 LT clip[0] OR x2 GT clip[2] THEN CONTINUE
         IF y0 LT clip[1] OR y0 GT clip[3] THEN CONTINUE
         IF y2 LT clip[1] OR y2 GT clip[3] THEN CONTINUE
         PLOTS, [x2, x0], [y2, y0], /Normal, Color=cgColor(color[j]), Clip=clip, Thick=thick
         POLYFILL, [x1, x2, x3], [y1, y2, y3], /Normal, Color=cgColor(color[j]), Clip=clip

         x1 = x2p
         y1 = y2p

      ENDFOR

   ENDFOR

END
</code>
    </div>
  </body>
</html>