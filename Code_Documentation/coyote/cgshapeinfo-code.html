<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:56:29 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>cgshapeinfo.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="cgshapeinfo.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">; docformat = 'rst'</span>
<span class="comments">;</span>
<span class="comments">; NAME:</span>
<span class="comments">;   cgShapeInfo</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;   The purpose of this program is allow the user to browse a very narrow</span>
<span class="comments">;   selection of shapefiles. Namely, those containing geographical shapes</span>
<span class="comments">;   in latitude and longitude coordinates. In other words, shapefiles</span>
<span class="comments">;   containing maps. File attributes are listed in the left-hand list</span>
<span class="comments">;   widget. Clicking on a file attribute, will list all the entity</span>
<span class="comments">;   attributes for that file attribute in the right-hand list. Clicking</span>
<span class="comments">;   an entity attribute with list the type of entity, and the X and Y</span>
<span class="comments">;   bounds of that entity (shown as LON and LAT, respectively), in the</span>
<span class="comments">;   statusbar at the bottom of the display.</span>
<span class="comments">;</span>
<span class="comments">;   Knowing the attribute and entity names of a shapefile will give</span>
<span class="comments">;   you insight into how to read and display the information in the file.</span>
<span class="comments">;   For examples, see the Coyote Library programs DrawCounties and DrawStates.</span>
<span class="comments">;</span>
<span class="comments">;******************************************************************************************;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  Copyright (c) 2012, by Fanning Software Consulting, Inc. All rights reserved.           ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  Redistribution and use in source and binary forms, with or without                      ;</span>
<span class="comments">;  modification, are permitted provided that the following conditions are met:             ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;      * Redistributions of source code must retain the above copyright                    ;</span>
<span class="comments">;        notice, this list of conditions and the following disclaimer.                     ;</span>
<span class="comments">;      * Redistributions in binary form must reproduce the above copyright                 ;</span>
<span class="comments">;        notice, this list of conditions and the following disclaimer in the               ;</span>
<span class="comments">;        documentation and/or other materials provided with the distribution.              ;</span>
<span class="comments">;      * Neither the name of Fanning Software Consulting, Inc. nor the names of its        ;</span>
<span class="comments">;        contributors may be used to endorse or promote products derived from this         ;</span>
<span class="comments">;        software without specific prior written permission.                               ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  THIS SOFTWARE IS PROVIDED BY FANNING SOFTWARE CONSULTING, INC. ''AS IS'' AND ANY        ;</span>
<span class="comments">;  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES    ;</span>
<span class="comments">;  OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT     ;</span>
<span class="comments">;  SHALL FANNING SOFTWARE CONSULTING, INC. BE LIABLE FOR ANY DIRECT, INDIRECT,             ;</span>
<span class="comments">;  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED    ;</span>
<span class="comments">;  TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;         ;</span>
<span class="comments">;  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND             ;</span>
<span class="comments">;  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT              ;</span>
<span class="comments">;  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS           ;</span>
<span class="comments">;  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.                            ;</span>
<span class="comments">;******************************************************************************************;</span>
<span class="comments">;</span>
<span class="comments">;+--------------------------------------------------------------------------</span>
<span class="comments">;   The purpose of this program is allow the user to browse a very narrow</span>
<span class="comments">;   selection of shapefiles. Namely, those containing geographical shapes</span>
<span class="comments">;   in latitude and longitude coordinates. In other words, shapefiles</span>
<span class="comments">;   containing maps. File attributes are listed in the left-hand list</span>
<span class="comments">;   widget. Clicking on a file attribute, will list all the entity</span>
<span class="comments">;   attributes for that file attribute in the right-hand list. Clicking</span>
<span class="comments">;   an entity attribute with list the type of entity, and the X and Y</span>
<span class="comments">;   bounds of that entity (shown as LON and LAT, respectively), in the</span>
<span class="comments">;   statusbar at the bottom of the display.</span>
<span class="comments">;</span>
<span class="comments">;   Knowing the attribute and entity names of a shapefile will give</span>
<span class="comments">;   you insight into how to read and display the information in the file.</span>
<span class="comments">;   For examples, see the Coyote Library programs DrawCounties and DrawStates.</span>
<span class="comments">;</span>
<span class="comments">; :Categories:</span>
<span class="comments">;    Utilities</span>
<span class="comments">;       </span>
<span class="comments">; :Author:</span>
<span class="comments">;    FANNING SOFTWARE CONSULTING::</span>
<span class="comments">;       David W. Fanning </span>
<span class="comments">;       1645 Sheely Drive </span>
<span class="comments">;       Fort Collins, CO 80526 USA </span>
<span class="comments">;       Phone: 970-221-0438 </span>
<span class="comments">;       E-mail: david@idlcoyote.com </span>
<span class="comments">;       Coyote's Guide to IDL Programming: http://www.idlcoyote.com</span>
<span class="comments">;       </span>
<span class="comments">; :Examples:</span>
<span class="comments">;    To learn about and draw the states.shp file in the IDL examples directory::</span>
<span class="comments">;       filename = Filepath(SubDir=['examples','data'], 'states.shp')</span>
<span class="comments">;       cgShapeInfo, filename, XRANGE=xr, YRANGE=yr</span>
<span class="comments">;       cgPlot, xr, yr, /NoData, XStyle=1, YStyle=1</span>
<span class="comments">;       cgDrawShapes, filename</span>
<span class="comments">;</span>
<span class="comments">; :History:</span>
<span class="comments">;    Modification History::</span>
<span class="comments">;       Written by David W. Fanning, 21 October 2006.</span>
<span class="comments">;       Slight modifications to the interface. 14 May 2010. DWF.</span>
<span class="comments">;       Added XRANGE and YRANGE output keywords. 15 May 2010. DWF.</span>
<span class="comments">;       Renamed cgShapeFile from Shapefile. 20 Aug 2012. DWF.</span>
<span class="comments">;       </span>
<span class="comments">; :Copyright:</span>
<span class="comments">;    Copyright (c) 2006-2012, Fanning Software Consulting, Inc.</span>
<span class="comments">;-   </span>
<span class="comments">;</span>
<span class="comments">;+</span>
<span class="comments">; The event handler for the program.</span>
<span class="comments">; </span>
<span class="comments">; :Params:</span>
<span class="comments">;      event: in, required, type=struct</span>
<span class="comments">;          The event structure passed by the window manager.</span>
<span class="comments">;-</span>
PRO cgShapeInfo_Events, event

   Compile_Opt idl2

   <span class="comments">; Error handling.</span>
   Catch, theError
   IF theError NE 0 THEN BEGIN
      Catch, /Cancel
      void = Error_Message()
      RETURN
   ENDIF

   <span class="comments">; Get the info structure.</span>
   Widget_Control, event.top, Get_UValue=info

   <span class="comments">; Possible events identified by UVALUE.</span>
   Widget_Control, event.id, Get_UValue=theEvent

   CASE theEvent OF

      <span class="comments">; User selected entity attribute. Get the particulars for this entity.</span>
      'ENTITYLIST': BEGIN

         types = IntArr(N_Elements(*(*info).entities))
         bounds = FltArr(N_Elements(*(*info).entities))
         thisEntity = (*(*info).entities)[event.index]
         types = thisEntity.shape_type
         bounds = thisEntity.bounds
         typeIndex = Where((*info).typecode EQ types, count)
         IF count EQ 0 THEN BEGIN
            ok = Dialog_Message('Unknown type code: ' + types + ' Returning.')
            RETURN
         ENDIF
         space = String(Replicate(32B, 5))
         type = 'Type = ' + ((*info).shapetype[typeIndex])[0]
         lat = 'Y Bounds = [' + StrTrim(bounds[1],2) + ', ' + StrTrim(bounds[5],2) + ']'
         lon = 'X Bounds = [' + StrTrim(bounds[0],2) + ', ' + StrTrim(bounds[4],2) + ']'
         idx = 'Index = ' + StrTrim(event.index,2)
         Widget_Control, (*info).statusbar, $
            Set_Value=type[0] + space + lon + space + lat + space + idx
         END

      <span class="comments">; User selected a file attribute. Get the entity attributes associated with this file attribute.</span>
      'NAMELIST': BEGIN

         entityAttributes = StrArr(N_Elements(*(*info).entities))
         FOR j=0,N_Elements(*(*info).entities)-1 DO BEGIN
            thisEntity = (*(*info).entities)[j]
            entityAttributes[j] = StrUpCase(StrTrim((*thisEntity.attributes).(event.index), 2))
         ENDFOR
         Widget_Control, (*info).entityList, Set_Value=entityAttributes
         *(*info).entityAttributes = entityAttributes
         Widget_Control, (*info).statusbar, Set_Value=String(Replicate(32B, 150))
         END

      <span class="comments">; User wants to open new shapefile.</span>
      'OPENFILE': BEGIN

         CD, CURRENT=thisDir, (*info).directory
         filename = Dialog_Pickfile(Title='Select Shapefile for Input...', Filter='*.shp')
         CD, thisDir
         IF filename EQ "" THEN RETURN
         (*info).directory = File_DirName(filename)

         <span class="comments">; Clean up current shapefile information.</span>
         Heap_Free, (*info).entities
         Ptr_Free, (*info).entityAttributes
         Obj_Destroy, (*info).shapefile

         <span class="comments">; Create a new shapefile object</span>
         shapefile = Obj_New('IDLffShape', filename)
         IF Obj_Valid(shapefile) EQ 0 THEN BEGIN
            Message, 'Specified file (' + File_Basename(filename) + $
                     ') does not appear to be a shapefile. Returning...'
         ENDIF

         <span class="comments">; Get the attribute names from the shape file.</span>
         shapefile -> GetProperty, ATTRIBUTE_NAMES=theNames
         theNames = StrUpCase(StrTrim(theNames, 2))

         <span class="comments">; Get all the attribute pointers from the file. These are the entities.</span>
         entities = Ptr_New(/Allocate_Heap)
         *entities = shapefile -> GetEntity(/All, /Attributes)

         <span class="comments">; Load the info structure.</span>
         (*info).shapefile = shapefile
         (*info).entities = entities

         entityAttributes = StrArr(N_Elements(*(*info).entities))
         FOR j=0,N_Elements(*(*info).entities)-1 DO BEGIN
            thisEntity = (*(*info).entities)[j]
            entityAttributes[j] = StrUpCase(StrTrim((*thisEntity.attributes).(0), 2))
         ENDFOR
         Widget_Control, (*info).namelist, Set_List_Select=0
         (*info).entityAttributes = Ptr_New(entityAttributes)

         Widget_Control, (*info).nameList, Set_Value=theNames
         Widget_Control, (*info).entityList, Set_Value=entityAttributes
         Widget_Control, (*info).statusbar, Set_Value=String(Replicate(32B, 150))
         END

      'QUIT': Widget_Control, event.top, /Destroy

      ELSE: Print, 'Event not currently handled.

   ENDCASE


END <span class="comments">; -----------------------------------------------------------------------------------------</span>

<span class="comments">;+</span>
<span class="comments">; The clean-up routine for the program.</span>
<span class="comments">;</span>
<span class="comments">; :Params:</span>
<span class="comments">;     tlb: in, required, type=long</span>
<span class="comments">;         The identifier of the widget that just died.</span>
<span class="comments">;-</span>
PRO cgShapeInfo_Cleanup, tlb
   Widget_Control, tlb, Get_UValue=info
   Heap_Free, (*info).entities
   Ptr_Free, (*info).entityAttributes
   Obj_Destroy, (*info).shapefile
   Ptr_Free, info
END <span class="comments">; -----------------------------------------------------------------------------------------</span>

<span class="comments">;+</span>
<span class="comments">; The calling program for learning more about the contents of the shapefile.</span>
<span class="comments">;</span>
<span class="comments">; :Params:</span>
<span class="comments">;     filename: in, optional, type=string</span>
<span class="comments">;         The name of the shapefile you wish to browse. If not provided, the user</span>
<span class="comments">;         will be asked to select a shapefile.</span>
<span class="comments">;</span>
<span class="comments">; :Keywords:</span>
<span class="comments">;     xrange: out, optional, type=float</span>
<span class="comments">;          The X range of the shapefile contents in the native units of the shapefile.</span>
<span class="comments">;     yrange: out, optional, type=float</span>
<span class="comments">;          The Y range of the shapefile contents in the native units of the shapefile.</span>
<span class="comments">;-</span>
PRO cgShapeInfo, filename, XRANGE=xrange, YRANGE=yrange

   Compile_Opt idl2

   <span class="comments">; Error handling.</span>
   Catch, theError
   IF theError NE 0 THEN BEGIN
      Catch, /Cancel
      void = Error_Message()
      RETURN
   ENDIF

   <span class="comments">; Ask the user to select file if one is not provided.</span>
   IF N_Elements(filename) EQ 0 THEN BEGIN
      filename = Dialog_Pickfile(Title='Select Shapefile for Input...', Filter='*.shp')
      IF filename EQ "" THEN RETURN
   ENDIF

   <span class="comments">; Create a shapefile object</span>
   shapefile = Obj_New('IDLffShape', filename)
   directory = File_DirName(filename)
   IF Obj_Valid(shapefile) EQ 0 THEN BEGIN
      Message, 'Specified file (' + File_Basename(filename) + $
               ') does not appear to be a shapefile. Returning...'
   ENDIF

   <span class="comments">; Get the attribute names from the shape file.</span>
   shapefile -> GetProperty, ATTRIBUTE_NAMES=theNames
   theNames = StrUpCase(StrTrim(theNames, 2))

   <span class="comments">; Get all the attribute pointers from the file. These are the entities.</span>
   entities = Ptr_New(/Allocate_Heap)
   *entities = shapefile -> GetEntity(/All, /Attributes)

   <span class="comments">; Create the widgets.</span>
   tlb = Widget_Base(Title='ShapeFile Information', Column=1, MBAR=menuID)
   listBase = Widget_Base(tlb, Row=1, XPAD=0, YPAD=0, SPACE=0)

   <span class="comments">; Menubar</span>
   fileID = Widget_Button(menuID, Value='File')
   button = Widget_Button(fileID, Value='Open New Shapefile', UVALUE='OPENFILE')
   button = Widget_Button(fileID, Value='Quit', UVALUE='QUIT')

   <span class="comments">; Shapefile Lists.</span>
   nameBase = Widget_Base(listBase, Column=1)
   label = Widget_Label(nameBase, Value='Attribute Name')
   nameList = Widget_List(nameBase, Value=theNames, YSize=25, XSIZE=40, UVALUE='NAMELIST')
   Widget_Control, nameList, Set_List_Select=0
   attIndex = 0

   <span class="comments">; Cycle through each entity and get the attribute</span>
   entityAttributes = StrArr(N_Elements(*entities))
   entityTypes = IntArr(N_Elements(*entities))
   entityMinX = FltArr(N_Elements(*entities))
   entityMaxX = FltArr(N_Elements(*entities))
   entityMiny = FltArr(N_Elements(*entities))
   entityMaxY = FltArr(N_Elements(*entities))
   FOR j=0,N_Elements(*entities)-1 DO BEGIN
      thisEntity = (*entities)[j]
      entityAttributes[j] = StrUpCase(StrTrim((*thisEntity.attributes).(attIndex), 2))
      entityTypes[j] = thisEntity.shape_type
      entityMinX[j] =  thisEntity.bounds[0]
      entityMaxX[j] =  thisEntity.bounds[4]
      entityMiny[j] =  thisEntity.bounds[1]
      entityMaxY[j] =  thisEntity.bounds[5]
   ENDFOR
   xrange = [Min(entityMinX), Max(entityMaxX)]
   yrange = [Min(entityMinY), Max(entityMaxY)]
   
<span class="comments">;   Print, 'XRange = [' + Strtrim(Min(entityMinX),2) + ',' + StrTrim(Max(entityMaxX),2) + ']'</span>
<span class="comments">;   Print, 'YRange = [' + Strtrim(Min(entityMinY),2) + ',' + StrTrim(Max(entityMaxY),2) + ']'</span>
<span class="comments">;   FOR j=0,N_Elements(*entities)-1 DO Print, entityMinx[j], entityMaxx[j], entityminy[j], entitymaxy[j]</span>

   <span class="comments">; Entity attribute list.</span>
   nameBase = Widget_Base(listBase, Column=1)
   label = Widget_Label(nameBase, Value='Attribute Value')
   entityList = Widget_List(nameBase, Value=entityAttributes, YSize=25,  XSIZE=75, UVALUE='ENTITYLIST')

   <span class="comments">; Entity statusbar widgets.</span>
   infobase = Widget_Base(tlb, Row=1, XPAD=0, YPAD=0, SPACE=0)
   label = Widget_Label(infobase, Value='Entity Info: ')

   <span class="comments">; Size the statusbar appropriately.</span>
   gb = Widget_Info(infobase, /Geometry)
   gl = Widget_Info(label, /Geometry)
   statusbar = Widget_Label(infobase,/Sunken_Frame, SCR_XSIZE=gb.scr_xsize-gl.scr_xsize, $
      Value=String(Replicate(32B, 150)))

   cgCenterTLB, tlb
   Widget_Control, tlb, /Realize

   <span class="comments">; Information to identify entity types.</span>
   typecode = [ 1, 3, 5, 8, 11, 13, 15, 18, 21, 23, 25, 28, 31]
   shapetype = ['Point', 'Polyline', 'Polygon', 'MultiPoint', 'PointZ', 'PointLineZ', 'PolygonZ', $
                'MultiPointZ', 'PointM', 'PolyLineM', 'PolygonM', 'MultiPointM', 'MultiPatch']

   <span class="comments">; Create info structure and store it.</span>
   info = Ptr_New({entities:entities, namelist:namelist, entitylist:entitylist, $
      entityAttributes:Ptr_New(entityAttributes, /No_Copy), shapefile:shapefile, $
      typecode:typecode, shapetype:shapetype, statusbar:statusbar, directory:directory}, /No_Copy)
   Widget_Control, tlb, Set_UValue=info

   <span class="comments">; Start it up.</span>
   XManager, 'cgshapeinfo', tlb, Event_Handler='cgShapeInfo_Events', $
      Cleanup='cgShapeInfo_Cleanup', /No_Block

END <span class="comments">; -----------------------------------------------------------------------------------------</span>
</code>
    </div>
  </body>
</html>