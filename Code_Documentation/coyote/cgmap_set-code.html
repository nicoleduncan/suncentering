<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:56:20 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>cgmap_set.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="cgmap_set.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">; docformat = 'rst'</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;   Provides a modified MAP_SET command that can work together with other Coyote Graphics</span>
<span class="comments">;   commands and be used in resizeable graphics windows.</span>
<span class="comments">;</span>
<span class="comments">;******************************************************************************************;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  Copyright (c) 2011, by Fanning Software Consulting, Inc. All rights reserved.           ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  Redistribution and use in source and binary forms, with or without                      ;</span>
<span class="comments">;  modification, are permitted provided that the following conditions are met:             ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;      * Redistributions of source code must retain the above copyright                    ;</span>
<span class="comments">;        notice, this list of conditions and the following disclaimer.                     ;</span>
<span class="comments">;      * Redistributions in binary form must reproduce the above copyright                 ;</span>
<span class="comments">;        notice, this list of conditions and the following disclaimer in the               ;</span>
<span class="comments">;        documentation and/or other materials provided with the distribution.              ;</span>
<span class="comments">;      * Neither the name of Fanning Software Consulting, Inc. nor the names of its        ;</span>
<span class="comments">;        contributors may be used to endorse or promote products derived from this         ;</span>
<span class="comments">;        software without specific prior written permission.                               ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  THIS SOFTWARE IS PROVIDED BY FANNING SOFTWARE CONSULTING, INC. ''AS IS'' AND ANY        ;</span>
<span class="comments">;  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES    ;</span>
<span class="comments">;  OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT     ;</span>
<span class="comments">;  SHALL FANNING SOFTWARE CONSULTING, INC. BE LIABLE FOR ANY DIRECT, INDIRECT,             ;</span>
<span class="comments">;  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED    ;</span>
<span class="comments">;  TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;         ;</span>
<span class="comments">;  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND             ;</span>
<span class="comments">;  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT              ;</span>
<span class="comments">;  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS           ;</span>
<span class="comments">;  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.                            ;</span>
<span class="comments">;******************************************************************************************;</span>
<span class="comments">;</span>
<span class="comments">;+--------------------------------------------------------------------------</span>
<span class="comments">;   Provides a modified MAP_SET command that can work together with other Coyote Graphics</span>
<span class="comments">;   commands and be used in resizeable graphics windows. Any keyword appropriate for MAP_SET,</span>
<span class="comments">;   MAP_CONTINENTS, or MAP_GRID can be used with this routine. Additional or modified </span>
<span class="comments">;   keywords are documented.</span>
<span class="comments">;</span>
<span class="comments">; :Categories:</span>
<span class="comments">;    Graphics, Map Projections</span>
<span class="comments">;    </span>
<span class="comments">; :Params:</span>
<span class="comments">;     p0lat: in, optional, type=float</span>
<span class="comments">;         The center latitude of the map projection.</span>
<span class="comments">;     p0lon: in, optional, type=float</span>
<span class="comments">;         The center longitude of the map projection.</span>
<span class="comments">;     rot: in, optional, type=float, default=0.0</span>
<span class="comments">;         The angle through which the map projection should be rotated. Positve </span>
<span class="comments">;         values are in a clockwise direction.</span>
<span class="comments">;       </span>
<span class="comments">; :Keywords:</span>
<span class="comments">;     addcmd: in, optional, type=boolean, default=0</span>
<span class="comments">;        If this keyword is set, the command is added to the resizeable graphics</span>
<span class="comments">;        window, cgWindow. </span>
<span class="comments">;     background: in, optional, type=string, default='white'</span>
<span class="comments">;        The name of the background color. Using this keyword automatically sets </span>
<span class="comments">;        the ERASE keyword to 1.</span>
<span class="comments">;     color: in, optional, type=string, default='opposite'</span>
<span class="comments">;        The name of the drawing color for the program.</span>
<span class="comments">;        erase: in, optional, type=boolean, default=0</span>
<span class="comments">;        Set this keyword if you wish to the current graphics content of the window</span>
<span class="comments">;        before drawing the map projection. The graphics display will be erased</span>
<span class="comments">;        in the background color. This is a more intuitive way to set this behavior</span>
<span class="comments">;        than to set NOERASE to 0, which does the same thing.</span>
<span class="comments">;     continents: in, optional, type=boolean, default=0</span>
<span class="comments">;         Set this keyword to display continental outlines on the map projection.</span>
<span class="comments">;         Any keyword appropriate to the IDL command Map_Continents can be used to</span>
<span class="comments">;         modify the look of the continental outlines.</span>
<span class="comments">;     erase: in, optional, type=boolean, default=0</span>
<span class="comments">;         A more intuitive way to set NOERASE=0. If ERASE is set, the display window</span>
<span class="comments">;         is erased in the BACKGROUND color.</span>
<span class="comments">;     grid: in, optional, type=boolean, default=0</span>
<span class="comments">;         Set this keyword to display a map grid on the map projection. And keyword</span>
<span class="comments">;         appropriate to the IDL command Map_Grid can be used to modify the look of the</span>
<span class="comments">;         map grid.</span>
<span class="comments">;     onimage: in, optional, type=boolean, default=0</span>
<span class="comments">;        If this keyword is set, the position of the map projection in the graphics window</span>
<span class="comments">;        is obtained from the last image displayed with cgImage. This makes it extremely</span>
<span class="comments">;        easy to display an image and immediately set up a map projection space that will</span>
<span class="comments">;        allow you to annotate the image using map locations. This keyword is ignored if</span>
<span class="comments">;        the 'Position` keyword is used.</span>
<span class="comments">;     position: in, optional, type=FltArr(4)</span>
<span class="comments">;        The normalized position of the map projection space in the graphics window.</span>
<span class="comments">;        The default is [0.075, 0.075, 0.925, 0.925]</span>
<span class="comments">;     window: in, optional, type=boolean, default=0</span>
<span class="comments">;         If this keyword is set, the command replaces any commands in a current</span>
<span class="comments">;         cgWindow or it opens a new cgWindow and adds itself to it.</span>
<span class="comments">;</span>
<span class="comments">; :Author:</span>
<span class="comments">;   FANNING SOFTWARE CONSULTING::</span>
<span class="comments">;      David W. Fanning </span>
<span class="comments">;      1645 Sheely Drive</span>
<span class="comments">;      Fort Collins, CO 80526 USA</span>
<span class="comments">;      Phone: 970-221-0438</span>
<span class="comments">;      E-mail: david@idlcoyote.com</span>
<span class="comments">;      Coyote's Guide to IDL Programming: http://www.idlcoyote.com</span>
<span class="comments">;           </span>
<span class="comments">; :History:</span>
<span class="comments">;     Written by David W. Fanning, 7 November 2011.</span>
<span class="comments">;     Added ONIMAGE keyword to allow the position to be specified at the last</span>
<span class="comments">;        image position from cgImage. 3 March 2012. DWF.</span>
<span class="comments">;     Several MAP_CONTINENTS keywords seem to have gone missing. Added COASTS,</span>
<span class="comments">;        COUNTRIES, FILL_CONTINENTS, and RIVERS. 4 Dec 2012. DWF.</span>
<span class="comments">;     Forgot to pass the "extra" information in (e.g., E_HORIZON keyword) to Map_Set. 18 Jan 2013. DWF.</span>
<span class="comments">;     HORIZON keyword not being passed along to Map_Set. 28 Feb 2013. DWF.</span>
<span class="comments">;     Forgot to look at !P.Multi before setting a POSITION. Fixed. 11 March 2013. DWF.</span>
<span class="comments">;     Modified the E_GRID and E_HORIZON structure code to allow color names. 29 April 2013. Joe Sapp.</span>
<span class="comments">;     In some situations, the "extra" continents structure was not being passed along. 29 May 2013. DWF.</span>
<span class="comments">;     Now, when "extra" structures are passed along, they can have duplicate fields. Put check in place. 22 June 2013. DWF.</span>
<span class="comments">;        </span>
<span class="comments">; :Copyright:</span>
<span class="comments">;     Copyright (c) 2011-2012, Fanning Software Consulting, Inc.</span>
<span class="comments">;---------------------------------------------------------------------------</span>
PRO cgMap_Set, p0lat, p0lon, rot, $
      ADDCMD=addcmd, $
      ADVANCE = advance,  $
      AITOFF = aitoff, $            
      ALBERS = albers, $            
      AZIMUTHAL = azimuth, $
      BACKGROUND=background, $
      BOX_AXES=box_axes, $
      CENTRAL_AZIMUTH=cent_azim, $
      CHARSIZE = charsize, $
      CLIP=clip, $
      COASTS=coasts, $
      COLOR=color, $
      CON_COLOR=con_color, $
      CONIC = conic, $
      CONTINENTS = continents, $
      COUNTRIES=countries, $
      CYLINDRICAL = cylindrical, $
      E_CONTINENTS=_econt, $ 
      E_HORIZON=_ehorizon, $
      E_GRID=_egrid, $      
      ELLIPSOID = ellips, $
      ERASE=erase, $
      FILL_CONTINENTS=fill_continents, $
      GLINESTYLE=glinestyle, $
      GLINETHICK=glinethick, $
      GRID=grid, $
      GOODESHOMOLOSINE = goodes, $  
      GNOMIC = gnomic, $
      HAMMER = hammer, $            
      HIRES = hires, $
      HORIZON=horizon, $
      ISOTROPIC = iso, $,             
      LAMBERT = lambert, $
      LABEL=label, $
      LATALIGN=latalign, $
      LATDEL=latdel, $
      LATLAB=latlab, $
      LIMIT = limit, $           
      LONALIGN=lonalign, $
      LONDEL=londel, $
      LONLAB=lonlab, $
      MERCATOR = mercator, $
      MILLER_CYLINDRICAL=miller, $
      MLINESTYLE=mlinestyle, $
      MLINETHICK=mlinethick, $
      MOLLWEIDE = mollweide, $
      NAME=name, $                    
      NOBORDER=noborder, $
      NOERASE=noerase, $
      ONIMAGE=onimage, $
      ORTHOGRAPHIC = orthographic, $
      POSITION = position, $
      PROJECTION=proj, $   
      RIVERS=rivers, $           
      REVERSE=reverse, $   
      ROBINSON = robinson, $         
      SAT_P = Sat_p, $ 
      SATELLITE = satellite, $       
      SCALE=scale, $ 
      STANDARD_PARALLELS = std_p, $
      STEREOGRAPHIC = stereographic, $
      SINUSOIDAL = sinusoidal, $
      T3D=t3d, $
      TITLE=title, $
      TRANSVERSE_MERCATOR = utm, $ 
      USA=usa, $
      WHOLE_MAP=whole_map, $
      WINDOW=window, $
      XMARGIN=xmargin, $
      YMARGIN=ymargin, $
      ZVALUE=zvalue
    
    Catch, theError
    IF theError NE 0 THEN BEGIN
      Catch, /CANCEL
      void = Error_Message()
      IF N_Elements(thisState) NE 0 THEN SetDecomposedState, thisState
      RETURN
    ENDIF
      
    <span class="comments">; Add this command to a cgWindow.</span>
    IF Keyword_Set(addcmd) THEN BEGIN
    
       cgWindow, 'cgMap_Set', p0lat, p0lon, rot, $
          ADDCMD=1, $
          ADVANCE = advance,  $
          AITOFF = aitoff, $            
          ALBERS = albers, $            
          AZIMUTHAL = azimuth, $
          BACKGROUND=background, $
          BOX_AXES=box_axes, $
          CENTRAL_AZIMUTH=cent_azim, $
          CHARSIZE = charsize, $
          CLIP=clip, $
          COASTS=coasts, $
          COLOR=color, $
          CON_COLOR=con_color, $
          CONIC = conic, $
          CONTINENTS = continents, $
          COUNTRIES=countries, $
          CYLINDRICAL = cylindrical, $
          E_CONTINENTS=_econt, $ 
          E_HORIZON=_ehorizon, $
          E_GRID=_egrid, $      
          ELLIPSOID = ellips, $
          ERASE=erase, $
          FILL_CONTINENTS=fill_continents, $
          GLINESTYLE=glinestyle, $
          GLINETHICK=glinethick, $
          GRID=grid, $
          GOODESHOMOLOSINE = goodes, $  
          GNOMIC = gnomic, $
          HAMMER = hammer, $            
          HIRES = hires, $
          HORIZON=horizon, $
          ISOTROPIC = iso, $,             
          LAMBERT = lambert, $
          LABEL=label, $
          LATALIGN=latalign, $
          LATDEL=latdel, $
          LATLAB=latlab, $
          LIMIT = limit, $           
          LONALIGN=lonalign, $
          LONDEL=londel, $
          LONLAB=lonlab, $
          MERCATOR = mercator, $
          MILLER_CYLINDRICAL=miller, $
          MLINESTYLE=mlinestyle, $
          MLINETHICK=mlinethick, $
          MOLLWEIDE = mollweide, $
          NAME=name, $                    
          NOBORDER=noborder, $
          NOERASE=noerase, $
          ONIMAGE=onimage, $
          ORTHOGRAPHIC = orthographic, $
          POSITION = position, $
          PROJECTION=proj, $    
          RIVERS=rivers, $          
          REVERSE=reverse, $   
          ROBINSON = robinson, $         
          SAT_P = Sat_p, $ 
          SATELLITE = satellite, $       
          SCALE=scale, $ 
          STANDARD_PARALLELS = std_p, $
          STEREOGRAPHIC = stereographic, $
          SINUSOIDAL = sinusoidal, $
          T3D=t3d, $
          TITLE=title, $
          TRANSVERSE_MERCATOR = utm, $ 
          USA=usa, $
          WHOLE_MAP=whole_map, $
          XMARGIN=xmargin, $
          YMARGIN=ymargin, $
          ZVALUE=zvalue
          
       RETURN
       
    ENDIF
    
    <span class="comments">; Replace the commands in or create a cgWindow.</span>
    IF Keyword_Set(window) THEN BEGIN
    
       currentWindow = cgQuery(/CURRENT, COUNT=wincnt)
       IF wincnt EQ 0 THEN BEGIN
           cgWindow
           IF N_Elements(background) EQ 0 THEN background='white'
       ENDIF
       cgWindow, 'cgMap_Set', p0lat, p0lon, rot, $
          ADVANCE = advance,  $
          AITOFF = aitoff, $            
          ALBERS = albers, $            
          AZIMUTHAL = azimuth, $
          BACKGROUND=background, $
          BOX_AXES=box_axes, $
          CENTRAL_AZIMUTH=cent_azim, $
          CHARSIZE = charsize, $
          CLIP=clip, $
          COLOR=color, $
          COASTS=coasts, $
          CON_COLOR=con_color, $
          CONIC = conic, $
          CONTINENTS = continents, $
          COUNTRIES=countries, $
          CYLINDRICAL = cylindrical, $
          E_CONTINENTS=_econt, $ 
          E_HORIZON=_ehorizon, $
          E_GRID=_egrid, $      
          ELLIPSOID = ellips, $
          ERASE=erase, $
          FILL_CONTINENTS=fill_continents, $
          GLINESTYLE=glinestyle, $
          GLINETHICK=glinethick, $
          GRID=grid, $
          GOODESHOMOLOSINE = goodes, $  
          GNOMIC = gnomic, $
          HAMMER = hammer, $            
          HIRES = hires, $
          HORIZON=horizon, $
          ISOTROPIC = iso, $,             
          LAMBERT = lambert, $
          LABEL=label, $
          LATALIGN=latalign, $
          LATDEL=latdel, $
          LATLAB=latlab, $
          LIMIT = limit, $           
          LONALIGN=lonalign, $
          LONDEL=londel, $
          LONLAB=lonlab, $
          MERCATOR = mercator, $
          MILLER_CYLINDRICAL=miller, $
          MLINESTYLE=mlinestyle, $
          MLINETHICK=mlinethick, $
          MOLLWEIDE = mollweide, $
          NAME=name, $                    
          NOBORDER=noborder, $
          NOERASE=noerase, $
          ONIMAGE=onimage, $
          ORTHOGRAPHIC = orthographic, $
          POSITION = position, $
          PROJECTION=proj, $  
          RIVERS=rivers, $            
          REVERSE=reverse, $   
          ROBINSON = robinson, $         
          SAT_P = Sat_p, $ 
          SATELLITE = satellite, $       
          SCALE=scale, $ 
          STANDARD_PARALLELS = std_p, $
          STEREOGRAPHIC = stereographic, $
          SINUSOIDAL = sinusoidal, $
          T3D=t3d, $
          TITLE=title, $
          TRANSVERSE_MERCATOR = utm, $ 
          USA=usa, $
          WHOLE_MAP=whole_map, $
          XMARGIN=xmargin, $
          YMARGIN=ymargin, $
          ZVALUE=zvalue, $
          REPLACECMD=1
          
       RETURN
       
    ENDIF
    
    <span class="comments">; Erasing to get the background color right is going to be very important.</span>
    <span class="comments">; Unfortunately, MAP_SET itself has an ERASE command in it that will result</span>
    <span class="comments">; in a window with a BLACK background. We don't want this, so we have to call</span>
    <span class="comments">; MAP_SET, when we do, with the NOERASE keyword set. We need a flag that </span>
    <span class="comments">; tells us when we want to do the erasing ourselves. Here we initialize the flag.</span>
    eraseForBackground = 0
    
    <span class="comments">; If you specify a BACKGROUND keyword, then ERASE is set automatically.</span>
    IF N_Elements(background) NE 0 THEN BEGIN
        CASE Size(background, /TNAME) OF
           'STRING':
           'LONG': 
           'BYTE': background = StrTrim(Fix(background), 2)
           ELSE: background = StrTrim(background,2)
        ENDCASE 
       IF N_Elements(noerase) EQ 0 THEN BEGIN
          noerase = 1
          eraseForBackground = 1
       ENDIF ELSE eraseForBackground = 0
    ENDIF ELSE background = 'white'
    
    IF N_Elements(color) NE 0 THEN BEGIN
        CASE Size(color, /TNAME) OF
           'STRING':
           'LONG': 
           'BYTE': color = StrTrim(Fix(color), 2)
           ELSE: color = StrTrim(color,2)
        ENDCASE 
    ENDIF ELSE color = "opposite"
    IF N_Elements(con_color) NE 0 THEN BEGIN
        CASE Size(con_color, /TNAME) OF
           'STRING':
           'LONG': 
           'BYTE': con_color = StrTrim(Fix(con_color), 2)
           ELSE: con_color = StrTrim(con_color,2)
        ENDCASE
    ENDIF ELSE BEGIN
       IF Keyword_Set(continents) THEN BEGIN
          IF (N_Elements(_econt) NE 0) THEN BEGIN
             tagnames = Tag_Names(_econt)
             index = Where(tagnames EQ 'COLOR')
             IF index LT 0 THEN BEGIN
                econt = _econt
                con_color = color
             ENDIF $
             ELSE BEGIN
                <span class="comments">; Create a copy of _econt to be passed on with an</span>
                <span class="comments">; appropriate color.</span>
                IF index EQ 0 then econt = {COLOR: 0L} $
                ELSE econt = Create_Struct(tagnames[0], _econt.(0))

                FOR j=1L,N_Elements(tagnames)-1 DO BEGIN
                   value = (j NE index) ? _econt.(j) : 0L
                   econt = Create_Struct(econt, $
                      tagnames[j], value)
                ENDFOR
                econt.color = cgColor(_econt.color)
             ENDELSE
          ENDIF ELSE con_color = color
       ENDIF 
    ENDELSE
    
    <span class="comments">; Make sure the extra continent structure is passed on.</span>
    IF (N_Elements(_econt) NE 0) && (N_Elements(econt) EQ 0) THEN econt = _econt

    <span class="comments">; Fix color passed on to MAP_GRID, if needed.</span>
    IF N_Elements(_egrid) NE 0 THEN BEGIN
       tagnames = Tag_Names(_egrid)
       index = Where(Tag_Names(_egrid) EQ 'COLOR')
       IF index LT 0 THEN egrid = _egrid $
       ELSE BEGIN
          <span class="comments">; Create a copy of _egrid to be passed on with an</span>
          <span class="comments">; appropriate color.</span>
          IF index EQ 0 then egrid = {COLOR: 0L} $
          ELSE egrid = Create_Struct(tagnames[0], _egrid.(0))

          FOR j=1L,N_Elements(tagnames)-1 DO BEGIN
             value = (j NE index) ? _egrid.(j) : 0L
             egrid = Create_Struct(egrid, $
                tagnames[j], value)
          ENDFOR
          egrid.color = cgColor(_egrid.color)
       ENDELSE
    ENDIF

    <span class="comments">; Fix color passed on to the HORIZON keyword, if needed.</span>
    IF N_Elements(_ehorizon) NE 0 THEN BEGIN
       tagnames = Tag_Names(_ehorizon)
       index = Where(Tag_Names(_ehorizon) EQ 'COLOR')
       IF index LT 0 THEN ehorizon = _ehorizon $
       ELSE BEGIN
          <span class="comments">; Create a copy of _ehorizon to be passed on with an</span>
          <span class="comments">; appropriate color.</span>
          IF index EQ 0 then ehorizon = {COLOR: 0L} $
          ELSE ehorizon = Create_Struct(tagnames[0], _ehorizon.(0))

          FOR j=1L,N_Elements(tagnames)-1 DO BEGIN
             value = (j NE index) ? _ehorizon.(j) : 0L
             ehorizon = Create_Struct(ehorizon, $
                tagnames[j], value)
          ENDFOR
          ehorizon.color = cgColor(_ehorizon.color)
       ENDELSE
    ENDIF

    IF N_Elements(position) EQ 0 THEN BEGIN
    
        <span class="comments">; Are you putting this on an image? If so, get the position from</span>
        <span class="comments">; the last image position in.</span>
        IF Keyword_Set(onimage) THEN BEGIN
            COMMON FSC_$CGIMAGE, _cgimage_xsize, _cgimage_ysize, $
                                 _cgimage_winxsize, _cgimage_winysize, $
                                 _cgimage_position, _cgimage_winID, $
                                 _cgimage_current
            position = _cgimage_position
        ENDIF ELSE BEGIN
            IF Total(!P.Multi) LT 0 THEN position = [0.075, 0.075, 0.925, 0.925]
        ENDELSE
    ENDIF
    
    <span class="comments">; Try to do this in decomposed color, if possible.</span>
    SetDecomposedState, 1, Current=thisState
    
    <span class="comments">; If this is a graphics device, and there is no current graphics window,</span>
    <span class="comments">; then set the erase flag.</span>
    IF (!D.Name EQ 'WIN' || !D.Name EQ 'X') && (!D.Window LT 0) THEN BEGIN
        IF N_Elements(noerase) EQ 0 THEN BEGIN
            noerase = 1
            eraseForBackground = 1 
        ENDIF 
    ENDIF
    
    <span class="comments">; Need to erase? If you are using this keyword, then I assume</span>
    <span class="comments">; you want the background color to show.</span>
    IF N_Elements(erase) NE 0 THEN BEGIN
         noerase = 1 - Keyword_Set(erase)
         IF Keyword_Set(erase) THEN eraseForBackground = 1
    ENDIF
    
    <span class="comments">; We need the following two lines to avoid problems in MAP_SET with</span>
    <span class="comments">; an ERASE command. We are going to do MAP_SET's erasing for it, then</span>
    <span class="comments">; set the NOERASE=1 keyword on the MAP_SET call further down in the code.</span>
    IF (!P.Multi[0] EQ 0) && Keyword_Set(advance) && ~eraseForBackground THEN eraseForBackground = 1
    IF (~Keyword_Set(noerase)) && (~Keyword_Set(advance)) && ~eraseForBackground THEN eraseForBackground = 1
    
    <span class="comments">; Erase with a background color?</span>
    IF eraseForBackground THEN BEGIN
        cgErase, Color=background
        noerase = 1
    ENDIF
    
    <span class="comments">; Change color into appropriate value, if needed.</span>
    IF Size(color, /TNAME) EQ 'STRING' THEN color = cgColor(color)
    
    <span class="comments">; Input parameters must be defined because of the way MAP_SET is written.</span>
    IF N_Elements(rot) EQ 0 THEN rot = 0.0d0
    IF N_Elements(p0lon) EQ 0 THEN p0lon = 0.0d0
    IF N_Elements(p0lat) EQ 0 THEN p0lat = 0.0d0    
    
    <span class="comments">; Call the MAP_SET procedure.</span>
    Map_Set, p0lat, p0lon, rot, $
        ADVANCE = advance,  $
        AITOFF = aitoff, $            
        ALBERS = albers, $            
        AZIMUTHAL = azimuth, $
        CENTRAL_AZIMUTH=cent_azim, $
        CHARSIZE = charsize, $
        COLOR=color, $
        CONIC = conic, $
        CYLINDRICAL = cylindrical, $
        E_CONTINENTS=econt, $ 
        E_HORIZON=ehorizon, $
        E_GRID=egrid, $      
        ELLIPSOID = ellips, $
        GOODESHOMOLOSINE = goodes, $  
        GNOMIC = gnomic, $
        HAMMER = hammer, $   
        HORIZON=horizon, $         
        ISOTROPIC = iso, $,             
        LAMBERT = lambert, $
        LIMIT = limit, $           
        MERCATOR = mercator, $
        MILLER_CYLINDRICAL=miller, $
        MOLLWEIDE = mollweide, $
        NAME=name, $                    
        NOBORDER=noborder, $
        NOERASE=1, $
        ORTHOGRAPHIC = orthographic, $
        POSITION = position, $
        PROJECTION=proj, $              
        REVERSE=reverse, $   
        ROBINSON = robinson, $         
        SAT_P = Sat_p, $ 
        SATELLITE = satellite, $       
        SCALE=scale, $ 
        STANDARD_PARALLELS = std_p, $
        STEREOGRAPHIC = stereographic, $
        SINUSOIDAL = sinusoidal, $
        T3D=t3d, $
        TITLE=title, $
        TRANSVERSE_MERCATOR = utm, $ 
        WHOLE_MAP=whole_map, $
        XMARGIN=xmargin, $
        YMARGIN=ymargin, $
        ZVALUE=zvalue
        
    <span class="comments">; Need continental outlines?</span>
    IF Keyword_Set(continents) THEN BEGIN
    
       cgMap_Continents, $
         COASTS=kcoasts, $
         COLOR=con_color, $
         CONTINENTS = continents, $
         COUNTRIES=countries, $
         FILL_CONTINENTS=fill_continents, $
         HIRES=hires, $
         LIMITS = lim_u, $
         MAP_STRUCTURE=mapStructure, $
         ORIENTATION=orientation, $
         RIVERS=rivers, $
         SPACING=spacing, $
         T3D=T3D, $
         THICK=thick, $
         USA = usa, $
         ZVALUE=zvalue, $
         _EXTRA=e_cont
       
    ENDIF
    
    <span class="comments">; Need a map grid?</span>
    IF Keyword_Set(grid) THEN BEGIN
    
       <span class="comments">; We have a couple of extra keyword structures that can come in</span>
       <span class="comments">; here. We have to build a structure appropriately, depending upon</span>
       <span class="comments">; what we have.</span>
       CASE 1 OF
          (N_Elements(egrid) EQ 0) && (N_Elements(ehorizon) EQ 0):
          (N_Elements(egrid) EQ 0) && (N_Elements(ehorizon) NE 0): extra = ehorizon
          (N_Elements(egrid) NE 0) && (N_Elements(ehorizon) EQ 0): extra = egrid
          (N_Elements(egrid) NE 0) && (N_Elements(ehorizon) NE 0): BEGIN
              g_tagnames = Tag_Names(egrid)
              h_tagnames = Tag_Names(ehorizon)
              extra = egrid
              
              <span class="comments">; It is possible that these two structures have identical tags, if so</span>
              <span class="comments">; we are going to skip them.</span>
              FOR j=0L,N_Elements(tagnames)-1 DO BEGIN
                 check = Where(tagnames[j] EQ g_tagnames, count)
                 IF count EQ 0 THEN BEGIN
                    extra = Create_Struct(extra, tagnames[j], ehorizon.(j))
                 ENDIF
              ENDFOR
              END        
       ENDCASE
       
       cgMap_Grid, $
          BOX_AXES=box_axes, $
          CHARSIZE=charsize, $
          CLIP_TEXT=clip, $
          HORIZON=horizon, $
          LABEL=label, $
          LATALIGN=latalign, $
          LATDEL=latdel, $
          LATLAB=latlab, $
          LINESTYLE=linestyle, $
          LONALIGN=lonalign, $
          LONDEL=londel, $
          LONLAB=lonlab, $
          ORIENTATION=orientation, $
          THICK=thick, $
          _EXTRA=extra
          
    ENDIF

    <span class="comments">; Restore color state.</span>
    SetDecomposedState, thisState
    
    END <span class="comments">;-------------------------------------------------------------------</span>
</code>
    </div>
  </body>
</html>