<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:10 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>pswindow.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="pswindow.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;    PSWINDOW</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;</span>
<span class="comments">;    This function is used to calculate the size of a PostScript</span>
<span class="comments">;    window that has the same aspect ratio (ratio of height to</span>
<span class="comments">;    width) as the current display graphics window. It creates</span>
<span class="comments">;    the largest possible PostScript output window with the</span>
<span class="comments">;    desired aspect ratio. This assures that PostScript output</span>
<span class="comments">;    looks similar, if not identical, to normal graphics output</span>
<span class="comments">;    on the display.</span>
<span class="comments">;</span>
<span class="comments">; AUTHOR:</span>
<span class="comments">;</span>
<span class="comments">;   FANNING SOFTWARE CONSULTING</span>
<span class="comments">;   David Fanning, Ph.D.</span>
<span class="comments">;   1645 Sheely Drive</span>
<span class="comments">;   Fort Collins, CO 80526 USA</span>
<span class="comments">;   Phone: 970-221-0438</span>
<span class="comments">;   E-mail: david@idlcoyote.com</span>
<span class="comments">;   Coyote's Guide to IDL Programming: http://www.idlcoyote.com/</span>
<span class="comments">;</span>
<span class="comments">; CATEGORY:</span>
<span class="comments">;</span>
<span class="comments">;    Graphics.</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;</span>
<span class="comments">;    pageInfo = PSWINDOW()</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;</span>
<span class="comments">;    None.</span>
<span class="comments">;</span>
<span class="comments">; KEYWORD PARAMETERS:</span>
<span class="comments">; </span>
<span class="comments">;    ASPECTRATIO: Normally the aspect ratio is matched to the</span>
<span class="comments">;    aspect ratio (ratio of height divided by width) of the current</span>
<span class="comments">;    graphics window. However, this keyword can be used to select</span>
<span class="comments">;    a particular aspect ratio for the PostScript window. This should</span>
<span class="comments">;    be a floating point value.</span>
<span class="comments">;</span>
<span class="comments">;    CM: Normally the structure value that is returned from this</span>
<span class="comments">;    function reports its values in inches. Setting this keyword</span>
<span class="comments">;    causes the return values to be in units of centimeters.</span>
<span class="comments">;    </span>
<span class="comments">;    EUROPEAN: This keyword is depreciated in favor of METRIC.</span>
<span class="comments">;</span>
<span class="comments">;    FUDGE: A quick way to set symetrical XFUDGE and YFUDGE factors.</span>
<span class="comments">;    If this keyword is set to a value, XFUDGE and YFUDGE keywords are</span>
<span class="comments">;    set to the same value. Fudge factors are used only with some</span>
<span class="comments">;    printers and generally only when output is being sent to the</span>
<span class="comments">;    PRINTER device. (See the description of the XFUDGE and YFUDGE</span>
<span class="comments">;    keywords for additional information.)</span>
<span class="comments">;</span>
<span class="comments">;    LANDSCAPE: Normally, a landscape page is selected if the current </span>
<span class="comments">;    graphics window is wider than it is tall. If you prefer a landscape</span>
<span class="comments">;    aspect window on a Portrait page, set the LANDSCAPE keywword to 0. </span>
<span class="comments">;    Setting  this keyword to 1 will result in a landscape page no </span>
<span class="comments">;    matter the size of the current graphics window.</span>
<span class="comments">;</span>
<span class="comments">;    MARGIN:  The margin around the edges of the plot. The value must be</span>
<span class="comments">;    a floating point value between 0.0 and 0.35. It is expressed in</span>
<span class="comments">;    normalized coordinate units. The default margin is 0.05.</span>
<span class="comments">;</span>
<span class="comments">;    METRIC: If this keyword is set, the program defaults change</span>
<span class="comments">;    so that the CM keyword is set to 1 and the PAGESIZE keyword is</span>
<span class="comments">;    set to "A4".</span>
<span class="comments">;</span>
<span class="comments">;    PAGESIZE: Set this keyword to a string indicating the type</span>
<span class="comments">;    of PostScript page size you want. Current values are "LETTER",</span>
<span class="comments">;    "LEGAL", and "A4". Default is "LETTER".</span>
<span class="comments">;</span>
<span class="comments">;    PRINTER: Set this keyword if the output will be used to</span>
<span class="comments">;    configure the PRINTER device, rather than the PS device.</span>
<span class="comments">;    (In the PRINTER device, offsets are always calculated from</span>
<span class="comments">;    the lower-left corner of the page and do not rotate in</span>
<span class="comments">;    Landscape mode, as they do with the PS device.) Note that</span>
<span class="comments">;    the PRINTER device is only able to accept these keywords</span>
<span class="comments">;    in IDL 5.1 and higher.</span>
<span class="comments">;</span>
<span class="comments">;    XFUDGE: Printers calculate the offset point from the printable</span>
<span class="comments">;    edge of the paper (sometimes), rather from the corner of the paper.</span>
<span class="comments">;    For example, on my Lexmark printer, both X and Y offsets are</span>
<span class="comments">;    calculated from a point 0.25 inches in from the edge. This keyword</span>
<span class="comments">;    allows you to set a "fudge" factor that will be subtracted from</span>
<span class="comments">;    the XOFFSET that is returned to the user. This allows you to create</span>
<span class="comments">;    output that is centered on the page. The fudge factor should be in</span>
<span class="comments">;    the same units as the returned size and offset values.</span>
<span class="comments">;</span>
<span class="comments">;    YFUDGE: Printers calculate the offset point from the printable</span>
<span class="comments">;    edge of the paper (sometimes), rather from the corner of the paper.</span>
<span class="comments">;    For example, on my Lexmark printer, both X and Y offsets are</span>
<span class="comments">;    calculated from a point 0.25 inches in from the edge. This keyword</span>
<span class="comments">;    allows you to set a "fudge" factor that will be subtracted from</span>
<span class="comments">;    the YOFFSET that is returned to the user. This allows you to create</span>
<span class="comments">;    output that is centered on the page. The fudge factor should be in</span>
<span class="comments">;    the same units as the returned size and offset values.</span>
<span class="comments">;</span>
<span class="comments">; OUTPUTS:</span>
<span class="comments">;</span>
<span class="comments">;    pageInfo: The output value is a named structure defined like</span>
<span class="comments">;    this:</span>
<span class="comments">;</span>
<span class="comments">;      pageInfo = {PSWINDOW_STRUCT, XSIZE:0.0, YSIZE:0.0, $</span>
<span class="comments">;         XOFSET:0.0, YOFFSET:0.0, INCHES:0, PORTRAIT:0, LANDSCAPE:0}</span>
<span class="comments">;</span>
<span class="comments">;    The units of the four size fields are inches unless the CM</span>
<span class="comments">;    keyword is set.</span>
<span class="comments">;</span>
<span class="comments">;    The output can be used to immediately configure the PostScript</span>
<span class="comments">;    or Printer device, like this:</span>
<span class="comments">;</span>
<span class="comments">;       Set_Plot, 'PS' ; or 'PRINTER'</span>
<span class="comments">;       Device, _Extra=pageInfo</span>
<span class="comments">;</span>
<span class="comments">; RESTRICTIONS:</span>
<span class="comments">;</span>
<span class="comments">;    The aspect ratio of the current graphics window is calculated</span>
<span class="comments">;    like this:</span>
<span class="comments">;</span>
<span class="comments">;       aspectRatio = FLOAT(!D.Y_VSIZE) / !D.X_VSIZE</span>
<span class="comments">;</span>
<span class="comments">; EXAMPLE:</span>
<span class="comments">;</span>
<span class="comments">;    To create a PostScript output window with the same aspect</span>
<span class="comments">;    ratio as the curently active display window, type:</span>
<span class="comments">;</span>
<span class="comments">;     pageInfo = PSWINDOW()</span>
<span class="comments">;     SET_PLOT, 'PS'</span>
<span class="comments">;     DEVICE, _Extra=pageInfo</span>
<span class="comments">;</span>
<span class="comments">;     To configure the PRINTER device:</span>
<span class="comments">;</span>
<span class="comments">;     pageInfo = PSWINDOW(/Printer, Fudge=0.25)</span>
<span class="comments">;     SET_PLOT, 'PRINTER'</span>
<span class="comments">;     DEVICE, _Extra=pageInfo</span>
<span class="comments">;</span>
<span class="comments">; MODIFICATION HISTORY:</span>
<span class="comments">;</span>
<span class="comments">;    Written by: David W. Fanning, November 1996.</span>
<span class="comments">;       Fixed a bug in which the YOFFSET was calculated incorrectly</span>
<span class="comments">;          in Landscape mode. 12 Feb 97.</span>
<span class="comments">;       Took out a line of code that wasn't being used. 14 Mar 97.</span>
<span class="comments">;       Added correct units keyword to return structure. 29 JUN 98. DWF</span>
<span class="comments">;       Fixed a bug in how landscape offsets were calculated. 19 JUL 99. DWF.</span>
<span class="comments">;       Fixed a bug in the way margins were used to conform to my</span>
<span class="comments">;          original conception of the program. 19 JUL 99. DWF.</span>
<span class="comments">;       Added Landscape and Portrait fields to the return structure. 19 JUL 99. DWF.</span>
<span class="comments">;       Added PageSize keyword, changed MARGIN keyword, and completely</span>
<span class="comments">;          rewrote most of the intenal code. 9 FEB 2000. DWF.</span>
<span class="comments">;       Fixed a bug in how I calculated the aspect ratio. 1 MAR 2000. DWF.</span>
<span class="comments">;       Added PRINTER keyword to return proper offset values for the</span>
<span class="comments">;          PRINTER device, where the offset location is not rotated. 1 MAR 2000. DWF.</span>
<span class="comments">;       Added PRINTER fudge factors to take into account that printer offsets are</span>
<span class="comments">;          calculated from the printable area of the paper, rather than the corner</span>
<span class="comments">;          of the paper. 8 AUG 2000. DWF.</span>
<span class="comments">;       Changed the default margin to 0.05 from 0.15. 29 Nov 2004, DWF.</span>
<span class="comments">;       Added EUROPEAN keyword and set LANDSCAPE mode if window wider than higher</span>
<span class="comments">;           as the default if LANDSCAPE is not set. 13 Dec 2010. DWF.</span>
<span class="comments">;       Added ASPECTRATIO keyword to allow user-specified window aspect ratio. 13 Dec 2010. DWF.</span>
<span class="comments">;       Depreciated EUROPEAN keyword in favor of METRIC. 31 Jan 2011. DWF.</span>
<span class="comments">;       Now setting LANDSCAPE=0 if aspect GT 1 and not set otherwise. 19 Feb 2013. DWF.</span>
<span class="comments">;-</span>
<span class="comments">;</span>
<span class="comments">;******************************************************************************************;</span>
<span class="comments">;  Copyright (c) 2008, by Fanning Software Consulting, Inc.                                ;</span>
<span class="comments">;  All rights reserved.                                                                    ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  Redistribution and use in source and binary forms, with or without                      ;</span>
<span class="comments">;  modification, are permitted provided that the following conditions are met:             ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;      * Redistributions of source code must retain the above copyright                    ;</span>
<span class="comments">;        notice, this list of conditions and the following disclaimer.                     ;</span>
<span class="comments">;      * Redistributions in binary form must reproduce the above copyright                 ;</span>
<span class="comments">;        notice, this list of conditions and the following disclaimer in the               ;</span>
<span class="comments">;        documentation and/or other materials provided with the distribution.              ;</span>
<span class="comments">;      * Neither the name of Fanning Software Consulting, Inc. nor the names of its        ;</span>
<span class="comments">;        contributors may be used to endorse or promote products derived from this         ;</span>
<span class="comments">;        software without specific prior written permission.                               ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  THIS SOFTWARE IS PROVIDED BY FANNING SOFTWARE CONSULTING, INC. ''AS IS'' AND ANY        ;</span>
<span class="comments">;  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES    ;</span>
<span class="comments">;  OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT     ;</span>
<span class="comments">;  SHALL FANNING SOFTWARE CONSULTING, INC. BE LIABLE FOR ANY DIRECT, INDIRECT,             ;</span>
<span class="comments">;  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED    ;</span>
<span class="comments">;  TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;         ;</span>
<span class="comments">;  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND             ;</span>
<span class="comments">;  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT              ;</span>
<span class="comments">;  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS           ;</span>
<span class="comments">;  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.                            ;</span>
<span class="comments">;******************************************************************************************;</span>



FUNCTION PSWINDOW_ASPECT, aspectRatio, MARGIN=margin, WindowAspect=wAspectRatio

    ON_ERROR, 1
    
    <span class="comments">; Check for aspect ratio parameter and possibilities.</span>
    IF N_PARAMS() EQ 0 THEN aspectRatio = 1.0
    IF aspectRatio EQ 0 THEN BEGIN
       MESSAGE, 'Aspect Ratio of 0. Changing to 1...', /Informational
       aspectRatio = 1.0
    ENDIF
    
    dataType = SIZE(aspectRatio, /TNAME)
    IF dataType NE 'FLOAT' THEN BEGIN
       MESSAGE, 'Aspect Ratio is not a FLOAT. Take care...', /Informational
       aspectRatio = Float(aspectRatio)
    ENDIF
    
    <span class="comments">; Check for margins.</span>
    IF N_ELEMENTS(margin) EQ 0 THEN margin = 0.15
    
    <span class="comments">; Error checking.</span>
    IF margin LT 0 OR margin GE 0.35 THEN $
       MESSAGE, 'The MARGIN keyword value must be between 0.0 and 0.35.'
    
    <span class="comments">; Calculate the aspect ratio of the current window.</span>
    IF N_Elements(wAspectRatio) EQ 0 THEN wAspectRatio = FLOAT(!D.Y_VSIZE) / !D.X_VSIZE
    
    <span class="comments">; Calculate normalized positions in window.</span>
    IF (aspectRatio LE wAspectRatio) THEN BEGIN
       xstart = margin
       ystart = 0.5 - (0.5 - margin) * (aspectRatio / wAspectRatio)
       xend = 1.0 - margin
       yend = 0.5 + (0.5 - margin) * (aspectRatio / wAspectRatio)
    ENDIF ELSE BEGIN
       xstart = 0.5 - (0.5 - margin) * (wAspectRatio / aspectRatio)
       ystart = margin
       xend = 0.5 + (0.5 - margin) * (wAspectRatio / aspectRatio)
       yend = 1.0 - margin
    ENDELSE
    
    <span class="comments">; Calculate a window position in normalized coordinates.</span>
    position = [xstart, ystart, xend, yend]
    
    <span class="comments">; Return the position.</span>
    RETURN, position
    
END <span class="comments">; ----------------------------------------------------------------------------------</span>



FUNCTION PSWINDOW, $
    ASPECTRATIO=aspectRatio, $
    CM=cm, $
    EUROPEAN=european, $
    FUDGE=fudge, $
    LANDSCAPE=landscape, $
    MARGIN=margin, $
    METRIC=metric, $
    PAGESIZE=pagesize, $
    PRINTER=printer, $
    XFUDGE=xfudge, $
    YFUDGE=yfudge

    <span class="comments">; Depreciated keywords.</span>
    IF N_Elements(metric) EQ 0 THEN metric = Keyword_Set(european) ELSE metric = Keyword_Set(metric)

    <span class="comments">; Set up default values and check keywords.</span>
    IF Keyword_Set(metric) THEN BEGIN
        cm = 1
        pagesize = 'A4'
    ENDIF
    IF N_Elements(landscape) EQ 0 THEN BEGIN
        IF N_Elements(aspectRatio) NE 0 THEN BEGIN
            IF aspectRatio LT 1.0 THEN landscape = 1 ELSE landscape = 0
        ENDIF ELSE BEGIN
            IF !D.Y_VSIZE LT !D.X_VSIZE THEN landscape = 1
        ENDELSE
    ENDIF
    landscape = Keyword_Set(landscape)
    cm = Keyword_Set(cm)
    printer = Keyword_Set(printer)
    inches = 1 <span class="comments">; Work in inches until later.</span>
    
    <span class="comments">; Set up printer fudge factors, if necessary.</span>
    IF N_Elements(fudge) NE 0 THEN BEGIN
       xfudge = fudge
       yfudge = fudge
    ENDIF
    IF N_Elements(xfudge) EQ 0 THEN xfudge = 0.0
    IF N_Elements(yfudge) EQ 0 THEN yfudge = 0.0
    
    <span class="comments">; Get the page size.</span>
    IF N_Elements(pagesize) EQ 0 THEN pagesize = 'LETTER' $
       ELSE pagesize = StrUpCase(pagesize)
    CASE pagesize OF
       'LETTER': BEGIN
          shortside = 8.5
          longside = 11.0
          ENDCASE
       'LEGAL': BEGIN
          shortside = 8.5
          longside = 14.0
          ENDCASE
        'A4': BEGIN
          shortside = 8.27
          longside = 11.7
          ENDCASE
        ELSE: BEGIN
          Message, 'Unknown page size. Using LETTER...', /Informational
          shortside = 8.5
          longside = 11.0
          ENDCASE
    ENDCASE
    
    <span class="comments">; Need measurements in centimeters?</span>
    IF KEYWORD_SET(cm) THEN BEGIN
          shortside = shortside * 2.54
          longside = longside * 2.54
          inches = 0
    ENDIF
    
    <span class="comments">; Determine the margin of the window on the page.</span>
    IF N_ELEMENTS(margin) EQ 0 THEN margin=0.05
    
    <span class="comments">; Get the aspect ratio of the current display window if needed. Aspect ratio</span>
    <span class="comments">; is ratio of ysize/xsize.</span>
    IF N_Elements(aspectRatio) EQ 0 THEN aspectRatio = FLOAT(!D.Y_VSIZE) / !D.X_VSIZE
    
    <span class="comments">; Get the aspect ratio of the page.</span>
    IF Keyword_Set(landscape) THEN pAspectRatio = shortside / longside $
       ELSE pAspectRatio = longside / shortside
    
    <span class="comments">; Get the position on the page for this window.</span>
    pos = PSWindow_Aspect(aspectRatio, Margin=margin, WindowAspect=pAspectRatio)
    
    <span class="comments">; Convert normalized position coordinates to size units.</span>
    IF KEYWORD_SET(landscape) THEN BEGIN
       IF printer THEN BEGIN
          xsize = (pos[2] - pos[0]) * longside
          ysize = (pos[3] - pos[1]) * shortside
          yoffset = pos[1] * shortside - yfudge
          xoffset = pos[0] * longside - xfudge
          landscape = 1
          portrait = 0
       ENDIF ELSE BEGIN
          xsize = (pos[2] - pos[0]) * longside
          ysize = (pos[3] - pos[1]) * shortside
          xoffset = pos[1] * shortside
          yoffset = longside - (pos[0] * longside)
          landscape = 1
          portrait = 0
       ENDELSE
    ENDIF ELSE BEGIN
       xsize = (pos[2] - pos[0]) * shortside
       ysize = (pos[3] - pos[1]) * longside
       IF printer THEN BEGIN
          xoffset = pos[0] * shortside - xfudge
          yoffset = pos[1] * longside - yfudge
       ENDIF ELSE BEGIN
          xoffset = pos[0] * shortside
          yoffset = pos[1] * longside
       ENDELSE
       landscape = 0
       portrait = 1
    ENDELSE
    
    <span class="comments">; Return the proper DEVICE data structure.</span>
    RETURN, {PSWINDOW_STRUCT, XSIZE:xsize, YSIZE:ysize, $
       XOFFSET:xoffset, YOFFSET:yoffset, INCHES:inches, $
       PORTRAIT:portrait, LANDSCAPE:landscape}
    
END  <span class="comments">; ----------------------------------------------------------------------------------</span>
</code>
    </div>
  </body>
</html>