<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:56:41 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>error_message.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="error_message.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;    ERROR_MESSAGE</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;</span>
<span class="comments">;    The purpose of this function  is to have a device-independent</span>
<span class="comments">;    error messaging function. The error message is reported</span>
<span class="comments">;    to the user by using DIALOG_MESSAGE if widgets are</span>
<span class="comments">;    supported and MESSAGE otherwise.</span>
<span class="comments">;</span>
<span class="comments">;    In general, the ERROR_MESSAGE function is not called directly.</span>
<span class="comments">;    Rather, it is used in a CATCH error handler. Errors are thrown</span>
<span class="comments">;    to ERROR_MESSAGE with the MESSAGE command. A typical CATCH error</span>
<span class="comments">;    handler is shown below.</span>
<span class="comments">;</span>
<span class="comments">;       Catch, theError</span>
<span class="comments">;       IF theError NE 0 THEN BEGIN</span>
<span class="comments">;          Catch, /Cancel</span>
<span class="comments">;          void = Error_Message()</span>
<span class="comments">;          RETURN</span>
<span class="comments">;       ENDIF</span>
<span class="comments">;</span>
<span class="comments">;    Error messages would get into the ERROR_MESSAGE function by</span>
<span class="comments">;    throwing an error with the MESSAGE command, like this:</span>
<span class="comments">;</span>
<span class="comments">;       IF test NE 1 THEN Message, 'The test failed.'</span>
<span class="comments">;</span>
<span class="comments">; AUTHOR:</span>
<span class="comments">;</span>
<span class="comments">;   FANNING SOFTWARE CONSULTING</span>
<span class="comments">;   David Fanning, Ph.D.</span>
<span class="comments">;   1645 Sheely Drive</span>
<span class="comments">;   Fort Collins, CO 80526 USA</span>
<span class="comments">;   Phone: 970-221-0438</span>
<span class="comments">;   E-mail: david@idlcoyote.com</span>
<span class="comments">;   Coyote's Guide to IDL Programming: http://www.idlcoyote.com/</span>
<span class="comments">;</span>
<span class="comments">; CATEGORY:</span>
<span class="comments">;</span>
<span class="comments">;    Utility.</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;</span>
<span class="comments">;    ok = Error_Message(the_Error_Message)</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;</span>
<span class="comments">;    the_Error_Message: This is a string argument containing the error</span>
<span class="comments">;       message you want reported. If undefined, this variable is set</span>
<span class="comments">;       to the string in the !Error_State.Msg system variable.</span>
<span class="comments">;</span>
<span class="comments">; KEYWORDS:</span>
<span class="comments">;</span>
<span class="comments">;    ERROR: Set this keyword to cause Dialog_Message to use the ERROR</span>
<span class="comments">;       reporting dialog. Note that a bug in IDL causes the ERROR dialog</span>
<span class="comments">;       to be used whether this keyword is set to 0 or 1!</span>
<span class="comments">;</span>
<span class="comments">;    INFORMATIONAL: Set this keyword to cause Dialog_Message to use the</span>
<span class="comments">;       INFORMATION dialog instead of the WARNING dialog. Note that a bug</span>
<span class="comments">;       in IDL causes the ERROR dialog to be used if this keyword is set to 0!</span>
<span class="comments">;       </span>
<span class="comments">;    NONAME: Normally, the name of the routine in which the error occurs is</span>
<span class="comments">;       added to the error message. Setting this keyword will suppress this</span>
<span class="comments">;       behavior.</span>
<span class="comments">;</span>
<span class="comments">;    TITLE: Set this keyword to the title of the DIALOG_MESSAGE window. By</span>
<span class="comments">;       default the keyword is set to 'System Error' unless !ERROR_STATE.NAME</span>
<span class="comments">;       equals "IDL_M_USER_ERR", in which case it is set to "Trapped Error'.</span>
<span class="comments">;</span>
<span class="comments">;    TRACEBACK: Setting this keyword results in an error traceback</span>
<span class="comments">;       being printed to standard output with the PRINT command. Set to</span>
<span class="comments">;       1 (ON) by default. Use TRACEBACK=0 to turn this functionality off.</span>
<span class="comments">;       </span>
<span class="comments">;    QUIET: Set this keyword to suppress the DIALOG_MESSAGE pop-up dialog.</span>
<span class="comments">;</span>
<span class="comments">; OUTPUTS:</span>
<span class="comments">;</span>
<span class="comments">;    Currently the only output from the function is the string "OK".</span>
<span class="comments">;</span>
<span class="comments">; RESTRICTIONS:</span>
<span class="comments">;</span>
<span class="comments">;    The WARNING Dialog_Message dialog is used by default.</span>
<span class="comments">;</span>
<span class="comments">; EXAMPLE:</span>
<span class="comments">;</span>
<span class="comments">;    To handle an undefined variable error:</span>
<span class="comments">;</span>
<span class="comments">;    IF N_Elements(variable) EQ 0 THEN $</span>
<span class="comments">;       ok = Error_Message('Variable is undefined')</span>
<span class="comments">;</span>
<span class="comments">; MODIFICATION HISTORY:</span>
<span class="comments">;</span>
<span class="comments">;    Written by: David W. Fanning, 27 April 1999.</span>
<span class="comments">;    Added the calling routine's name in the message and NoName keyword. 31 Jan 2000. DWF.</span>
<span class="comments">;    Added _Extra keyword. 10 February 2000. DWF.</span>
<span class="comments">;    Forgot to add _Extra everywhere. Fixed for MAIN errors. 8 AUG 2000. DWF.</span>
<span class="comments">;    Adding call routine's name to Traceback Report. 8 AUG 2000. DWF.</span>
<span class="comments">;    Added ERROR, INFORMATIONAL, and TITLE keywords. 19 SEP 2002. DWF.</span>
<span class="comments">;    Removed the requirement that you use the NONAME keyword with the MESSAGE</span>
<span class="comments">;      command when generating user-trapped errors. 19 SEP 2002. DWF.</span>
<span class="comments">;    Added distinctions between trapped errors (errors generated with the</span>
<span class="comments">;      MESSAGE command) and IDL system errors. Note that if you call ERROR_MESSAGE</span>
<span class="comments">;      directly, then the state of the !ERROR_STATE.NAME variable is set</span>
<span class="comments">;      to the *last* error generated. It is better to access ERROR_MESSAGE</span>
<span class="comments">;      indirectly in a Catch error handler from the MESSAGE command. 19 SEP 2002. DWF.</span>
<span class="comments">;    Change on 19 SEP 2002 to eliminate NONAME requirement did not apply to object methods.</span>
<span class="comments">;      Fixed program to also handle messages from object methods. 30 JULY 2003. DWF.</span>
<span class="comments">;    Removed obsolete STR_SEP and replaced with STRSPLIT. 27 Oct 2004. DWF.</span>
<span class="comments">;    Made a traceback the default case without setting TRACEBACK keyword. 19 Nov 2004. DWF.</span>
<span class="comments">;    Added check for window connection specifically for CRON jobs. 6 May 2008. DWF.</span>
<span class="comments">;    Added QUIET keyword. 18 October 2008. DWF.</span>
<span class="comments">;    The traceback information was bypassed when in the PostScript device. Not what I</span>
<span class="comments">;      had in mind. Fixed. 6 July 2009. DWF.</span>
<span class="comments">;    The QUIET keyword was clearing traceback information. Fixed with help from Phillip Bitzer. 2 Oct 2012. DWF.</span>
<span class="comments">;-</span>
<span class="comments">;******************************************************************************************;</span>
<span class="comments">;  Copyright (c) 2008, by Fanning Software Consulting, Inc.                                ;</span>
<span class="comments">;  All rights reserved.                                                                    ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  Redistribution and use in source and binary forms, with or without                      ;</span>
<span class="comments">;  modification, are permitted provided that the following conditions are met:             ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;      * Redistributions of source code must retain the above copyright                    ;</span>
<span class="comments">;        notice, this list of conditions and the following disclaimer.                     ;</span>
<span class="comments">;      * Redistributions in binary form must reproduce the above copyright                 ;</span>
<span class="comments">;        notice, this list of conditions and the following disclaimer in the               ;</span>
<span class="comments">;        documentation and/or other materials provided with the distribution.              ;</span>
<span class="comments">;      * Neither the name of Fanning Software Consulting, Inc. nor the names of its        ;</span>
<span class="comments">;        contributors may be used to endorse or promote products derived from this         ;</span>
<span class="comments">;        software without specific prior written permission.                               ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  THIS SOFTWARE IS PROVIDED BY FANNING SOFTWARE CONSULTING, INC. ''AS IS'' AND ANY        ;</span>
<span class="comments">;  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES    ;</span>
<span class="comments">;  OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT     ;</span>
<span class="comments">;  SHALL FANNING SOFTWARE CONSULTING, INC. BE LIABLE FOR ANY DIRECT, INDIRECT,             ;</span>
<span class="comments">;  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED    ;</span>
<span class="comments">;  TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;         ;</span>
<span class="comments">;  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND             ;</span>
<span class="comments">;  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT              ;</span>
<span class="comments">;  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS           ;</span>
<span class="comments">;  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.                            ;</span>
<span class="comments">;******************************************************************************************;</span>
FUNCTION ERROR_MESSAGE, theMessage, Error=error, Informational=information, $
   Traceback=traceback, NoName=noname, Title=title, Quiet=quiet, _Extra=extra

   On_Error, 2
   
   <span class="comments">; Check for presence and type of message.</span>
   
   IF N_Elements(theMessage) EQ 0 THEN theMessage = !Error_State.Msg
   s = Size(theMessage)
   messageType = s[s[0]+1]
   IF messageType NE 7 THEN BEGIN
      Message, "The message parameter must be a string.", _Extra=extra
   ENDIF
   IF N_Elements(traceback) EQ 0 THEN traceback = 1
   
   <span class="comments">; Get the call stack and the calling routine's name.</span>
   Help, Calls=callStack
   callingRoutine = (StrSplit(StrCompress(callStack[1])," ", /Extract))[0]
   
   <span class="comments">; Are widgets supported?</span>
   IF !D.Name EQ 'PS' OR !D.Name EQ 'Z' THEN BEGIN
      widgetsSupported = 1
   ENDIF ELSE BEGIN
      widgetsSupported = ((!D.Flags AND 65536L) NE 0)
   ENDELSE

   <span class="comments">; Is the QUIET keyword set? Then no dialogs.</span>
   IF Keyword_Set(quiet) THEN widgetsSupported = 0
   
   <span class="comments">; It is not enough to know if widgets are supported. In CRON jobs, widgets are</span>
   <span class="comments">; supported, but there is no X connection and pop-up dialogs are not allowed.</span>
   <span class="comments">; Here is a quick test to see if we can connect to a windowing system. If not,</span>
   <span class="comments">; then we are going to assume widgets are not supported.</span>
   Catch, theError
   IF theError NE 0 THEN BEGIN
      Catch, /CANCEL
      widgetsSupported = 0
      GOTO, testWidgetSupport
   ENDIF
   theWindow = !D.Window
   IF (!D.Flags AND 256) NE 0 THEN Window, /FREE, XSIZE=5, YSIZE=5, /PIXMAP
   Catch, /CANCEL
   
   testWidgetSupport: <span class="comments">; Come here if you choke on creating a window.</span>
   IF !D.Window NE theWindow THEN BEGIN
      WDelete, !D.Window
      IF theWindow GE 0 THEN WSet, theWindow
   ENDIF
   
   IF widgetsSupported THEN BEGIN
   
      <span class="comments">; If this is an error produced with the MESSAGE command, it is a trapped</span>
      <span class="comments">; error and will have the name "IDL_M_USER_ERR".</span>
      IF !ERROR_STATE.NAME EQ "IDL_M_USER_ERR" THEN BEGIN
   
         IF N_Elements(title) EQ 0 THEN title = 'Trapped Error'
   
            <span class="comments">; If the message has the name of the calling routine in it,</span>
            <span class="comments">; it should be stripped out. Can you find a colon in the string?</span>
   
         <span class="comments">; Is the calling routine an object method? If so, special processing</span>
         <span class="comments">; is required. Object methods will have two colons together.</span>
         doublecolon = StrPos(theMessage, "::")
         IF doublecolon NE -1 THEN BEGIN
   
            prefix = StrMid(theMessage, 0, doublecolon+2)
            submessage = StrMid(theMessage, doublecolon+2)
            colon = StrPos(submessage, ":")
            IF colon NE -1 THEN BEGIN
   
               <span class="comments">; Extract the text up to the colon. Is this the same as</span>
               <span class="comments">; the callingRoutine? If so, strip it.</span>
               IF StrMid(theMessage, 0, colon+StrLen(prefix)) EQ callingRoutine THEN $
                  theMessage = StrMid(theMessage, colon+1+StrLen(prefix))
            ENDIF
         ENDIF ELSE BEGIN
   
            colon = StrPos(theMessage, ":")
            IF colon NE -1 THEN BEGIN
   
               <span class="comments">; Extract the text up to the colon. Is this the same as</span>
               <span class="comments">; the callingRoutine? If so, strip it.</span>
               IF StrMid(theMessage, 0, colon) EQ callingRoutine THEN $
                  theMessage = StrMid(theMessage, colon+1)
            ENDIF
   
         ENDELSE
   
   
         <span class="comments">; Add the calling routine's name, unless NONAME is set.</span>
         IF Keyword_Set(noname) THEN BEGIN
            answer = Dialog_Message(theMessage, Title=title, _Extra=extra, $
               Error=error, Information=information)
         ENDIF ELSE BEGIN
            answer = Dialog_Message(StrUpCase(callingRoutine) + ": " + $
               theMessage, Title=title, _Extra=extra, $
               Error=error, Information=information)
         ENDELSE
   
      ENDIF ELSE BEGIN
   
         <span class="comments">; Otherwise, this is an IDL system error.</span>
         IF N_Elements(title) EQ 0 THEN title = 'System Error'
   
         IF StrUpCase(callingRoutine) EQ "$MAIN$" THEN $
            answer = Dialog_Message(theMessage, _Extra=extra, Title=title, $
               Error=error, Information=information) ELSE $
         IF Keyword_Set(noname) THEN BEGIN
            answer = Dialog_Message(theMessage, _Extra=extra, Title=title, $
               Error=error, Information=information)
         ENDIF ELSE BEGIN
            answer = Dialog_Message(StrUpCase(callingRoutine) + "--> " + $
               theMessage, _Extra=extra, Title=title, $
               Error=error, Information=information)
         ENDELSE
      ENDELSE
   ENDIF ELSE BEGIN
         Help, /Last_Message, Output=traceback_msg <span class="comments">; Required because following MESSAGE call clears traceback info.</span>
         Message, theMessage, /Continue, /NoPrint, /NoName, /NoPrefix, _Extra=extra
         IF Keyword_Set(noname) THEN $
            Print, theMessage ELSE $
            Print, '%' + callingRoutine + ': ' + theMessage 
         answer = 'OK'
   ENDELSE
   
   <span class="comments">; Provide traceback information if requested and this is NOT an informational message.</span>
   IF Keyword_Set(traceback) AND ~Keyword_Set(informational)THEN BEGIN
      IF N_Elements(traceback_msg) NE 0 THEN traceback = traceback_msg ELSE Help, /Last_Message, Output=traceback
      Print,''
      Print, 'Traceback Report from ' + StrUpCase(callingRoutine) + ':'
      Print, ''
      FOR j=0,N_Elements(traceback)-1 DO Print, "     " + traceback[j]
   ENDIF
   
   RETURN, answer
END <span class="comments">; ----------------------------------------------------------------------------</span>

</code>
    </div>
  </body>
</html>