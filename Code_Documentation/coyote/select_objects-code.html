<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:12 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>select_objects.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="select_objects.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;       SELECT_OBJECTS</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;       The purpose of this program is to demonstrate how to select</span>
<span class="comments">;       and move objects in an object graphics window. Once the objects</span>
<span class="comments">;       appear in the window, use your mouse to select the objects and</span>
<span class="comments">;       move them in the window. The window is resizeable.</span>
<span class="comments">;</span>
<span class="comments">; AUTHOR:</span>
<span class="comments">;       FANNING SOFTWARE CONSULTING</span>
<span class="comments">;       David Fanning, Ph.D.</span>
<span class="comments">;       1645 Sheely Drive</span>
<span class="comments">;       Fort Collins, CO 80526 USA</span>
<span class="comments">;       Phone: 970-221-0438</span>
<span class="comments">;       E-mail: david@idlcoyote.com</span>
<span class="comments">;       Coyote's Guide to IDL Programming: http://www.idlcoyote.com</span>
<span class="comments">;</span>
<span class="comments">; CATEGORY:</span>
<span class="comments">;       Object Graphics.</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;       SELECT_OBJECTS</span>
<span class="comments">;</span>
<span class="comments">; REQUIRED INPUTS:</span>
<span class="comments">;       None.</span>
<span class="comments">;</span>
<span class="comments">; KEYWORD PARAMETERS:</span>
<span class="comments">;       None.</span>
<span class="comments">;</span>
<span class="comments">; COMMON BLOCKS:</span>
<span class="comments">;       None.</span>
<span class="comments">;</span>
<span class="comments">; SIDE EFFECTS:</span>
<span class="comments">;       None.</span>
<span class="comments">;</span>
<span class="comments">; RESTRICTIONS:</span>
<span class="comments">;       Requires VCOLORBAR from the Coyote Library:</span>
<span class="comments">;           http://www.idlcoyote.com/programs/vcolorbar__define.pro.</span>
<span class="comments">;</span>
<span class="comments">; EXAMPLE:</span>
<span class="comments">;       Select_Objects</span>
<span class="comments">;</span>
<span class="comments">; MODIFICATION HISTORY:</span>
<span class="comments">;       Written by David Fanning, 21 September 98.</span>
<span class="comments">;       Added the ability to shrink and expand the objects. 27 Sept 98. DWF.</span>
<span class="comments">;       Changed FSC_Normalize to cgNormalize to reflect new name. 6 Feb 2013. DWF.</span>
<span class="comments">;-</span>
<span class="comments">;******************************************************************************************;</span>
<span class="comments">;  Copyright (c) 2008, by Fanning Software Consulting, Inc.                                ;</span>
<span class="comments">;  All rights reserved.                                                                    ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  Redistribution and use in source and binary forms, with or without                      ;</span>
<span class="comments">;  modification, are permitted provided that the following conditions are met:             ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;      * Redistributions of source code must retain the above copyright                    ;</span>
<span class="comments">;        notice, this list of conditions and the following disclaimer.                     ;</span>
<span class="comments">;      * Redistributions in binary form must reproduce the above copyright                 ;</span>
<span class="comments">;        notice, this list of conditions and the following disclaimer in the               ;</span>
<span class="comments">;        documentation and/or other materials provided with the distribution.              ;</span>
<span class="comments">;      * Neither the name of Fanning Software Consulting, Inc. nor the names of its        ;</span>
<span class="comments">;        contributors may be used to endorse or promote products derived from this         ;</span>
<span class="comments">;        software without specific prior written permission.                               ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  THIS SOFTWARE IS PROVIDED BY FANNING SOFTWARE CONSULTING, INC. ''AS IS'' AND ANY        ;</span>
<span class="comments">;  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES    ;</span>
<span class="comments">;  OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT     ;</span>
<span class="comments">;  SHALL FANNING SOFTWARE CONSULTING, INC. BE LIABLE FOR ANY DIRECT, INDIRECT,             ;</span>
<span class="comments">;  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED    ;</span>
<span class="comments">;  TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;         ;</span>
<span class="comments">;  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND             ;</span>
<span class="comments">;  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT              ;</span>
<span class="comments">;  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS           ;</span>
<span class="comments">;  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.                            ;</span>
<span class="comments">;******************************************************************************************;</span>
PRO Select_Button_Events, event

<span class="comments">; This event handler responds to draw widget events.</span>

   <span class="comments">; Get the info structure.</span>

Widget_Control, event.top, Get_UValue=info

   <span class="comments">; What kind of an event is this?</span>

possibleEvents = ['DOWN', 'UP', 'MOTION', 'SCROLL', 'EXPOSE']
possibleButtons = ['NONE', 'LEFT', 'MIDDLE', 'NONE', 'RIGHT']
thisEvent = possibleEvents(event.type)
thisButton = possibleButtons(event.press)

   <span class="comments">; Do the right thing.</span>

CASE thisEvent OF

   'EXPOSE': info.thisWindow->Draw, info.thisView

   'DOWN': BEGIN

         <span class="comments">; Has the user selected an object?</span>

      item = info.thisWindow->Select(info.thisView, [event.x, event.y])

         <span class="comments">; Get the first (closest) object in the list of selected objects.</span>

      IF Obj_Valid(item[0]) THEN BEGIN

         item = item[0]

         CASE thisButton OF

               <span class="comments">; Move the selected object.</span>

            'LEFT': BEGIN

               <span class="comments">; Turn motion events ON. Record starting coordinates.</span>

            Widget_Control, info.drawID, Draw_Motion_Events=1
            info.xstart = event.x
            info.ystart = event.y

               <span class="comments">; Save the selected item. Get its name. Store it.</span>

            info.selectedItem = item
            info.selectedItem->GetProperty, Name=selectedName
            info.selectedName = selectedName

            Print, 'Object Selected: ', selectedName
            ENDCASE

               <span class="comments">; Shrink the selected object.</span>

            'RIGHT': BEGIN
               item->Scale, 0.95, 0.95, 1.00
               info.thisWindow->Draw, info.thisView
               ENDCASE

               <span class="comments">; Expand the selected object.</span>

            'MIDDLE': BEGIN
               item->Scale, 1.05, 1.05, 1.00
               info.thisWindow->Draw, info.thisView
               ENDCASE

            ENDCASE
      ENDIF ELSE Print, 'No Object Selected.'
         ENDCASE

   'UP': BEGIN

         <span class="comments">; Turn motion events OFF. Reinitialize selected object fields.</span>

      Widget_Control, info.drawID, Draw_Motion_Events=0, /Clear_Events
      info.selectedName = ''
      info.selectedItem = Obj_New()
      END

   'MOTION': BEGIN

            <span class="comments">; Calculate movement in normalized coordinates. Update start coords.</span>

         deltax = (event.x - info.xstart) / Float(info.xsize)
         deltay = (event.y - info.ystart) / Float(info.ysize)
         info.xstart = event.x
         info.ystart = event.y

            <span class="comments">; Translate the selected model.</span>

         info.selectedItem->Translate, deltax, deltay, 0

            <span class="comments">; Draw the view.</span>

         info.thisWindow->Draw, info.thisView

      END

  ELSE:

ENDCASE

   <span class="comments">; Store info structure.</span>

Widget_Control, event.top, Set_UValue=info
END
<span class="comments">;------------------------------------------------------------------------</span>



PRO Select_Cleanup, tlb

<span class="comments">; This procedure cleans up all the persistent objects.</span>

Widget_Control, tlb, Get_UValue=info
Obj_Destroy, info.thisContainer
END
<span class="comments">;------------------------------------------------------------------------</span>



PRO Select_Resize, event

<span class="comments">; This procedure resizes the graphics window.</span>

Widget_Control, event.top, Get_UValue=info, /No_Copy

   <span class="comments">; Resize the draw widget.</span>

Widget_Control, info.drawID, Draw_XSize=event.x, Draw_YSize=event.y

   <span class="comments">; Update the size fields in the info structure.</span>

info.xsize = event.x
info.ysize = event.y

   <span class="comments">; Redisplay the graphic.</span>

info.thisWindow->Draw, info.thisView

Widget_Control, event.top, Set_UValue=info, /No_Copy

END
<span class="comments">;------------------------------------------------------------------------</span>



PRO Select_Objects

<span class="comments">; This is an example program that shows you how to select</span>
<span class="comments">; and move objects in an object graphics window.</span>

   <span class="comments">; Load an image data file.</span>

filename = FilePath(SubDirectory=['examples', 'data'], 'worldelv.dat')
image = BytArr(360,360)
OpenR, lun, filename, /Get_Lun
ReadU, lun, image
Free_Lun, lun

   <span class="comments">; Create an object graphics display window.</span>

tlb = Widget_Base(Title='Object Selection Example', TLB_Size_Events=1, $
   Base_Align_Center=1, Column=1)
drawID = Widget_Draw(tlb, Button_Events=1, Expose_Events=1, $
   Retain=0, Graphics_Level=2, XSize=400, YSize=400, $
   Event_Pro='Select_Button_Events')
labelID = Widget_Label(tlb, $
   Value='Left Button: Drag.  Middle Button: Expand.  Right Button: Contract.')

   <span class="comments">; Realize the widgets. Get window object.</span>

Widget_Control, tlb, /Realize
Widget_Control, drawID, Get_Value=thisWindow

   <span class="comments">; Create the coordinate system for the window.</span>

thisView = Obj_New('IDLgrView', Viewplane_Rect=[0,0,1,1], Color=[100,100,100])

   <span class="comments">; Create a color palette for the image and colorbar.</span>

thisPalette = Obj_New('IDLgrPalette')
thisPalette->LoadCT, 5

   <span class="comments">; Create objects to be selected and moved in the window.</span>

thisImage = Obj_New('IDLgrImage', image, Palette=thisPalette)
thisImage->GetProperty, XRange=xrange, YRange=yrange
xs = cgNormalize(xrange, Position=[0.2, 0.9])
ys = cgNormalize(yrange, Position=[0.1, 0.8])
thisImage->SetProperty, XCoord_Conv=xs, YCoord_Conv=ys

thisColorbar = Obj_New('VColorbar', Palette=thisPalette, $
   Position=[0.10, 0.10, 0.15, 0.80], Color=[255,255,255], $
   Title='Color Range')

thisTitle = Obj_New('IDLgrText', 'World Elevation Data Set', $
   Location=[0.5, 0.9], Alignment=0.5, Color=[255,255,255])

   <span class="comments">; The easiest way to move objects in a window is to put</span>
   <span class="comments">; each object to be moved in its own model. The models</span>
   <span class="comments">; are easy to translate and move.</span>

   <span class="comments">; Create a model for each of the objects to be moved.</span>
   <span class="comments">; Make each model a selection target.</span>

imageModel = Obj_New('IDLgrModel', Name='IMAGE', Select_Target=1)
   imageModel->Add, thisImage
colorbarModel = Obj_New('IDLgrModel', Name='COLORBAR', Select_Target=1)
   colorbarModel->Add, thisColorbar
titleModel = Obj_New('IDLgrModel', Name='TITLE', Select_Target=1)
   titleModel->Add, thisTitle

   <span class="comments">; Add the models to the view.</span>

thisView->Add, imageModel
thisView->Add, colorbarModel
thisView->Add, titleModel

   <span class="comments">; Create a container for later cleanup.</span>

thisContainer = Obj_New('IDL_Container')
thisContainer->Add, thisView
thisContainer->Add, thisWindow
thisContainer->Add, thisPalette
thisContainer->Add, imageModel
thisContainer->Add, colorbarModel
thisContainer->Add, titleModel

   <span class="comments">; Select an ARROW cursor.</span>

thisWindow->SetCurrentCursor, 'Arrow'

   <span class="comments">; Create info structure to hold program information.</span>

info = { thisContainer:thisContainer, $    <span class="comments">; The graphics container.</span>
         thisWindow:thisWindow, $          <span class="comments">; The window object.</span>
         thisView:thisView, $              <span class="comments">; The view to be displayed in the window.</span>
         xstart:0, $                       <span class="comments">; The starting x coordinate in a drag action.</span>
         ystart:0, $                       <span class="comments">; The starting y coordinate in a drag action.</span>
         drawID:drawID, $                  <span class="comments">; The draw widget ID.</span>
         xsize:400, $                      <span class="comments">; The current X size of the draw widget.</span>
         ysize:400, $                      <span class="comments">; The current Y size of the draw widget.</span>
         selectedItem:Obj_New(),$          <span class="comments">; The selected object. Currently NULL.</span>
         selectedName:'' $                 <span class="comments">; The name of the selected object.</span>
       }

   <span class="comments">; Store the info structure in the UVALUE of the TLB.</span>

Widget_Control, tlb, Set_UValue=info
XManager, 'select', tlb, Cleanup='Select_Cleanup', /No_Block, $
   Event_Handler='Select_Resize'
END
</code>
    </div>
  </body>
</html>