<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:57:10 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>ps_start.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="ps_start.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">; docformat = 'rst'</span>
<span class="comments">;</span>
<span class="comments">; NAME:</span>
<span class="comments">;   PS_START</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;    The purpose of PS_START and PS_END is to make it easy to set-up</span>
<span class="comments">;    and close a PostScript file. These programs are used extensively</span>
<span class="comments">;    in all Coyote Graphics routines.</span>
<span class="comments">;******************************************************************************************;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  Copyright (c) 2011, by Fanning Software Consulting, Inc. All rights reserved.           ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  Redistribution and use in source and binary forms, with or without                      ;</span>
<span class="comments">;  modification, are permitted provided that the following conditions are met:             ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;      * Redistributions of source code must retain the above copyright                    ;</span>
<span class="comments">;        notice, this list of conditions and the following disclaimer.                     ;</span>
<span class="comments">;      * Redistributions in binary form must reproduce the above copyright                 ;</span>
<span class="comments">;        notice, this list of conditions and the following disclaimer in the               ;</span>
<span class="comments">;        documentation and/or other materials provided with the distribution.              ;</span>
<span class="comments">;      * Neither the name of Fanning Software Consulting, Inc. nor the names of its        ;</span>
<span class="comments">;        contributors may be used to endorse or promote products derived from this         ;</span>
<span class="comments">;        software without specific prior written permission.                               ;</span>
<span class="comments">;                                                                                          ;</span>
<span class="comments">;  THIS SOFTWARE IS PROVIDED BY FANNING SOFTWARE CONSULTING, INC. ''AS IS'' AND ANY        ;</span>
<span class="comments">;  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES    ;</span>
<span class="comments">;  OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT     ;</span>
<span class="comments">;  SHALL FANNING SOFTWARE CONSULTING, INC. BE LIABLE FOR ANY DIRECT, INDIRECT,             ;</span>
<span class="comments">;  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED    ;</span>
<span class="comments">;  TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;         ;</span>
<span class="comments">;  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND             ;</span>
<span class="comments">;  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT              ;</span>
<span class="comments">;  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS           ;</span>
<span class="comments">;  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.                            ;</span>
<span class="comments">;******************************************************************************************;</span>
<span class="comments">;</span>
<span class="comments">;+</span>
<span class="comments">; The purpose of PS_START and `PS_END` is to make it easy to set-up</span>
<span class="comments">; and close a PostScript file. These programs are used extensively</span>
<span class="comments">; in all Coyote Graphics routines.</span>
<span class="comments">;</span>
<span class="comments">; If `ImageMagick  &lt;http://www.imagemagick.org/script/index.php>` is installed </span>
<span class="comments">; on your computer, you can easily convert PostScript output to GIF, JPEG, PNG, and TIFF</span>
<span class="comments">; raster output. If `Ghostscript &lt;http://www.ghostscript.com/download/>` is installed</span>
<span class="comments">; you can convert PostScript output to PDF files. See the appropriate keywords to</span>
<span class="comments">; `PS_END`.</span>
<span class="comments">; </span>
<span class="comments">; When PS_START is called, the current graphics device is set to "PS" (the PostScript </span>
<span class="comments">; device). When PS_END is called the current graphics device is returned to the device</span>
<span class="comments">; in effect when PS_START was called.</span>
<span class="comments">; </span>
<span class="comments">; PS_Start uses the current display window as a template for the Postscript</span>
<span class="comments">; file. Thus, if the display window is wider than it is higher, output is</span>
<span class="comments">; in Landscape mode. To set the size of the PostScript "window" yourself, be</span>
<span class="comments">; sure to set the NOMATCH keyword to 1.</span>
<span class="comments">;       </span>
<span class="comments">; To display surface plots correctly the FONT keyword should be set to 1.</span>
<span class="comments">; Otherwise, the default font is 0, or hardware fonts when outputting to </span>
<span class="comments">; PostScript.</span>
<span class="comments">;</span>
<span class="comments">; You can easily configure any modifications you like for your PostScript output</span>
<span class="comments">; by setting fields in the plot and axis system variables (!P, !X, !Y, and !Z).</span>
<span class="comments">; The modifications currently made by default in this program are these::</span>
<span class="comments">;</span>
<span class="comments">;     !P.Thick = 3</span>
<span class="comments">;     !P.CharThick = 3</span>
<span class="comments">;     !X.Thick = 3</span>
<span class="comments">;     !Y.Thick = 3</span>
<span class="comments">;     !Z.Thick = 3</span>
<span class="comments">;     !P.Font = 0</span>
<span class="comments">;          </span>
<span class="comments">; The !P.Charsize variable is set differently on Windows computers, and depending</span>
<span class="comments">; on whether !P.MULTI is being used. On Windows the default is 1.25, or 1.00 for</span>
<span class="comments">; multiple plots. On other computers, the default is 1.5, or 1.25 for multiple plots.</span>
<span class="comments">; If true-type fonts are being used (FONT=1), the default is 1.5, or 1.25 for </span>
<span class="comments">; multiple plots.</span>
<span class="comments">;</span>
<span class="comments">; The PS_Start program contains the common block, _$FSC_PS_START_. See the FSC_PS_SETUP__DEFINE </span>
<span class="comments">; program in the Coyote Library for its definition.</span>
<span class="comments">; </span>
<span class="comments">; :Categories:</span>
<span class="comments">;    Utilities, Graphics</span>
<span class="comments">;    </span>
<span class="comments">; :Params:</span>
<span class="comments">;     filename: in, optional, type=string, default='idl.ps'</span>
<span class="comments">;        The name of the PostScript file created.</span>
<span class="comments">;    </span>
<span class="comments">; :Keywords:</span>
<span class="comments">;     cancel: out, optional, type=boolean, default=0</span>
<span class="comments">;         An output keyword that is set to 1 if the user cancelled from</span>
<span class="comments">;         PS_Config. Otherwise, set to 0.</span>
<span class="comments">;     charsize: in, optional, type=float</span>
<span class="comments">;         If this keyword is set, the !P.Charsize variable is set to this value until PS_END is called.</span>
<span class="comments">;     default_thickness: in, optional, type=integer, default=3</span>
<span class="comments">;         Sets the following system variables to this value while creating PostScript output:</span>
<span class="comments">;         !P.Thick, !P.CharThick, !X.Thick, !Y.Thick, !Z.Thick. These variables are returned to</span>
<span class="comments">;         their original values by `PS_End`. A system variable is set to this value only if it </span>
<span class="comments">;         currently contains the IDL default value of 0.0. If it is set to anything else, this </span>
<span class="comments">;         default thickness value is ignored.</span>
<span class="comments">;     dejavusans: in, optional, type=boolean, default=0</span>
<span class="comments">;         Set this keyword to select the DejaVuSans true-type font for PostScript output.</span>
<span class="comments">;         This option is ONLY available in IDL 8.2 or higher and/or you have installed the</span>
<span class="comments">;         DejaVuSans true-type font in your font directory.</span>
<span class="comments">;     filename: in, optional, type=string, default='idl.ps'</span>
<span class="comments">;         The name of the PostScript file created. An alternative, and older, way of setting</span>
<span class="comments">;         the `filename` parameter.</span>
<span class="comments">;     font: in, optional, type=integer, default=0                </span>
<span class="comments">;         Set this to the type of font you want. A -1 selects Hershey fonts, a 0 selects hardware </span>
<span class="comments">;         fonts (Helvetica, normally), and a 1 selects a True-Type font. Set to 0 by default.</span>
<span class="comments">;     encapsulated: in, optional, type=boolean, default=0</span>
<span class="comments">;         Set this keyword to produce encapsulated PostScript output.</span>
<span class="comments">;     gui: in, optional, type=boolean, default=0</span>
<span class="comments">;         The default behavior is to use PSCONFIG to configure the PostScript device silently. </span>
<span class="comments">;         If you wish to allow the user to interatively configure the PostScript device, set this</span>
<span class="comments">;         keyword.</span>
<span class="comments">;     keywords: out, optional, type=structure                </span>
<span class="comments">;         This output keyword contains the keyword structure returned from PS_Config.</span>
<span class="comments">;     landscape: in, optional, type=boolean, default=0</span>
<span class="comments">;         Set this keyword to produce landscape PostScript output.</span>
<span class="comments">;     nomatch: in, optional, type=boolean, default=0                </span>
<span class="comments">;         Normally, PS_Start will try to "match" the aspect ratio of the PostScript file "window" </span>
<span class="comments">;         to the current display window. If this keyword is set, then this doesn't occur, giving </span>
<span class="comments">;         the user the option of specifying the size and offsets of the PostScript window directly </span>
<span class="comments">;         though appropriate keywords.</span>
<span class="comments">;     quiet: in, optional, type=boolean, default=0</span>
<span class="comments">;         If set, informational messages are not set. </span>
<span class="comments">;     scale_factor: in, optional, type=float, default=1.0</span>
<span class="comments">;         Set this to the PostScript scale factor. By default: 1.</span>
<span class="comments">;     tt_font: in, optional, type=string</span>
<span class="comments">;         The name of a true-type font to use. Using this keyword sets `Font` to 1.</span>
<span class="comments">;     _ref_extra: in, optional</span>
<span class="comments">;         Any keyword appropriate for the PostScript configuration program PSConfig, from</span>
<span class="comments">;         the Coyote Library can be used with PS_Start.</span>
<span class="comments">;              </span>
<span class="comments">; :Examples:</span>
<span class="comments">;    To create a line plot in a PostScript file named lineplot.ps and</span>
<span class="comments">;    also create a PNG file named lineplot.png for display in a browser,</span>
<span class="comments">;    type these commands::</span>
<span class="comments">;</span>
<span class="comments">;        PS_Start, FILENAME='lineplot.ps'</span>
<span class="comments">;        cgPlot, Findgen(11), COLOR='navy', /NODATA, XTITLE='Time', YTITLE='Signal'</span>
<span class="comments">;        cgPlot, Findgen(11), COLOR='indian red', /OVERPLOT</span>
<span class="comments">;        cgPlot, Findgen(11), COLOR='olive', PSYM=2, /OVERPLOT</span>
<span class="comments">;        PS_End, /PNG</span>
<span class="comments">;       </span>
<span class="comments">; :Author:</span>
<span class="comments">;       FANNING SOFTWARE CONSULTING::</span>
<span class="comments">;           David W. Fanning </span>
<span class="comments">;           1645 Sheely Drive</span>
<span class="comments">;           Fort Collins, CO 80526 USA</span>
<span class="comments">;           Phone: 970-221-0438</span>
<span class="comments">;           E-mail: david@idlcoyote.com</span>
<span class="comments">;           Coyote's Guide to IDL Programming: http://www.idlcoyote.com</span>
<span class="comments">;</span>
<span class="comments">; :History:</span>
<span class="comments">;     Change History::</span>
<span class="comments">;       Written by: David W. Fanning, 20 May 2008.</span>
<span class="comments">;       Slight modification to allow filenames with spaces in them.</span>
<span class="comments">;       Added NoMatch keyword. 17 March 2009. DWF.</span>
<span class="comments">;       Added a number of keywords to make these commands more configurable. 19 March 2009. DWF.</span>
<span class="comments">;       Only set thickness system variables if starting system variables are set to their</span>
<span class="comments">;           default values (namely, 0). This allows users to set their own system variables</span>
<span class="comments">;           before they call PS_START, rather than after. 23 March  2009. DWF.</span>
<span class="comments">;       Moved PS_END to its own file to allow the IDLExBr_Assistant to work properly. 7 April 2009. DWF.</span>
<span class="comments">;       Modified to allow PostScript page type to be stored for future processing with cgFixPS. 9 August 2009. DWF.</span>
<span class="comments">;       Added NoFix keyword to PS_END calls to repair previous, but unused set-ups. 1 Nov 2010. DWF.</span>
<span class="comments">;       Added Charsize keyword to PS_START. 14 Nov 2010. DWF.</span>
<span class="comments">;       Changed the way default character sizes are set. 19 Nov 2010. DWF.</span>
<span class="comments">;       Added CANCEL and KEYWORDS output keywords. 16 Jan 2011. DWF.</span>
<span class="comments">;       Changes to handle inability to create raster files from PS encapsulated files in </span>
<span class="comments">;           landscape mode. 26 Aug 2011. DWF.</span>
<span class="comments">;       The SCALE_FACTOR is called at the time the PostScript file is opened to avoid problems</span>
<span class="comments">;           with the bounding box not being set to the correct values. 26 October 2011. DWF.</span>
<span class="comments">;       Created a DEFAULT_THICKNESS keyword to set the default thicknesses of PostScript </span>
<span class="comments">;           system variables. 14 Dec 2011. DWF.</span>
<span class="comments">;       Moved the true-type font set-up to *after* changing the graphics device to PostScript. 10 Jan 2012. DWF.</span>
<span class="comments">;       Added DejaVuSans keyword to allow this true-type font to be used in PostScript Output. 21 Dec 2012. DWF.</span>
<span class="comments">;       Modified so that the PostScript device can keep a consistent interface when using True-Type</span>
<span class="comments">;          fonts. Requires using cgSet_TTFont to select True-Type fonts. 22 May 2013. DWF.</span>
<span class="comments">;       </span>
<span class="comments">; :Copyright:</span>
<span class="comments">;     Copyright (c) 2008-2013, Fanning Software Consulting, Inc.</span>
<span class="comments">;-</span>
PRO PS_START, filename, $
    CANCEL=cancelled, $
    CHARSIZE=charsize, $
    DEFAULT_THICKNESS=default_thickness, $
    DEJAVUSANS=dejavusans, $
    FILENAME=ps_filename, $
    FONT=font , $
    ENCAPSULATED=encapsulated, $
    GUI=gui, $
    KEYWORDS=keywords, $
    LANDSCAPE=landscape, $
    NOMATCH=nomatch, $
    QUIET=quiet, $
    SCALE_FACTOR=scale_factor, $
    TT_FONT=tt_font, $
   _REF_EXTRA=extra
 
   COMMON _$FSC_PS_START_, ps_struct
   
   <span class="comments">; Handle the filename parameter and keywords.</span>
   IF N_Elements(filename) EQ 0 THEN filename = 'idl.ps'
   IF N_Elements(ps_filename) EQ 0 THEN ps_filename = filename 
      
   <span class="comments">; Need DejaVuSans fonts?</span>
   IF Keyword_Set(dejavusans) && (Float(!Version.Release) GE 8.2) THEN BEGIN
      tt_font = 'DejaVuSans'
      font = 1
   ENDIF
   
   <span class="comments">; Define the PS structure.</span>
   IF N_Elements(ps_struct) EQ 0 THEN ps_struct = {FSC_PS_SETUP}
   
   <span class="comments">; Save the current True-Type font before entering the PostScript device.</span>
   <span class="comments">; Necessary for restoring it later.</span>
   cgWindow_GetDefs, PS_TT_FONT=ps_tt_font
   ps_struct.tt_font_old = ps_tt_font
   
   <span class="comments">; PostScript hardware fonts by default.</span>
   SetDefaultValue, font, 0
   ps_struct.font = font
   
   <span class="comments">; Store the current true-type font.</span>
   IF N_Elements(tt_font) NE 0 THEN BEGIN
        ps_struct.tt_font = tt_font
        font = 1
   ENDIF
   
   gui = Keyword_Set(gui)
   quiet = Keyword_Set(quiet)
   
   <span class="comments">; Handle keywords appropriately.</span>
   SetDefaultValue, default_thickness, 3
   encapsulated = Keyword_Set(encapsulated)
   landscape = Keyword_Set(landscape)
   IF encapsulated THEN landscape = 0
   SetDefaultValue, scale_factor, 1

   <span class="comments">; If the setup flag is on, then we have to close the previous</span>
   <span class="comments">; start command before we can continue.</span>
   IF ps_struct.setup EQ 1 THEN PS_END, /NoFix, /NoMessage
   
   <span class="comments">; Save current setup information in the PS_STRUCT structure.</span>
   ps_struct.setup = 1
   ps_struct.currentDevice = !D.Name
   ps_struct.p = !P
   ps_struct.x = !X
   ps_struct.y = !Y
   ps_struct.z = !Z
   
   <span class="comments">; Change any parameters you feel like changing.</span>
   IF ps_struct.p.thick EQ 0 THEN !P.Thick = default_thickness
   IF ps_struct.p.charthick EQ 0 THEN !P.Charthick = default_thickness
   IF ps_struct.p.charsize EQ 0 THEN BEGIN
        IF N_Elements(charsize) EQ 0 THEN BEGIN
            !P.Charsize = cgDefCharsize(FONT=font)
        ENDIF ELSE !P.Charsize = charsize
   ENDIF ELSE BEGIN
        IF N_Elements(charsize) NE 0 THEN !P.Charsize = charsize
   ENDELSE
   IF ps_struct.x.thick EQ 0 THEN !X.Thick = default_thickness
   IF ps_struct.y.thick EQ 0 THEN !Y.Thick = default_thickness
   IF ps_struct.z.thick EQ 0 THEN !Z.Thick = default_thickness
   
   <span class="comments">; Set the true-type font.</span>
   thisWindow = !D.Window
   IF thisWindow EQ -1 AND ((!D.Flags AND 256) NE 0) THEN BEGIN
        Window, /FREE, /PIXMAP
        pixmap = !D.Window
   ENDIF
   !P.Font = font 
   IF N_Elements(pixmap) NE 0 THEN WDelete, pixmap

   <span class="comments">; Configure the PostScript Device</span>
   cancelled = 0
   IF ~Keyword_Set(nomatch) THEN BEGIN
      IF !D.X_Size GT !D.Y_Size THEN landscape = 1 ELSE landscape = 0
      IF Keyword_Set(encapsulated) THEN landscape = 0
      sizes = PSWindow(_Extra=extra, LANDSCAPE=landscape)
      keywords = PSConfig(_Strict_Extra=extra, INCHES=sizes.inches, XSIZE=sizes.xsize, YSIZE=sizes.ysize, $
         XOFFSET=sizes.xoffset, YOFFSET=sizes.yoffset, Cancel=cancelled, NOGUI=(~gui), $
         LANDSCAPE=sizes.landscape, ENCAPSULATED=encapsulated, FILENAME=ps_filename[0])
   ENDIF ELSE BEGIN
      keywords = PSConfig(_Strict_Extra=extra, ENCAPSULATED=encapsulated, $
          LANDSCAPE=landscape, CANCEL=cancelled, NOGUI=(~gui), FILENAME=ps_filename[0])
   ENDELSE
   IF cancelled THEN BEGIN
        PS_END, /NoFix, /NoMessage
        RETURN
   ENDIF
   
   <span class="comments">; Let them know where the output will be.</span>
   IF ~quiet THEN Print, 'PostScript output will be created here: ', keywords.filename
   
   Set_Plot, 'PS'
   Device, _EXTRA=keywords, SCALE_FACTOR=scale_factor
   IF N_Elements(tt_font) NE 0 THEN Device, Set_Font=tt_font, /TT_Font
   
   <span class="comments">; Store filename and other pertinent information.</span>
   ps_struct.filename = keywords.filename
   ps_struct.encapsulated = keywords.encapsulated
   ps_struct.landscape = Fix(keywords.landscape)
   ps_struct.pagetype = keywords.pagetype
   ps_struct.quiet = Fix(quiet)
 
END
</code>
    </div>
  </body>
</html>