<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Mon Sep 30 16:55:25 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>bundle.pro (Documentation for ./)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="bundle.pro (Documentation for ./)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">; PRO bundle</span>

READ_JPEG, '../plots_tables_images/Bundles/DSC02928.jpg', jim
wim = READ_TIFF('../plots_tables_images/Bundles/DSC02928.tiff')
im = rotate(reform(wim[0,*,*]),7)
jim = reform(jim[0,*,*])

<span class="comments">; bc = ((a[1000:2600,1300:1700]) lt 10)</span>
<span class="comments">; c = (a[1000:2600,1300:1700])*bc</span>

<span class="comments">; mc = 200*morph_close(c,replicate(1,3,3))</span>

<span class="comments">; cgimage,bc,/k,/display</span>
<span class="comments">; cgimage,shift_diff(bc,direction=1),/k,/display</span>
<span class="comments">; cgimage,laplacian(c),/k,/display</span>
<span class="comments">; cgimage,mc,/k,/display</span>
<span class="comments">; cgimage,200*morph_close(mc,replicate(1,3,3)),/k,/display</span>
<span class="comments">; cgimage,200*a[1000:2600,1300:1700]*(a[1000:2600,1300:1700] lt 10),/k,/display</span>
<span class="comments">; cgimage,((a[1000:2600,1300:1700]) gt 50)*(a[1000:2600,1300:1700]),/k</span>



<span class="comments">; b = (a[1000:2600,1300:1700] lt 10)</span>

<span class="comments">; xx = where(total(b,1) gt 1000) ; = rows where more than 1500 pixels are a 'slat'</span>

<span class="comments">; d=b</span>
<span class="comments">; d[*,xx]=100</span>
<span class="comments">; cgimage,d,/k,/display</span>
<span class="comments">; cgimage,b*a[1000:2600,1300:1700],/k,/display</span>

<span class="comments">; the problem with this is that the slats need to be aligned, when nicole said to draw lines on the edge of the slats, probably didn't mean to mask it?</span>





fftransform = FFT(im[1000:2600,1300:1700],/center)
power = abs(fftransform)^2
scaledpower = alog10(power)

scaledpowerto0 = scaledpower - max(scaledpower)

<span class="comments">; s3 = surface(scaledpowerto0)</span>

mask = real_part(scaledpowerto0) gt -7

maskedtransform = fftransform*mask

it = real_part(FFT(maskedtransform,/inverse,/center))

<span class="comments">; so doing an inverse FFT to filter out noise is awesome.</span>

<span class="comments">; so we get rid of weird artifacts at edges</span>
rim = (im[1000:2600,1300:1700])[15:1585,15:385]
www = fltarr(size(rim,/dim))
nit = it[15:1585,15:385]

<span class="comments">; window,0</span>
<span class="comments">; cgimage,nit,/k</span>



nitmask = 200*(nit lt 5000) <span class="comments">;was 20 for jpeg, TIFF uses floats</span>
<span class="comments">; cgimage,nitmask,/k</span>


begp = !null
endp = !null

for i = 0,(size(nit,/dim))[0] -1 do begin
    a = where(nitmask[i,*] gt 100)
    begp = [ [begp], [a[where(a - shift(a,1) ne 1)]] ]
    endp = [ [endp], [a[where(a - shift(a,-1) ne -1)]] ]
endfor


for i = 0,(size(begp,/dim))[0]-1 do begin
    line = linfit(findgen((size(begp,/dim))[1]),begp[i,*],yfit=begyfit)
    line = linfit(findgen((size(begp,/dim))[1]),endp[i,*],yfit=endyfit)

<span class="comments">; ps_start,filename='edgefit0.eps',/encap</span>
<span class="comments">; plot,begp[0,*],xs=3,ys=3,title='Distance of edge of slat from edge of image',yr=[24,38]</span>
<span class="comments">; oplot,begyfit,color=!red</span>
<span class="comments">; legend,['Slat Edge Position','Fitted Edge'],linestyle=[0,0],color=[!black,!red],/bottom,/right</span>
<span class="comments">; ps_end</span>

<span class="comments">; line = linfit(findgen((size(begp,/dim))[1]),begp[1,*],yfit=begyfit)</span>

<span class="comments">; ps_start,filename='edgefit1.eps',/encap</span>
<span class="comments">; plot,begp[1,*],xs=3,ys=3,title='Another slat',yr=[72,85]</span>
<span class="comments">; oplot,begyfit,color=!red</span>
<span class="comments">; legend,['Slat Edge Position','Fitted Edge'],linestyle=[0,0],color=[!black,!red],/bottom,/right</span>
<span class="comments">; ps_end</span>

<span class="comments">; !p.multi=[0,1,2]</span>
<span class="comments">; ps_start,filename='findedge.eps',/encap,xsize=18,ysize=6</span>
<span class="comments">; plot,nit[0,*],xs=3</span>
<span class="comments">; plot,nitmask[0,*],xs=3</span>
<span class="comments">; ps_end</span>
<span class="comments">; !p.multi=0</span>
<span class="comments">; stop</span>
    for j =0,(size(nitmask,/dim))[0]-1 do begin
        nitmask[j,begyfit[j]]=!red
        nitmask[j,endyfit[j]]=!green

        <span class="comments">; To make lines thicker</span>
        <span class="comments">; nitmask[j,begyfit[j]-1:begyfit[j]+1]=!red</span>
        <span class="comments">; nitmask[j,endyfit[j]-1:endyfit[j]+1]=!green</span>

        www[j,begyfit[j]]=!red
        www[j,endyfit[j]]=!green
    endfor
endfor



<span class="comments">; This isn't exactly on the edge because it's a fit</span>
cgimage,rim+www,/k
stop


<span class="comments">; This IS the edge</span>
aaa = (shift_diff(nit,dir=1) gt 10)*!green
cgimage,aaa+rim,/k




stop
END
</code>
    </div>
  </body>
</html>